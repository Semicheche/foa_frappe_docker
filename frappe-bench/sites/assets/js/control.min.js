!function(){"use strict";frappe._.get_data_uri=function(t){var e=$(t),i=e.width(),a=e.height(),n=$("<canvas/>");return n[0].width=i,n[0].height=a,n[0].getContext("2d").drawImage(e[0],0,0,i,a),n[0].toDataURL("image/png")},frappe.ui.Capture=function(){function t(t){void 0===t&&(t={}),this.options=frappe.ui.Capture.OPTIONS,this.set_options(t)}return t.prototype.set_options=function(t){return this.options=Object.assign({},frappe.ui.Capture.OPTIONS,t),this},t.prototype.render=function(){var t=this;return navigator.mediaDevices.getUserMedia({video:!0}).then(function(e){t.dialog=new frappe.ui.Dialog({title:t.options.title,animate:t.options.animate,action:{secondary:{label:"<b>&times</b>"}}});var i=$(frappe.ui.Capture.TEMPLATE),a=i.find("video")[0];a.srcObject=e,a.play(),$(t.dialog.body).html(i),i.find(".fc-btf").hide(),i.find(".fc-bcp").click(function(){var t=frappe._.get_data_uri(a);i.find(".fc-p").attr("src",t),i.find(".fc-s").hide(),i.find(".fc-p").show(),i.find(".fc-btu").hide(),i.find(".fc-btf").show()}),i.find(".fc-br").click(function(){i.find(".fc-p").hide(),i.find(".fc-s").show(),i.find(".fc-btf").hide(),i.find(".fc-btu").show()}),i.find(".fc-bs").click(function(){var e=frappe._.get_data_uri(a);t.hide(),t.callback&&t.callback(e)})})},t.prototype.show=function(){var t=this;this.render().then(function(){t.dialog.show()}).catch(function(e){if(t.options.error){var i='<span class="indicator red"/> '+frappe.ui.Capture.ERR_MESSAGE;frappe.show_alert(i,3)}throw e})},t.prototype.hide=function(){this.dialog&&this.dialog.hide()},t.prototype.submit=function(t){this.callback=t},t}(),frappe.ui.Capture.OPTIONS={title:__("Camera"),animate:!1,error:!1},frappe.ui.Capture.ERR_MESSAGE=__("Unable to load camera."),frappe.ui.Capture.TEMPLATE='\n<div class="frappe-capture">\n\t<div class="panel panel-default">\n\t\t<img class="fc-p img-responsive"/>\n\t\t<div class="fc-s  embed-responsive embed-responsive-16by9">\n\t\t\t<video class="embed-responsive-item">'+frappe.ui.Capture.ERR_MESSAGE+'</video>\n\t\t</div>\n\t</div>\n\t<div>\n\t\t<div class="fc-btf">\n\t\t\t<div class="row">\n\t\t\t\t<div class="col-md-6">\n\t\t\t\t\t<div class="pull-left">\n\t\t\t\t\t\t<button class="btn btn-default fc-br">\n\t\t\t\t\t\t\t<small>'+__("Retake")+'</small>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-md-6">\n\t\t\t\t\t<div class="pull-right">\n\t\t\t\t\t\t<button class="btn btn-primary fc-bs">\n\t\t\t\t\t\t\t<small>'+__("Submit")+'</small>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="fc-btu">\n\t\t\t<div class="row">\n\t\t\t\t<div class="col-md-6">\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t\t<div class="col-md-6">\n\t\t\t\t\t<div class="pull-right">\n\t\t\t\t\t\t<button class="btn btn-default fc-bcp">\n\t\t\t\t\t\t\t<small>'+__("Take Photo")+"</small>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n",frappe.ui.form.make_control=function(t){var e="Control"+t.df.fieldtype.replace(/ /g,"");if(frappe.ui.form[e])return new frappe.ui.form[e](t);console.log("Invalid Control Name: "+t.df.fieldtype)},frappe.ui.form.Control=Class.extend({init:function(t){$.extend(this,t),this.make(),frappe.boot.user&&"Administrator"===frappe.boot.user.name&&1===frappe.boot.developer_mode&&this.$wrapper&&this.$wrapper.attr("title",__(this.df.fieldname)),this.render_input&&this.refresh()},make:function(){this.make_wrapper(),this.$wrapper.attr("data-fieldtype",this.df.fieldtype).attr("data-fieldname",this.df.fieldname),this.wrapper=this.$wrapper.get(0),this.wrapper.fieldobj=this},make_wrapper:function(){this.$wrapper=$("<div class='frappe-control'></div>").appendTo(this.parent),this.wrapper=this.$wrapper},toggle:function(t){this.df.hidden=t?0:1,this.refresh()},get_status:function(t){if(this.df.get_status)return this.df.get_status(this);if(!this.doctype&&!this.docname)return cint(this.df.hidden)?(t&&console.log("By Hidden: None"),"None"):cint(this.df.hidden_due_to_dependency)?(t&&console.log("By Hidden Dependency: None"),"None"):cint(this.df.read_only)?(t&&console.log("By Read Only: Read"),"Read"):"Write";var e=frappe.perm.get_field_display_status(this.df,frappe.model.get_doc(this.doctype,this.docname),this.perm||this.frm&&this.frm.perm,t);return this.doctype&&"Read"===e&&!this.only_input&&is_null(frappe.model.get_value(this.doctype,this.docname,this.df.fieldname))&&!in_list(["HTML","Image"],this.df.fieldtype)&&(t&&console.log("By Hide Read-only, null fields: None"),e="None"),e},refresh:function(){this.disp_status=this.get_status(),this.$wrapper&&this.$wrapper.toggleClass("hide-control","None"==this.disp_status)&&this.refresh_input&&this.refresh_input();var t=this.get_value();this.show_translatable_button(t)},show_translatable_button:function(t){var e=this;if(frappe.model&&frappe.model.can_write("Translation")&&this.frm&&this.doc&&this.df.translatable&&t&&frappe.views&&frappe.views.TranslationManager&&!this.$wrapper.find(".clearfix .btn-translation").length){var i='<a class="btn-translation no-decoration text-muted" title="'+__("Open Translation")+'">\n\t\t\t\t<i class="fa fa-globe"></i>\n\t\t\t</a>';$(i).appendTo(this.$wrapper.find(".clearfix")).on("click",function(){e.doc.__islocal||new frappe.views.TranslationManager({df:e.df,source_name:t,target_language:e.doc.language,doc:e.doc})})}},get_doc:function(){return this.doctype&&this.docname&&locals[this.doctype]&&locals[this.doctype][this.docname]||{}},get_model_value:function(){if(this.doc)return this.doc[this.df.fieldname]},set_value:function(t){return this.validate_and_set_in_model(t)},parse_validate_and_set_in_model:function(t,e){return this.parse&&(t=this.parse(t)),this.validate_and_set_in_model(t,e)},validate_and_set_in_model:function(t,e){var i=this;if(this.inside_change_event)return Promise.resolve();this.inside_change_event=!0;var a=function(t){return i.inside_change_event=!1,frappe.run_serially([function(){return i.set_model_value(t)},function(){if(i.set_mandatory&&i.set_mandatory(t),i.df.change||i.df.onchange)return(i.df.change||i.df.onchange).apply(i,[e])}])};return(t=this.validate(t))&&t.then?t.then(function(t){return a(t)}):a(t)},get_value:function(){return"Write"===this.get_status()?this.get_input_value?this.parse?this.parse(this.get_input_value()):this.get_input_value():void 0:this.value||void 0},set_model_value:function(t){return this.doctype&&this.docname?(this.last_value=t,frappe.model.set_value(this.doctype,this.docname,this.df.fieldname,t,this.df.fieldtype)):(this.doc&&(this.doc[this.df.fieldname]=t),this.set_input(t),Promise.resolve())},set_focus:function(){if(this.$input)return this.$input.get(0).focus(),!0}}),frappe.ui.form.ControlInput=frappe.ui.form.Control.extend({horizontal:!0,make:function(){this._super(),this.set_input_areas(),this.set_max_width()},make_wrapper:function(){this.only_input?this.$wrapper=$('<div class="form-group frappe-control">').appendTo(this.parent):this.$wrapper=$('<div class="frappe-control">\t\t\t\t<div class="form-group">\t\t\t\t\t<div class="clearfix">\t\t\t\t\t\t<label class="control-label" style="padding-right: 0px;"></label>\t\t\t\t\t</div>\t\t\t\t\t<div class="control-input-wrapper">\t\t\t\t\t\t<div class="control-input"></div>\t\t\t\t\t\t<div class="control-value like-disabled-input" style="display: none;"></div>\t\t\t\t\t\t<p class="help-box small text-muted hidden-xs"></p>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t</div>').appendTo(this.parent)},toggle_label:function(t){this.$wrapper.find(".control-label").toggleClass("hide",!t)},toggle_description:function(t){this.$wrapper.find(".help-box").toggleClass("hide",!t)},set_input_areas:function(){this.only_input?this.input_area=this.wrapper:(this.label_area=this.label_span=this.$wrapper.find("label").get(0),this.input_area=this.$wrapper.find(".control-input").get(0),this.$input_wrapper=this.$wrapper.find(".control-input-wrapper"),this.disp_area=this.$wrapper.find(".control-value").get(0))},set_max_width:function(){this.horizontal&&this.$wrapper.addClass("input-max-width")},refresh_input:function(){var t=this,e=function(){t.has_input||(t.make_input(),t.df.on_make&&t.df.on_make(t))},i=function(){t.doctype&&t.docname?t.set_input(t.value):t.set_input(t.value||null)};"None"!=t.disp_status&&(t.doctype&&t.docname&&(t.value=frappe.model.get_value(t.doctype,t.docname,t.df.fieldname)),"Write"==t.disp_status?(t.disp_area&&$(t.disp_area).toggle(!1),$(t.input_area).toggle(!0),t.$input&&t.$input.prop("disabled",!1),e(),i()):(t.only_input?(e(),i()):($(t.input_area).toggle(!1),t.disp_area&&(t.set_disp_area(t.value),$(t.disp_area).toggle(!0))),t.$input&&t.$input.prop("disabled",!0)),t.set_description(),t.set_label(),t.set_mandatory(t.value),t.set_bold())},set_disp_area:function(t){t=!in_list(["Currency","Int","Float"],this.df.fieldtype)||0!==this.value&&0!==t?this.value||t:0,this.disp_area&&$(this.disp_area).html(frappe.format(t,this.df,{no_icon:!0,inline:!0},this.doc||this.frm&&this.frm.doc))},bind_change_event:function(){var t=this;this.$input&&this.$input.on("change",this.change||function(e){t.parse_validate_and_set_in_model(t.get_input_value(),e)})},bind_focusout:function(){if(frappe.dom.is_touchscreen()){var t=this;this.$input&&this.$input.on("focusout",function(){frappe.dom.is_touchscreen()&&frappe.utils.scroll_to(t.$wrapper)})}},set_label:function(t){if(t&&(this.df.label=t),!this.only_input&&this.df.label!=this._label){this.label_span.innerHTML=""+__(this.df.label)||"&nbsp;",this._label=this.df.label}},set_description:function(t){void 0!==t&&(this.df.description=t),this.only_input||this.df.description===this._description||(this.df.description?this.$wrapper.find(".help-box").html(__(this.df.description)):this.set_empty_description(),this._description=this.df.description)},set_new_description:function(t){this.$wrapper.find(".help-box").html(t)},set_empty_description:function(){this.$wrapper.find(".help-box").html("")},set_mandatory:function(t){this.$wrapper.toggleClass("has-error",!(!this.df.reqd||!is_null(t)))},set_bold:function(){this.$input&&this.$input.toggleClass("bold",!(!this.df.bold&&!this.df.reqd)),this.disp_area&&$(this.disp_area).toggleClass("bold",!(!this.df.bold&&!this.df.reqd))}}),frappe.ui.form.ControlData=frappe.ui.form.ControlInput.extend({html_element:"input",input_type:"text",make_input:function(){this.$input||(this.$input=$("<"+this.html_element+">").attr("type",this.input_type).attr("autocomplete","off").addClass("input-with-feedback form-control").prependTo(this.input_area),in_list(["Data","Link","Dynamic Link","Password","Select","Read Only","Attach","Attach Image"],this.df.fieldtype)&&this.$input.attr("maxlength",this.df.length||140),this.set_input_attributes(),this.input=this.$input.get(0),this.has_input=!0,this.bind_change_event(),this.bind_focusout(),this.setup_autoname_check())},setup_autoname_check:function(){var t=this;this.df.parent&&(this.meta=frappe.get_meta(this.df.parent),this.meta&&(this.meta.autoname&&"field:"===this.meta.autoname.substr(0,6)&&this.meta.autoname.substr(6)===this.df.fieldname||"__newname"===this.df.fieldname)&&this.$input.on("keyup",function(){if(t.set_description(""),t.doc&&t.doc.__islocal){var e=setTimeout(function(){t.last_check&&clearTimeout(t.last_check),frappe.db.get_value(t.doctype,t.$input.val(),"name",function(e){e&&t.set_description(__("{0} already exists. Select another name",[e.name]))}),t.last_check=null},1e3);t.last_check=e}}))},set_input_attributes:function(){this.$input.attr("data-fieldtype",this.df.fieldtype).attr("data-fieldname",this.df.fieldname).attr("placeholder",this.df.placeholder||""),this.doctype&&this.$input.attr("data-doctype",this.doctype),this.df.input_css&&this.$input.css(this.df.input_css),this.df.input_class&&this.$input.addClass(this.df.input_class)},set_input:function(t){this.last_value=this.value,this.value=t,this.set_formatted_input(t),this.set_disp_area(t),this.set_mandatory&&this.set_mandatory(t)},set_formatted_input:function(t){this.$input&&this.$input.val(this.format_for_input(t))},get_input_value:function(){return this.$input?this.$input.val():void 0},format_for_input:function(t){return null==t?"":t},validate:function(t){if("Phone"==this.df.options){if(t+""=="")return"";var e="";return(t=t.replace(/ /g,"").replace(/-/g,"").replace(/\(/g,"").replace(/\)/g,""))&&"+"==t.substr(0,1)&&(e="+",t=t.substr(1)),t&&"00"==t.substr(0,2)&&(e+="00",t=t.substr(2)),t&&"0"==t.substr(0,1)&&(e+="0",t=t.substr(1)),e+=cint(t)+""}if("Email"==this.df.options){if(t+""=="")return"";var i=frappe.utils.split_emails(t);if(i){var a=!1;return i.forEach(function(t){validate_email(t)||(frappe.msgprint(__("Invalid Email: {0}",[t])),a=!0)}),a?"":t}return""}return t}}),frappe.ui.form.ControlInt=frappe.ui.form.ControlData.extend({make:function(){this._super()},make_input:function(){var t=this;this._super(),this.$input.on("focus",function(){return setTimeout(function(){document.activeElement&&(document.activeElement.value=t.validate(document.activeElement.value),document.activeElement.select())},100),!1})},parse:function(t){return cint(t,null)}}),frappe.ui.form.ControlFloat=frappe.ui.form.ControlInt.extend({parse:function(t){return isNaN(parseFloat(t))?null:flt(t,this.get_precision())},format_for_input:function(t){var e;"Float"===this.df.fieldtype&&this.df.options&&this.df.options.trim()&&(e=this.get_number_format());var i=format_number(parseFloat(t),e,this.get_precision());return isNaN(parseFloat(t))?"":i},get_number_format:function(){var t=frappe.meta.get_field_currency(this.df,this.get_doc());return get_number_format(t)},get_precision:function(){return this.df.precision||cint(frappe.boot.sysdefaults.float_precision,null)}}),frappe.ui.form.ControlPercent=frappe.ui.form.ControlFloat,frappe.ui.form.ControlCurrency=frappe.ui.form.ControlFloat.extend({format_for_input:function(t){var e=format_number(parseFloat(t),this.get_number_format(),this.get_precision());return isNaN(parseFloat(t))?"":e},get_precision:function(){return this.df.precision||(frappe.boot.sysdefaults.currency_precision?this.df.precision=frappe.boot.sysdefaults.currency_precision:this.df.precision=get_number_format_info(this.get_number_format()).precision),this.df.precision}}),frappe.ui.form.ControlDate=frappe.ui.form.ControlData.extend({make_input:function(){this._super(),this.set_date_options(),this.set_datepicker(),this.set_t_for_today()},set_formatted_input:function(t){if(this._super(t),t){var e=this.last_value&&this.last_value!==t;if(!e)if(this.datepicker.selectedDates.length>0)e=moment(this.datepicker.selectedDates[0]).format(this.date_format)!==t;else e=!0;e&&this.datepicker.selectDate(frappe.datetime.str_to_obj(t))}},set_date_options:function(){var t=this,e=this,i=frappe.boot.user.language;$.fn.datepicker.language[i]||(i="en"),this.today_text=__("Today"),this.date_format=moment.defaultDateFormat,this.datepicker_options={language:i,autoClose:!0,todayButton:!0,dateFormat:frappe.boot.sysdefaults.date_format||"yyyy-mm-dd",startDate:frappe.datetime.now_date(!0),keyboardNav:!1,onSelect:function(){t.$input.trigger("change")},onShow:function(){t.datepicker.$datepicker.find(".datepicker--button:visible").text(e.today_text),t.update_datepicker_position()}}},update_datepicker_position:function(){if(this.frm){var t="top left";$(window).height()+$(window).scrollTop()>=this.$input.offset().top+280&&(t="bottom left"),this.datepicker.update("position",t)}},set_datepicker:function(){var t=this;this.$input.datepicker(this.datepicker_options),this.datepicker=this.$input.data("datepicker"),this.datepicker.$datepicker.find('[data-action="today"]').click(function(){t.datepicker.selectDate(t.get_now_date())})},get_now_date:function(){return frappe.datetime.now_date(!0)},set_t_for_today:function(){var t=this;this.$input.on("keydown",function(e){if(84===e.which)return"Date"==t.df.fieldtype&&t.set_value(frappe.datetime.nowdate()),"Datetime"==t.df.fieldtype&&t.set_value(frappe.datetime.now_datetime()),"Time"==t.df.fieldtype&&t.set_value(frappe.datetime.now_time()),!1})},parse:function(t){if(t)return frappe.datetime.user_to_str(t)},format_for_input:function(t){return t?frappe.datetime.str_to_user(t):""},validate:function(t){return t&&!frappe.datetime.validate(t)?(frappe.msgprint(__("Date must be in format: {0}",[frappe.sys_defaults.date_format||"yyyy-mm-dd"])),""):t}}),frappe.ui.form.ControlTime=frappe.ui.form.ControlData.extend({make_input:function(){var t=this,e=this;this._super(),this.$input.datepicker({language:"en",timepicker:!0,onlyTimepicker:!0,timeFormat:"hh:ii:ss",startDate:frappe.datetime.now_time(!0),onSelect:function(){moment(e.get_value(),"hh:mm:ss").format("HH:mm:ss")!=moment(e.value,"hh:mm:ss").format("HH:mm:ss")&&e.$input.trigger("change")},onShow:function(){$(".datepicker--button:visible").text(__("Now"))},keyboardNav:!1,todayButton:!0}),this.datepicker=this.$input.data("datepicker"),this.datepicker.$datepicker.find('[data-action="today"]').click(function(){t.datepicker.selectDate(frappe.datetime.now_time(!0))}),this.refresh()},set_input:function(t){if(this._super(t),t&&(this.last_value&&this.last_value!==this.value||!this.datepicker.selectedDates.length)){var e=frappe.datetime.moment_to_date_obj(moment(t,"HH:mm:ss"));this.datepicker.selectDate(e)}},set_description:function(){var t=this.df.description,e=frappe.sys_defaults.time_zone;frappe.datetime.is_timezone_same()||(t?t.includes(e)||(this.df.description+="<br>"+e):this.df.description=e),this._super()}}),frappe.ui.form.ControlDatetime=frappe.ui.form.ControlDate.extend({set_date_options:function(){this._super(),this.today_text=__("Now"),this.date_format=moment.defaultDatetimeFormat,$.extend(this.datepicker_options,{timepicker:!0,timeFormat:"hh:ii:ss"})},get_now_date:function(){return frappe.datetime.now_datetime(!0)},set_description:function(){var t=this.df.description,e=frappe.sys_defaults.time_zone;frappe.datetime.is_timezone_same()||(t?t.includes(e)||(this.df.description+="<br>"+e):this.df.description=e),this._super()}}),frappe.ui.form.ControlDateRange=frappe.ui.form.ControlData.extend({make_input:function(){this._super(),this.set_date_options(),this.set_datepicker(),this.refresh()},set_date_options:function(){var t=this;this.datepicker_options={language:"en",range:!0,autoClose:!0,toggleSelected:!1},this.datepicker_options.dateFormat=frappe.boot.sysdefaults.date_format||"yyyy-mm-dd",this.datepicker_options.onSelect=function(){t.$input.trigger("change")}},set_datepicker:function(){this.$input.datepicker(this.datepicker_options),this.datepicker=this.$input.data("datepicker")},set_input:function(t,e){if(this.last_value=this.value,this.value=t&&e?[t,e]:t,this.value){var i=this.format_for_input(this.value[0],this.value[1]);this.$input&&this.$input.val(i)}else this.$input&&this.$input.val("");this.set_disp_area(t||""),this.set_mandatory&&this.set_mandatory(t)},parse:function(t){var e=__("{0} to {1}").replace("{0}","").replace("{1}","");if((t=t.replace(e,","))&&t.includes(",")){var i=t.split(",");return[moment(frappe.datetime.user_to_obj(i[0])).format("YYYY-MM-DD"),moment(frappe.datetime.user_to_obj(i[i.length-1])).format("YYYY-MM-DD")]}},format_for_input:function(t,e){return t&&e?(t=frappe.datetime.str_to_user(t),e=frappe.datetime.str_to_user(e),__("{0} to {1}",[t,e])):""}}),frappe.ui.form.ControlSelect=frappe.ui.form.ControlData.extend({html_element:"select",make_input:function(){this._super(),this.set_options()},set_formatted_input:function(t){null==t&&(t=""),this.set_options(t),this._super(t);var e="";this.$input&&(e=this.$input.val()),t&&e&&t!==e&&this.set_model_value(e)},set_options:function(t){var e=this.df.options||[];if("string"==typeof this.df.options&&(e=this.df.options.split("\n")),e.toString()!==this.last_options&&(this.last_options=e.toString(),this.$input)){var i=this.$input.find(":selected").val();this.$input.empty().add_options(e||[]),void 0===t&&i&&this.$input.val(i)}},get_file_attachment_list:function(){if(this.frm){var t=frappe.model.docinfo[this.frm.doctype][this.frm.docname];if(t&&t.attachments){this.set_description("");var e=[""];return $.each(t.attachments,function(t,i){e.push(i.file_url)}),e}return this.set_description(__("Please attach a file first.")),[""]}}}),frappe.ui.form.ControlLink=frappe.ui.form.ControlData.extend({make_input:function(){var t=this;$('<div class="link-field ui-front" style="position: relative; line-height: 1;">\t\t\t<input type="text" class="input-with-feedback form-control">\t\t\t<span class="link-btn">\t\t\t\t<a class="btn-open no-decoration" title="'+__("Open Link")+'">\t\t\t\t\t<i class="octicon octicon-arrow-right"></i></a>\t\t\t</span>\t\t</div>').prependTo(this.input_area),this.$input_area=$(this.input_area),this.$input=this.$input_area.find("input"),this.$link=this.$input_area.find(".link-btn"),this.$link_open=this.$link.find(".btn-open"),this.set_input_attributes(),this.$input.on("focus",function(){setTimeout(function(){t.$input.val()&&t.get_options()&&(t.$link.toggle(!0),t.$link_open.attr("href","#Form/"+t.get_options()+"/"+t.$input.val())),t.$input.val()||t.$input.val("").trigger("input")},500)}),this.$input.on("blur",function(){setTimeout(function(){t.$link.toggle(!1)},500)}),this.input=this.$input.get(0),this.has_input=!0,this.translate_values=!0,this.setup_buttons(),this.setup_awesomeplete()},get_options:function(){return this.df.options},setup_buttons:function(){this.only_input&&!this.with_link_btn&&this.$input_area.find(".link-btn").remove()},open_advanced_search:function(){var t=this.get_options();if(t)return new frappe.ui.form.LinkSelector({doctype:t,target:this,txt:this.get_input_value()}),!1},new_doc:function(){var t=this.get_options(),e=this;if(t)return this.df.get_route_options_for_new_doc?frappe.route_options=this.df.get_route_options_for_new_doc(this):frappe.route_options={},frappe.route_options.name_field=this.get_value(),frappe._from_link=this,frappe._from_link_scrollY=$(document).scrollTop(),frappe.ui.form.make_quick_entry(t,function(t){return e.set_value(t.name)}),!1},setup_awesomeplete:function(){var t=this;this.$input.cache={},this.awesomplete=new Awesomplete(t.input,{minChars:0,maxItems:99,autoFirst:!0,list:[],data:function(t){return{label:t.label||t.value,value:t.value}},filter:function(){return!0},item:function(e){var i=this.get_item(e.value);i.label||(i.label=i.value);var a="<strong>"+(t.translate_values?__(i.label):i.label)+"</strong>";return i.description&&i.value!==i.description&&(a+='<br><span class="small">'+__(i.description)+"</span>"),$("<li></li>").data("item.autocomplete",i).prop("aria-selected","false").html("<a><p>"+a+"</p></a>").get(0)},sort:function(){return 0}}),this.$input.on("input",frappe.utils.debounce(function(e){var i=t.get_options();if(i){t.$input.cache[i]||(t.$input.cache[i]={});var a=e.target.value;null!=t.$input.cache[i][a]&&(t.awesomplete.list=t.$input.cache[i][a]);var n={txt:a,doctype:i};t.set_custom_query(n),frappe.call({type:"GET",method:"frappe.desk.search.search_link",no_spinner:!0,args:n,callback:function(e){t.$input.is(":focus")&&(t.df.only_select||(frappe.model.can_create(i)&&"Dynamic Link"!==t.df.fieldtype&&e.results.push({label:"<span class='text-primary link-option'><i class='fa fa-plus' style='margin-right: 5px;'></i> "+__("Create a new {0}",[__(t.df.options)])+"</span>",value:"create_new__link_option",action:t.new_doc}),e.results.push({label:"<span class='text-primary link-option'><i class='fa fa-search' style='margin-right: 5px;'></i> "+__("Advanced Search")+"</span>",value:"advanced_search__link_option",action:t.open_advanced_search})),t.$input.cache[i][a]=e.results,t.awesomplete.list=t.$input.cache[i][a])}})}},618)),this.$input.on("blur",function(){if(t.selected)t.selected=!1;else{var e=t.get_input_value();e!==t.last_value&&t.parse_validate_and_set_in_model(e)}}),this.$input.on("awesomplete-open",function(){t.$wrapper.css({"z-index":100}),t.$wrapper.find("ul").css({"z-index":100}),t.autocomplete_open=!0}),this.$input.on("awesomplete-close",function(){t.$wrapper.css({"z-index":1}),t.autocomplete_open=!1}),this.$input.on("awesomplete-select",function(e){var i=e.originalEvent,a=t.awesomplete.get_item(i.text.value);t.autocomplete_open=!1;if(9===e.keyCode)return e.preventDefault(),t.awesomplete.close(),!1;a.action&&(a.value="",a.action.apply(t)),t.df.remember_last_selected_value&&(frappe.boot.user.last_selected_values[t.df.options]=a.value),t.parse_validate_and_set_in_model(a.value)}),this.$input.on("awesomplete-selectcomplete",function(e){-1!==e.originalEvent.text.value.indexOf("__link_option")&&t.$input.val("")})},set_custom_query:function(t){var e=function(t){return $.each(t,function(e,i){void 0!==i&&(t[e]=i)}),t};if(this.get_query||this.df.get_query){var i=this.get_query||this.df.get_query;if($.isPlainObject(i)){var a=null;i.filters?a=i.filters:i.query?t.query=i:a=i,a&&(a=e(a),$.extend(t,a),t.filters=a)}else if("string"==typeof i)t.query=i;else{var n=i(this.frm&&this.frm.doc||this.doc,this.doctype,this.docname);"string"==typeof n?t.query=n:$.isPlainObject(n)&&(n.filters&&e(n.filters),void 0!==n.translate_values&&(this.translate_values=n.translate_values),$.extend(t,n),t.filters=n.filters)}}this.df.filters&&(e(this.df.filters),t.filters||(t.filters={}),$.extend(t.filters,this.df.filters))},validate:function(t){return"[Select]"==this.df.options||this.df.ignore_link_validation?t:this.validate_link_and_fetch(this.df,this.get_options(),this.docname,t)},validate_link_and_fetch:function(t,e,i,a){var n=this,s=this;if(a)return new Promise(function(o){var r="";return n.frm&&n.frm.fetch_dict[t.fieldname]&&(r=n.frm.fetch_dict[t.fieldname].columns.join(", ")),frappe.call({method:"frappe.desk.form.utils.validate_link",type:"GET",args:{value:a,options:e,fetch:r},no_spinner:!0,callback:function(e){"Ok"==e.message?(e.fetch_values&&i&&s.set_fetch_values(t,i,e.fetch_values),o(e.valid_value)):o("")}})})},set_fetch_values:function(t,e,i){for(var a=this.frm.fetch_dict[t.fieldname].fields,n=0;n<a.length;n++)frappe.model.set_value(t.parent,e,a[n],i[n],t.fieldtype)}}),Awesomplete&&(Awesomplete.prototype.get_item=function(t){return this._list.find(function(e){return e.value===t})}),frappe.ui.form.ControlDynamicLink=frappe.ui.form.ControlLink.extend({get_options:function(){var t="";if(this.df.get_options)t=this.df.get_options();else if(null==this.docname&&cur_dialog)t=cur_dialog.get_value(this.df.options);else if(cur_frm)t=frappe.model.get_value(this.df.parent,this.docname,this.df.options);else{var e='input[data-fieldname="'+this.df.options+'"]',i=null;cur_list&&(i=cur_list.wrapper.find(e)),cur_page&&(i=$(cur_page.page).find(e)),i&&(t=i.val())}return frappe.model.is_single(t)&&frappe.throw(__(t.bold()+" is not a valid DocType for Dynamic Link")),t}}),frappe.ui.form.ControlText=frappe.ui.form.ControlData.extend({html_element:"textarea",horizontal:!1,make_wrapper:function(){this._super(),this.$wrapper.find(".like-disabled-input").addClass("for-description")},make_input:function(){this._super(),this.$input.css({height:"300px"})}}),frappe.ui.form.ControlLongText=frappe.ui.form.ControlText,frappe.ui.form.ControlSmallText=frappe.ui.form.ControlText.extend({make_input:function(){this._super(),this.$input.css({height:"150px"})}}),frappe.ui.form.ControlCode=frappe.ui.form.ControlText.extend({make_input:function(){this._super(),$(this.input_area).find("textarea").allowTabs().addClass("control-code")}}),frappe.ui.form.ControlTextEditor=frappe.ui.form.ControlCode.extend({make_input:function(){var t=this;this.has_input=!0,this.make_editor(),this.hide_elements_on_mobile(),this.setup_drag_drop(),this.setup_image_dialog(),this.setting_count=0,$(document).on("form-refresh",function(){t.last_keystroke_on=null})},render_camera_button:function(t){return $.summernote.ui.button({contents:'<i class="fa fa-camera"/>',tooltip:"Camera",click:function(){var e=new frappe.ui.Capture;e.show(),e.submit(function(e){t.invoke("editor.insertImage",e)})}}).render()},make_editor:function(){var t=this;this.editor=$("<div>").appendTo(this.input_area),this.editor.summernote({minHeight:400,toolbar:[["magic",["style"]],["style",["bold","italic","underline","clear"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph","hr"]],["media",["link","picture","camera","video","table"]],["misc",["fullscreen","codeview"]]],buttons:{camera:this.render_camera_button},keyMap:{pc:{"CTRL+ENTER":""},mac:{"CMD+ENTER":""}},prettifyHtml:!0,dialogsInBody:!0,callbacks:{onInit:function(){$(".note-editable[contenteditable='true']").one("focus",function(){var t=$(this);t.html()||t.html(t.html()+"<br>")})},onChange:function(e){t.parse_validate_and_set_in_model(e)},onKeydown:function(e){t.last_keystroke_on=new Date;var i=frappe.ui.keys.get_key(e);-1!==["ctrl+b","meta+b"].indexOf(i)&&e.stopPropagation(),-1!==i.indexOf("escape")&&t.note_editor.hasClass("fullscreen")&&t.note_editor.find(".note-btn.btn-fullscreen").trigger("click")}},icons:{align:"fa fa-align",alignCenter:"fa fa-align-center",alignJustify:"fa fa-align-justify",alignLeft:"fa fa-align-left",alignRight:"fa fa-align-right",indent:"fa fa-indent",outdent:"fa fa-outdent",arrowsAlt:"fa fa-arrows-alt",bold:"fa fa-bold",camera:"fa fa-camera",caret:"caret",circle:"fa fa-circle",close:"fa fa-close",code:"fa fa-code",eraser:"fa fa-eraser",font:"fa fa-font",frame:"fa fa-frame",italic:"fa fa-italic",link:"fa fa-link",unlink:"fa fa-chain-broken",magic:"fa fa-magic",menuCheck:"fa fa-check",minus:"fa fa-minus",orderedlist:"fa fa-list-ol",pencil:"fa fa-pencil",picture:"fa fa-image",question:"fa fa-question",redo:"fa fa-redo",square:"fa fa-square",strikethrough:"fa fa-strikethrough",subscript:"fa fa-subscript",superscript:"fa fa-superscript",table:"fa fa-table",textHeight:"fa fa-text-height",trash:"fa fa-trash",underline:"fa fa-underline",undo:"fa fa-undo",unorderedlist:"fa fa-list-ul",video:"fa fa-video-camera"}}),this.note_editor=$(this.input_area).find(".note-editor")},setup_drag_drop:function(){var t=this;this.note_editor.on("dragenter dragover",!1).on("drop",function(e){var i=e.originalEvent.dataTransfer;i&&i.files&&i.files.length&&(t.note_editor.focus(),[].slice.call(i.files).forEach(function(e){t.get_image(e,function(i){t.editor.summernote("insertImage",i,e.name)})}));e.preventDefault(),e.stopPropagation()})},get_image:function(t,e){var i=new FileReader;i.onload=function(){var a=i.result,n=a.split(",");n[0]+=";filename="+t.name,a=n[0]+","+n[1],e(a)},i.readAsDataURL(t)},hide_elements_on_mobile:function(){this.note_editor.find(".note-btn-underline,\t\t\t.note-btn-italic, .note-fontsize,\t\t\t.note-color, .note-height, .btn-codeview").addClass("hidden-xs"),$(".toggle-sidebar").is(":visible")&&this.note_editor.find(".note-btn").attr("data-original-title","")},get_input_value:function(){return this.editor?this.editor.summernote("code"):""},parse:function(t){return null==t&&(t=""),frappe.dom.remove_script_and_style(t)},set_formatted_input:function(t){t!==this.get_input_value()&&this.set_in_editor(t)},set_in_editor:function(t){var e=this;if(!(this.setting_count>2)){this.setting_count+=1;var i=moment()-moment(this.last_keystroke_on);!this.last_keystroke_on||i>3e3?(setTimeout(function(){return e.setting_count=0},500),this.editor.summernote("code",t||""),this.last_keystroke_on=null):this._setting_value=setInterval(function(){i>3e3&&(e.last_value!==e.get_input_value()&&e.editor.summernote("code",e.last_value||""),clearInterval(e._setting_value),e._setting_value=null,e.setting_count=0,e.last_keystroke_on=null)},1e3)}},set_focus:function(){return this.editor.summernote("focus")},set_upload_options:function(){var t=this;this.upload_options={parent:this.image_dialog.get_field("upload_area").$wrapper,args:{},max_width:this.df.max_width,max_height:this.df.max_height,options:"Image",no_socketio:!0,btn:this.image_dialog.set_primary_action(__("Insert")),on_no_attach:function(){var e=t.image_dialog.get_field("select").get_value();e?(t.editor.summernote("insertImage",e),t.image_dialog.hide()):frappe.msgprint(__("Please attach a file or set a URL"))},callback:function(e){t.editor.summernote("insertImage",e.file_url,e.file_name),t.image_dialog.hide()},onerror:function(){t.image_dialog.hide()}},"is_private"in this.df&&(this.upload_options.is_private=this.df.is_private),this.frm?this.upload_options.args={from_form:1,doctype:this.frm.doctype,docname:this.frm.docname}:this.upload_options.on_attach=function(e,i){t.editor.summernote("insertImage",i),t.image_dialog.hide(),frappe.hide_progress()}},setup_image_dialog:function(){var t=this;this.note_editor.find('[data-original-title="Image"]').on("click",function(){t.image_dialog||(t.image_dialog=new frappe.ui.Dialog({title:__("Image"),fields:[{fieldtype:"HTML",fieldname:"upload_area"},{fieldtype:"HTML",fieldname:"or_attach",options:__("Or")},{fieldtype:"Select",fieldname:"select",label:__("Select from existing attachments")}]})),t.image_dialog.show(),t.image_dialog.get_field("upload_area").$wrapper.empty();var e=t.frm&&t.frm.attachments.get_attachments()||[],i=t.image_dialog.get_field("select");e.length?(e=$.map(e,function(t){return t.file_url}),i.df.options=[""].concat(e),i.toggle(!0),t.image_dialog.get_field("or_attach").toggle(!0),i.refresh()):(t.image_dialog.get_field("or_attach").toggle(!1),i.toggle(!1)),i.$input.val(""),t.set_upload_options(),frappe.upload.make(t.upload_options)})}}),frappe.ui.form.ControlCheck=frappe.ui.form.ControlData.extend({input_type:"checkbox",make_wrapper:function(){this.$wrapper=$('<div class="form-group frappe-control">\t\t\t<div class="checkbox">\t\t\t\t<label>\t\t\t\t\t<span class="input-area"></span>\t\t\t\t\t<span class="disp-area"></span>\t\t\t\t\t<span class="label-area small"></span>\t\t\t\t</label>\t\t\t\t<p class="help-box small text-muted"></p>\t\t\t</div>\t\t</div>').appendTo(this.parent)},set_input_areas:function(){this.label_area=this.label_span=this.$wrapper.find(".label-area").get(0),this.input_area=this.$wrapper.find(".input-area").get(0),this.disp_area=this.$wrapper.find(".disp-area").get(0)},make_input:function(){this._super(),this.$input.removeClass("form-control")},get_input_value:function(){return this.input&&this.input.checked?1:0},validate:function(t){return cint(t)},set_input:function(t){this.input&&(this.input.checked=t?1:0),this.last_value=t,this.set_mandatory(t),this.set_disp_area(t)}}),frappe.ui.form.ControlImage=frappe.ui.form.Control.extend({make:function(){this._super(),this.$wrapper.css({margin:"0px"}),this.$body=$("<div></div>").appendTo(this.$wrapper).css({"margin-bottom":"10px"}),$('<div class="clearfix"></div>').appendTo(this.$wrapper)},refresh_input:function(){this.$body.empty();var t=this.get_doc();return t&&this.df.options&&t[this.df.options]?this.$img=$("<img src='"+t[this.df.options]+"' class='img-responsive'>").appendTo(this.$body):this.$buffer=$("<div class='missing-image'><i class='octicon octicon-circle-slash'></i></div>").appendTo(this.$body),!1}}),frappe.ui.form.ControlAttach=frappe.ui.form.ControlData.extend({make_input:function(){var t=this;this.$input=$('<button class="btn btn-default btn-sm btn-attach">').html(__("Attach")).prependTo(t.input_area).on("click",function(){t.onclick()}),this.$value=$('<div class="attached-file">\n\t\t\t\t<div class="ellipsis">\n\t\t\t\t\t<i class="fa fa-paperclip"></i>\n\t\t\t\t\t<a class="attached-file-link" target="_blank"></a>\n\t\t\t\t</div>\n\t\t\t\t<a class="close">&times;</a>\n\t\t\t</div>').prependTo(t.input_area).toggle(!1),this.input=this.$input.get(0),this.set_input_attributes(),this.has_input=!0,this.$value.find(".close").on("click",function(){t.clear_attachment()})},clear_attachment:function(){var t=this;this.frm?t.frm.attachments.remove_attachment_by_filename(t.value,function(){t.parse_validate_and_set_in_model(null),t.refresh(),1==t.frm.doc.docstatus?t.frm.save("Update"):t.frm.save()}):(this.dataurl=null,this.fileobj=null,this.set_input(null),this.refresh())},onclick:function(){var t=this;if(this.doc&&(this.doc.parent&&frappe.model.get_doc(this.doc.parenttype,this.doc.parent)||this.doc).__islocal)return void frappe.msgprint(__("Please save the document before uploading."));this.dialog||(this.dialog=new frappe.ui.Dialog({title:__(this.df.label||__("Upload")),fields:[{fieldtype:"HTML",fieldname:"upload_area"},{fieldtype:"HTML",fieldname:"or_attach",options:__("Or")},{fieldtype:"Select",fieldname:"select",label:__("Select from existing attachments")},{fieldtype:"Button",fieldname:"clear",label:__("Clear Attachment"),click:function(){t.clear_attachment(),t.dialog.hide()}}]})),this.dialog.show(),this.dialog.get_field("upload_area").$wrapper.empty();var e=this.frm&&this.frm.attachments.get_attachments()||[],i=this.dialog.get_field("select");e.length?(e=$.map(e,function(t){return t.file_url}),i.df.options=[""].concat(e),i.toggle(!0),this.dialog.get_field("or_attach").toggle(!0),i.refresh()):(this.dialog.get_field("or_attach").toggle(!1),i.toggle(!1)),i.$input.val(""),this.dialog.get_field("clear").$wrapper.toggle(!!this.get_model_value()),this.set_upload_options(),frappe.upload.make(this.upload_options)},set_upload_options:function(){var t=this;this.upload_options={parent:this.dialog.get_field("upload_area").$wrapper,args:{},allow_multiple:0,max_width:this.df.max_width,max_height:this.df.max_height,options:this.df.options,btn:this.dialog.set_primary_action(__("Upload")),on_no_attach:function(){var e=t.dialog.get_field("select").get_value();e?(t.parse_validate_and_set_in_model(e),t.dialog.hide(),t.frm.save()):frappe.msgprint(__("Please attach a file or set a URL"))},callback:function(e){t.on_upload_complete(e),t.dialog.hide()},onerror:function(){t.dialog.hide()}},"is_private"in this.df&&(this.upload_options.is_private=this.df.is_private),this.frm?this.upload_options.args={from_form:1,doctype:this.frm.doctype,docname:this.frm.docname}:this.upload_options.on_attach=function(e,i){t.dialog.hide(),t.fileobj=e,t.dataurl=i,t.on_attach&&t.on_attach(),t.df.on_attach&&t.df.on_attach(e,i),t.on_upload_complete()}},set_input:function(t,e){if(this.value=t,this.value){if(this.$input.toggle(!1),-1!==this.value.indexOf(",")){var i=this.value.split(","),a=i[0];e=i[1]}this.$value.toggle(!0).find(".attached-file-link").html(a||this.value).attr("href",e||this.value)}else this.$input.toggle(!0),this.$value.toggle(!1)},get_value:function(){if(this.frm)return this.value;if(this.fileobj){if(this.fileobj.file_url)return this.fileobj.file_url;if(this.fileobj.filename)return this.fileobj.filename+","+this.dataurl}return null},on_upload_complete:function(t){this.frm?(this.parse_validate_and_set_in_model(t.file_url),this.refresh(),this.frm.attachments.update_attachment(t),1==this.frm.doc.docstatus?this.frm.save("Update"):this.frm.save()):(this.value=this.get_value(),this.refresh(),frappe.hide_progress())}}),frappe.ui.form.ControlAttachImage=frappe.ui.form.ControlAttach.extend({make:function(){var t=this;this._super(),this.container=$('<div class="control-container">').insertAfter($(this.wrapper)),$(this.wrapper).detach(),this.container.attr("data-fieldtype",this.df.fieldtype).append(this.wrapper),"center"===this.df.align?this.container.addClass("flex-justify-center"):"right"===this.df.align&&this.container.addClass("flex-justify-end"),this.img_wrapper=$('<div style="width: 100%; height: calc(100% - 40px); position: relative;">\t\t\t<div class="missing-image attach-missing-image"><i class="octicon octicon-device-camera"></i></div></div>').appendTo(this.wrapper),this.img_container=$("<div class='img-container'></div>"),this.img=$("<img class='img-responsive attach-image-display'>").appendTo(this.img_container),this.img_overlay=$("<div class='img-overlay'>\n\t\t\t\t<span class=\"overlay-text\">Change</span>\n\t\t\t</div>").appendTo(this.img_container),this.remove_image_link=$('<a style="font-size: 12px;color: #8D99A6;">Remove</a>'),this.img_wrapper.append(this.img_container).append(this.remove_image_link),this.img_container.toggle(!1),this.remove_image_link.toggle(!1),this.img_wrapper.find(".missing-image").on("click",function(){t.$input.click()}),this.img_container.on("click",function(){t.$input.click()}),this.remove_image_link.on("click",function(){t.$value.find(".close").click()}),this.set_image()},refresh_input:function(){this._super(),$(this.wrapper).find(".btn-attach").addClass("hidden"),this.set_image(),"Read"==this.get_status()&&$(this.disp_area).toggle(!1)},set_image:function(){this.get_value()?($(this.img_wrapper).find(".missing-image").toggle(!1),this.img.attr("src",this.dataurl?this.dataurl:this.value),this.img_container.toggle(!0),this.remove_image_link.toggle(!0)):($(this.img_wrapper).find(".missing-image").toggle(!0),this.img_container.toggle(!1),this.remove_image_link.toggle(!1))}}),frappe.ui.form.ControlTable=frappe.ui.form.Control.extend({make:function(){this._super(),this.grid=new frappe.ui.form.Grid({frm:this.frm,df:this.df,perm:this.perm||this.frm&&this.frm.perm||this.df.perm,parent:this.wrapper}),this.frm&&(this.frm.grids[this.frm.grids.length]=this),this.df.description&&$('<p class="text-muted small">'+__(this.df.description)+"</p>").appendTo(this.wrapper)},refresh_input:function(){this.grid.refresh()},get_value:function(){if(this.grid)return this.grid.get_data()}}),frappe.ui.form.ControlColor=frappe.ui.form.ControlData.extend({make_input:function(){this._super(),this.colors=["#ffc4c4","#ff8989","#ff4d4d","#a83333","#ffe8cd","#ffd19c","#ffb868","#a87945","#ffd2c2","#ffa685","#ff7846","#a85b5b","#ffd7d7","#ffb1b1","#ff8989","#a84f2e","#fffacd","#fff168","#fff69c","#a89f45","#ebf8cc","#d9f399","#c5ec63","#7b933d","#cef6d1","#9deca2","#6be273","#428b46","#d2f8ed","#a4f3dd","#77ecca","#49937e","#d2f1ff","#a6e4ff","#78d6ff","#4f8ea8","#d2d2ff","#a3a3ff","#7575ff","#4d4da8","#dac7ff","#b592ff","#8e58ff","#5e3aa8","#f8d4f8","#f3aaf0","#ec7dea","#934f92"],this.make_color_input()},make_color_input:function(){this.$wrapper.find(".control-input-wrapper").append('<div class="color-picker">\n\t\t\t\t<div class="color-picker-pallete"></div>\n\t\t\t</div>'),this.$color_pallete=this.$wrapper.find(".color-picker-pallete");var t=this.colors.map(this.get_color_box).join("");this.$color_pallete.append(t),this.$color_pallete.hide(),this.bind_events()},get_color_box:function(t){return'<div class="color-box" data-color="'+t+'" style="background-color: '+t+'"></div>'},set_formatted_input:function(t){this._super(t),t||(t="#FFFFFF");var e=frappe.ui.color.get_contrast_color(t);this.$input.css({"background-color":t,color:e})},bind_events:function(){var t=this,e=!1;this.$wrapper.on("click",".color-box",function(i){e=!1;var a=$(i.target).data("color");t.set_value(a),t.set_focus()}),this.$wrapper.find(".color-box").mousedown(function(){e=!0}),this.$input.on("focus",function(){t.$color_pallete.show()}),this.$input.on("blur",function(){e?e=!1:$(t.$color_pallete).hide()})},validate:function(t){return""===t?"":/^#[0-9A-F]{6}$/i.test(t)?t:null}}),frappe.ui.form.ControlSignature=frappe.ui.form.ControlData.extend({saving:!1,loading:!1,make:function(){this._super(),this.body=$('<div class="signature-field"></div>').appendTo(this.wrapper),this.make_pad(),this.img_wrapper=$('<div class="signature-display">\n\t\t\t<div class="missing-image attach-missing-image">\n\t\t\t\t<i class="octicon octicon-circle-slash"></i>\n\t\t\t</div></div>').appendTo(this.wrapper),this.img=$("<img class='img-responsive attach-image-display'>").appendTo(this.img_wrapper).toggle(!1)},make_pad:function(){var t=this;this.body.width()>0&&!this.$pad&&(this.$pad=this.body.jSignature({height:300,width:this.body.width(),lineWidth:.8}).on("change",this.on_save_sign.bind(this)),this.load_pad(),this.$reset_button_wrapper=$('<div class="signature-btn-row">\n\t\t\t\t<a href="#" type="button" class="signature-reset btn btn-default">\n\t\t\t\t<i class="glyphicon glyphicon-repeat"></i></a>').appendTo(this.$pad).on("click",".signature-reset",function(){return t.on_reset_sign(),!1}))},refresh_input:function(t){this.make_pad(),this.$wrapper.find(".control-input").toggle(!1),this.set_editable("Write"==this.get_status()),this.load_pad(),"Read"==this.get_status()&&$(this.disp_area).toggle(!1)},set_image:function(t){t?($(this.img_wrapper).find(".missing-image").toggle(!1),this.img.attr("src",t).toggle(!0)):($(this.img_wrapper).find(".missing-image").toggle(!0),this.img.toggle(!1))},load_pad:function(){if(!this.saving){var t=this.get_value();if(this.$pad){if(this.loading=!0,this.$pad.jSignature("reset"),t)try{this.$pad.jSignature("setData",t),this.set_image(t)}catch(e){console.log("Cannot set data for signature",t,e)}this.loading=!1}}},set_editable:function(t){this.$pad&&this.$pad.toggle(t),this.img_wrapper.toggle(!t),this.$reset_button_wrapper&&(this.$reset_button_wrapper.toggle(t),t?this.$reset_button_wrapper.addClass("editing"):this.$reset_button_wrapper.removeClass("editing"))},set_my_value:function(t){this.saving||this.loading||(this.saving=!0,this.set_value(t),this.saving=!1)},get_value:function(){return this.value?this.value:this.get_model_value()},on_reset_sign:function(){this.$pad.jSignature("reset"),this.set_my_value("")},on_save_sign:function(){if(!this.saving&&!this.loading){var t=this.$pad.jSignature("getData");this.set_my_value(t),this.set_image(this.get_value())}}}),frappe.ui.form.ControlPassword=frappe.ui.form.ControlData.extend({input_type:"password",make:function(){this._super()},make_input:function(){var t=this,e=this;this._super(),this.$input.parent().append($('<span class="password-strength-indicator indicator"></span>')),this.$wrapper.find(".control-input-wrapper").append($('<p class="password-strength-message text-muted small hidden"></p>')),this.indicator=this.$wrapper.find(".password-strength-indicator"),this.message=this.$wrapper.find(".help-box"),this.$input.on("keyup",function(){clearTimeout(t.check_password_timeout),t.check_password_timeout=setTimeout(function(){e.get_password_strength(e.$input.val())},500)})},get_password_strength:function(t){var e=this;frappe.call({type:"POST",method:"frappe.core.doctype.user.user.test_password_strength",args:{new_password:t||""},callback:function(t){if(t.message&&t.message.entropy){var i=t.message.score;t.message.feedback.crack_time_display=t.message.crack_time_display;e.set_strength_indicator(["grey","red","orange","yellow","green"][i])}}})},set_strength_indicator:function(t){var e=__("Include symbols, numbers and capital letters in the password");this.indicator.removeClass().addClass("password-strength-indicator indicator "+t),this.message.html(e).removeClass("hidden")}}),frappe.ui.form.ControlReadOnly=frappe.ui.form.ControlData.extend({get_status:function(t){var e=this._super(t);"Write"===e&&(e="Read")}}),frappe.ui.form.ControlButton=frappe.ui.form.ControlData.extend({make_input:function(){var t=this;this.$input=$('<button class="btn btn-default btn-xs">').prependTo(t.input_area).on("click",function(){t.onclick()}),this.input=this.$input.get(0),this.set_input_attributes(),this.has_input=!0,this.toggle_label(!1)},onclick:function(){this.frm&&this.frm.doc?this.frm.script_manager.has_handlers(this.df.fieldname,this.doctype)?this.frm.script_manager.trigger(this.df.fieldname,this.doctype,this.docname):this.frm.runscript(this.df.options,this):this.df.click&&this.df.click()},hide:function(){this.$input.hide()},set_input_areas:function(){this._super(),$(this.disp_area).removeClass().addClass("hide")},set_empty_description:function(){this.$wrapper.find(".help-box").empty().toggle(!1)},set_label:function(){$(this.label_span).html("&nbsp;"),this.$input&&this.$input.html((this.df.icon?'<i class="'+this.df.icon+' fa-fw"></i> ':"")+__(this.df.label))}}),frappe.ui.form.ControlHTML=frappe.ui.form.Control.extend({make:function(){this._super(),this.disp_area=this.wrapper},refresh_input:function(){var t=this.get_content();t&&this.$wrapper.html(t)},get_content:function(){var t=this.df.options||"";try{return frappe.render(t,this)}catch(e){return t}},html:function(t){this.$wrapper.html(t||this.get_content())},set_value:function(t){t.appendTo?t.appendTo(this.$wrapper.empty()):(this.df.options=t,this.html(t))}}),frappe.ui.form.ControlHeading=frappe.ui.form.ControlHTML.extend({get_content:function(){return"<h4>"+__(this.df.label)+"</h4>"}}),frappe.ui.form.ControlAutocomplete=frappe.ui.form.ControlData.extend({make_input:function(){this._super(),this.setup_awesomplete(),this.set_options()},set_options:function(){if(this.df.options){var t=this.df.options||[];"string"==typeof t&&(t=t.split("\n")),"string"==typeof t[0]&&(t=t.map(function(t){return{label:t,value:t}})),this._data=t}},get_awesomplete_settings:function(){return{minChars:0,maxItems:99,autoFirst:!0,list:this.get_data(),sort:function(){return 0}}},setup_awesomplete:function(){var t=this;this.awesomplete=new Awesomplete(this.input,this.get_awesomplete_settings()),$(this.input_area).find(".awesomplete ul").css("min-width","100%"),this.$input.on("input",function(){t.awesomplete.list=t.get_data()}),this.$input.on("focus",function(){t.$input.val()||(t.$input.val(""),t.$input.trigger("input"))}),this.$input.on("awesomplete-selectcomplete",function(){t.$input.trigger("change")})},get_data:function(){return this._data||[]},set_data:function(t){this.awesomplete&&(this.awesomplete.list=t),this._data=t}}),frappe.ui.form.ControlBarcode=frappe.ui.form.ControlData.extend({make_wrapper:function(){var t=this;this._super();var e=this.$wrapper.find(".control-input-wrapper");this.barcode_area=$('<div class="barcode-wrapper border"><svg height=80></svg></div>'),frappe.require("assets/frappe/js/lib/JsBarcode.all.min.js",function(){t.barcode_area.appendTo(e)})},parse:function(t){return this.get_barcode_html(t)},set_formatted_input:function(t){var e=t,i=$(e).attr("data-barcode-value");this.$input.val(i),this.barcode_area.html(e)},get_barcode_html:function(t){var e=this.barcode_area.find("svg")[0];return JsBarcode(e,t,this.get_options(t)),$(e).attr("data-barcode-value",t),this.barcode_area.html()},get_options:function(t){var e=JSON.parse('{ "height" : 40 }');return this.isValidJson(this.df.options)&&(e=JSON.parse(this.df.options)).format&&"EAN"===e.format&&(e.format=8==t.length?"EAN8":"EAN13"),e},isValidJson:function(t){try{return JSON.parse(t),!0}catch(t){return!1}}}),frappe.ui.form.ControlGeolocation=frappe.ui.form.ControlCode.extend({make_wrapper:function(){this._super();var t=this.$wrapper.find(".control-input-wrapper");this.map_id=frappe.dom.get_unique_id(),this.map_area=$('<div class="map-wrapper border">\n\t\t\t\t<div id="'+this.map_id+'" style="min-height: 400px; z-index: 1; max-width:100%"></div>\n\t\t\t</div>'),this.map_area.prependTo(t),this.$wrapper.find(".control-input").addClass("hidden"),this.bind_leaflet_map(),this.bind_leaflet_draw_control(),this.bind_leaflet_locate_control(),this.bind_leaflet_refresh_button()},format_for_input:function(t){if(this.clear_editable_layers(),t){var e=(new L.FeatureGroup).addLayer(L.geoJson(JSON.parse(t),{pointToLayer:function(t,e){return"circle"==t.properties.point_type?L.circle(e,{radius:t.properties.radius}):"circlemarker"==t.properties.point_type?L.circleMarker(e,{radius:t.properties.radius}):L.marker(e)}}));this.add_non_group_layers(e,this.editableLayers);try{this.map.flyToBounds(this.editableLayers.getBounds(),{padding:[50,50]})}catch(t){}this.editableLayers.addTo(this.map),this.map._onResize()}else void 0!==t&&t!=JSON.stringify((new L.FeatureGroup).toGeoJSON())||this.locate_control.start()},bind_leaflet_map:function(){var t=L.Circle.prototype.toGeoJSON;L.Circle.include({toGeoJSON:function(){var e=t.call(this);return e.properties={point_type:"circle",radius:this.getRadius()},e}}),L.CircleMarker.include({toGeoJSON:function(){var e=t.call(this);return e.properties={point_type:"circlemarker",radius:this.getRadius()},e}}),L.Icon.Default.imagePath="/assets/frappe/images/leaflet/",this.map=L.map(this.map_id).setView([19.08,72.8961],13),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(this.map)},bind_leaflet_locate_control:function(){this.locate_control=L.control.locate({position:"topright"}),this.locate_control.addTo(this.map)},bind_leaflet_draw_control:function(){var t=this;this.editableLayers=new L.FeatureGroup;var e={position:"topleft",draw:{polyline:{shapeOptions:{color:frappe.ui.color.get("blue"),weight:10}},polygon:{allowIntersection:!1,drawError:{color:frappe.ui.color.get("orange"),message:"<strong>Oh snap!<strong> you can't draw that!"},shapeOptions:{color:frappe.ui.color.get("blue")}},circle:!0,rectangle:{shapeOptions:{clickable:!1}}},edit:{featureGroup:this.editableLayers,remove:!0}},i=new L.Control.Draw(e);this.map.addControl(i),this.map.on("draw:created",function(e){var i=e.layerType,a=e.layer;"marker"===i&&a.bindPopup("Marker"),t.editableLayers.addLayer(a),t.set_value(JSON.stringify(t.editableLayers.toGeoJSON()))}),this.map.on("draw:deleted draw:edited",function(e){var i=e.layer;t.editableLayers.removeLayer(i),t.set_value(JSON.stringify(t.editableLayers.toGeoJSON()))})},bind_leaflet_refresh_button:function(){L.easyButton({id:"refresh-map-"+this.df.fieldname,position:"topright",type:"replace",leafletClasses:!0,states:[{stateName:"refresh-map",onClick:function(t,e){e._onResize()},title:"Refresh map",icon:"fa fa-refresh"}]}).addTo(this.map)},add_non_group_layers:function(t,e){var i=this;t instanceof L.LayerGroup?t.eachLayer(function(t){i.add_non_group_layers(t,e)}):e.addLayer(t)},clear_editable_layers:function(){var t=this;this.editableLayers.eachLayer(function(e){t.editableLayers.removeLayer(e)})}}),frappe.ui.form.ControlMultiSelect=frappe.ui.form.ControlAutocomplete.extend({get_awesomplete_settings:function(){var t=this._super();return Object.assign(t,{filter:function(t,e){return Awesomplete.FILTER_CONTAINS(t,e.match(/[^,]*$/)[0])},item:function(t,e){return Awesomplete.ITEM(t,e.match(/[^,]*$/)[0])},replace:function(t){var e=this.input.value.match(/^.+,\s*|/)[0];this.input.value=e+t+", "}})},get_values:function(){return(this.get_value()||"").split(", ").filter(function(t){return t})},get_data:function(){var t=this.get_values();return this._super().filter(function(e){return!t.includes(e)})}}),frappe.ui.form.ControlMultiCheck=frappe.ui.form.Control.extend({make:function(){this._super(),this.$label=$('<label class="control-label">'+(this.df.label||"")+"</label>").appendTo(this.wrapper),this.$load_state=$('<div class="load-state text-muted small">'+__("Loading")+"...</div>"),this.$select_buttons=this.get_select_buttons().appendTo(this.wrapper),this.$load_state.appendTo(this.wrapper);var t=12===this.get_column_size()?"":"row";this.$checkbox_area=$('<div class="checkbox-options '+t+'"></div>').appendTo(this.wrapper),this.refresh()},refresh:function(){this.set_options(),this.bind_checkboxes(),this.refresh_input()},refresh_input:function(){this.select_options(this.selected_options)},set_options:function(){var t=this;this.$load_state.show(),this.$select_buttons.hide(),this.parse_df_options(),this.df.get_data?"function"==typeof this.df.get_data().then?this.df.get_data().then(function(e){t.options=e,t.make_checkboxes()}):(this.options=this.df.get_data(),this.make_checkboxes()):this.make_checkboxes()},parse_df_options:function(){if(Array.isArray(this.df.options))this.options=this.df.options;else if(this.df.options&&this.df.options.length>0&&frappe.utils.is_json(this.df.options)){var t=JSON.parse(this.df.options);Array.isArray(t)?this.options=t:Array.isArray(t.options)&&(this.options=t.options)}else this.options=[]},make_checkboxes:function(){var t=this;this.$load_state.hide(),this.$checkbox_area.empty(),this.options.forEach(function(e){t.get_checkbox_element(e).appendTo(t.$checkbox_area)}),this.df.select_all&&this.setup_select_all(),this.set_checked_options()},bind_checkboxes:function(){var t=this;$(this.wrapper).on("change",":checkbox",function(e){var i=$(e.target),a=i.attr("data-unit");if(i.is(":checked"))t.selected_options.push(a);else{var n=t.selected_options.indexOf(a);t.selected_options.splice(n,1)}t.df.on_change&&t.df.on_change()})},set_checked_options:function(){this.selected_options=this.options.filter(function(t){return t.checked}).map(function(t){return t.value}),this.select_options(this.selected_options)},setup_select_all:function(){var t=this;this.$select_buttons.show();var e=function(e){void 0===e&&(e=!1),$(t.wrapper).find(":checkbox").prop("checked",e).trigger("click")};this.$select_buttons.find(".select-all").on("click",function(){e()}),this.$select_buttons.find(".deselect-all").on("click",function(){e(!0)})},select_options:function(t){var e=this;this.options.map(function(t){return t.value}).forEach(function(i){var a=$(e.wrapper).find(':checkbox[data-unit="'+i+'"]')[0];a&&(a.checked=t.includes(i))})},get_value:function(){return this.selected_options},get_checked_options:function(){return this.get_value()},get_unchecked_options:function(){var t=this;return this.options.map(function(t){return t.value}).filter(function(e){return!t.selected_options.includes(e)})},get_checkbox_element:function(t){var e=this.get_column_size();return $('\n\t\t\t<div class="checkbox unit-checkbox col-sm-'+e+'">\n\t\t\t\t<label>\n\t\t\t\t<input type="checkbox" data-unit="'+t.value+'">\n\t\t\t\t</input>\n\t\t\t\t<span class="label-area small" data-unit="'+t.value+'">'+__(t.label)+"</span>\n\t\t\t\t</label>\n\t\t\t</div>")},get_select_buttons:function(){return $('<div><button class="btn btn-xs btn-default select-all">\n\t\t\t'+__("Select All")+'</button>\n\t\t\t<button class="btn btn-xs btn-default deselect-all">\n\t\t'+__("Unselect All")+"</button></div>")},get_column_size:function(){return 12/(+this.df.columns||1)}})}();
//# sourceMappingURL=control.min.js.map
