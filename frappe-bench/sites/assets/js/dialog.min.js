!function(){"use strict";frappe.provide("frappe.dom"),frappe.dom={id_count:0,freeze_count:0,by_id:function(e){return document.getElementById(e)},get_unique_id:function(){var e="unique-"+frappe.dom.id_count;return frappe.dom.id_count++,e},set_unique_id:function(e){var t=$(e);if(t.attr("id"))return t.attr("id");var i="unique-"+frappe.dom.id_count;return t.attr("id",i),frappe.dom.id_count++,i},eval:function(e){if(e){var t=document.createElement("script");t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t)}},remove_script_and_style:function(e){var t=["script","style","noscript","title","meta","base","head"];if(!new RegExp(t.map(function(e){return"<"+e+">.*<\\/"+e+">"}).join("|")).test(e))return e;var i=document.createElement("div");i.innerHTML=e;var n=!1;t.forEach(function(e){var t=i.getElementsByTagName(e);for(a=t.length;a--;)n=!0,t[a].parentNode.removeChild(t[a])});for(var s=i.getElementsByTagName("link"),a=s.length;a--;)"stylesheet"==s[a].getAttribute("rel")&&(n=!0,s[a].parentNode.removeChild(s[a]));return n?i.innerHTML:e},is_element_in_viewport:function(e){"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]);var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0},set_style:function(e,t){if(e){var i=document.createElement("style");if(i.type="text/css",t){var n=document.getElementById(t);n&&n.parentNode.removeChild(n),i.id=t}return i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(i),i}},add:function(e,t,i,n,s,a){e&&e.substr&&(e=frappe.dom.by_id(e));var r=document.createElement(t);return e&&e.appendChild(r),i&&("img"==t.toLowerCase()?r.src=i:r.className=i),n&&frappe.dom.css(r,n),s&&(r.innerHTML=s),a&&(r.onclick=a),r},css:function(e,t){return e&&t&&$.extend(e.style,t),e},activate:function(e,t,i,n){void 0===n&&(n="active"),e.find("."+i+"."+n).removeClass(n),t.addClass(n)},freeze:function(e,t){if($("#freeze").length)$("#freeze").addClass("in");else{var i=$('<div id="freeze" class="modal-backdrop fade"></div>').on("click",function(){if(cur_frm&&cur_frm.cur_grid)return cur_frm.cur_grid.toggle_view(),!1}).appendTo("#body_div");i.html(repl('<div class="freeze-message-container"><div class="freeze-message"><p class="lead">%(msg)s</p></div></div>',{msg:e||""})),setTimeout(function(){i.addClass("in")},1)}t&&$("#freeze").addClass(t),frappe.dom.freeze_count++},unfreeze:function(){if(frappe.dom.freeze_count&&(frappe.dom.freeze_count--,!frappe.dom.freeze_count))$("#freeze").removeClass("in").remove()},save_selection:function(){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount){for(var t=[],i=0,n=e.rangeCount;i<n;++i)t.push(e.getRangeAt(i));return t}}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},restore_selection:function(e){if(e)if(window.getSelection){var t=window.getSelection();t.removeAllRanges();for(var i=0,n=e.length;i<n;++i)t.addRange(e[i])}else document.selection&&e.select&&e.select()},is_touchscreen:function(){return"ontouchstart"in window}},frappe.ellipsis=function(e,t){return t||(t=20),(e=cstr(e)).length>t&&(e=e.substr(0,t)+"..."),e},frappe.run_serially=function(e){var t=Promise.resolve();return e.forEach(function(e){e&&(t=t.then?t.then(e):Promise.resolve())}),t},frappe.load_image=function(e,t,i,n){void 0===n&&(n=function(){});var s=new Image;s.onload=function(){t(this)},s.onerror=i,n(s),s.src=e},frappe.timeout=function(e){return new Promise(function(t){setTimeout(function(){return t()},1e3*e)})},frappe.scrub=function(e){return e.replace(/ /g,"_").toLowerCase()},frappe.get_modal=function(e,t){return $(frappe.render_template("modal",{title:e,content:t})).appendTo(document.body)},frappe.is_online=function(){return 1==frappe.boot.developer_mode||(!("onLine"in navigator)||navigator.onLine)},$(window).on("online",function(){frappe.show_alert({indicator:"green",message:__("You are connected to internet.")})}),$(window).on("offline",function(){frappe.show_alert({indicator:"orange",message:__("Connection lost. Some features might not work.")})}),function(e){e.fn.add_options=function(t){for(var i=0,n=t.length;i<n;i++){var s=t[i];if(is_null(s))var a=null,r=null;else{var o=is_null(s.value),l=is_null(s.label);if(o&&l)a=s,r=__(s);else a=o?"":s.value,r=l?__(a):__(s.label)}e("<option>").html(cstr(r)).attr("value",a).appendTo(this)}return this.selectedIndex=0,e(this)},e.fn.set_working=function(){this.prop("disabled",!0)},e.fn.done_working=function(){this.prop("disabled",!1)}}(jQuery),function(e){function t(t){e(t).keydown(function(e){if(9==e.which)return function(e,t){if(e.focus(),"number"==typeof e.selectionStart){var i=e.value,n=e.selectionStart;e.value=i.slice(0,n)+t+i.slice(e.selectionEnd),e.selectionEnd=e.selectionStart=n+t.length}else if(void 0!==document.selection){var s=document.selection.createRange();s.text=t,s.collapse(!1),s.select()}}(this,"\t"),!1}),e(t).keypress(function(e){if(9==e.which)return!1})}e.fn.allowTabs=function(){return this.jquery&&this.each(function(){if(1==this.nodeType){var e=this.nodeName.toLowerCase();("textarea"==e||"input"==e&&"text"==this.type)&&t(this)}}),this}}(jQuery),frappe.templates.modal='<div class="modal fade" style="overflow: auto;" tabindex="-1">  <div class="modal-dialog">   <div class="modal-content">    <div class="modal-header">                 <div class="row">                     <div class="col-xs-7">       <span class="indicator hidden"></span>                         <h4 class="modal-title" style="font-weight: bold;">{%= title %}</h4>                     </div>                     <div class="col-xs-5">                         <div class="text-right buttons">                 <button type="button" class="btn btn-default btn-sm btn-modal-close"                                 data-dismiss="modal">         <i class="octicon octicon-x visible-xs" style="padding: 1px 0px;"></i>         <span class="hidden-xs">{%= __("Close") %}</span></button>                 <button type="button" class="btn btn-primary btn-sm hide">                                 {%= __("Confirm") %}</button>                         </div>                     </div>                 </div>    </div>    <div class="modal-body ui-front">{%= content %}    </div>   </div>  </div> </div> ',frappe.provide("frappe.form.formatters"),frappe.form.link_formatters={},frappe.form.formatters={_right:function(e,t){return t&&(t.inline||t.only_value)?e:"<div style='text-align: right'>"+e+"</div>"},Data:function(e){return null==e?"":e},Select:function(e){return __(frappe.form.formatters.Data(e))},Float:function(e,t,i,n){var s=t.precision||cint(frappe.boot.sysdefaults.float_precision)||null;if(t.options&&t.options.trim())return t.precision=s,frappe.form.formatters.Currency(e,t,i,n);if(!(i||{}).always_show_decimals&&!is_null(e)){var a=cstr(e).split(".");null!=a[1]&&0!==cint(a[1])||(s=0)}return frappe.form.formatters._right(null==e||""===e?"":format_number(e,null,s),i)},Int:function(e,t,i){return frappe.form.formatters._right(null==e?"":cint(e),i)},Percent:function(e,t,i){return frappe.form.formatters._right(flt(e,2)+"%",i)},Currency:function(e,t,i,n){var s=frappe.meta.get_field_currency(t,n),a=t.precision||cint(frappe.boot.sysdefaults.currency_precision)||2;if(a>2){var r=cstr(e).split("."),o=r.length>1?r[1]:"";if(o.length<3||o.length<a){var l=frappe.model.get_value(":Currency",s,"fraction_units")||100;a=cstr(l).length-1}}return e=null==e||""==e?"":format_currency(e,s,a),i&&i.only_value?e:frappe.form.formatters._right(e,i)},Check:function(e){return e?'<i class="octicon octicon-check" style="margin-right: 3px;"></i>':'<i class="fa fa-square disabled-check"></i>'},Link:function(e,t,i,n){var s=t._options||t.options,a=e;return e&&e.match&&e.match(/^['"].*['"]$/)&&e.replace(/^.(.*).$/,"$1"),i&&(i.for_print||i.only_value)?e:(frappe.form.link_formatters[s]&&n&&s!==n.doctype&&(e=frappe.form.link_formatters[s](e,n)),e?"'"==e[0]&&"'"==e[e.length-1]?e.substring(1,e.length-1):t&&t.link_onclick?repl('<a onclick="%(onclick)s">%(value)s</a>',{onclick:t.link_onclick.replace(/"/g,"&quot;"),value:e}):t&&s?repl('<a class="grey" href="#Form/%(doctype)s/%(name)s" data-doctype="%(doctype)s">%(label)s</a>',{doctype:encodeURIComponent(s),name:encodeURIComponent(a),label:__(i&&i.label||e)}):e:"")},Date:function(e){return e&&"Invalid date"===(e=frappe.datetime.str_to_user(e))&&(e=null),e||""},DateRange:function(e){return $.isArray(e)?__("{0} to {1}",[frappe.datetime.str_to_user(e[0]),frappe.datetime.str_to_user(e[1])]):e||""},Datetime:function(e){if(e){var t=moment(frappe.datetime.convert_to_user_tz(e));return frappe.boot.sysdefaults.time_zone&&(t=t.tz(frappe.boot.sysdefaults.time_zone)),t.format(frappe.boot.sysdefaults.date_format.toUpperCase()+", h:mm a z")}return""},Text:function(e){if(e){for(var t=["<p","<div","<br","<table"],i=!1,n=0;n<t.length;n++)if(e.match(t[n])){i=!0;break}i||(e=replace_newlines(e))}return frappe.form.formatters.Data(e)},LikedBy:function(e){var t="";return $.each(JSON.parse(e||"[]"),function(e,i){i&&(t+=frappe.avatar(i))}),t},Tag:function(e){var t="";return $.each((e||"").split(","),function(e,i){i&&(t+='<span class="label label-info" \t\t\t\tstyle="margin-right: 7px; cursor: pointer;"\t\t\t\tdata-field="_user_tags" data-label="'+i+'">'+i+"</span>")}),t},Comment:function(e){var t="";return $.each(JSON.parse(e||"[]"),function(e,i){i&&(t+='<span class="label label-warning" \t\t\t\tstyle="margin-right: 7px;"\t\t\t\tdata-field="_comments" data-label="'+i.name+'">'+i.comment+"</span>")}),t},Assign:function(e){var t="";return $.each(JSON.parse(e||"[]"),function(e,i){i&&(t+='<span class="label label-warning" \t\t\t\tstyle="margin-right: 7px;"\t\t\t\tdata-field="_assign">'+i+"</span>")}),t},SmallText:function(e){return frappe.form.formatters.Text(e)},TextEditor:function(e){return frappe.form.formatters.Text(e)},Code:function(e){return"<pre>"+(null==e?"":$("<div>").text(e).html())+"</pre>"},WorkflowState:function(e){var t=frappe.get_doc("Workflow State",e);return t?repl("<span class='label label-%(style)s' \t\t\t\tdata-workflow-state='%(value)s'\t\t\t\tstyle='padding-bottom: 4px; cursor: pointer;'>\t\t\t\t<i class='fa fa-small fa-white fa-%(icon)s'></i> %(value)s</span>",{value:e,style:t.style.toLowerCase(),icon:t.icon}):"<span class='label'>"+e+"</span>"},Email:function(e){return $("<div></div>").text(e).html()},FileSize:function(e){return e>1048576?e=flt(flt(e)/1048576,1)+"M":e>1024&&(e=flt(flt(e)/1024,1)+"K"),e}},frappe.form.get_formatter=function(e){return e||(e="Data"),frappe.form.formatters[e.replace(/ /g,"")]||frappe.form.formatters.Data},frappe.format=function(e,t,i,n){t||(t={fieldtype:"Data"});var s=t.fieldtype||"Data";"Dynamic Link"===s&&(s="Link",t._options=n?n[t.options]:null);var a=(t.formatter||frappe.form.get_formatter(s))(e,t,i,n);return"string"==typeof a&&(a=frappe.dom.remove_script_and_style(a)),a},frappe.get_format_helper=function(e){var t={get_formatted:function(t){var i=frappe.meta.get_docfield(e.doctype,t);return i||console.log("fieldname not found: "+t),frappe.format(e[t],i,{inline:1},e)}};return $.extend(t,e),t};var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};!function(e){var t=/xyz/.test(function(){})?/\b_super\b/:/.*/;function i(){}i.extend=function(e){var n=this.prototype,s=Object.create(n);for(var a in e)s[a]="function"==typeof e[a]&&"function"==typeof n[a]&&t.test(e[a])?function(e,t){return function(){var i=this._super;this._super=n[e];var s=t.apply(this,arguments);return this._super=i,s}}(a,e[a]):e[a];var r="function"==typeof s.init?s.hasOwnProperty("init")?s.init:function(){n.init.apply(this,arguments)}:function(){};return r.prototype=s,s.constructor=r,r.extend=i.extend,r},e.Class=i}(commonjsGlobal),frappe.provide("frappe.ui.form"),frappe.ui.form.Layout=Class.extend({init:function(e){this.views={},this.pages=[],this.sections=[],this.fields_list=[],this.fields_dict={},$.extend(this,e)},make:function(){!this.parent&&this.body&&(this.parent=this.body),this.wrapper=$('<div class="form-layout">').appendTo(this.parent),this.message=$('<div class="form-message text-muted small hidden"></div>').appendTo(this.wrapper),this.fields||(this.fields=this.get_doctype_fields()),this.setup_tabbing(),this.render()},show_empty_form_message:function(){this.wrapper.find(".frappe-control:visible").length||this.wrapper.find(".section-head.collapsed").length||this.show_message(__("This form does not have any input"))},get_doctype_fields:function(){var e=[{parent:this.frm.doctype,fieldtype:"Data",fieldname:"__newname",reqd:1,hidden:1,label:__("Name"),get_status:function(e){return e.frm&&e.frm.is_new()&&e.frm.meta.autoname&&["prompt","name"].includes(e.frm.meta.autoname.toLowerCase())?"Write":"None"}}];return e=e.concat(frappe.meta.sort_docfields(frappe.meta.docfield_map[this.doctype]))},show_message:function(e){e?("<"!==e.substr(0,1)&&(e="<div>"+e+"</div>"),$(e).appendTo(this.message.removeClass("hidden"))):this.message.empty().addClass("hidden")},render:function(e){var t=this,i=e||this.fields;this.section=null,this.column=null,this.with_dashboard&&this.setup_dashboard_section(),this.no_opening_section()&&this.make_section(),$.each(i,function(e,i){switch(i.fieldtype){case"Fold":t.make_page(i);break;case"Section Break":t.make_section(i);break;case"Column Break":t.make_column(i);break;default:t.make_field(i)}})},no_opening_section:function(){return this.fields[0]&&"Section Break"!=this.fields[0].fieldtype||!this.fields.length},setup_dashboard_section:function(){this.no_opening_section()&&this.fields.unshift({fieldtype:"Section Break"}),this.fields.unshift({fieldtype:"Section Break",fieldname:"_form_dashboard",label:__("Dashboard"),cssClass:"form-dashboard",collapsible:1})},replace_field:function(e,t,i){if(t.fieldname=e,this.fields_dict[e]&&this.fields_dict[e].df){var n=this.init_field(t,i);this.fields_dict[e].$wrapper.remove(),this.fields_list.splice(this.fields_dict[e],1,n),this.fields_dict[e]=n,this.frm&&(n.perm=this.frm.perm),this.section.fields_list.splice(this.section.fields_dict[e],1,n),this.section.fields_dict[e]=n,this.refresh_fields([t])}},make_field:function(e,t,i){!this.section&&this.make_section(),!this.column&&this.make_column();var n=this.init_field(e,i);this.fields_list.push(n),this.fields_dict[e.fieldname]=n,this.frm&&(n.perm=this.frm.perm),this.section.fields_list.push(n),this.section.fields_dict[e.fieldname]=n},init_field:function(e,t){void 0===t&&(t=!1);var i=frappe.ui.form.make_control({df:e,doctype:this.doctype,parent:this.column.wrapper.get(0),frm:this.frm,render_input:t});return i.layout=this,i},make_page:function(e){var t=this,i=$('<div class="form-clickable-section text-center">\t\t\t\t<a class="btn-fold h6 text-muted">'+__("Show more details")+"</a>\t\t\t</div>").appendTo(this.wrapper);this.page=$('<div class="form-page second-page hide"></div>').appendTo(this.wrapper),this.fold_btn=i.find(".btn-fold").on("click",function(){var e=$(this).parent().next();e.hasClass("hide")?($(this).removeClass("btn-fold").html(__("Hide details")),e.removeClass("hide"),frappe.utils.scroll_to($(this),!0,30),t.folded=!1):($(this).addClass("btn-fold").html(__("Show more details")),e.addClass("hide"),t.folded=!0)}),this.section=null,this.folded=!0},unfold:function(){this.fold_btn.trigger("click")},make_section:function(e){this.section=new frappe.ui.form.Section(this,e),e&&(this.fields_dict[e.fieldname]=this.section,this.fields_list.push(this.section)),this.column=null},make_column:function(e){this.column=new frappe.ui.form.Column(this.section,e),e&&e.fieldname&&this.fields_list.push(this.column)},refresh:function(e){e&&(this.doc=e),this.frm&&this.wrapper.find(".empty-form-alert").remove(),this.attach_doc_and_docfields(!0),this.frm&&this.frm.wrapper&&$(this.frm.wrapper).trigger("refresh-fields"),this.refresh_dependency(),this.refresh_sections(),this.frm&&this.refresh_section_collapse()},refresh_sections:function(){var e=0;this.wrapper.find(".form-section:not(.hide-control)").each(function(){var t=$(this).removeClass("empty-section").removeClass("visible-section").removeClass("shaded-section");t.find(".frappe-control:not(.hide-control)").length||t.hasClass("form-dashboard")?(t.addClass("visible-section"),e%2&&t.addClass("shaded-section"),e++):t.addClass("empty-section")})},refresh_fields:function(e){var t=e.map(function(e){if(e.fieldname)return e.fieldname});this.fields_list.map(function(e){t.includes(e.df.fieldname)&&(e.refresh(),e.df.default&&e.set_input(e.df.default))})},add_fields:function(e){this.render(e),this.refresh_fields(e)},refresh_section_collapse:function(){if(this.doc)for(var e=0;e<this.sections.length;e++){var t=this.sections[e],i=t.df;if(i&&i.collapsible){var n=!0;i.collapsible_depends_on&&(n=!this.evaluate_depends_on_value(i.collapsible_depends_on)),n&&t.has_missing_mandatory()&&(n=!1),"_form_dashboard"===i.fieldname&&(n=!1),t.collapse(n)}}},attach_doc_and_docfields:function(e){for(var t=this,i=0,n=this.fields_list.length;i<n;i++){var s=this.fields_list[i];t.doc&&(s.doc=t.doc,s.doctype=t.doc.doctype,s.docname=t.doc.name,s.df=frappe.meta.get_docfield(t.doc.doctype,s.df.fieldname,t.frm?t.frm.doc.name:t.doc.name)||s.df,t.frm&&(s.perm=t.frm.perm)),e&&s.refresh&&s.refresh()}},refresh_section_count:function(){this.wrapper.find(".section-count-label:visible").each(function(e){$(this).html(e+1)})},setup_tabbing:function(){var e=this;this.wrapper.on("keydown",function(t){if(9==t.which){var i=$(t.target),n=i.attr("data-doctype"),s=i.attr("data-fieldname");if(n)return e.handle_tab(n,s,t.shiftKey)}})},handle_tab:function(e,t,i){var n=null,s=null,a=this.fields_list,r=!1;if(e!=this.doctype){if(!(n=this.get_open_grid_row())||!n.layout)return;a=n.layout.fields_list}for(var o=0,l=a.length;o<l;o++){if(a[o].df.fieldname==t){if(i){s?this.set_focus(s):$(this.primary_button).focus();break}if(o<l-1&&(r=this.focus_on_next_field(o,a)),r)break}this.is_visible(a[o])&&(s=a[o])}return r||(n?n.doc.idx==n.grid.grid_rows.length?n.toggle_view(!1,function(){n.grid.frm.layout.handle_tab(n.grid.df.parent,n.grid.df.fieldname)}):n.grid.grid_rows[n.doc.idx].toggle_view(!0):$(this.primary_button).focus()),!1},focus_on_next_field:function(e,t){for(var i=e+1,n=t.length;i<n;i++){var s=t[i];if(this.is_visible(s)){if("Table"===s.df.fieldtype)return s.grid.grid_rows&&s.grid.grid_rows.length||s.grid.add_new_row(),s.grid.grid_rows[0].show_form(),!0;if(!in_list(frappe.model.no_value_type,s.df.fieldtype))return this.set_focus(s),!0}}},is_visible:function(e){return"Write"===e.disp_status&&e.$wrapper&&e.$wrapper.is(":visible")},set_focus:function(e){"Table"==e.df.fieldtype?e.grid.grid_rows.length?e.grid.grid_rows[0].toggle_view(!0):e.grid.add_new_row(1):e.editor?e.editor.set_focus():e.$input&&e.$input.focus()},get_open_grid_row:function(){return $(".grid-row-open").data("grid_row")},refresh_dependency:function(){var e=!1;for(var t in this.fields_list){(n=this.fields_list[t]).dependencies_clear=!0,n.df.depends_on&&(e=!0)}if(e){for(var i=this.fields_list.length-1;i>=0;i--){var n;(n=this.fields_list[i]).guardian_has_value=!0,n.df.depends_on&&(n.guardian_has_value=this.evaluate_depends_on_value(n.df.depends_on),n.guardian_has_value?n.df.hidden_due_to_dependency&&(n.df.hidden_due_to_dependency=!1,n.refresh()):n.df.hidden_due_to_dependency||(n.df.hidden_due_to_dependency=!0,n.refresh()))}this.refresh_section_count()}},evaluate_depends_on_value:function(expression){var out=null,doc=this.doc;if(!doc&&this.get_values)var doc=this.get_values(!0);if(doc){var parent=this.frm?this.frm.doc:null;if("eval:"==expression.substr(0,5))try{out=eval(expression.substr(5))}catch(e){frappe.throw(__('Invalid "depends_on" expression'))}else if("fn:"==expression.substr(0,3)&&this.frm)out=this.frm.script_manager.trigger(expression.substr(3),this.doctype,this.docname);else{var value=doc[expression];out=$.isArray(value)?!!value.length:!!value}return out}}}),frappe.ui.form.Section=Class.extend({init:function(e,t){this.layout=e,this.df=t||{},this.fields_list=[],this.fields_dict={},this.make(),this.row={wrapper:this.wrapper},this.df.collapsible&&this.collapse(!0),this.refresh()},make:function(){this.layout.page||(this.layout.page=$('<div class="form-page"></div>').appendTo(this.layout.wrapper)),this.wrapper=$('<div class="row form-section">').appendTo(this.layout.page),this.layout.sections.push(this),this.df&&(this.df.label&&this.make_head(),this.df.description&&$('<div class="col-sm-12 small text-muted form-section-description">'+__(this.df.description)+"</div>").appendTo(this.wrapper),this.df.cssClass&&this.wrapper.addClass(this.df.cssClass)),this.body=$('<div class="section-body">').appendTo(this.wrapper)},make_head:function(){var e=this;this.df.collapsible?(this.head=$('<div class="section-head"><a class="h6 uppercase">'+__(this.df.label)+'</a><span class="octicon octicon-chevron-down collapse-indicator"></span></div>').appendTo(this.wrapper),this.collapse_link=this.head.on("click",function(){e.collapse()}),this.indicator=this.head.find(".collapse-indicator")):$('<div class="col-sm-12"><h6 class="form-section-heading uppercase">'+__(this.df.label)+"</h6></div>").appendTo(this.wrapper)},refresh:function(){if(this.df){var e=this.df.hidden||this.df.hidden_due_to_dependency;!e&&this.layout&&this.layout.frm&&!this.layout.frm.get_perm(this.df.permlevel||0,"read")&&(e=!0),this.wrapper.toggleClass("hide-control",!!e)}},collapse:function(e){this.head&&this.body&&(void 0===e&&(e=!this.body.hasClass("hide")),this.body.toggleClass("hide",e),this.head.toggleClass("collapsed",e),this.indicator.toggleClass("octicon-chevron-down",e),this.indicator.toggleClass("octicon-chevron-up",!e),this.fields_list.forEach(function(e){"Signature"==e.df.fieldtype&&e.refresh()}))},has_missing_mandatory:function(){for(var e=!1,t=0,i=this.fields_list.length;t<i;t++){var n=this.fields_list[t].df;if(n.reqd&&null==this.layout.doc[n.fieldname]){e=!0;break}}return e}}),frappe.ui.form.Column=Class.extend({init:function(e,t){t||(t={}),this.df=t,this.section=e,this.make(),this.resize_all_columns()},make:function(){this.wrapper=$('<div class="form-column">\t\t\t<form>\t\t\t</form>\t\t</div>').appendTo(this.section.body).find("form").on("submit",function(){return!1}),this.df.label&&$('<label class="control-label">'+__(this.df.label)+"</label>").appendTo(this.wrapper)},resize_all_columns:function(){var e=cint(12/this.section.wrapper.find(".form-column").length);this.section.wrapper.find(".form-column").removeClass().addClass("form-column").addClass("col-sm-"+e)},refresh:function(){this.section.refresh()}}),frappe.provide("frappe.ui"),frappe.ui.FieldGroup=frappe.ui.form.Layout.extend({init:function(e){$.extend(this,e),this._super(),$.each(this.fields||[],function(e,t){!t.fieldname&&t.label&&(t.fieldname=t.label.replace(/ /g,"_").toLowerCase())}),this.values&&this.set_values(this.values)},make:function(){var e=this;this.fields&&(this._super(),this.refresh(),$.each(this.fields_list,function(t,i){i.df.default&&(i.set_input(i.df.default),e.refresh_dependency())}),this.no_submit_on_enter||this.catch_enter_as_submit(),$(this.body).find("input, select").on("change",function(){frappe.run_serially([function(){return frappe.timeout(.1)},function(){return e.refresh_dependency()}])}))},first_button:!1,focus_on_first_input:function(){this.no_focus||$.each(this.fields_list,function(e,t){if(!in_list(["Date","Datetime","Time","Check"],t.df.fieldtype)&&t.set_focus)return t.set_focus(),!1})},catch_enter_as_submit:function(){var e=this;$(this.body).find('input[type="text"], input[type="password"]').keypress(function(t){13==t.which&&e.has_primary_action&&(t.preventDefault(),e.get_primary_btn().trigger("click"))})},get_input:function(e){var t=this.fields_dict[e];return $(t.txt?t.txt:t.input)},get_field:function(e){return this.fields_dict[e]},get_values:function(e){var t={},i=[];for(var n in this.fields_dict){var s=this.fields_dict[n];if(s.get_value){var a=s.get_value();s.df.reqd&&is_null(a)&&i.push(__(s.df.label)),is_null(a)||(t[s.df.fieldname]=a)}}return i.length&&!e?(frappe.msgprint({title:__("Missing Values Required"),message:__("Following fields have missing values:")+"<br><br><ul><li>"+i.join("<li>")+"</ul>",indicator:"orange"}),null):t},get_value:function(e){var t=this.fields_dict[e];return t&&(t.get_value?t.get_value():null)},set_value:function(e,t){var i=this;return new Promise(function(n){var s=i.fields_dict[e];s?s.set_value(t).then(function(){s.set_input(t),i.refresh_dependency(),n()}):n()})},set_input:function(e,t){return this.set_value(e,t)},set_values:function(e){for(var t in e)this.fields_dict[t]&&this.set_value(t,e[t])},clear:function(){for(var e in this.fields_dict){var t=this.fields_dict[e];t&&t.set_input&&t.set_input(t.df.default||"")}},set_df_property:function(e,t,i){var n=this.get_field(e);n.df[t]=i,n.refresh()}}),frappe.ui.form.LinkSelector=Class.extend({init:function(e){$.extend(this,e);var t=this;"[Select]"!=this.doctype?frappe.model.with_doctype(this.doctype,function(e){t.make()}):this.make()},make:function(){var e=this;this.dialog=new frappe.ui.Dialog({title:__("Select {0}",["[Select]"==this.doctype?__("value"):__(this.doctype)]),fields:[{fieldtype:"Data",fieldname:"txt",label:__("Beginning with"),description:__("You can use wildcard %")},{fieldtype:"HTML",fieldname:"results"}],primary_action_label:__("Search"),primary_action:function(){e.search()}}),this.txt&&this.dialog.fields_dict.txt.set_input(this.txt),this.dialog.get_input("txt").on("keypress",function(t){13===t.which&&e.search()}),this.dialog.show(),this.search()},search:function(){var e={txt:this.dialog.fields_dict.txt.get_value(),searchfield:"name"},t=this;this.target.set_custom_query&&this.target.set_custom_query(e),this.target.is_grid&&this.target.fieldinfo[this.fieldname]&&this.target.fieldinfo[this.fieldname].get_query&&$.extend(e,this.target.fieldinfo[this.fieldname].get_query(cur_frm.doc)),frappe.link_search(this.doctype,e,function(e){var i=t.dialog.fields_dict.results.$wrapper;i.empty(),e.values.length?$.each(e.values,function(e,n){$(repl('<div class="row link-select-row">\t\t\t\t\t\t<div class="col-xs-4">\t\t\t\t\t\t\t<b><a href="#">%(name)s</a></b></div>\t\t\t\t\t\t<div class="col-xs-8">\t\t\t\t\t\t\t<span class="text-muted">%(values)s</span></div>\t\t\t\t\t\t</div>',{name:n[0],values:n.splice(1).join(", ")})).appendTo(i).find("a").attr("data-value",n[0]).click(function(){var e=$(this).attr("data-value");return t.target.is_grid?t.set_in_grid(e):(t.target.doctype?t.target.parse_validate_and_set_in_model(e):(t.target.set_input(e),t.target.$input.trigger("change")),t.dialog.hide()),!1})}):$('<p><br><span class="text-muted">'+__("No Results")+"</span>"+(frappe.model.can_create(t.doctype)?'<br><br><a class="new-doc btn btn-default btn-sm">'+__("Make a new {0}",[__(t.doctype)])+"</a>":"")+"</p>").appendTo(i).find(".new-doc").click(function(){frappe.new_doc(t.doctype)})},this.dialog.get_primary_btn())},set_in_grid:function(e){var t=this,i=!1,n=null;if(this.qty_fieldname)frappe.prompt({fieldname:"qty",fieldtype:"Float",label:"Qty",default:1,reqd:1},function(s){$.each(t.target.frm.doc[t.target.df.fieldname]||[],function(n,a){if(a[t.fieldname]===e)return frappe.model.set_value(a.doctype,a.name,t.qty_fieldname,s.qty),frappe.show_alert(__("Added {0} ({1})",[e,a[t.qty_fieldname]])),i=!0,!1}),i||frappe.run_serially([function(){n=t.target.add_new_row()},function(){return frappe.timeout(.1)},function(){return frappe.model.set_value(n.doctype,n.name,t.fieldname,e)},function(){return frappe.timeout(.5)},function(){return frappe.model.set_value(n.doctype,n.name,t.qty_fieldname,s.qty)},function(){return frappe.show_alert(__("Added {0} ({1})",[e,s.qty]))}])},__("Set Quantity"),__("Set"));else{n=t.target.add_new_row();frappe.model.set_value(n.doctype,n.name,t.fieldname,e),frappe.show_alert(__("{0} added",[e]))}}}),frappe.link_search=function(e,t,i,n){t||(t={txt:""}),t.doctype=e,t.searchfield||(t.searchfield="name"),frappe.call({method:"frappe.desk.search.search_widget",type:"GET",args:t,callback:function(e){i&&i(e)},btn:n})},frappe.ui.form.MultiSelectDialog=Class.extend({init:function(e){$.extend(this,e);var t=this;"[Select]"!=this.doctype?frappe.model.with_doctype(this.doctype,function(e){t.make()}):this.make()},make:function(){var e=this;this.page_length=20;var t=[{fieldtype:"Data",label:__("Search Term"),fieldname:"search_term"},{fieldtype:"Column Break"}],i=0;this.date_field||(this.date_field="transaction_date"),Object.keys(this.setters).forEach(function(n){t.push({fieldtype:e.target.fields_dict[n].df.fieldtype,label:e.target.fields_dict[n].df.label,fieldname:n,options:e.target.fields_dict[n].df.options,default:e.setters[n]}),i++<Object.keys(e.setters).length&&t.push({fieldtype:"Column Break"})}),t=t.concat([{fieldname:"date_range",label:__("Date Range"),fieldtype:"DateRange"},{fieldtype:"Section Break"},{fieldtype:"HTML",fieldname:"results_area"},{fieldtype:"Button",fieldname:"make_new",label:__("Make a new "+e.doctype)}]);var n=this.doctype.endsWith("y")?this.doctype.slice(0,-1)+"ies":this.doctype+"s";this.dialog=new frappe.ui.Dialog({title:__("Select {0}",["[Select]"==this.doctype?__("value"):__(n)]),fields:t,primary_action_label:__("Get Items"),primary_action:function(){e.action(e.get_checked_values(),e.args)}}),this.$parent=$(this.dialog.body),this.$wrapper=this.dialog.fields_dict.results_area.$wrapper.append('<div class="results"\n\t\t\tstyle="border: 1px solid #d1d8dd; border-radius: 3px; height: 300px; overflow: auto;"></div>'),this.$results=this.$wrapper.find(".results"),this.$make_new_btn=this.dialog.fields_dict.make_new.$wrapper,this.$placeholder=$('<div class="multiselect-empty-state">\n\t\t\t\t\t<span class="text-center" style="margin-top: -40px;">\n\t\t\t\t\t\t<i class="fa fa-2x fa-tags text-extra-muted"></i>\n\t\t\t\t\t\t<p class="text-extra-muted">No '+this.doctype+' found</p>\n\t\t\t\t\t\t<button class="btn btn-default btn-xs text-muted" data-fieldtype="Button"\n\t\t\t\t\t\t\tdata-fieldname="make_new" placeholder="" value="">Make a new '+this.doctype+"</button>\n\t\t\t\t\t</span>\n\t\t\t\t</div>"),this.args={},this.bind_events(),this.get_results(),this.dialog.show()},bind_events:function(){var e=this,t=this;this.$results.on("click",".list-item-container",function(e){$(e.target).is(":checkbox")||$(e.target).is("a")||$(this).find(":checkbox").trigger("click")}),this.$results.on("click",".list-item--head :checkbox",function(t){e.$results.find(".list-item-container .list-row-check").prop("checked",$(t.target).is(":checked"))}),this.$parent.find(".input-with-feedback").on("change",function(t){e.get_results()}),this.$parent.find('[data-fieldname="date_range"]').on("blur",function(t){e.get_results()}),this.$parent.find('[data-fieldname="search_term"]').on("input",function(i){var n=$(e);clearTimeout(n.data("timeout")),n.data("timeout",setTimeout(function(){t.get_results()},300))}),this.$parent.on("click",'.btn[data-fieldname="make_new"]',function(i){frappe.route_options={},Object.keys(e.setters).forEach(function(e){frappe.route_options[e]=t.dialog.fields_dict[e].get_value()||void 0}),frappe.new_doc(e.doctype,!0)})},get_checked_values:function(){return this.$results.find(".list-item-container").map(function(){if($(this).find(".list-row-check:checkbox:checked").length>0)return $(this).attr("data-item-name")}).get()},make_list_row:function(e){void 0===e&&(e={});var t=this,i=0===Object.keys(e).length,n="";["name"].concat(Object.keys(this.setters)).concat("Date").forEach(function(s){n+='<div class="list-item__content ellipsis">\n\t\t\t\t'+(i?'<span class="ellipsis">'+__(frappe.model.unscrub(s))+"</span>":"name"!==s?'<span class="ellipsis">'+__(e[s])+"</span>":'<a href="#Form/'+t.doctype+"/"+e[s]+'" class="list-id ellipsis">\n\t\t\t\t\t\t\t'+__(e[s])+"</a>")+"\n\t\t\t</div>"});var s=$('<div class="list-item">\n\t\t\t<div class="list-item__content" style="flex: 0 0 10px;">\n\t\t\t\t<input type="checkbox" class="list-row-check" '+(e.checked?"checked":"")+">\n\t\t\t</div>\n\t\t\t"+n+"\n\t\t</div>");return i?s.addClass("list-item--head"):s=$('<div class="list-item-container" data-item-name="'+e.name+'"></div>').append(s),s},render_result_list:function(e,t){void 0===t&&(t=0);var i=this;if(this.$results.empty(),0===e.length)return this.$make_new_btn.addClass("hide"),void this.$results.append(i.$placeholder);if(this.$make_new_btn.removeClass("hide"),this.$results.append(this.make_list_row()),e.forEach(function(e){i.$results.append(i.make_list_row(e))}),t){var n=__("Only {0} entries shown. Please filter for more specific results.",[this.page_length]);i.$results.append($('<div class="text-muted small" style="text-align: center;\n\t\t\t\tmargin: 10px;">'+n+"</div>"))}},get_results:function(){var e=this,t=this.get_query?this.get_query().filters:{};Object.keys(this.setters).forEach(function(i){t[i]=e.dialog.fields_dict[i].get_value()||void 0,e.args[i]=t[i]});var i=this.dialog.fields_dict.date_range.get_value();i&&(t[this.date_field]=["between",i]);var n={doctype:e.doctype,txt:e.dialog.fields_dict.search_term.get_value(),filters:t,filter_fields:Object.keys(e.setters).concat([e.date_field]),page_length:this.page_length+1,query:this.get_query?this.get_query().query:"",as_dict:1};frappe.call({type:"GET",method:"frappe.desk.search.search_widget",no_spinner:!0,args:n,callback:function(t){var i=[],n=0;t.values.length&&(t.values.length>e.page_length&&(t.values.pop(),n=1),t.values.forEach(function(t){e.date_field in t&&(t.Date=t[e.date_field]),t.checked=0,t.parsed_date=Date.parse(t.Date),i.push(t)}),i.map(function(e){e.Date=frappe.format(e.Date,{fieldtype:"Date"})}),i.sort(function(e,t){return e.parsed_date-t.parsed_date}),i[0].checked=1),e.render_result_list(i,n)}})}}),frappe.provide("frappe.ui"),window.cur_dialog=null,frappe.ui.open_dialogs=[],frappe.ui.Dialog=frappe.ui.FieldGroup.extend({init:function(e){this.display=!1,this.is_dialog=!0,$.extend(this,{animate:!0,size:null},e),this._super(),this.make()},make:function(){this.$wrapper=frappe.get_modal("",""),this.wrapper=this.$wrapper.find(".modal-dialog").get(0),"small"==this.size?$(this.wrapper).addClass("modal-sm"):"large"==this.size&&$(this.wrapper).addClass("modal-lg"),this.make_head(),this.body=this.$wrapper.find(".modal-body").get(0),this.header=this.$wrapper.find(".modal-header"),this._super(),this.action=this.action||{primary:{},secondary:{}},!this.primary_action&&frappe.utils.is_empty(this.action.primary)||this.set_primary_action(this.primary_action_label||this.action.primary.label||__("Submit"),this.primary_action||this.action.primary.onsubmit),!this.secondary_action_label&&frappe.utils.is_empty(this.action.secondary)||this.get_close_btn().html(this.secondary_action_label||this.action.secondary.label);var e=this;this.$wrapper.on("hide.bs.modal",function(){e.display=!1,frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1]===e&&(frappe.ui.open_dialogs.pop(),frappe.ui.open_dialogs.length?window.cur_dialog=frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1]:window.cur_dialog=null),e.onhide&&e.onhide(),e.on_hide&&e.on_hide()}).on("shown.bs.modal",function(){e.display=!0,window.cur_dialog=e,frappe.ui.open_dialogs.push(e),e.focus_on_first_input(),e.on_page_show&&e.on_page_show()}).on("scroll",function(){var e=$("input:focus");e.length&&["Date","Datetime","Time"].includes(e.attr("data-fieldtype"))&&e.blur()})},get_primary_btn:function(){return this.$wrapper.find(".modal-header .btn-primary")},set_primary_action:function(e,t){this.has_primary_action=!0;var i=this;return this.get_primary_btn().removeClass("hide").html(e).click(function(){i.primary_action_fulfilled=!0;var e=i.get_values();e&&t&&t.apply(i,[e])})},disable_primary_action:function(){this.get_primary_btn().addClass("disabled")},enable_primary_action:function(){this.get_primary_btn().removeClass("disabled")},make_head:function(){this.set_title(this.title)},set_title:function(e){this.$wrapper.find(".modal-title").html(e)},show:function(){this.animate?this.$wrapper.addClass("fade"):this.$wrapper.removeClass("fade"),this.$wrapper.modal("show"),this.primary_action_fulfilled=!1,this.is_visible=!0},hide:function(){this.$wrapper.modal("hide"),this.is_visible=!1},get_close_btn:function(){return this.$wrapper.find(".btn-modal-close")},no_cancel:function(){this.get_close_btn().toggle(!1)},cancel:function(){this.get_close_btn().trigger("click")}})}();
//# sourceMappingURL=dialog.min.js.map
