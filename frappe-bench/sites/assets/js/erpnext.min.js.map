{"version":3,"file":"erpnext.min.js","sources":["../../../apps/erpnext/erpnext/public/js/conf.js","../../../apps/erpnext/erpnext/public/js/utils.js","../../../apps/erpnext/erpnext/public/js/queries.js","../../../apps/erpnext/erpnext/public/js/sms_manager.js","../../../apps/erpnext/erpnext/public/js/utils/party.js","../../../apps/erpnext/erpnext/public/js/controllers/stock_controller.js","../../../apps/erpnext/erpnext/public/js/payment/payments.js","../../../apps/erpnext/erpnext/public/js/controllers/taxes_and_totals.js","../../../apps/erpnext/erpnext/public/js/controllers/transaction.js","../../../apps/erpnext/erpnext/public/js/utils/item_selector.js","../../../apps/erpnext/erpnext/public/js/help_links.js","../../../apps/erpnext/erpnext/public/js/agriculture/ternary_plot.js","../../../apps/erpnext/erpnext/public/js/utils/item_quick_entry.js","../../../apps/erpnext/erpnext/public/js/utils/customer_quick_entry.js","../../../apps/erpnext/erpnext/public/js/hub/hub_factory.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide('erpnext');\n\n// add toolbar icon\n$(document).bind('toolbar_setup', function() {\n\tfrappe.app.name = \"ERPNext\";\n\n\tfrappe.help_feedback_link = '<p><a class=\"text-muted\" \\\n\t\thref=\"https://discuss.erpnext.com\">Feedback</a></p>'\n\n\n\t$('.navbar-home').html('<img class=\"erpnext-icon\" src=\"'+\n\t\t\tfrappe.urllib.get_base_url()+'/assets/erpnext/images/erp-icon.svg\" />');\n\n\t$('[data-link=\"docs\"]').attr(\"href\", \"https://frappe.github.io/erpnext/\")\n\t$('[data-link=\"issues\"]').attr(\"href\", \"https://github.com/frappe/erpnext/issues\")\n\n\n\t// default documentation goes to erpnext\n\t// $('[data-link-type=\"documentation\"]').attr('data-path', '/erpnext/manual/index');\n\n\t// additional help links for erpnext\n\tvar $help_menu = $('.dropdown-help ul .documentation-links');\n\n\t$('<li><a data-link-type=\"forum\" href=\"https://discuss.erpnext.com\" \\\n\t\ttarget=\"_blank\">'+__('User Forum')+'</a></li>').insertBefore($help_menu);\n\t$('<li><a href=\"https://gitter.im/frappe/erpnext\" \\\n\t\ttarget=\"_blank\">'+__('Chat')+'</a></li>').insertBefore($help_menu);\n\t$('<li><a href=\"https://github.com/frappe/erpnext/issues\" \\\n\t\ttarget=\"_blank\">'+__('Report an Issue')+'</a></li>').insertBefore($help_menu);\n\n});\n\n\n\n// doctypes created via tree\n$.extend(frappe.create_routes, {\n\t\"Customer Group\": \"Tree/Customer Group\",\n\t\"Territory\": \"Tree/Territory\",\n\t\"Item Group\": \"Tree/Item Group\",\n\t\"Sales Person\": \"Tree/Sales Person\",\n\t\"Account\": \"Tree/Account\",\n\t\"Cost Center\": \"Tree/Cost Center\"\n});\n\n// preferred modules for breadcrumbs\n$.extend(frappe.breadcrumbs.preferred, {\n\t\"Item Group\": \"Stock\",\n\t\"Customer Group\": \"Selling\",\n\t\"Supplier Type\": \"Buying\",\n\t\"Territory\": \"Selling\",\n\t\"Sales Person\": \"Selling\",\n\t\"Sales Partner\": \"Selling\",\n\t\"Brand\": \"Selling\"\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\nfrappe.provide(\"erpnext\");\nfrappe.provide(\"erpnext.utils\");\n\n$.extend(erpnext, {\n\tget_currency: function(company) {\n\t\tif(!company && cur_frm)\n\t\t\tcompany = cur_frm.doc.company;\n\t\tif(company)\n\t\t\treturn frappe.get_doc(\":Company\", company).default_currency || frappe.boot.sysdefaults.currency;\n\t\telse\n\t\t\treturn frappe.boot.sysdefaults.currency;\n\t},\n\n\tget_presentation_currency_list: () => {\n\t\tconst docs = frappe.boot.docs;\n\t\tconst currency_list = docs.filter(d => d.doctype === \":Currency\").map(d => d.name);\n\t\treturn currency_list;\n\t},\n\n\ttoggle_naming_series: function() {\n\t\tif(cur_frm.fields_dict.naming_series) {\n\t\t\tcur_frm.toggle_display(\"naming_series\", cur_frm.doc.__islocal?true:false);\n\t\t}\n\t},\n\n\thide_company: function() {\n\t\tif(cur_frm.fields_dict.company) {\n\t\t\tvar companies = Object.keys(locals[\":Company\"] || {});\n\t\t\tif(companies.length === 1) {\n\t\t\t\tif(!cur_frm.doc.company) cur_frm.set_value(\"company\", companies[0]);\n\t\t\t\tcur_frm.toggle_display(\"company\", false);\n\t\t\t} else if(erpnext.last_selected_company) {\n\t\t\t\tif(!cur_frm.doc.company) cur_frm.set_value(\"company\", erpnext.last_selected_company);\n\t\t\t}\n\t\t}\n\t},\n\n\tis_perpetual_inventory_enabled: function(company) {\n\t\tif(company) {\n\t\t\treturn frappe.get_doc(\":Company\", company).enable_perpetual_inventory\n\t\t}\n\t},\n\n\tstale_rate_allowed: () => {\n\t\treturn cint(frappe.boot.sysdefaults.allow_stale);\n\t},\n\n\tsetup_serial_no: function() {\n\t\tvar grid_row = cur_frm.open_grid_row();\n\t\tif(!grid_row || !grid_row.grid_form.fields_dict.serial_no ||\n\t\t\tgrid_row.grid_form.fields_dict.serial_no.get_status()!==\"Write\") return;\n\n\t\tvar $btn = $('<button class=\"btn btn-sm btn-default\">'+__(\"Add Serial No\")+'</button>')\n\t\t\t.appendTo($(\"<div>\")\n\t\t\t\t.css({\"margin-bottom\": \"10px\", \"margin-top\": \"10px\"})\n\t\t\t\t.appendTo(grid_row.grid_form.fields_dict.serial_no.$wrapper));\n\n\t\t$btn.on(\"click\", function() {\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: __(\"Add Serial No\"),\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"fieldtype\": \"Link\",\n\t\t\t\t\t\t\"fieldname\": \"serial_no\",\n\t\t\t\t\t\t\"options\": \"Serial No\",\n\t\t\t\t\t\t\"label\": __(\"Serial No\"),\n\t\t\t\t\t\t\"get_query\": function () {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\titem_code:grid_row.doc.item_code ,\n\t\t\t\t\t\t\t\t\twarehouse:cur_frm.doc.is_return ? null : grid_row.doc.warehouse\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"fieldtype\": \"Button\",\n\t\t\t\t\t\t\"fieldname\": \"add\",\n\t\t\t\t\t\t\"label\": __(\"Add\")\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\n\t\t\td.get_input(\"add\").on(\"click\", function() {\n\t\t\t\tvar serial_no = d.get_value(\"serial_no\");\n\t\t\t\tif(serial_no) {\n\t\t\t\t\tvar val = (grid_row.doc.serial_no || \"\").split(\"\\n\").concat([serial_no]).join(\"\\n\");\n\t\t\t\t\tgrid_row.grid_form.fields_dict.serial_no.set_model_value(val.trim());\n\t\t\t\t}\n\t\t\t\td.hide();\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\td.show();\n\t\t});\n\t}\n});\n\n\n$.extend(erpnext.utils, {\n\tset_party_dashboard_indicators: function(frm) {\n\t\tif(frm.doc.__onload && frm.doc.__onload.dashboard_info) {\n\t\t\tvar info = frm.doc.__onload.dashboard_info;\n\t\t\tfrm.dashboard.add_indicator(__('Annual Billing: {0}',\n\t\t\t\t[format_currency(info.billing_this_year, info.currency)]), 'blue');\n\t\t\tfrm.dashboard.add_indicator(__('Total Unpaid: {0}',\n\t\t\t\t[format_currency(info.total_unpaid, info.currency)]),\n\t\t\t\tinfo.total_unpaid ? 'orange' : 'green');\n\t\t}\n\t},\n\n\tget_party_name: function(party_type) {\n\t\tvar dict = {'Customer': 'customer_name', 'Supplier': 'supplier_name', 'Employee': 'employee_name',\n\t\t\t'Member': 'member_name'};\n\t\treturn dict[party_type];\n\t},\n\n\tcopy_value_in_all_row: function(doc, dt, dn, table_fieldname, fieldname) {\n\t\tvar d = locals[dt][dn];\n\t\tif(d[fieldname]){\n\t\t\tvar cl = doc[table_fieldname] || [];\n\t\t\tfor(var i = 0; i < cl.length; i++) {\n\t\t\t\tif(!cl[i][fieldname]) cl[i][fieldname] = d[fieldname];\n\t\t\t}\n\t\t}\n\t\trefresh_field(table_fieldname);\n\t},\n\n\tget_terms: function(tc_name, doc, callback) {\n\t\tif(tc_name) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: 'erpnext.setup.doctype.terms_and_conditions.terms_and_conditions.get_terms_and_conditions',\n\t\t\t\targs: {\n\t\t\t\t\ttemplate_name: tc_name,\n\t\t\t\t\tdoc: doc\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tcallback(r)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tmake_subscription: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.subscription.subscription.make_subscription\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\t/**\n\t* Checks if the first row of a given child table is empty\n\t* @param child_table - Child table Doctype\n\t* @return {Boolean}\n\t**/\n\tfirst_row_is_empty: function(child_table){\n\t\tif($.isArray(child_table) && child_table.length > 0) {\n\t\t\treturn !child_table[0].item_code;\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t* Removes the first row of a child table if it is empty\n\t* @param {_Frm} frm - The current form\n\t* @param {String} child_table_name - The child table field name\n\t* @return {Boolean}\n\t**/\n\tremove_empty_first_row: function(frm, child_table_name){\n\t\tconst rows = frm['doc'][child_table_name];\n\t\tif (this.first_row_is_empty(rows)){\n\t\t\tfrm['doc'][child_table_name] = rows.splice(1);\n\t\t}\n\t\treturn rows;\n\t},\n});\n\nerpnext.utils.select_alternate_items = function(opts) {\n\tconst frm = opts.frm;\n\tconst warehouse_field = opts.warehouse_field || 'warehouse';\n\tconst item_field = opts.item_field || 'item_code';\n\n\tthis.data = [];\n\tconst dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Select Alternate Item\"),\n\t\tfields: [\n\t\t\t{fieldtype:'Section Break', label: __('Items')},\n\t\t\t{\n\t\t\t\tfieldname: \"alternative_items\", fieldtype: \"Table\", cannot_add_rows: true,\n\t\t\t\tin_place_edit: true, data: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: [{\n\t\t\t\t\tfieldtype:'Data',\n\t\t\t\t\tfieldname:\"docname\",\n\t\t\t\t\thidden: 1\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"item_code\",\n\t\t\t\t\toptions: 'Item',\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tlabel: __('Item Code')\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"alternate_item\",\n\t\t\t\t\toptions: 'Item',\n\t\t\t\t\tdefault: \"\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Alternate Item'),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst item_code = this.get_value();\n\t\t\t\t\t\tconst warehouse = this.grid_row.on_grid_fields_dict.warehouse.get_value();\n\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\twarehouse: warehouse\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict\n\t\t\t\t\t\t\t\t\t\t.actual_qty.set_value(r.message || 0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tget_query: (e) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tquery: \"erpnext.stock.doctype.item_alternative.item_alternative.get_alternative_items\",\n\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\titem_code: e.item_code\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"warehouse\",\n\t\t\t\t\toptions: 'Warehouse',\n\t\t\t\t\tdefault: \"\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Warehouse'),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst warehouse = this.get_value();\n\t\t\t\t\t\tconst item_code = this.grid_row.on_grid_fields_dict.item_code.get_value();\n\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\twarehouse: warehouse\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict\n\t\t\t\t\t\t\t\t\t\t.actual_qty.set_value(r.message || 0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Float',\n\t\t\t\t\tfieldname:\"actual_qty\",\n\t\t\t\t\tdefault: 0,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Available Qty')\n\t\t\t\t}]\n\t\t\t},\n\t\t],\n\t\tprimary_action: function() {\n\t\t\tconst args = this.get_values()[\"alternative_items\"];\n\t\t\tconst alternative_items = args.filter(d => {\n\t\t\t\tif (d.alternate_item && d.item_code != d.alternate_item) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\talternative_items.forEach(d => {\n\t\t\t\tlet row = frappe.get_doc(opts.child_doctype, d.docname);\n\t\t\t\tlet qty = row.qty;\n\t\t\t\trow[item_field] = d.alternate_item;\n\n\t\t\t\tfrm.script_manager.trigger(item_field, row.doctype, row.name)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'qty', qty);\n\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name,\n\t\t\t\t\t\t\topts.original_item_field, d.item_code);\n\t\t\t\t\t});\n\t\t\t});\n\n\t\t\trefresh_field(opts.child_docname);\n\t\t\tthis.hide();\n\t\t},\n\t\tprimary_action_label: __('Update')\n\t});\n\n\tfrm.doc[opts.child_docname].forEach(d => {\n\t\tif (!opts.condition || opts.condition(d)) {\n\t\t\tdialog.fields_dict.alternative_items.df.data.push({\n\t\t\t\t\"docname\": d.name,\n\t\t\t\t\"item_code\": d[item_field],\n\t\t\t\t\"warehouse\": d[warehouse_field],\n\t\t\t\t\"actual_qty\": d.actual_qty\n\t\t\t});\n\t\t}\n\t})\n\n\tthis.data = dialog.fields_dict.alternative_items.df.data;\n\tdialog.fields_dict.alternative_items.grid.refresh();\n\tdialog.show();\n}\n\nerpnext.utils.map_current_doc = function(opts) {\n\tif(opts.get_query_filters) {\n\t\topts.get_query = function() {\n\t\t\treturn {filters: opts.get_query_filters};\n\t\t}\n\t}\n\tvar _map = function() {\n\t\tif($.isArray(cur_frm.doc.items) && cur_frm.doc.items.length > 0) {\n\t\t\t// remove first item row if empty\n\t\t\tif(!cur_frm.doc.items[0].item_code) {\n\t\t\t\tcur_frm.doc.items = cur_frm.doc.items.splice(1);\n\t\t\t}\n\n\t\t\t// find the doctype of the items table\n\t\t\tvar items_doctype = frappe.meta.get_docfield(cur_frm.doctype, 'items').options;\n\n\t\t\t// find the link fieldname from items table for the given\n\t\t\t// source_doctype\n\t\t\tvar link_fieldname = null;\n\t\t\tfrappe.get_meta(items_doctype).fields.forEach(function(d) {\n\t\t\t\tif(d.options===opts.source_doctype) link_fieldname = d.fieldname; });\n\n\t\t\t// search in existing items if the source_name is already set and full qty fetched\n\t\t\tvar already_set = false;\n\t\t\tvar item_qty_map = {};\n\n\t\t\t$.each(cur_frm.doc.items, function(i, d) {\n\t\t\t\topts.source_name.forEach(function(src) {\n\t\t\t\t\tif(d[link_fieldname]==src) {\n\t\t\t\t\t\talready_set = true;\n\t\t\t\t\t\tif (item_qty_map[d.item_code])\n\t\t\t\t\t\t\titem_qty_map[d.item_code] += flt(d.qty);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\titem_qty_map[d.item_code] = flt(d.qty);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif(already_set) {\n\t\t\t\topts.source_name.forEach(function(src) {\n\t\t\t\t\tfrappe.model.with_doc(opts.source_doctype, src, function(r) {\n\t\t\t\t\t\tvar source_doc = frappe.model.get_doc(opts.source_doctype, src);\n\t\t\t\t\t\t$.each(source_doc.items || [], function(i, row) {\n\t\t\t\t\t\t\tif(row.qty > flt(item_qty_map[row.item_code])) {\n\t\t\t\t\t\t\t\talready_set = false;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\n\t\t\t\t\tif(already_set) {\n\t\t\t\t\t\tfrappe.msgprint(__(\"You have already selected items from {0} {1}\",\n\t\t\t\t\t\t\t[opts.source_doctype, src]));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\treturn frappe.call({\n\t\t\t// Sometimes we hit the limit for URL length of a GET request\n\t\t\t// as we send the full target_doc. Hence this is a POST request.\n\t\t\ttype: \"POST\",\n\t\t\tmethod: 'frappe.model.mapper.map_docs',\n\t\t\targs: {\n\t\t\t\t\"method\": opts.method,\n\t\t\t\t\"source_names\": opts.source_name,\n\t\t\t\t\"target_doc\": cur_frm.doc,\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tvar doc = frappe.model.sync(r.message);\n\t\t\t\t\tcur_frm.dirty();\n\t\t\t\t\tcur_frm.refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\tif(opts.source_doctype) {\n\t\tvar d = new frappe.ui.form.MultiSelectDialog({\n\t\t\tdoctype: opts.source_doctype,\n\t\t\ttarget: opts.target,\n\t\t\tdate_field: opts.date_field || undefined,\n\t\t\tsetters: opts.setters,\n\t\t\tget_query: opts.get_query,\n\t\t\taction: function(selections, args) {\n\t\t\t\tlet values = selections;\n\t\t\t\tif(values.length === 0){\n\t\t\t\t\tfrappe.msgprint(__(\"Please select {0}\", [opts.source_doctype]))\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\topts.source_name = values;\n\t\t\t\topts.setters = args;\n\t\t\t\td.dialog.hide();\n\t\t\t\t_map();\n\t\t\t},\n\t\t});\n\t} else if(opts.source_name) {\n\t\topts.source_name = [opts.source_name];\n\t\t_map();\n\t}\n}\n\nfrappe.form.link_formatters['Item'] = function(value, doc) {\n\tif(doc && doc.item_name && doc.item_name !== value) {\n\t\treturn value? value + ': ' + doc.item_name: doc.item_name;\n\t} else {\n\t\treturn value;\n\t}\n}\n\nfrappe.form.link_formatters['Employee'] = function(value, doc) {\n\tif(doc && doc.employee_name && doc.employee_name !== value) {\n\t\treturn value? value + ': ' + doc.employee_name: doc.employee_name;\n\t} else {\n\t\treturn value;\n\t}\n}\n\n// add description on posting time\n$(document).on('app_ready', function() {\n\tif(!frappe.datetime.is_timezone_same()) {\n\t\t$.each([\"Stock Reconciliation\", \"Stock Entry\", \"Stock Ledger Entry\",\n\t\t\t\"Delivery Note\", \"Purchase Receipt\", \"Sales Invoice\"], function(i, d) {\n\t\t\tfrappe.ui.form.on(d, \"onload\", function(frm) {\n\t\t\t\tcur_frm.set_df_property(\"posting_time\", \"description\",\n\t\t\t\t\tfrappe.sys_defaults.time_zone);\n\t\t\t});\n\t\t});\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n// searches for enabled users\nfrappe.provide(\"erpnext.queries\");\n$.extend(erpnext.queries, {\n\tuser: function() {\n\t\treturn { query: \"frappe.core.doctype.user.user.user_query\" };\n\t},\n\n\tlead: function() {\n\t\treturn { query: \"erpnext.controllers.queries.lead_query\" };\n\t},\n\n\tcustomer: function() {\n\t\treturn { query: \"erpnext.controllers.queries.customer_query\" };\n\t},\n\n\tsupplier: function() {\n\t\treturn { query: \"erpnext.controllers.queries.supplier_query\" };\n\t},\n\n\titem: function(filters) {\n\t\tvar args = { query: \"erpnext.controllers.queries.item_query\" };\n\t\tif(filters) args[\"filters\"] = filters;\n\t\treturn args;\n\t},\n\n\tbom: function() {\n\t\treturn { query: \"erpnext.controllers.queries.bom\" };\n\t},\n\n\ttask: function() {\n\t\treturn { query: \"erpnext.projects.utils.query_task\" };\n\t},\n\n\tcustomer_filter: function(doc) {\n\t\tif(!doc.customer) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"customer\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { customer: doc.customer } };\n\t},\n\n\tcontact_query: function(doc) {\n\t\tif(frappe.dynamic_link) {\n\t\t\tif(!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(__(\"Please set {0}\",\n\t\t\t\t\t[__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name))]));\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: 'frappe.contacts.doctype.contact.contact.contact_query',\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname]\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\n\taddress_query: function(doc) {\n\t\tif(frappe.dynamic_link) {\n\t\t\tif(!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(__(\"Please set {0}\",\n\t\t\t\t\t[__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name))]));\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname]\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\n\tcompany_address_query: function(doc) {\n\t\treturn {\n\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\tfilters: { is_your_company_address: 1, link_doctype: 'Company', link_name: doc.company || '' }\n\t\t};\n\t},\n\n\tsupplier_filter: function(doc) {\n\t\tif(!doc.supplier) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"supplier\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { supplier: doc.supplier } };\n\t},\n\n\tlead_filter: function(doc) {\n\t\tif(!doc.lead) {\n\t\t\tfrappe.throw(__(\"Please specify a {0}\",\n\t\t\t\t[__(frappe.meta.get_label(doc.doctype, \"lead\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { lead: doc.lead } };\n\t},\n\n\tnot_a_group_filter: function() {\n\t\treturn { filters: { is_group: 0 } };\n\t},\n\n\temployee: function() {\n\t\treturn { query: \"erpnext.controllers.queries.employee_query\" }\n\t},\n\n\twarehouse: function(doc) {\n\t\treturn {\n\t\t\tfilters: [\n\t\t\t\t[\"Warehouse\", \"company\", \"in\", [\"\", cstr(doc.company)]],\n\t\t\t\t[\"Warehouse\", \"is_group\", \"=\",0]\n\n\t\t\t]\n\t\t}\n\t}\n});\n\nerpnext.queries.setup_queries = function(frm, options, query_fn) {\n\tvar me = this;\n\tvar set_query = function(doctype, parentfield) {\n\t\tvar link_fields = frappe.meta.get_docfields(doctype, frm.doc.name,\n\t\t\t{\"fieldtype\": \"Link\", \"options\": options});\n\t\t$.each(link_fields, function(i, df) {\n\t\t\tif(parentfield) {\n\t\t\t\tfrm.set_query(df.fieldname, parentfield, query_fn);\n\t\t\t} else {\n\t\t\t\tfrm.set_query(df.fieldname, query_fn);\n\t\t\t}\n\t\t});\n\t};\n\n\tset_query(frm.doc.doctype);\n\n\t// warehouse field in tables\n\t$.each(frappe.meta.get_docfields(frm.doc.doctype, frm.doc.name, {\"fieldtype\": \"Table\"}),\n\t\tfunction(i, df) {\n\t\t\tset_query(df.options, df.fieldname);\n\t\t});\n}\n\n/* \tif item code is selected in child table\n\tthen list down warehouses with its quantity\n\telse apply default filters.\n*/\nerpnext.queries.setup_warehouse_query = function(frm){\n\tfrm.set_query('warehouse', 'items', function(doc, cdt, cdn) {\n\t\tvar row  = locals[cdt][cdn];\n\t\tvar filters = erpnext.queries.warehouse(frm.doc);\n\t\tif(row.item_code){\n\t\t\t$.extend(filters, {\"query\":\"erpnext.controllers.queries.warehouse_query\"});\n\t\t\tfilters[\"filters\"].push([\"Bin\", \"item_code\", \"=\", row.item_code]);\n\t\t}\n\t\treturn filters\n\t});\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.SMSManager = function SMSManager(doc) {\n\tvar me = this;\n\tthis.setup = function() {\n\t\tvar default_msg = {\n\t\t\t'Lead'\t\t\t\t: '',\n\t\t\t'Opportunity'\t\t\t: 'Your enquiry has been logged into the system. Ref No: ' + doc.name,\n\t\t\t'Quotation'\t\t\t: 'Quotation ' + doc.name + ' has been sent via email. Thanks!',\n\t\t\t'Sales Order'\t\t: 'Sales Order ' + doc.name + ' has been created against '\n\t\t\t\t\t\t+ (doc.quotation_no ? ('Quote No:' + doc.quotation_no) : '')\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Delivery Note'\t\t: 'Items has been delivered against delivery note: ' + doc.name\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Sales Invoice': 'Invoice ' + doc.name + ' has been sent via email '\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Material Request'\t\t\t: 'Material Request ' + doc.name + ' has been raised in the system',\n\t\t\t'Purchase Order'\t: 'Purchase Order ' + doc.name + ' has been sent via email',\n\t\t\t'Purchase Receipt'\t: 'Items has been received against purchase receipt: ' + doc.name\n\t\t}\n\n\t\tif (in_list(['Quotation', 'Sales Order', 'Delivery Note', 'Sales Invoice'], doc.doctype))\n\t\t\tthis.show(doc.contact_person, 'Customer', doc.customer, '', default_msg[doc.doctype]);\n\t\telse if (in_list(['Purchase Order', 'Purchase Receipt'], doc.doctype))\n\t\t\tthis.show(doc.contact_person, 'Supplier', doc.supplier, '', default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Lead')\n\t\t\tthis.show('', '', '', doc.mobile_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Opportunity')\n\t\t\tthis.show('', '', '', doc.contact_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Material Request')\n\t\t\tthis.show('', '', '', '', default_msg[doc.doctype]);\n\n\t};\n\n\tthis.get_contact_number = function(contact, ref_doctype, ref_name) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.get_contact_number\",\n\t\t\targs: {\n\t\t\t\tcontact_name: contact,\n\t\t\t\tref_doctype: ref_doctype,\n\t\t\t\tref_name: ref_name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.exc) { frappe.msgprint(r.exc); return; }\n\t\t\t\tme.number = r.message;\n\t\t\t\tme.show_dialog();\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.show = function(contact, ref_doctype, ref_name, mobile_nos, message) {\n\t\tthis.message = message;\n\t\tif (mobile_nos) {\n\t\t\tme.number = mobile_nos;\n\t\t\tme.show_dialog();\n\t\t} else if (contact){\n\t\t\tthis.get_contact_number(contact, ref_doctype, ref_name)\n\t\t} else {\n\t\t\tme.show_dialog();\n\t\t}\n\t}\n\tthis.show_dialog = function() {\n\t\tif(!me.dialog)\n\t\t\tme.make_dialog();\n\t\tme.dialog.set_values({\n\t\t\t'message': me.message,\n\t\t\t'number': me.number\n\t\t})\n\t\tme.dialog.show();\n\t}\n\tthis.make_dialog = function() {\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: 'Send SMS',\n\t\t\twidth: 400,\n\t\t\tfields: [\n\t\t\t\t{fieldname:'number', fieldtype:'Data', label:'Mobile Number', reqd:1},\n\t\t\t\t{fieldname:'message', fieldtype:'Text', label:'Message', reqd:1},\n\t\t\t\t{fieldname:'send', fieldtype:'Button', label:'Send'}\n\t\t\t]\n\t\t})\n\t\td.fields_dict.send.input.onclick = function() {\n\t\t\tvar btn = d.fields_dict.send.input;\n\t\t\tvar v = me.dialog.get_values();\n\t\t\tif(v) {\n\t\t\t\t$(btn).set_working();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.send_sms\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\treceiver_list: [v.number],\n\t\t\t\t\t\tmsg: v.message\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t$(btn).done_working();\n\t\t\t\t\t\tif(r.exc) {frappe.msgprint(r.exc); return; }\n\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tthis.dialog = d;\n\t}\n\tthis.setup();\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.utils\");\n\nerpnext.utils.get_party_details = function(frm, method, args, callback) {\n\tif(!method) {\n\t\tmethod = \"erpnext.accounts.party.get_party_details\";\n\t}\n\tif(!args) {\n\t\tif(frm.doctype != \"Purchase Order\" && frm.doc.customer) {\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.customer,\n\t\t\t\tparty_type: \"Customer\",\n\t\t\t\tprice_list: frm.doc.selling_price_list\n\t\t\t};\n\t\t} else if(frm.doc.supplier) {\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.supplier,\n\t\t\t\tparty_type: \"Supplier\",\n\t\t\t\tbill_date: frm.doc.bill_date,\n\t\t\t\tprice_list: frm.doc.buying_price_list\n\t\t\t};\n\t\t}\n\n\t\tif (args) {\n\t\t\targs.posting_date = frm.doc.posting_date || frm.doc.transaction_date;\n\t\t}\n\t}\n\tif(!args) return;\n\n\tif(frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif(!erpnext.utils.validate_mandatory(frm, \"Posting/Transaction Date\",\n\t\t\targs.posting_date, args.party_type==\"Customer\" ? \"customer\": \"supplier\")) return;\n\t}\n\n\targs.currency = frm.doc.currency;\n\targs.company = frm.doc.company;\n\targs.doctype = frm.doc.doctype;\n\tfrappe.call({\n\t\tmethod: method,\n\t\targs: args,\n\t\tcallback: function(r) {\n\t\t\tif(r.message) {\n\t\t\t\tfrm.updating_party_details = true;\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => frm.set_value(r.message),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tfrm.updating_party_details = false;\n\t\t\t\t\t\tif(callback) callback();\n\t\t\t\t\t\tfrm.refresh();\n\t\t\t\t\t\terpnext.utils.add_item(frm);\n\t\t\t\t\t}\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\t});\n}\n\nerpnext.utils.add_item = function(frm) {\n\tif(frm.is_new()) {\n\t\tvar prev_route = frappe.get_prev_route();\n\t\tif(prev_route[1]==='Item' && !(frm.doc.items && frm.doc.items.length)) {\n\t\t\t// add row\n\t\t\tvar item = frm.add_child('items');\n\t\t\tfrm.refresh_field('items');\n\n\t\t\t// set item\n\t\t\tfrappe.model.set_value(item.doctype, item.name, 'item_code', prev_route[2]);\n\t\t}\n\t}\n}\n\nerpnext.utils.get_address_display = function(frm, address_field, display_field, is_your_company_address) {\n\tif(frm.updating_party_details) return;\n\n\tif(!address_field) {\n\t\tif(frm.doctype != \"Purchase Order\" && frm.doc.customer) {\n\t\t\taddress_field = \"customer_address\";\n\t\t} else if(frm.doc.supplier) {\n\t\t\taddress_field = \"supplier_address\";\n\t\t} else return;\n\t}\n\n\tif(!display_field) display_field = \"address_display\";\n\tif(frm.doc[address_field]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.address.address.get_address_display\",\n\t\t\targs: {\"address_dict\": frm.doc[address_field] },\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\tfrm.set_value(display_field, r.message)\n\t\t\t\t}\n\t\t\t\terpnext.utils.set_taxes(frm, address_field, display_field, is_your_company_address);\n\t\t\t}\n\t\t})\n\t} else {\n\t\tfrm.set_value(display_field, '');\n\t}\n};\n\nerpnext.utils.set_taxes = function(frm, address_field, display_field, is_your_company_address) {\n\tif(frappe.meta.get_docfield(frm.doc.doctype, \"taxes\") && !is_your_company_address) {\n\t\tif(!erpnext.utils.validate_mandatory(frm, \"Lead/Customer/Supplier\",\n\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead, address_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(!erpnext.utils.validate_mandatory(frm, \"Posting/Transaction Date\",\n\t\t\tfrm.doc.posting_date || frm.doc.transaction_date, address_field)) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tvar party_type, party;\n\tif (frm.doc.lead) {\n\t\tparty_type = 'Lead';\n\t\tparty = frm.doc.lead;\n\t} else if (frm.doc.customer) {\n\t\tparty_type = 'Customer';\n\t\tparty = frm.doc.customer;\n\t} else if (frm.doc.supplier) {\n\t\tparty_type = 'Supplier';\n\t\tparty = frm.doc.supplier;\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.accounts.party.set_taxes\",\n\t\targs: {\n\t\t\t\"party\": party,\n\t\t\t\"party_type\": party_type,\n\t\t\t\"posting_date\": frm.doc.posting_date || frm.doc.transaction_date,\n\t\t\t\"company\": frm.doc.company,\n\t\t\t\"billing_address\": ((frm.doc.customer || frm.doc.lead) ? (frm.doc.customer_address) : (frm.doc.supplier_address)),\n\t\t\t\"shipping_address\": frm.doc.shipping_address_name\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif(r.message){\n\t\t\t\tfrm.set_value(\"taxes_and_charges\", r.message)\n\t\t\t}\n\t\t}\n\t});\n}\n\nerpnext.utils.get_contact_details = function(frm) {\n\tif(frm.updating_party_details) return;\n\n\tif(frm.doc[\"contact_person\"]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.contact.contact.get_contact_details\",\n\t\t\targs: {contact: frm.doc.contact_person },\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message)\n\t\t\t\t\tfrm.set_value(r.message);\n\t\t\t}\n\t\t})\n\t}\n}\n\nerpnext.utils.validate_mandatory = function(frm, label, value, trigger_on) {\n\tif(!value) {\n\t\tfrm.doc[trigger_on] = \"\";\n\t\trefresh_field(trigger_on);\n\t\tfrappe.msgprint(__(\"Please enter {0} first\", [label]));\n\t\treturn false;\n\t}\n\treturn true;\n}\n\nerpnext.utils.get_shipping_address = function(frm, callback){\n\tfrappe.call({\n\t\tmethod: \"frappe.contacts.doctype.address.address.get_shipping_address\",\n\t\targs: {\n\t\t\tcompany: frm.doc.company,\n\t\t\taddress: frm.doc.shipping_address\n\t\t},\n\t\tcallback: function(r){\n\t\t\tif(r.message){\n\t\t\t\tfrm.set_value(\"shipping_address\", r.message[0]) //Address title or name\n\t\t\t\tfrm.set_value(\"shipping_address_display\", r.message[1]) //Address to be displayed on the page\n\t\t\t}\n\n\t\t\tif(callback){\n\t\t\t\treturn callback();\n\t\t\t}\n\t\t}\n\t});\n}","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.stock\");\n\nerpnext.stock.StockController = frappe.ui.form.Controller.extend({\n\tonload: function() {\n\t\t// warehouse query if company\n\t\tif (this.frm.fields_dict.company) {\n\t\t\tthis.setup_warehouse_query();\n\t\t}\n\t},\n\n\tsetup_warehouse_query: function() {\n\t\tvar me = this;\n\t\terpnext.queries.setup_queries(this.frm, \"Warehouse\", function() {\n\t\t\treturn erpnext.queries.warehouse(me.frm.doc);\n\t\t});\n\t},\n\n\tsetup_posting_date_time_check: function() {\n\t\t// make posting date default and read only unless explictly checked\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_date_and_time_read_only', function(frm) {\n\t\t\tif(frm.doc.docstatus == 0 && frm.doc.set_posting_time) {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 0);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 0);\n\t\t\t} else {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 1);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 1);\n\t\t\t}\n\t\t})\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_time', function(frm) {\n\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'refresh', function(frm) {\n\t\t\t// set default posting date / time\n\t\t\tif(frm.doc.docstatus==0) {\n\t\t\t\tif(!frm.doc.posting_date) {\n\t\t\t\t\tfrm.set_value('posting_date', frappe.datetime.nowdate());\n\t\t\t\t}\n\t\t\t\tif(!frm.doc.posting_time) {\n\t\t\t\t\tfrm.set_value('posting_time', frappe.datetime.now_time());\n\t\t\t\t}\n\t\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t\t}\n\t\t});\n\t},\n\n\tshow_stock_ledger: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus===1) {\n\t\t\tcur_frm.add_custom_button(__(\"Stock Ledger\"), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: me.frm.doc.posting_date,\n\t\t\t\t\tcompany: me.frm.doc.company\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"Stock Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\n\t},\n\n\tshow_general_ledger: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus===1) {\n\t\t\tcur_frm.add_custom_button(__('Accounting Ledger'), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: me.frm.doc.posting_date,\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\tgroup_by_voucher: false\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"General Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.payments = erpnext.stock.StockController.extend({\n\tmake_payment: function() {\n\t\tvar me = this;\n\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Payment'\n\t\t});\n\t\n\t\tthis.dialog.show();\n\t\tthis.$body = this.dialog.body;\n\t\tthis.set_payment_primary_action();\n\t\tthis.make_keyboard();\n\t\tthis.select_text()\n\t},\n\n\tselect_text: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find('.form-control').click(function(){\n\t\t\t$(this).select();\n\t\t})\n\t},\n\n\tset_payment_primary_action: function(){\n\t\tvar me = this;\n\t\n\t\tthis.dialog.set_primary_action(__(\"Submit\"), function() {\n\t\t\t// Allow no ZERO payment\n\t\t\t$.each(me.frm.doc.payments, function (index, data) {\n\t\t\t\tif (data.amount != 0) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\tme.submit_invoice();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t},\n\n\tmake_keyboard: function(){\n\t\tvar me = this;\n\t\t$(this.$body).empty();\n\t\t$(this.$body).html(frappe.render_template('pos_payment', this.frm.doc))\n\t\tthis.show_payment_details();\n\t\tthis.bind_keyboard_event()\n\t\tthis.clear_amount()\n\t},\n\n\tmake_multimode_payment: function(){\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.change_amount > 0){\n\t\t\tme.payment_val = me.doc.outstanding_amount\n\t\t}\n\n\t\tthis.payments = frappe.model.add_child(this.frm.doc, 'Multi Mode Payment', \"payments\");\n\t\tthis.payments.mode_of_payment = this.dialog.fields_dict.mode_of_payment.get_value();\n\t\tthis.payments.amount = flt(this.payment_val);\n\t},\n\n\tshow_payment_details: function(){\n\t\tvar me = this;\n\t\tvar multimode_payments = $(this.$body).find('.multimode-payments').empty();\n\t\tif(this.frm.doc.payments.length){\n\t\t\t$.each(this.frm.doc.payments, function(index, data){\n\t\t\t\t$(frappe.render_template('payment_details', {\n\t\t\t\t\tmode_of_payment: data.mode_of_payment,\n\t\t\t\t\tamount: data.amount,\n\t\t\t\t\tidx: data.idx,\n\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\ttype: data.type\n\t\t\t\t})).appendTo(multimode_payments)\n\n\t\t\t\tif (data.type == 'Cash' && data.amount == me.frm.doc.paid_amount) {\n\t\t\t\t\tme.idx = data.idx;\n\t\t\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': me.idx}));\n\t\t\t\t\tme.highlight_selected_row();\n\t\t\t\t\tme.bind_amount_change_event();\n\t\t\t\t}\n\t\t\t})\n\t\t}else{\n\t\t\t$(\"<p>No payment mode selected in pos profile</p>\").appendTo(multimode_payments)\n\t\t}\n\t},\n\n\tset_outstanding_amount: function(){\n\t\tthis.selected_mode = $(this.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': this.idx}));\n\t\tthis.highlight_selected_row()\n\t\tthis.payment_val = 0.0\n\t\tif(this.frm.doc.outstanding_amount > 0 && flt(this.selected_mode.val()) == 0.0){\n\t\t\t//When user first time click on row\n\t\t\tthis.payment_val = flt(this.frm.doc.outstanding_amount / this.frm.doc.conversion_rate, precision(\"outstanding_amount\"))\n\t\t\tthis.selected_mode.val(format_currency(this.payment_val, this.frm.doc.currency));\n\t\t\tthis.update_payment_amount()\n\t\t}else if(flt(this.selected_mode.val()) > 0){\n\t\t\t//If user click on existing row which has value\n\t\t\tthis.payment_val = flt(this.selected_mode.val());\n\t\t}\n\t\tthis.selected_mode.select()\n\t\tthis.bind_amount_change_event();\n\t},\n\t\n\tbind_keyboard_event: function(){\n\t\tvar me = this;\n\t\tthis.payment_val = '';\n\t\tthis.bind_form_control_event();\n\t\tthis.bind_numeric_keys_event();\n\t},\n\n\tbind_form_control_event: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find('.pos-payment-row').click(function(){\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.set_outstanding_amount()\n\t\t})\n\t\t\n\t\t$(this.$body).find('.form-control').click(function(){\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.set_outstanding_amount();\n\t\t\tme.update_paid_amount(true);\n\t\t})\n\t\t\n\t\t$(this.$body).find('.write_off_amount').change(function(){\n\t\t\tme.write_off_amount(flt($(this).val()), precision(\"write_off_amount\"));\n\t\t})\n\t\t\n\t\t$(this.$body).find('.change_amount').change(function(){\n\t\t\tme.change_amount(flt($(this).val()), precision(\"change_amount\"));\n\t\t})\n\t},\n\n\thighlight_selected_row: function(){\n\t\tvar me = this;\n\t\tvar selected_row = $(this.$body).find(repl(\".pos-payment-row[idx='%(idx)s']\",{'idx': this.idx}));\n\t\t$(this.$body).find('.pos-payment-row').removeClass('selected-payment-mode')\n\t\tselected_row.addClass('selected-payment-mode')\n\t\t$(this.$body).find('.amount').attr('disabled', true);\n\t\tthis.selected_mode.attr('disabled', false);\n\t},\n\t\n\tbind_numeric_keys_event: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find('.pos-keyboard-key').click(function(){\n\t\t\tme.payment_val += $(this).text();\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency))\n\t\t\tme.idx = me.selected_mode.attr(\"idx\")\n\t\t\tme.update_paid_amount()\n\t\t})\n\t\t\n\t\t$(this.$body).find('.delete-btn').click(function(){\n\t\t\tme.payment_val =  cstr(flt(me.selected_mode.val())).slice(0, -1);\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\tme.idx = me.selected_mode.attr(\"idx\")\n\t\t\tme.update_paid_amount();\n\t\t})\n\n\t},\n\t\n\tbind_amount_change_event: function(){\n\t\tvar me = this;\n\t\tthis.selected_mode.change(function(){\n\t\t\tme.payment_val =  flt($(this).val()) || 0.0;\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency))\n\t\t\tme.idx = me.selected_mode.attr(\"idx\")\n\t\t\tme.update_payment_amount()\n\t\t})\n\t},\n\n\tclear_amount: function() {\n\t\tvar me = this;\n\t\t$(this.$body).find('.clr').click(function(e){\n\t\t\te.stopPropagation();\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': me.idx}));\n\t\t\tme.payment_val = 0.0;\n\t\t\tme.selected_mode.val(0.0);\n\t\t\tme.highlight_selected_row();\n\t\t\tme.update_payment_amount();\n\t\t})\n\t},\n\n\twrite_off_amount: function(write_off_amount) {\n\t\tvar me = this;\n\n\t\tthis.frm.doc.write_off_amount = flt(write_off_amount, precision(\"write_off_amount\"));\n\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\tprecision(\"base_write_off_amount\"));\n\t\tthis.calculate_outstanding_amount(false)\n\t\tthis.show_amounts()\n\t},\n\n\tchange_amount: function(change_amount) {\n\t\tvar me = this;\n\n\t\tthis.frm.doc.change_amount = flt(change_amount, precision(\"change_amount\"));\n\t\tthis.calculate_write_off_amount()\n\t\tthis.show_amounts()\n\t},\n\n\tupdate_paid_amount: function(update_write_off) {\n\t\tvar me = this;\n\t\tif(in_list(['change_amount', 'write_off_amount'], this.idx)){\n\t\t\tvar value = me.selected_mode.val();\n\t\t\tif(me.idx == 'change_amount'){\n\t\t\t\tme.change_amount(value)\n\t\t\t} else{\n\t\t\t\tif(flt(value) == 0 && update_write_off && me.frm.doc.outstanding_amount > 0) {\n\t\t\t\t\tvalue = flt(me.frm.doc.outstanding_amount / me.frm.doc.conversion_rate, precision(me.idx));\n\t\t\t\t}\n\t\t\t\tme.write_off_amount(value)\n\t\t\t}\n\t\t}else{\n\t\t\tthis.update_payment_amount()\n\t\t}\n\t},\n\n\tupdate_payment_amount: function(){\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc.payments, function(index, data){\n\t\t\tif(cint(me.idx) == cint(data.idx)){\n\t\t\t\tdata.amount = flt(me.selected_mode.val(), 2)\n\t\t\t}\n\t\t})\n\n\t\tthis.calculate_outstanding_amount(false);\n\t\tthis.show_amounts();\n\t},\n\n\tshow_amounts: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find(\".write_off_amount\").val(format_currency(this.frm.doc.write_off_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.paid_amount').text(format_currency(this.frm.doc.paid_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.change_amount').val(format_currency(this.frm.doc.change_amount, this.frm.doc.currency))\n\t\t$(this.$body).find('.outstanding_amount').text(format_currency(this.frm.doc.outstanding_amount, frappe.get_doc(\":Company\", this.frm.doc.company).default_currency))\n\t\tthis.update_invoice();\n\t}\n})","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.taxes_and_totals = erpnext.payments.extend({\n\tsetup: function() {},\n\tapply_pricing_rule_on_item: function(item){\n\n\t\tif(item.margin_type == \"Percentage\"){\n\t\t\titem.rate_with_margin = flt(item.price_list_rate)\n\t\t\t\t+ flt(item.price_list_rate) * ( flt(item.margin_rate_or_amount) / 100);\n\t\t} else {\n\t\t\titem.rate_with_margin = flt(item.price_list_rate) + flt(item.margin_rate_or_amount);\n\t\t\titem.base_rate_with_margin = flt(item.rate_with_margin) * flt(this.frm.doc.conversion_rate);\n\t\t}\n\n\t\titem.rate = flt(item.rate_with_margin , precision(\"rate\", item));\n\n\t\tif(item.discount_percentage){\n\t\t\tvar discount_value = flt(item.rate_with_margin) * flt(item.discount_percentage) / 100;\n\t\t\titem.rate = flt((item.rate_with_margin) - (discount_value), precision('rate', item));\n\t\t}\n\t},\n\n\tcalculate_taxes_and_totals: function(update_paid_amount) {\n\t\tthis.discount_amount_applied = false;\n\t\tthis._calculate_taxes_and_totals();\n\t\tthis.calculate_discount_amount();\n\n\t\t// Advance calculation applicable to Sales /Purchase Invoice\n\t\tif(in_list([\"Sales Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.docstatus < 2 && !this.frm.doc.is_return) {\n\t\t\tthis.calculate_total_advance(update_paid_amount);\n\t\t}\n\n\t\t// Sales person's commission\n\t\tif(in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"], this.frm.doc.doctype)) {\n\t\t\tthis.calculate_commission();\n\t\t\tthis.calculate_contribution();\n\t\t}\n\n\t\tthis.frm.refresh_fields();\n\t},\n\n\tcalculate_discount_amount: function(){\n\t\tif (frappe.meta.get_docfield(this.frm.doc.doctype, \"discount_amount\")) {\n\t\t\tthis.set_discount_amount();\n\t\t\tthis.apply_discount_amount();\n\t\t}\n\t},\n\n\t_calculate_taxes_and_totals: function() {\n\t\tthis.validate_conversion_rate();\n\t\tthis.calculate_item_values();\n\t\tthis.initialize_taxes();\n\t\tthis.determine_exclusive_rate();\n\t\tthis.calculate_net_total();\n\t\tthis.calculate_taxes();\n\t\tthis.manipulate_grand_total_for_inclusive_tax();\n\t\tthis.calculate_totals();\n\t\tthis._cleanup();\n\t},\n\n\tvalidate_conversion_rate: function() {\n\t\tthis.frm.doc.conversion_rate = flt(this.frm.doc.conversion_rate, (cur_frm) ? precision(\"conversion_rate\") : 9);\n\t\tvar conversion_rate_label = frappe.meta.get_label(this.frm.doc.doctype, \"conversion_rate\",\n\t\t\tthis.frm.doc.name);\n\t\tvar company_currency = this.get_company_currency();\n\n\t\tif(!this.frm.doc.conversion_rate) {\n\t\t\tif(this.frm.doc.currency == company_currency) {\n\t\t\t\tthis.frm.set_value(\"conversion_rate\", 1);\n\t\t\t} else {\n\t\t\t\tfrappe.throw(repl('%(conversion_rate_label)s' +\n\t\t\t\t\t__(' is mandatory. Maybe Currency Exchange record is not created for ') +\n\t\t\t\t'%(from_currency)s' + __(\" to \") + '%(to_currency)s', {\n\t\t\t\t\t\"conversion_rate_label\": conversion_rate_label,\n\t\t\t\t\t\"from_currency\": this.frm.doc.currency,\n\t\t\t\t\t\"to_currency\": company_currency\n\t\t\t\t}));\n\t\t\t}\n\n\t\t}\n\t},\n\n\tcalculate_item_values: function() {\n\t\tvar me = this;\n\n\t\tif (!this.discount_amount_applied) {\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\tfrappe.model.round_floats_in(item);\n\t\t\t\titem.net_rate = item.rate;\n\t\t\t\titem.amount = flt(item.rate * item.qty, precision(\"amount\", item));\n\t\t\t\titem.net_amount = item.amount;\n\t\t\t\titem.item_tax_amount = 0.0;\n\t\t\t\titem.total_weight = flt(item.weight_per_unit * item.stock_qty);\n\n\t\t\t\tme.set_in_company_currency(item, [\"price_list_rate\", \"rate\", \"amount\", \"net_rate\", \"net_amount\"]);\n\t\t\t});\n\t\t}\n\t},\n\n\tset_in_company_currency: function(doc, fields) {\n\t\tvar me = this;\n\t\t$.each(fields, function(i, f) {\n\t\t\tdoc[\"base_\"+f] = flt(flt(doc[f], precision(f, doc)) * me.frm.doc.conversion_rate, precision(\"base_\" + f, doc));\n\t\t});\n\t},\n\n\tinitialize_taxes: function() {\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\ttax.item_wise_tax_detail = {};\n\t\t\tvar tax_fields = [\"total\", \"tax_amount_after_discount_amount\",\n\t\t\t\t\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif (cstr(tax.charge_type) != \"Actual\" &&\n\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\ttax_fields.push(\"tax_amount\");\n\t\t\t}\n\n\t\t\t$.each(tax_fields, function(i, fieldname) { tax[fieldname] = 0.0; });\n\n\t\t\tif (!this.discount_amount_applied && cur_frm) {\n\t\t\t\tcur_frm.cscript.validate_taxes_and_charges(tax.doctype, tax.name);\n\t\t\t\tme.validate_inclusive_tax(tax);\n\t\t\t}\n\t\t\tfrappe.model.round_floats_in(tax);\n\t\t});\n\t},\n\n\tdetermine_exclusive_rate: function() {\n\t\tvar me = this;\n\n\t\tvar has_inclusive_tax = false;\n\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, row) {\n\t\t\tif(cint(row.included_in_print_rate)) has_inclusive_tax = true;\n\t\t});\n\t\tif(has_inclusive_tax==false) return;\n\n\t\t$.each(me.frm.doc[\"items\"] || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\tvar cumulated_tax_fraction = 0.0;\n\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\ttax.tax_fraction_for_current_item = me.get_current_tax_fraction(tax, item_tax_map);\n\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item = 1 + tax.tax_fraction_for_current_item;\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item =\n\t\t\t\t\t\tme.frm.doc[\"taxes\"][i-1].grand_total_fraction_for_current_item +\n\t\t\t\t\t\ttax.tax_fraction_for_current_item;\n\t\t\t\t}\n\n\t\t\t\tcumulated_tax_fraction += tax.tax_fraction_for_current_item;\n\t\t\t});\n\n\t\t\tif(cumulated_tax_fraction && !me.discount_amount_applied) {\n\t\t\t\titem.net_amount = flt(item.amount / (1 + cumulated_tax_fraction));\n\t\t\t\titem.net_rate = flt(item.net_amount / item.qty, precision(\"net_rate\", item));\n\n\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t}\n\t\t});\n\t},\n\n\tget_current_tax_fraction: function(tax, item_tax_map) {\n\t\t// Get tax fraction for calculating tax exclusive amount\n\t\t// from tax inclusive amount\n\t\tvar current_tax_fraction = 0.0;\n\n\t\tif(cint(tax.included_in_print_rate)) {\n\t\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\n\t\t\tif(tax.charge_type == \"On Net Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0);\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_fraction_for_current_item;\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_fraction_for_current_item;\n\t\t\t}\n\t\t}\n\n\t\tif(tax.add_deduct_tax) {\n\t\t\tcurrent_tax_fraction *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t}\n\t\treturn current_tax_fraction;\n\t},\n\n\t_get_tax_rate: function(tax, item_tax_map) {\n\t\treturn (Object.keys(item_tax_map).indexOf(tax.account_head) != -1) ?\n\t\t\tflt(item_tax_map[tax.account_head], precision(\"rate\", tax)) : tax.rate;\n\t},\n\n\tcalculate_net_total: function() {\n\t\tvar me = this;\n\t\tthis.frm.doc.total = this.frm.doc.base_total = this.frm.doc.net_total = this.frm.doc.base_net_total = 0.0;\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\tme.frm.doc.total += item.amount;\n\t\t\tme.frm.doc.base_total += item.base_amount;\n\t\t\tme.frm.doc.net_total += item.net_amount;\n\t\t\tme.frm.doc.base_net_total += item.base_net_amount;\n\t\t\t});\n\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"total\", \"base_total\", \"net_total\", \"base_net_total\"]);\n\t},\n\n\tcalculate_taxes: function() {\n\t\tvar me = this;\n\t\tthis.frm.doc.rounding_adjustment = 0;\n\t\tvar actual_tax_dict = {};\n\n\t\t// maintain actual tax rate based on idx\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\tactual_tax_dict[tax.idx] = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\t}\n\t\t});\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t// tax_amount represents the amount of tax for the current step\n\t\t\t\tvar current_tax_amount = me.get_current_tax_amount(item, tax, item_tax_map);\n\n\t\t\t\t// Adjust divisional loss to the last item\n\t\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\t\tactual_tax_dict[tax.idx] -= current_tax_amount;\n\t\t\t\t\tif (n == me.frm.doc[\"items\"].length - 1) {\n\t\t\t\t\t\tcurrent_tax_amount += actual_tax_dict[tax.idx];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// accumulate tax amount into tax.tax_amount\n\t\t\t\tif (tax.charge_type != \"Actual\" &&\n\t\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\t\ttax.tax_amount += current_tax_amount;\n\t\t\t\t}\n\n\t\t\t\t// store tax_amount for current item as it will be used for\n\t\t\t\t// charge type = 'On Previous Row Amount'\n\t\t\t\ttax.tax_amount_for_current_item = current_tax_amount;\n\n\t\t\t\t// tax amount after discount amount\n\t\t\t\ttax.tax_amount_after_discount_amount += current_tax_amount;\n\n\t\t\t\t// for buying\n\t\t\t\tif(tax.category) {\n\t\t\t\t\t// if just for valuation, do not add the tax amount in total\n\t\t\t\t\t// hence, setting it as 0 for further steps\n\t\t\t\t\tcurrent_tax_amount = (tax.category == \"Valuation\") ? 0.0 : current_tax_amount;\n\n\t\t\t\t\tcurrent_tax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t}\n\n\t\t\t\t// note: grand_total_for_current_item contains the contribution of\n\t\t\t\t// item's amount, previously applied tax and the current tax on that item\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_for_current_item = flt(item.net_amount + current_tax_amount);\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_for_current_item =\n\t\t\t\t\t\tflt(me.frm.doc[\"taxes\"][i-1].grand_total_for_current_item + current_tax_amount);\n\t\t\t\t}\n\n\t\t\t\t// set precision in the last item iteration\n\t\t\t\tif (n == me.frm.doc[\"items\"].length - 1) {\n\t\t\t\t\tme.round_off_totals(tax);\n\n\t\t\t\t\t// in tax.total, accumulate grand total for each item\n\t\t\t\t\tme.set_cumulative_total(i, tax);\n\n\t\t\t\t\tme.set_in_company_currency(tax,\n\t\t\t\t\t\t[\"total\", \"tax_amount\", \"tax_amount_after_discount_amount\"]);\n\n\t\t\t\t\t// adjust Discount Amount loss in last tax iteration\n\t\t\t\t\tif ((i == me.frm.doc[\"taxes\"].length - 1) && me.discount_amount_applied\n\t\t\t\t\t\t&& me.frm.doc.apply_discount_on == \"Grand Total\" && me.frm.doc.discount_amount) {\n\t\t\t\t\t\tme.frm.doc.rounding_adjustment = flt(me.frm.doc.grand_total -\n\t\t\t\t\t\t\tflt(me.frm.doc.discount_amount) - tax.total, precision(\"rounding_adjustment\"));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tset_cumulative_total: function(row_idx, tax) {\n\t\tvar tax_amount = tax.tax_amount_after_discount_amount;\n\t\tif (tax.category == 'Valuation') {\n\t\t\ttax_amount = 0;\n\t\t}\n\n\t\tif (tax.add_deduct_tax == \"Deduct\") { tax_amount = -1*tax_amount; }\n\n\t\tif(row_idx==0) {\n\t\t\ttax.total = flt(this.frm.doc.net_total + tax_amount, precision(\"total\", tax));\n\t\t} else {\n\t\t\ttax.total = flt(this.frm.doc[\"taxes\"][row_idx-1].total + tax_amount, precision(\"total\", tax));\n\t\t}\n\t},\n\n\t_load_item_tax_rate: function(item_tax_rate) {\n\t\treturn item_tax_rate ? JSON.parse(item_tax_rate) : {};\n\t},\n\n\tget_current_tax_amount: function(item, tax, item_tax_map) {\n\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\t\tvar current_tax_amount = 0.0;\n\n\t\tif(tax.charge_type == \"Actual\") {\n\t\t\t// distribute the tax amount proportionally to each item row\n\t\t\tvar actual = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\tcurrent_tax_amount = this.frm.doc.net_total ?\n\t\t\t\t((item.net_amount / this.frm.doc.net_total) * actual) : 0.0;\n\n\t\t} else if(tax.charge_type == \"On Net Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) * item.net_amount;\n\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_amount_for_current_item;\n\n\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_for_current_item;\n\t\t}\n\n\t\tthis.set_item_wise_tax(item, tax, tax_rate, current_tax_amount);\n\n\t\treturn current_tax_amount;\n\t},\n\n\tset_item_wise_tax: function(item, tax, tax_rate, current_tax_amount) {\n\t\t// store tax breakup for each item\n\t\tvar key = item.item_code || item.item_name;\n\t\tvar item_wise_tax_amount = current_tax_amount * this.frm.doc.conversion_rate;\n\t\tif (tax.item_wise_tax_detail && tax.item_wise_tax_detail[key])\n\t\t\titem_wise_tax_amount += tax.item_wise_tax_detail[key][1];\n\n\t\ttax.item_wise_tax_detail[key] = [tax_rate, flt(item_wise_tax_amount, precision(\"base_tax_amount\", tax))];\n\t},\n\n\tround_off_totals: function(tax) {\n\t\ttax.tax_amount = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\ttax.tax_amount_after_discount_amount = flt(tax.tax_amount_after_discount_amount, precision(\"tax_amount\", tax));\n\t},\n\n\tmanipulate_grand_total_for_inclusive_tax: function() {\n\t\tvar me = this;\n\t\t// if fully inclusive taxes and diff\n\t\tif (this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar any_inclusive_tax = false;\n\t\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\t\tif(cint(d.included_in_print_rate)) any_inclusive_tax = true;\n\t\t\t});\n\t\t\tif (any_inclusive_tax) {\n\t\t\t\tvar last_tax = me.frm.doc[\"taxes\"].slice(-1)[0];\n\t\t\t\tvar non_inclusive_tax_amount = frappe.utils.sum($.map(this.frm.doc.taxes || [],\n\t\t\t\t\tfunction(d) {\n\t\t\t\t\t\tif(!d.included_in_print_rate) {\n\t\t\t\t\t\t\treturn flt(d.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t));\n\t\t\t\tvar diff = me.frm.doc.total + non_inclusive_tax_amount\n\t\t\t\t\t- flt(last_tax.total, precision(\"grand_total\"));\n\n\t\t\t\tif ( diff && Math.abs(diff) <= (5.0 / Math.pow(10, precision(\"tax_amount\", last_tax))) ) {\n\t\t\t\t\tthis.frm.doc.rounding_adjustment = flt(flt(this.frm.doc.rounding_adjustment) + diff,\n\t\t\t\t\t\tprecision(\"rounding_adjustment\"));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_totals: function() {\n\t\t// Changing sequence can cause rounding_adjustmentng issue and on-screen discrepency\n\t\tvar me = this;\n\t\tvar tax_count = this.frm.doc[\"taxes\"] ? this.frm.doc[\"taxes\"].length : 0;\n\t\tthis.frm.doc.grand_total = flt(tax_count\n\t\t\t? this.frm.doc[\"taxes\"][tax_count - 1].total + flt(this.frm.doc.rounding_adjustment)\n\t\t\t: this.frm.doc.net_total);\n\n\t\tif(in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"], this.frm.doc.doctype)) {\n\t\t\tthis.frm.doc.base_grand_total = (this.frm.doc.total_taxes_and_charges) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total;\n\t\t} else {\n\t\t\t// other charges added/deducted\n\t\t\tthis.frm.doc.taxes_and_charges_added = this.frm.doc.taxes_and_charges_deducted = 0.0;\n\t\t\tif(tax_count) {\n\t\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t\tif (in_list([\"Valuation and Total\", \"Total\"], tax.category)) {\n\t\t\t\t\t\tif(tax.add_deduct_tax == \"Add\") {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_added += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_deducted += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfrappe.model.round_floats_in(this.frm.doc,\n\t\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t\t}\n\n\t\t\tthis.frm.doc.base_grand_total = flt((this.frm.doc.taxes_and_charges_added || this.frm.doc.taxes_and_charges_deducted) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total);\n\n\t\t\tthis.set_in_company_currency(this.frm.doc,\n\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t}\n\n\t\tthis.frm.doc.total_taxes_and_charges = flt(this.frm.doc.grand_total - this.frm.doc.net_total\n\t\t\t- flt(this.frm.doc.rounding_adjustment), precision(\"total_taxes_and_charges\"));\n\n\t\tthis.set_in_company_currency(this.frm.doc, [\"total_taxes_and_charges\", \"rounding_adjustment\"]);\n\n\t\t// Round grand total as per precision\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"base_grand_total\"]);\n\n\t\t// rounded totals\n\t\tthis.set_rounded_total();\n\t},\n\n\tset_rounded_total: function() {\n\t\tvar disable_rounded_total = 0;\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"disable_rounded_total\", this.frm.doc.name)) {\n\t\t\tdisable_rounded_total = this.frm.doc.disable_rounded_total;\n\t\t} else if (frappe.sys_defaults.disable_rounded_total) {\n\t\t\tdisable_rounded_total = frappe.sys_defaults.disable_rounded_total;\n\t\t}\n\n\t\tif (cint(disable_rounded_total)) {\n\t\t\tthis.frm.doc.rounded_total = 0;\n\t\t\tthis.frm.doc.base_rounded_total = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"rounded_total\", this.frm.doc.name)) {\n\t\t\tthis.frm.doc.rounded_total = round_based_on_smallest_currency_fraction(this.frm.doc.grand_total,\n\t\t\t\tthis.frm.doc.currency, precision(\"rounded_total\"));\n\t\t\tthis.frm.doc.rounding_adjustment += flt(this.frm.doc.rounded_total - this.frm.doc.grand_total,\n\t\t\t\tprecision(\"rounding_adjustment\"));\n\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"rounding_adjustment\", \"rounded_total\"]);\n\t\t}\n\t},\n\n\t_cleanup: function() {\n\t\tthis.frm.doc.base_in_words = this.frm.doc.in_words = \"\";\n\n\t\tif(this.frm.doc[\"items\"] && this.frm.doc[\"items\"].length) {\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"items\"][0].doctype, \"item_tax_amount\", this.frm.doctype)) {\n\t\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\t\tdelete item[\"item_tax_amount\"];\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif(this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar temporary_fields = [\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"taxes\"][0].doctype, \"tax_amount_after_discount_amount\", this.frm.doctype)) {\n\t\t\t\ttemporary_fields.push(\"tax_amount_after_discount_amount\");\n\t\t\t}\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t$.each(temporary_fields, function(i, fieldname) {\n\t\t\t\t\tdelete tax[fieldname];\n\t\t\t\t});\n\n\t\t\t\ttax.item_wise_tax_detail = JSON.stringify(tax.item_wise_tax_detail);\n\t\t\t});\n\t\t}\n\t},\n\n\tset_discount_amount: function() {\n\t\tif(this.frm.doc.additional_discount_percentage) {\n\t\t\tthis.frm.doc.discount_amount = flt(flt(this.frm.doc[frappe.scrub(this.frm.doc.apply_discount_on)])\n\t\t\t\t* this.frm.doc.additional_discount_percentage / 100, precision(\"discount_amount\"));\n\t\t}\n\t},\n\n\tapply_discount_amount: function() {\n\t\tvar me = this;\n\t\tvar distributed_amount = 0.0;\n\t\tthis.frm.doc.base_discount_amount = 0.0;\n\n\t\tif (this.frm.doc.discount_amount) {\n\t\t\tif(!this.frm.doc.apply_discount_on)\n\t\t\t\tfrappe.throw(__(\"Please select Apply Discount On\"));\n\n\t\t\tthis.frm.doc.base_discount_amount = flt(this.frm.doc.discount_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_discount_amount\"));\n\n\t\t\tvar total_for_discount_amount = this.get_total_for_discount_amount();\n\t\t\tvar net_total = 0;\n\t\t\t// calculate item amount after Discount Amount\n\t\t\tif (total_for_discount_amount) {\n\t\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\t\tdistributed_amount = flt(me.frm.doc.discount_amount) * item.net_amount / total_for_discount_amount;\n\t\t\t\t\titem.net_amount = flt(item.net_amount - distributed_amount,\n\t\t\t\t\t\tprecision(\"base_amount\", item));\n\t\t\t\t\tnet_total += item.net_amount;\n\n\t\t\t\t\t// discount amount rounding loss adjustment if no taxes\n\t\t\t\t\tif ((!(me.frm.doc.taxes || []).length || (me.frm.doc.apply_discount_on == \"Net Total\"))\n\t\t\t\t\t\t\t&& i == (me.frm.doc.items || []).length - 1) {\n\t\t\t\t\t\tvar discount_amount_loss = flt(me.frm.doc.net_total - net_total\n\t\t\t\t\t\t\t- me.frm.doc.discount_amount, precision(\"net_total\"));\n\t\t\t\t\t\titem.net_amount = flt(item.net_amount + discount_amount_loss,\n\t\t\t\t\t\t\tprecision(\"net_amount\", item));\n\t\t\t\t\t}\n\t\t\t\t\titem.net_rate = flt(item.net_amount / item.qty, precision(\"net_rate\", item));\n\t\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t\t});\n\n\t\t\t\tthis.discount_amount_applied = true;\n\t\t\t\tthis._calculate_taxes_and_totals();\n\t\t\t}\n\t\t}\n\t},\n\n\tget_total_for_discount_amount: function() {\n\t\tif(this.frm.doc.apply_discount_on == \"Net Total\") {\n\t\t\treturn this.frm.doc.net_total;\n\t\t} else {\n\t\t\tvar total_actual_tax = 0.0;\n\t\t\tvar actual_taxes_dict = {};\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\t\tvar tax_amount = (tax.category == \"Valuation\") ? 0.0 : tax.tax_amount;\n\t\t\t\t\ttax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = tax_amount;\n\t\t\t\t} else if (actual_taxes_dict[tax.row_id] !== null) {\n\t\t\t\t\tvar actual_tax_amount = flt(actual_taxes_dict[tax.row_id]) * flt(tax.rate) / 100;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = actual_tax_amount;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$.each(actual_taxes_dict, function(key, value) {\n\t\t\t\tif (value) total_actual_tax += value;\n\t\t\t});\n\n\t\t\treturn flt(this.frm.doc.grand_total - total_actual_tax, precision(\"grand_total\"));\n\t\t}\n\t},\n\n\tcalculate_total_advance: function(update_paid_amount) {\n\t\tvar total_allocated_amount = frappe.utils.sum($.map(this.frm.doc[\"advances\"] || [], function(adv) {\n\t\t\treturn flt(adv.allocated_amount, precision(\"allocated_amount\", adv));\n\t\t}));\n\t\tthis.frm.doc.total_advance = flt(total_allocated_amount, precision(\"total_advance\"));\n\n\t\tthis.calculate_outstanding_amount(update_paid_amount);\n\t},\n\n\tcalculate_outstanding_amount: function(update_paid_amount) {\n\t\t// NOTE:\n\t\t// paid_amount and write_off_amount is only for POS Invoice\n\t\t// total_advance is only for non POS Invoice\n\n\t\tif(this.frm.doc.doctype == \"Sales Invoice\" && this.frm.doc.is_return){\n\t\t\tthis.calculate_paid_amount();\n\t\t}\n\n\t\tif(this.frm.doc.is_return || this.frm.doc.docstatus > 0) return;\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"total_advance\", \"write_off_amount\"]);\n\n\t\tif(in_list([\"Sales Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)) {\n\t\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\n\t\t\tif(this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\t\tvar total_amount_to_pay = flt((grand_total - this.frm.doc.total_advance\n\t\t\t\t\t- this.frm.doc.write_off_amount), precision(\"grand_total\"));\n\t\t\t} else {\n\t\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t\t(flt(grand_total*this.frm.doc.conversion_rate, precision(\"grand_total\"))\n\t\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount),\n\t\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tfrappe.model.round_floats_in(this.frm.doc, [\"paid_amount\"]);\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"paid_amount\"]);\n\n\t\t\tif(this.frm.refresh_field){\n\t\t\t\tthis.frm.refresh_field(\"paid_amount\");\n\t\t\t\tthis.frm.refresh_field(\"base_paid_amount\");\n\t\t\t}\n\n\t\t\tif(this.frm.doc.doctype == \"Sales Invoice\") {\n\t\t\t\tthis.set_default_payment(total_amount_to_pay, update_paid_amount);\n\t\t\t\tthis.calculate_paid_amount();\n\t\t\t}\n\t\t\tthis.calculate_change_amount();\n\n\t\t\tvar paid_amount = (this.frm.doc.party_account_currency == this.frm.doc.currency) ?\n\t\t\t\tthis.frm.doc.paid_amount : this.frm.doc.base_paid_amount;\n\n\t\t\tthis.frm.doc.outstanding_amount =  flt(total_amount_to_pay - flt(paid_amount) +\n\t\t\t\tflt(this.frm.doc.change_amount * this.frm.doc.conversion_rate), precision(\"outstanding_amount\"));\n\t\t}\n\t},\n\n\tset_default_payment: function(total_amount_to_pay, update_paid_amount){\n\t\tvar me = this;\n\t\tvar payment_status = true;\n\t\tif(this.frm.doc.is_pos && (update_paid_amount===undefined || update_paid_amount)){\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data){\n\t\t\t\tif(data.default && payment_status && total_amount_to_pay > 0) {\n\t\t\t\t\tdata.base_amount = flt(total_amount_to_pay, precision(\"base_amount\"));\n\t\t\t\t\tdata.amount = flt(total_amount_to_pay / me.frm.doc.conversion_rate, precision(\"amount\"));\n\t\t\t\t\tpayment_status = false;\n\t\t\t\t}else if(me.frm.doc.paid_amount){\n\t\t\t\t\tdata.amount = 0.0;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tcalculate_paid_amount: function(){\n\t\tvar me = this;\n\t\tvar paid_amount = 0.0;\n\t\tvar base_paid_amount = 0.0;\n\t\tif(this.frm.doc.is_pos) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data){\n\t\t\t\tdata.base_amount = flt(data.amount * me.frm.doc.conversion_rate, precision(\"base_amount\"));\n\t\t\t\tpaid_amount += data.amount;\n\t\t\t\tbase_paid_amount += data.base_amount;\n\t\t\t});\n\t\t} else if(!this.frm.doc.is_return){\n\t\t\tthis.frm.doc.payments = [];\n\t\t}\n\n\t\tthis.frm.doc.paid_amount = flt(paid_amount, precision(\"paid_amount\"));\n\t\tthis.frm.doc.base_paid_amount = flt(base_paid_amount, precision(\"base_paid_amount\"));\n\t},\n\n\tcalculate_change_amount: function(){\n\t\tthis.frm.doc.change_amount = 0.0;\n\t\tthis.frm.doc.base_change_amount = 0.0;\n\t\tif(this.frm.doc.doctype == \"Sales Invoice\"\n\t\t\t&& this.frm.doc.paid_amount > this.frm.doc.grand_total && !this.frm.doc.is_return) {\n\n\t\t\tvar payment_types = $.map(this.frm.doc.payments, function(d) { return d.type; });\n\t\t\tif (in_list(payment_types, 'Cash')) {\n\t\t\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\t\t\tvar base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\t\t\tthis.frm.doc.change_amount = flt(this.frm.doc.paid_amount - grand_total +\n\t\t\t\t\tthis.frm.doc.write_off_amount, precision(\"change_amount\"));\n\n\t\t\t\tthis.frm.doc.base_change_amount = flt(this.frm.doc.base_paid_amount -\n\t\t\t\t\tbase_grand_total + this.frm.doc.base_write_off_amount,\n\t\t\t\t\tprecision(\"base_change_amount\"));\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_write_off_amount: function(){\n\t\tif(this.frm.doc.paid_amount > this.frm.doc.grand_total){\n\t\t\tthis.frm.doc.write_off_amount = flt(this.frm.doc.grand_total - this.frm.doc.paid_amount\n\t\t\t\t+ this.frm.doc.change_amount, precision(\"write_off_amount\"));\n\n\t\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_write_off_amount\"));\n\t\t}else{\n\t\t\tthis.frm.doc.paid_amount = 0.0;\n\t\t}\n\t\tthis.calculate_outstanding_amount(false);\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.TransactionController = erpnext.taxes_and_totals.extend({\n\tsetup: function() {\n\t\tthis._super();\n\t\tfrappe.flags.hide_serial_batch_dialog = false;\n\t\tfrappe.ui.form.on(this.frm.doctype + \" Item\", \"rate\", function(frm, cdt, cdn) {\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\tvar has_margin_field = frappe.meta.has_field(cdt, 'margin_type');\n\n\t\t\tfrappe.model.round_floats_in(item, [\"rate\", \"price_list_rate\"]);\n\n\t\t\tif(item.price_list_rate) {\n\t\t\t\tif(item.rate > item.price_list_rate && has_margin_field) {\n\t\t\t\t\t// if rate is greater than price_list_rate, set margin\n\t\t\t\t\t// or set discount\n\t\t\t\t\titem.discount_percentage = 0;\n\t\t\t\t\titem.margin_type = 'Amount';\n\t\t\t\t\titem.margin_rate_or_amount = flt(item.rate - item.price_list_rate,\n\t\t\t\t\t\tprecision(\"margin_rate_or_amount\", item));\n\t\t\t\t\titem.rate_with_margin = item.rate;\n\t\t\t\t} else {\n\t\t\t\t\titem.discount_percentage = flt((1 - item.rate / item.price_list_rate) * 100.0,\n\t\t\t\t\t\tprecision(\"discount_percentage\", item));\n\t\t\t\t\titem.margin_type = '';\n\t\t\t\t\titem.margin_rate_or_amount = 0;\n\t\t\t\t\titem.rate_with_margin = 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titem.discount_percentage = 0.0;\n\t\t\t\titem.margin_type = '';\n\t\t\t\titem.margin_rate_or_amount = 0;\n\t\t\t\titem.rate_with_margin = 0;\n\t\t\t}\n\n\t\t\tcur_frm.cscript.set_gross_profit(item);\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\n\t\t});\n\n\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"tax_amount\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"row_id\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"included_in_print_rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.set_dynamic_labels();\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"apply_discount_on\", function(frm) {\n\t\t\tif(frm.doc.additional_discount_percentage) {\n\t\t\t\tfrm.trigger(\"additional_discount_percentage\");\n\t\t\t} else {\n\t\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"additional_discount_percentage\", function(frm) {\n\t\t\tif(!frm.doc.apply_discount_on) {\n\t\t\t\tfrappe.msgprint(__(\"Please set 'Apply Additional Discount On'\"));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfrm.via_discount_percentage = true;\n\n\t\t\tif(frm.doc.additional_discount_percentage && frm.doc.discount_amount) {\n\t\t\t\t// Reset discount amount and net / grand total\n\t\t\t\tfrm.doc.discount_amount = 0;\n\t\t\t\tfrm.cscript.calculate_taxes_and_totals();\n\t\t\t}\n\n\t\t\tvar total = flt(frm.doc[frappe.model.scrub(frm.doc.apply_discount_on)]);\n\t\t\tvar discount_amount = flt(total*flt(frm.doc.additional_discount_percentage) / 100,\n\t\t\t\tprecision(\"discount_amount\"));\n\n\t\t\tfrm.set_value(\"discount_amount\", discount_amount)\n\t\t\t\t.then(() => delete frm.via_discount_percentage);\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"discount_amount\", function(frm) {\n\t\t\tfrm.cscript.set_dynamic_labels();\n\n\t\t\tif (!frm.via_discount_percentage) {\n\t\t\t\tfrm.doc.additional_discount_percentage = 0;\n\t\t\t}\n\n\t\t\tfrm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tvar me = this;\n\t\tif(this.frm.fields_dict[\"items\"].grid.get_field('batch_no')) {\n\t\t\tthis.frm.set_query(\"batch_no\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\treturn me.set_query_for_batch(doc, cdt, cdn);\n\t\t\t});\n\t\t}\n\n\t\tif(\n\t\t\tthis.frm.docstatus < 2 \n\t\t\t&& this.frm.fields_dict[\"payment_terms_template\"]\n\t\t\t&& this.frm.fields_dict[\"payment_schedule\"]\n\t\t\t&& this.frm.doc.payment_terms_template\n\t\t\t&& !this.frm.doc.payment_schedule.length\n\t\t){\n\t\t\tthis.frm.trigger(\"payment_terms_template\");\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"taxes\"]) {\n\t\t\tthis[\"taxes_remove\"] = this.calculate_taxes_and_totals;\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"items\"]) {\n\t\t\tthis[\"items_remove\"] = this.calculate_net_weight;\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"recurring_print_format\"]) {\n\t\t\tthis.frm.set_query(\"recurring_print_format\", function(doc) {\n\t\t\t\treturn{\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t['Print Format', 'doc_type', '=', cur_frm.doctype],\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"return_against\"]) {\n\t\t\tthis.frm.set_query(\"return_against\", function(doc) {\n\t\t\t\tvar filters = {\n\t\t\t\t\t\"docstatus\": 1,\n\t\t\t\t\t\"is_return\": 0,\n\t\t\t\t\t\"company\": doc.company\n\t\t\t\t};\n\t\t\t\tif (me.frm.fields_dict[\"customer\"] && doc.customer) filters[\"customer\"] = doc.customer;\n\t\t\t\tif (me.frm.fields_dict[\"supplier\"] && doc.supplier) filters[\"supplier\"] = doc.supplier;\n\n\t\t\t\treturn {\n\t\t\t\t\tfilters: filters\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t},\n\tonload: function() {\n\t\tvar me = this;\n\n\t\tthis.setup_quality_inspection();\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tvar currency = frappe.defaults.get_user_default(\"currency\");\n\n\t\t\tlet set_value = (fieldname, value) => {\n\t\t\t\tif(me.frm.fields_dict[fieldname] && !me.frm.doc[fieldname]) {\n\t\t\t\t\treturn me.frm.set_value(fieldname, value);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn frappe.run_serially([\n\t\t\t\t() => set_value('currency', currency),\n\t\t\t\t() => set_value('price_list_currency', currency),\n\t\t\t\t() => set_value('status', 'Draft'),\n\t\t\t\t() => set_value('is_subcontracted', 'No'),\n\t\t\t\t() => {\n\t\t\t\t\tif(this.frm.doc.company && !this.frm.doc.amended_from) {\n\t\t\t\t\t\tthis.frm.trigger(\"company\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\t},\n\n\tsetup_quality_inspection: function() {\n\t\tif(!in_list([\"Delivery Note\", \"Sales Invoice\", \"Purchase Receipt\", \"Purchase Invoice\"], this.frm.doc.doctype)) {\n\t\t\treturn;\n\t\t}\n\t\tvar me = this;\n\t\tvar inspection_type = in_list([\"Purchase Receipt\", \"Purchase Invoice\"], this.frm.doc.doctype)\n\t\t\t? \"Incoming\" : \"Outgoing\";\n\n\t\tvar quality_inspection_field = this.frm.get_docfield(\"items\", \"quality_inspection\");\n\t\tquality_inspection_field.get_route_options_for_new_doc = function(row) {\n\t\t\tif(me.frm.is_new()) return;\n\t\t\treturn {\n\t\t\t\t\"inspection_type\": inspection_type,\n\t\t\t\t\"reference_type\": me.frm.doc.doctype,\n\t\t\t\t\"reference_name\": me.frm.doc.name,\n\t\t\t\t\"item_code\": row.doc.item_code,\n\t\t\t\t\"description\": row.doc.description,\n\t\t\t\t\"item_serial_no\": row.doc.serial_no ? row.doc.serial_no.split(\"\\n\")[0] : null,\n\t\t\t\t\"batch_no\": row.doc.batch_no\n\t\t\t}\n\t\t}\n\n\t\tthis.frm.set_query(\"quality_inspection\", \"items\", function(doc, cdt, cdn) {\n\t\t\tvar d = locals[cdt][cdn];\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\tdocstatus: 1,\n\t\t\t\t\tinspection_type: inspection_type,\n\t\t\t\t\treference_name: doc.name,\n\t\t\t\t\titem_code: d.item_code\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\tonload_post_render: function() {\n\t\tif(this.frm.doc.__islocal && !(this.frm.doc.taxes || []).length\n\t\t\t&& !(this.frm.doc.__onload ? this.frm.doc.__onload.load_after_mapping : false)) {\n\t\t\tfrappe.after_ajax(() => this.apply_default_taxes());\n\t\t} else if(this.frm.doc.__islocal && this.frm.doc.company && this.frm.doc[\"items\"]\n\t\t\t&& !this.frm.doc.is_pos) {\n\t\t\tfrappe.after_ajax(() => this.calculate_taxes_and_totals());\n\t\t}\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype + \" Item\", \"item_code\")) {\n\t\t\tthis.setup_item_selector();\n\t\t}\n\t},\n\n\trefresh: function() {\n\t\terpnext.toggle_naming_series();\n\t\terpnext.hide_company();\n\t\tthis.set_dynamic_labels();\n\t\tthis.setup_sms();\n\t},\n\n\tapply_default_taxes: function() {\n\t\tvar me = this;\n\t\tvar taxes_and_charges_field = frappe.meta.get_docfield(me.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\tme.frm.doc.name);\n\n\t\tif (!this.frm.doc.taxes_and_charges && this.frm.doc.taxes) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (taxes_and_charges_field) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_default_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": taxes_and_charges_field.options,\n\t\t\t\t\t\"tax_template\": me.frm.doc.taxes_and_charges,\n\t\t\t\t\t\"company\": me.frm.doc.company\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t// directly set in doc, so as not to call triggers\n\t\t\t\t\t\t\t\tif(r.message.taxes_and_charges) {\n\t\t\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges = r.message.taxes_and_charges;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// set taxes table\n\t\t\t\t\t\t\t\tif(r.message.taxes) {\n\t\t\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message.taxes);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t() => me.calculate_taxes_and_totals()\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tsetup_sms: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus===1 && !in_list([\"Lost\", \"Stopped\", \"Closed\"], this.frm.doc.status)\n\t\t\t&& this.frm.doctype != \"Purchase Invoice\") {\n\t\t\tthis.frm.page.add_menu_item(__('Send SMS'), function() { me.send_sms(); });\n\t\t}\n\t},\n\n\tsend_sms: function() {\n\t\tvar sms_man = new erpnext.SMSManager(this.frm.doc);\n\t},\n\n\tbarcode: function(doc, cdt, cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\tif(d.barcode==\"\" || d.barcode==null) {\n\t\t\t// barcode cleared, remove item\n\t\t\td.item_code = \"\";\n\t\t}\n\t\tthis.item_code(doc, cdt, cdn, true);\n\t},\n\n\titem_code: function(doc, cdt, cdn, from_barcode) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tvar update_stock = 0, show_batch_dialog = 0;\n\n\t\tif(['Sales Invoice'].includes(this.frm.doc.doctype)) {\n\t\t\tupdate_stock = cint(me.frm.doc.update_stock);\n\t\t\tshow_batch_dialog = update_stock;\n\n\t\t} else if((this.frm.doc.doctype === 'Purchase Receipt' && me.frm.doc.is_return) ||\n\t\t\tthis.frm.doc.doctype === 'Delivery Note') {\n\t\t\tshow_batch_dialog = 1;\n\t\t}\n\n\t\t// clear barcode if setting item (else barcode will take priority)\n\t\tif(!from_barcode) {\n\t\t\titem.barcode = null;\n\t\t}\n\t\tif(item.item_code || item.barcode || item.serial_no) {\n\t\t\tif(!this.validate_company_and_party()) {\n\t\t\t\tthis.frm.fields_dict[\"items\"].grid.grid_rows[item.idx - 1].remove();\n\t\t\t} else {\n\t\t\t\treturn this.frm.call({\n\t\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_details\",\n\t\t\t\t\tchild: item,\n\t\t\t\t\targs: {\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\t\tbarcode: item.barcode,\n\t\t\t\t\t\t\tserial_no: item.serial_no,\n\t\t\t\t\t\t\twarehouse: item.warehouse,\n\t\t\t\t\t\t\tcustomer: me.frm.doc.customer,\n\t\t\t\t\t\t\tsupplier: me.frm.doc.supplier,\n\t\t\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\t\t\tupdate_stock: update_stock,\n\t\t\t\t\t\t\tconversion_rate: me.frm.doc.conversion_rate,\n\t\t\t\t\t\t\tprice_list: me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n\t\t\t\t\t\t\tprice_list_currency: me.frm.doc.price_list_currency,\n\t\t\t\t\t\t\tplc_conversion_rate: me.frm.doc.plc_conversion_rate,\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\t\t\torder_type: me.frm.doc.order_type,\n\t\t\t\t\t\t\tis_pos: cint(me.frm.doc.is_pos),\n\t\t\t\t\t\t\tis_subcontracted: me.frm.doc.is_subcontracted,\n\t\t\t\t\t\t\ttransaction_date: me.frm.doc.transaction_date || me.frm.doc.posting_date,\n\t\t\t\t\t\t\tignore_pricing_rule: me.frm.doc.ignore_pricing_rule,\n\t\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\t\t\tproject: item.project || me.frm.doc.project,\n\t\t\t\t\t\t\tqty: item.qty || 1,\n\t\t\t\t\t\t\tstock_qty: item.stock_qty,\n\t\t\t\t\t\t\tconversion_factor: item.conversion_factor,\n\t\t\t\t\t\t\tweight_per_unit: item.weight_per_unit,\n\t\t\t\t\t\t\tweight_uom: item.weight_uom,\n\t\t\t\t\t\t\tpos_profile: me.frm.doc.doctype == 'Sales Invoice' ? me.frm.doc.pos_profile : ''\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t() => me.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn),\n\t\t\t\t\t\t\t\t() => me.toggle_conversion_factor(item),\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif(show_batch_dialog && !frappe.flags.hide_serial_batch_dialog) {\n\t\t\t\t\t\t\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\t\t\t\t\t\t\t$.each(r.message, function(k, v) {\n\t\t\t\t\t\t\t\t\t\t\tif(!d[k]) d[k] = v;\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\terpnext.show_serial_batch_selector(me.frm, d, (item) => {\n\t\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger('qty', item.doctype, item.name);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => me.conversion_factor(doc, cdt, cdn, true)\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\n\tserial_no: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif (item.serial_no) {\n\t\t\tif (!item.item_code) {\n\t\t\t\tthis.frm.trigger(\"item_code\", cdt, cdn);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar valid_serial_nos = [];\n\n\t\t\t\t// Replacing all occurences of comma with carriage return\n\t\t\t\tvar serial_nos = item.serial_no.trim().replace(/,/g, '\\n');\n\n\t\t\t\tserial_nos = serial_nos.trim().split('\\n');\n\n\t\t\t\t// Trim each string and push unique string to new list\n\t\t\t\tfor (var x=0; x<=serial_nos.length - 1; x++) {\n\t\t\t\t\tif (serial_nos[x].trim() != \"\" && valid_serial_nos.indexOf(serial_nos[x].trim()) == -1) {\n\t\t\t\t\t\tvalid_serial_nos.push(serial_nos[x].trim());\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Add the new list to the serial no. field in grid with each in new line\n\t\t\t\titem.serial_no = valid_serial_nos.join('\\n');\n\n\t\t\t\trefresh_field(\"serial_no\", item.name, item.parentfield);\n\t\t\t\tif(!doc.is_return) {\n\t\t\t\t\tfrappe.model.set_value(item.doctype, item.name,\n\t\t\t\t\t\t\"qty\", valid_serial_nos.length / item.conversion_factor);\n\t\t\t\t\tfrappe.model.set_value(item.doctype, item.name, \"stock_qty\", valid_serial_nos.length);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tvalidate: function() {\n\t\tthis.calculate_taxes_and_totals(false);\n\t},\n\n\tcompany: function() {\n\t\tvar me = this;\n\t\tvar set_pricing = function() {\n\t\t\tif(me.frm.doc.company && me.frm.fields_dict.currency) {\n\t\t\t\tvar company_currency = me.get_company_currency();\n\t\t\t\tvar company_doc = frappe.get_doc(\":Company\", me.frm.doc.company);\n\n\t\t\t\tif (!me.frm.doc.currency) {\n\t\t\t\t\tme.frm.set_value(\"currency\", company_currency);\n\t\t\t\t}\n\n\t\t\t\tif (me.frm.doc.currency == company_currency) {\n\t\t\t\t\tme.frm.set_value(\"conversion_rate\", 1.0);\n\t\t\t\t}\n\t\t\t\tif (me.frm.doc.price_list_currency == company_currency) {\n\t\t\t\t\tme.frm.set_value('plc_conversion_rate', 1.0);\n\t\t\t\t}\n\t\t\t\tif (company_doc.default_letter_head) {\n\t\t\t\t\tif(me.frm.fields_dict.letter_head) {\n\t\t\t\t\t\tme.frm.set_value(\"letter_head\", company_doc.default_letter_head);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (company_doc.default_terms && me.frm.doc.doctype != \"Purchase Invoice\" && frappe.meta.has_field(me.frm.doc.doctype, \"tc_name\")) {\n\t\t\t\t\tme.frm.set_value(\"tc_name\", company_doc.default_terms);\n\t\t\t\t}\n\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => me.frm.script_manager.trigger(\"currency\"),\n\t\t\t\t\t() => me.apply_default_taxes(),\n\t\t\t\t\t() => me.apply_pricing_rule()\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\n\t\tvar set_party_account = function(set_pricing) {\n\t\t\tif (in_list([\"Sales Invoice\", \"Purchase Invoice\"], me.frm.doc.doctype)) {\n\t\t\t\tif(me.frm.doc.doctype==\"Sales Invoice\") {\n\t\t\t\t\tvar party_type = \"Customer\";\n\t\t\t\t\tvar party_account_field = 'debit_to';\n\t\t\t\t} else {\n\t\t\t\t\tvar party_type = \"Supplier\";\n\t\t\t\t\tvar party_account_field = 'credit_to';\n\t\t\t\t}\n\n\t\t\t\tvar party = me.frm.doc[frappe.model.scrub(party_type)];\n\t\t\t\tif(party && me.frm.doc.company) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: \"erpnext.accounts.party.get_party_account\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\t\t\tparty_type: party_type,\n\t\t\t\t\t\t\tparty: party\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\t\t\tme.frm.set_value(party_account_field, r.message);\n\t\t\t\t\t\t\t\tset_pricing();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tset_pricing();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tset_pricing();\n\t\t\t}\n\n\t\t}\n\n\t\tif (this.frm.doc.posting_date) var date = this.frm.doc.posting_date;\n\t\telse var date = this.frm.doc.transaction_date;\n\n\t\tif (frappe.meta.get_docfield(this.frm.doctype, \"shipping_address\") &&\n\t\t\tin_list(['Purchase Order', 'Purchase Receipt', 'Purchase Invoice'], this.frm.doctype)){\n\t\t\terpnext.utils.get_shipping_address(this.frm, function(){\n\t\t\t\tset_party_account(set_pricing);\n\t\t\t})\n\t\t} else {\n\t\t\tset_party_account(set_pricing);\n\t\t}\n\n\t\tif(this.frm.doc.company) {\n\t\t\terpnext.last_selected_company = this.frm.doc.company;\n\t\t}\n\t},\n\n\ttransaction_date: function() {\n\t\tif (this.frm.doc.transaction_date) {\n\t\t\tthis.frm.transaction_date = this.frm.doc.transaction_date;\n\t\t\tfrappe.ui.form.trigger(this.frm.doc.doctype, \"currency\");\n\t\t}\n\t},\n\n\tposting_date: function() {\n\t\tvar me = this;\n\t\tif (this.frm.doc.posting_date) {\n\t\t\tthis.frm.posting_date = this.frm.doc.posting_date;\n\n\t\t\tif ((this.frm.doc.doctype == \"Sales Invoice\" && this.frm.doc.customer) ||\n\t\t\t\t(this.frm.doc.doctype == \"Purchase Invoice\" && this.frm.doc.supplier)) {\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: \"erpnext.accounts.party.get_due_date\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\t\"posting_date\": me.frm.doc.posting_date,\n\t\t\t\t\t\t\"party_type\": me.frm.doc.doctype == \"Sales Invoice\" ? \"Customer\" : \"Supplier\",\n\t\t\t\t\t\t\"bill_date\": me.frm.doc.bill_date,\n\t\t\t\t\t\t\"party\": me.frm.doc.doctype == \"Sales Invoice\" ? me.frm.doc.customer : me.frm.doc.supplier,\n\t\t\t\t\t\t\"company\": me.frm.doc.company\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t\tme.frm.doc.due_date = r.message;\n\t\t\t\t\t\t\trefresh_field(\"due_date\");\n\t\t\t\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n\t\t\t\t\t\t\tme.recalculate_terms();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n\t\t\t}\n\t\t}\n\t},\n\n\tdue_date: function() {\n\t\t// due_date is to be changed, payment terms template and/or payment schedule must\n\t\t// be removed as due_date is automatically changed based on payment terms\n\t\tif (this.frm.doc.due_date && !this.frm.updating_party_details && !this.frm.doc.is_pos) {\n\t\t\tif (this.frm.doc.payment_terms_template ||\n\t\t\t\t(this.frm.doc.payment_schedule && this.frm.doc.payment_schedule.length)) {\n\t\t\t\tvar message1 = \"\";\n\t\t\t\tvar message2 = \"\";\n\t\t\t\tvar final_message = \"Please clear the \";\n\n\t\t\t\tif (this.frm.doc.payment_terms_template) {\n\t\t\t\t\tmessage1 = \"selected Payment Terms Template\";\n\t\t\t\t\tfinal_message = final_message + message1;\n\t\t\t\t}\n\n\t\t\t\tif ((this.frm.doc.payment_schedule || []).length) {\n\t\t\t\t\tmessage2 = \"Payment Schedule Table\";\n\t\t\t\t\tif (message1.length !== 0) message2 = \" and \" + message2;\n\t\t\t\t\tfinal_message = final_message + message2;\n\t\t\t\t}\n\t\t\t\tfrappe.msgprint(final_message);\n\t\t\t}\n\t\t}\n\t},\n\n\tbill_date: function() {\n\t\tthis.posting_date();\n\t},\n\n\trecalculate_terms: function() {\n\t\tconst doc = this.frm.doc;\n\t\tif (doc.payment_terms_template) {\n\t\t\tthis.payment_terms_template();\n\t\t} else if (doc.payment_schedule) {\n\t\t\tconst me = this;\n\t\t\tdoc.payment_schedule.forEach(\n\t\t\t\tfunction(term) {\n\t\t\t\t\tif (term.payment_term) {\n\t\t\t\t\t\tme.payment_term(doc, term.doctype, term.name);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\t\t\tterm.doctype, term.name, 'due_date',\n\t\t\t\t\t\t\tdoc.posting_date || doc.transaction_date\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t},\n\n\tget_company_currency: function() {\n\t\treturn erpnext.get_currency(this.frm.doc.company);\n\t},\n\n\tcontact_person: function() {\n\t\terpnext.utils.get_contact_details(this.frm);\n\t},\n\n\tcurrency: function() {\n\t\t/* manqala 19/09/2016: let the translation date be whichever of the transaction_date or posting_date is available */\n\t\tvar transaction_date = this.frm.doc.transaction_date || this.frm.doc.posting_date;\n\t\t/* end manqala */\n\n\t\tvar me = this;\n\t\tthis.set_dynamic_labels();\n\n\t\tvar company_currency = this.get_company_currency();\n\t\t// Added `ignore_pricing_rule` to determine if document is loading after mapping from another doc\n\t\tif(this.frm.doc.currency && this.frm.doc.currency !== company_currency\n\t\t\t\t&& !this.frm.doc.ignore_pricing_rule) {\n\t\t\tthis.get_exchange_rate(transaction_date, this.frm.doc.currency, company_currency,\n\t\t\t\tfunction(exchange_rate) {\n\t\t\t\t\tme.frm.set_value(\"conversion_rate\", exchange_rate);\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.conversion_rate();\n\t\t}\n\t},\n\n\tconversion_rate: function() {\n\t\tconst me = this.frm;\n\t\tif(this.frm.doc.currency === this.get_company_currency()) {\n\t\t\tthis.frm.set_value(\"conversion_rate\", 1.0);\n\t\t}\n\t\tif(this.frm.doc.currency === this.frm.doc.price_list_currency &&\n\t\t\tthis.frm.doc.plc_conversion_rate !== this.frm.doc.conversion_rate) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", this.frm.doc.conversion_rate);\n\t\t}\n\n\t\tif(flt(this.frm.doc.conversion_rate)>0.0) {\n\t\t\tif(this.frm.doc.ignore_pricing_rule) {\n\t\t\t\tthis.calculate_taxes_and_totals();\n\t\t\t} else if (!this.in_apply_price_list){\n\t\t\t\tthis.set_actual_charges_based_on_currency();\n\t\t\t\tthis.apply_price_list();\n\t\t\t}\n\n\t\t}\n\t\t// Make read only if Accounts Settings doesn't allow stale rates\n\t\tthis.frm.set_df_property(\"conversion_rate\", \"read_only\", erpnext.stale_rate_allowed() ? 0 : 1);\n\t},\n\n\tshipping_rule: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.shipping_rule) {\n\t\t\treturn this.frm.call({\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tmethod: \"apply_shipping_rule\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).fail(() => this.frm.set_value('shipping_rule', ''));\n\t\t}\n\t\telse {\n\t\t\tme.calculate_taxes_and_totals();\n\t\t}\n\t},\n\n\tset_actual_charges_based_on_currency: function() {\n\t\tvar me = this;\n\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\tif(d.charge_type == \"Actual\") {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"tax_amount\",\n\t\t\t\t\tflt(d.tax_amount) / flt(me.frm.doc.conversion_rate));\n\t\t\t}\n\t\t});\n\t},\n\n\tget_exchange_rate: function(transaction_date, from_currency, to_currency, callback) {\n\t\tif (!transaction_date || !from_currency || !to_currency) return;\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.setup.utils.get_exchange_rate\",\n\t\t\targs: {\n\t\t\t\ttransaction_date: transaction_date,\n\t\t\t\tfrom_currency: from_currency,\n\t\t\t\tto_currency: to_currency\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tcallback(flt(r.message));\n\t\t\t}\n\t\t});\n\t},\n\n\tprice_list_currency: function() {\n\t\tvar me=this;\n\t\tthis.set_dynamic_labels();\n\n\t\tvar company_currency = this.get_company_currency();\n\t\t// Added `ignore_pricing_rule` to determine if document is loading after mapping from another doc\n\t\tif(this.frm.doc.price_list_currency !== company_currency  && !this.frm.doc.ignore_pricing_rule) {\n\t\t\tthis.get_exchange_rate(this.frm.doc.posting_date, this.frm.doc.price_list_currency, company_currency,\n\t\t\t\tfunction(exchange_rate) {\n\t\t\t\t\tme.frm.set_value(\"plc_conversion_rate\", exchange_rate);\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.plc_conversion_rate();\n\t\t}\n\t},\n\n\tplc_conversion_rate: function() {\n\t\tif(this.frm.doc.price_list_currency === this.get_company_currency()) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", 1.0);\n\t\t} else if(this.frm.doc.price_list_currency === this.frm.doc.currency\n\t\t\t&& this.frm.doc.plc_conversion_rate && cint(this.frm.doc.plc_conversion_rate) != 1 &&\n\t\t\tcint(this.frm.doc.plc_conversion_rate) != cint(this.frm.doc.conversion_rate)) {\n\t\t\tthis.frm.set_value(\"conversion_rate\", this.frm.doc.plc_conversion_rate);\n\t\t}\n\n\t\tif(!this.in_apply_price_list) {\n\t\t\tthis.apply_price_list(null, true);\n\t\t}\n\t},\n\n\tuom: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tif(item.item_code && item.uom) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_conversion_factor\",\n\t\t\t\tchild: item,\n\t\t\t\targs: {\n\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\tuom: item.uom\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tme.conversion_factor(me.frm.doc, cdt, cdn);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tconversion_factor: function(doc, cdt, cdn, dont_fetch_price_list_rate) {\n\t\tif(frappe.meta.get_docfield(cdt, \"stock_qty\", cdn)) {\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\tfrappe.model.round_floats_in(item, [\"qty\", \"conversion_factor\"]);\n\t\t\titem.stock_qty = flt(item.qty * item.conversion_factor, precision(\"stock_qty\", item));\n\t\t\titem.total_weight = flt(item.stock_qty * item.weight_per_unit);\n\t\t\trefresh_field(\"stock_qty\", item.name, item.parentfield);\n\t\t\trefresh_field(\"total_weight\", item.name, item.parentfield);\n\t\t\tthis.toggle_conversion_factor(item);\n\t\t\tthis.calculate_net_weight();\n\t\t\tif (!dont_fetch_price_list_rate &&\n\t\t\t\tfrappe.meta.has_field(doc.doctype, \"price_list_currency\")) {\n\t\t\t\tthis.apply_price_list(item, true);\n\t\t\t}\n\t\t}\n\t},\n\n\ttoggle_conversion_factor: function(item) {\n\t\t// toggle read only property for conversion factor field if the uom and stock uom are same\n\t\tif(this.frm.get_field('items').grid.fields_map.conversion_factor) {\n\t\t\tthis.frm.fields_dict.items.grid.toggle_enable(\"conversion_factor\",\n\t\t\t\t((item.uom != item.stock_uom) && !frappe.meta.get_docfield(cur_frm.fields_dict.items.grid.doctype, \"conversion_factor\").read_only)? true: false);\n\t\t}\n\n\t},\n\n\tqty: function(doc, cdt, cdn) {\n\t\tthis.conversion_factor(doc, cdt, cdn, true);\n\t\tthis.apply_pricing_rule(frappe.get_doc(cdt, cdn), true);\n\t},\n\n\tcalculate_net_weight: function(){\n\t\t/* Calculate Total Net Weight then further applied shipping rule to calculate shipping charges.*/\n\t\tvar me = this;\n\t\tthis.frm.doc.total_net_weight= 0.0;\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\tme.frm.doc.total_net_weight += flt(item.total_weight);\n\t\t});\n\t\trefresh_field(\"total_net_weight\");\n\t\tthis.shipping_rule();\n\t},\n\n\tset_dynamic_labels: function() {\n\t\t// What TODO? should we make price list system non-mandatory?\n\t\tthis.frm.toggle_reqd(\"plc_conversion_rate\",\n\t\t\t!!(this.frm.doc.price_list_name && this.frm.doc.price_list_currency));\n\n\t\tif(this.frm.doc_currency!==this.frm.doc.currency\n\t\t\t|| this.frm.doc_currency!==this.frm.doc.price_list_currency) {\n\t\t\t// reset names only when the currency is different\n\n\t\t\tvar company_currency = this.get_company_currency();\n\t\t\tthis.change_form_labels(company_currency);\n\t\t\tthis.change_grid_labels(company_currency);\n\t\t\tthis.frm.refresh_fields();\n\t\t\tthis.frm.doc_currency = this.frm.doc.currency;\n\t\t}\n\t},\n\n\tchange_form_labels: function(company_currency) {\n\t\tvar me = this;\n\n\t\tthis.frm.set_currency_labels([\"base_total\", \"base_net_total\", \"base_total_taxes_and_charges\",\n\t\t\t\"base_discount_amount\", \"base_grand_total\", \"base_rounded_total\", \"base_in_words\",\n\t\t\t\"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\", \"total_amount_to_pay\",\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_change_amount\", \"base_operating_cost\",\n\t\t\t\"base_raw_material_cost\", \"base_total_cost\", \"base_scrap_material_cost\",\n\t\t\t\"base_rounding_adjustment\"], company_currency);\n\n\t\tthis.frm.set_currency_labels([\"total\", \"net_total\", \"total_taxes_and_charges\", \"discount_amount\",\n\t\t\t\"grand_total\", \"taxes_and_charges_added\", \"taxes_and_charges_deducted\",\n\t\t\t\"rounded_total\", \"in_words\", \"paid_amount\", \"write_off_amount\", \"operating_cost\",\n\t\t\t\"scrap_material_cost\", \"rounding_adjustment\", \"raw_material_cost\",\n\t\t\t\"total_cost\"], this.frm.doc.currency);\n\n\t\tthis.frm.set_currency_labels([\"outstanding_amount\", \"total_advance\"],\n\t\t\tthis.frm.doc.party_account_currency);\n\n\t\tcur_frm.set_df_property(\"conversion_rate\", \"description\", \"1 \" + this.frm.doc.currency\n\t\t\t+ \" = [?] \" + company_currency);\n\n\t\tif(this.frm.doc.price_list_currency && this.frm.doc.price_list_currency!=company_currency) {\n\t\t\tcur_frm.set_df_property(\"plc_conversion_rate\", \"description\", \"1 \"\n\t\t\t\t+ this.frm.doc.price_list_currency + \" = [?] \" + company_currency);\n\t\t}\n\n\t\t// toggle fields\n\t\tthis.frm.toggle_display([\"conversion_rate\", \"base_total\", \"base_net_total\",\n\t\t\t\"base_total_taxes_and_charges\", \"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\",\n\t\t\t\"base_grand_total\", \"base_rounded_total\", \"base_in_words\", \"base_discount_amount\",\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_operating_cost\", \"base_raw_material_cost\",\n\t\t\t\"base_total_cost\", \"base_scrap_material_cost\", \"base_rounding_adjustment\"],\n\t\tthis.frm.doc.currency != company_currency);\n\n\t\tthis.frm.toggle_display([\"plc_conversion_rate\", \"price_list_currency\"],\n\t\t\tthis.frm.doc.price_list_currency != company_currency);\n\n\t\tvar show = cint(cur_frm.doc.discount_amount) ||\n\t\t\t\t((cur_frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\n\n\t\tif(frappe.meta.get_docfield(cur_frm.doctype, \"net_total\"))\n\t\t\tcur_frm.toggle_display(\"net_total\", show);\n\n\t\tif(frappe.meta.get_docfield(cur_frm.doctype, \"base_net_total\"))\n\t\t\tcur_frm.toggle_display(\"base_net_total\", (show && (me.frm.doc.currency != company_currency)));\n\n\t},\n\n\tchange_grid_labels: function(company_currency) {\n\t\tvar me = this;\n\n\t\tthis.frm.set_currency_labels([\"base_rate\", \"base_net_rate\", \"base_price_list_rate\", \"base_amount\", \"base_net_amount\"],\n\t\t\tcompany_currency, \"items\");\n\n\t\tthis.frm.set_currency_labels([\"rate\", \"net_rate\", \"price_list_rate\", \"amount\", \"net_amount\"],\n\t\t\tthis.frm.doc.currency, \"items\");\n\n\t\tif(this.frm.fields_dict[\"operations\"]) {\n\t\t\tthis.frm.set_currency_labels([\"operating_cost\", \"hour_rate\"], this.frm.doc.currency, \"operations\");\n\t\t\tthis.frm.set_currency_labels([\"base_operating_cost\", \"base_hour_rate\"], company_currency, \"operations\");\n\n\t\t\tvar item_grid = this.frm.fields_dict[\"operations\"].grid;\n\t\t\t$.each([\"base_operating_cost\", \"base_hour_rate\"], function(i, fname) {\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"scrap_items\"]) {\n\t\t\tthis.frm.set_currency_labels([\"rate\", \"amount\"], this.frm.doc.currency, \"scrap_items\");\n\t\t\tthis.frm.set_currency_labels([\"base_rate\", \"base_amount\"], company_currency, \"scrap_items\");\n\n\t\t\tvar item_grid = this.frm.fields_dict[\"scrap_items\"].grid;\n\t\t\t$.each([\"base_rate\", \"base_amount\"], function(i, fname) {\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"taxes\"]) {\n\t\t\tthis.frm.set_currency_labels([\"tax_amount\", \"total\", \"tax_amount_after_discount\"], this.frm.doc.currency, \"taxes\");\n\n\t\t\tthis.frm.set_currency_labels([\"base_tax_amount\", \"base_total\", \"base_tax_amount_after_discount\"], company_currency, \"taxes\");\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"advances\"]) {\n\t\t\tthis.frm.set_currency_labels([\"advance_amount\", \"allocated_amount\"],\n\t\t\t\tthis.frm.doc.party_account_currency, \"advances\");\n\t\t}\n\n\t\t// toggle columns\n\t\tvar item_grid = this.frm.fields_dict[\"items\"].grid;\n\t\t$.each([\"base_rate\", \"base_price_list_rate\", \"base_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t});\n\n\t\tvar show = (cint(cur_frm.doc.discount_amount)) ||\n\t\t\t((cur_frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\n\n\t\t$.each([\"net_rate\", \"net_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, show);\n\t\t});\n\n\t\t$.each([\"base_net_rate\", \"base_net_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, (show && (me.frm.doc.currency != company_currency)));\n\t\t});\n\n\t\t// set labels\n\t\tvar $wrapper = $(this.frm.wrapper);\n\t},\n\n\trecalculate: function() {\n\t\tthis.calculate_taxes_and_totals();\n\t},\n\n\trecalculate_values: function() {\n\t\tthis.calculate_taxes_and_totals();\n\t},\n\n\tcalculate_charges: function() {\n\t\tthis.calculate_taxes_and_totals();\n\t},\n\n\tignore_pricing_rule: function() {\n\t\tif(this.frm.doc.ignore_pricing_rule) {\n\t\t\tvar me = this;\n\t\t\tvar item_list = [];\n\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\n\t\t\t\tif (d.item_code) {\n\t\t\t\t\titem_list.push({\n\t\t\t\t\t\t\"doctype\": d.doctype,\n\t\t\t\t\t\t\"name\": d.name,\n\t\t\t\t\t\t\"pricing_rule\": d.pricing_rule\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.remove_pricing_rules\",\n\t\t\t\targs: { item_list: item_list },\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\t\tme._set_values_for_item_list(r.message);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.apply_pricing_rule();\n\t\t}\n\t},\n\n\tapply_pricing_rule: function(item, calculate_taxes_and_totals) {\n\t\tvar me = this;\n\t\tvar args = this._get_args(item);\n\t\tif (!(args.items && args.items.length)) {\n\t\t\tif(calculate_taxes_and_totals) me.calculate_taxes_and_totals();\n\t\t\treturn;\n\t\t}\n\t\treturn this.frm.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.apply_pricing_rule\",\n\t\t\targs: {\targs: args },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\tme._set_values_for_item_list(r.message);\n\t\t\t\t\tif(item) me.set_gross_profit(item);\n\t\t\t\t\tif(calculate_taxes_and_totals) me.calculate_taxes_and_totals();\n\t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\")\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\t_get_args: function(item) {\n\t\tvar me = this;\n\t\treturn {\n\t\t\t\"items\": this._get_item_list(item),\n\t\t\t\"customer\": me.frm.doc.customer,\n\t\t\t\"customer_group\": me.frm.doc.customer_group,\n\t\t\t\"territory\": me.frm.doc.territory,\n\t\t\t\"supplier\": me.frm.doc.supplier,\n\t\t\t\"supplier_type\": me.frm.doc.supplier_type,\n\t\t\t\"currency\": me.frm.doc.currency,\n\t\t\t\"conversion_rate\": me.frm.doc.conversion_rate,\n\t\t\t\"price_list\": me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n\t\t\t\"price_list_currency\": me.frm.doc.price_list_currency,\n\t\t\t\"plc_conversion_rate\": me.frm.doc.plc_conversion_rate,\n\t\t\t\"company\": me.frm.doc.company,\n\t\t\t\"transaction_date\": me.frm.doc.transaction_date || me.frm.doc.posting_date,\n\t\t\t\"campaign\": me.frm.doc.campaign,\n\t\t\t\"sales_partner\": me.frm.doc.sales_partner,\n\t\t\t\"ignore_pricing_rule\": me.frm.doc.ignore_pricing_rule,\n\t\t\t\"doctype\": me.frm.doc.doctype,\n\t\t\t\"name\": me.frm.doc.name,\n\t\t\t\"is_return\": cint(me.frm.doc.is_return),\n\t\t\t\"update_stock\": in_list(['Sales Invoice', 'Purchase Invoice'], me.frm.doc.doctype) ? cint(me.frm.doc.update_stock) : 0,\n\t\t\t\"conversion_factor\": me.frm.doc.conversion_factor,\n\t\t\t\"pos_profile\": me.frm.doc.doctype == 'Sales Invoice' ? me.frm.doc.pos_profile : ''\n\t\t};\n\t},\n\n\t_get_item_list: function(item) {\n\t\tvar item_list = [];\n\t\tvar append_item = function(d) {\n\t\t\tif (d.item_code) {\n\t\t\t\titem_list.push({\n\t\t\t\t\t\"doctype\": d.doctype,\n\t\t\t\t\t\"name\": d.name,\n\t\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t\t\"item_group\": d.item_group,\n\t\t\t\t\t\"brand\": d.brand,\n\t\t\t\t\t\"qty\": d.qty,\n\t\t\t\t\t\"parenttype\": d.parenttype,\n\t\t\t\t\t\"parent\": d.parent,\n\t\t\t\t\t\"pricing_rule\": d.pricing_rule,\n\t\t\t\t\t\"warehouse\": d.warehouse,\n\t\t\t\t\t\"serial_no\": d.serial_no,\n\t\t\t\t\t\"discount_percentage\": d.discount_percentage || 0.0,\n\t\t\t\t\t\"conversion_factor\": d.conversion_factor || 1.0\n\t\t\t\t});\n\n\t\t\t\t// if doctype is Quotation Item / Sales Order Iten then add Margin Type and rate in item_list\n\t\t\t\tif (in_list([\"Quotation Item\", \"Sales Order Item\", \"Delivery Note Item\", \"Sales Invoice Item\"]), d.doctype){\n\t\t\t\t\titem_list[0][\"margin_type\"] = d.margin_type;\n\t\t\t\t\titem_list[0][\"margin_rate_or_amount\"] = d.margin_rate_or_amount;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (item) {\n\t\t\tappend_item(item);\n\t\t} else {\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\n\t\t\t\tappend_item(d);\n\t\t\t});\n\t\t}\n\t\treturn item_list;\n\t},\n\n\t_set_values_for_item_list: function(children) {\n\t\tvar me = this;\n\t\tvar price_list_rate_changed = false;\n\t\tfor(var i=0, l=children.length; i<l; i++) {\n\t\t\tvar d = children[i];\n\t\t\tvar existing_pricing_rule = frappe.model.get_value(d.doctype, d.name, \"pricing_rule\");\n\t\t\tfor(var k in d) {\n\t\t\t\tvar v = d[k];\n\t\t\t\tif ([\"doctype\", \"name\"].indexOf(k)===-1) {\n\t\t\t\t\tif(k==\"price_list_rate\") {\n\t\t\t\t\t\tif(flt(v) != flt(d.price_list_rate)) price_list_rate_changed = true;\n\t\t\t\t\t}\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, k, v);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// if pricing rule set as blank from an existing value, apply price_list\n\t\t\tif(!me.frm.doc.ignore_pricing_rule && existing_pricing_rule && !d.pricing_rule) {\n\t\t\t\tme.apply_price_list(frappe.get_doc(d.doctype, d.name));\n\t\t\t}\n\t\t}\n\n\t\tif(!price_list_rate_changed) me.calculate_taxes_and_totals();\n\t},\n\n\tapply_price_list: function(item, reset_plc_conversion) {\n\t\t// We need to reset plc_conversion_rate sometimes because the call to\n\t\t// `erpnext.stock.get_item_details.apply_price_list` is sensitive to its value\n\t\tif (!reset_plc_conversion) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", \"\");\n\t\t}\n\n\t\tvar me = this;\n\t\tvar args = this._get_args(item);\n\t\tif (!((args.items && args.items.length) || args.price_list)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (me.in_apply_price_list == true) return;\n\n\t\tme.in_apply_price_list = true;\n\t\treturn this.frm.call({\n\t\t\tmethod: \"erpnext.stock.get_item_details.apply_price_list\",\n\t\t\targs: {\targs: args },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => me.frm.set_value(\"price_list_currency\", r.message.parent.price_list_currency),\n\t\t\t\t\t\t() => me.frm.set_value(\"plc_conversion_rate\", r.message.parent.plc_conversion_rate),\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif(args.items.length) {\n\t\t\t\t\t\t\t\tme._set_values_for_item_list(r.message.children);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t() => { me.in_apply_price_list = false; }\n\t\t\t\t\t]);\n\n\t\t\t\t} else {\n\t\t\t\t\tme.in_apply_price_list = false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\tvalidate_company_and_party: function() {\n\t\tvar me = this;\n\t\tvar valid = true;\n\n\t\t$.each([\"company\", \"customer\"], function(i, fieldname) {\n\t\t\tif(frappe.meta.has_field(me.frm.doc.doctype, fieldname) && me.frm.doc.doctype != \"Purchase Order\") {\n\t\t\t\tif (!me.frm.doc[fieldname]) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please specify\") + \": \" +\n\t\t\t\t\t\tfrappe.meta.get_label(me.frm.doc.doctype, fieldname, me.frm.doc.name) +\n\t\t\t\t\t\t\". \" + __(\"It is needed to fetch Item Details.\"));\n\t\t\t\t\tvalid = false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn valid;\n\t},\n\n\tget_terms: function() {\n\t\tvar me = this;\n\n\t\terpnext.utils.get_terms(this.frm.doc.tc_name, this.frm.doc, function(r) {\n\t\t\tif(!r.exc) {\n\t\t\t\tme.frm.set_value(\"terms\", r.message);\n\t\t\t}\n\t\t});\n\t},\n\n\ttaxes_and_charges: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.taxes_and_charges) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": frappe.meta.get_docfield(this.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\t\t\t\tthis.frm.doc.name).options,\n\t\t\t\t\t\"master_name\": this.frm.doc.taxes_and_charges,\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tis_recurring: function() {\n\t\t// set default values for recurring documents\n\t\tif(this.frm.doc.is_recurring && this.frm.doc.__islocal) {\n\t\t\tfrappe.msgprint(__(\"Please set recurring after saving\"));\n\t\t\tthis.frm.set_value('is_recurring', 0);\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.frm.doc.is_recurring) {\n\t\t\tif(!this.frm.doc.recurring_id) {\n\t\t\t\tthis.frm.set_value('recurring_id', this.frm.doc.name);\n\t\t\t}\n\n\t\t\tvar owner_email = this.frm.doc.owner==\"Administrator\"\n\t\t\t\t? frappe.user_info(\"Administrator\").email\n\t\t\t\t: this.frm.doc.owner;\n\n\t\t\tthis.frm.doc.notification_email_address = $.map([cstr(owner_email),\n\t\t\t\tcstr(this.frm.doc.contact_email)], function(v) { return v || null; }).join(\", \");\n\t\t\tthis.frm.doc.repeat_on_day_of_month = frappe.datetime.str_to_obj(this.frm.doc.posting_date).getDate();\n\t\t}\n\n\t\trefresh_many([\"notification_email_address\", \"repeat_on_day_of_month\"]);\n\t},\n\n\tfrom_date: function() {\n\t\t// set to_date\n\t\tif(this.frm.doc.from_date) {\n\t\t\tvar recurring_type_map = {'Monthly': 1, 'Quarterly': 3, 'Half-yearly': 6,\n\t\t\t\t'Yearly': 12};\n\n\t\t\tvar months = recurring_type_map[this.frm.doc.recurring_type];\n\t\t\tif(months) {\n\t\t\t\tvar to_date = frappe.datetime.add_months(this.frm.doc.from_date,\n\t\t\t\t\tmonths);\n\t\t\t\tthis.frm.doc.to_date = frappe.datetime.add_days(to_date, -1);\n\t\t\t\trefresh_field('to_date');\n\t\t\t}\n\t\t}\n\t},\n\n\tset_gross_profit: function(item) {\n\t\tif (this.frm.doc.doctype == \"Sales Order\" && item.valuation_rate) {\n\t\t\tvar rate = flt(item.rate) * flt(this.frm.doc.conversion_rate || 1);\n\t\t\titem.gross_profit = flt(((rate - item.valuation_rate) * item.stock_qty), precision(\"amount\", item));\n\t\t}\n\t},\n\n\tsetup_item_selector: function() {\n\t\t// TODO: remove item selector\n\n\t\treturn;\n\t\t// if(!this.item_selector) {\n\t\t// \tthis.item_selector = new erpnext.ItemSelector({frm: this.frm});\n\t\t// }\n\t},\n\n\tget_advances: function() {\n\t\tif(!this.frm.is_return) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"set_advances\",\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\trefresh_field(\"advances\");\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tmake_payment_entry: function() {\n\t\treturn frappe.call({\n\t\t\tmethod: cur_frm.cscript.get_method_for_payment(),\n\t\t\targs: {\n\t\t\t\t\"dt\": cur_frm.doc.doctype,\n\t\t\t\t\"dn\": cur_frm.doc.name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t\t// cur_frm.refresh_fields()\n\t\t\t}\n\t\t});\n\t},\n\n\tget_method_for_payment: function(){\n\t\tvar method = \"erpnext.accounts.doctype.payment_entry.payment_entry.get_payment_entry\";\n\t\tif(cur_frm.doc.__onload && cur_frm.doc.__onload.make_payment_via_journal_entry){\n\t\t\tif(in_list(['Sales Invoice', 'Purchase Invoice'],  cur_frm.doc.doctype)){\n\t\t\t\tmethod = \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_invoice\";\n\t\t\t}else {\n\t\t\t\tmethod= \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_order\";\n\t\t\t}\n\t\t}\n\n\t\treturn method\n\t},\n\n\tset_query_for_batch: function(doc, cdt, cdn) {\n\t\t// Show item's batches in the dropdown of batch no\n\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif(!item.item_code) {\n\t\t\tfrappe.throw(__(\"Please enter Item Code to get batch no\"));\n\t\t} else if (doc.doctype == \"Purchase Receipt\" ||\n\t\t\t(doc.doctype == \"Purchase Invoice\" && doc.update_stock)) {\n\n\t\t\treturn {\n\t\t\t\tfilters: {'item': item.item_code}\n\t\t\t}\n\t\t} else {\n\t\t\tlet filters = {\n\t\t\t\t'item_code': item.item_code,\n\t\t\t\t'posting_date': me.frm.doc.posting_date || frappe.datetime.nowdate(),\n\t\t\t}\n\t\t\tif (item.warehouse) filters[\"warehouse\"] = item.warehouse;\n\n\t\t\treturn {\n\t\t\t\tquery : \"erpnext.controllers.queries.get_batch_no\",\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}\n\t},\n\n\tpayment_terms_template: function() {\n\t\tvar me = this;\n\t\tconst doc = this.frm.doc;\n\t\tif(doc.payment_terms_template && doc.doctype !== 'Delivery Note') {\n\t\t\tvar posting_date = doc.posting_date || doc.transaction_date;\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_terms\",\n\t\t\t\targs: {\n\t\t\t\t\tterms_template: doc.payment_terms_template,\n\t\t\t\t\tposting_date: posting_date,\n\t\t\t\t\tgrand_total: doc.rounded_total || doc.grand_total,\n\t\t\t\t\tbill_date: doc.bill_date\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message && !r.exc) {\n\t\t\t\t\t\tme.frm.set_value(\"payment_schedule\", r.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tpayment_term: function(doc, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\n\t\tif(row.payment_term) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_term_details\",\n\t\t\t\targs: {\n\t\t\t\t\tterm: row.payment_term,\n\t\t\t\t\tbill_date: this.frm.doc.bill_date,\n\t\t\t\t\tposting_date: this.frm.doc.posting_date || this.frm.doc.transaction_date,\n\t\t\t\t\tgrand_total: this.frm.doc.rounded_total || this.frm.doc.grand_total\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message && !r.exc) {\n\t\t\t\t\t\tfor (var d in r.message) {\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, d, r.message[d]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n});\n\nerpnext.show_serial_batch_selector = function(frm, d, callback, on_close, show_dialog) {\n\tfrappe.require(\"assets/erpnext/js/utils/serial_no_batch_selector.js\", function() {\n\t\tnew erpnext.SerialNoBatchSelector({\n\t\t\tfrm: frm,\n\t\t\titem: d,\n\t\t\twarehouse_details: {\n\t\t\t\ttype: \"Warehouse\",\n\t\t\t\tname: d.warehouse\n\t\t\t},\n\t\t\tcallback: callback,\n\t\t\ton_close: on_close\n\t\t}, show_dialog);\n\t});\n}\n","erpnext.ItemSelector = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\n\t\tif (!this.item_field) {\n\t\t\tthis.item_field = 'item_code';\n\t\t}\n\n\t\tif (!this.item_query) {\n\t\t\tthis.item_query = erpnext.queries.item().query;\n\t\t}\n\n\t\tthis.grid = this.frm.get_field(\"items\").grid;\n\t\tthis.setup();\n\t},\n\n\tsetup: function() {\n\t\tvar me = this;\n\t\tif(!this.grid.add_items_button) {\n\t\t\tthis.grid.add_items_button = this.grid.add_custom_button(__('Add Items'), function() {\n\t\t\t\tif(!me.dialog) {\n\t\t\t\t\tme.make_dialog();\n\t\t\t\t}\n\t\t\t\tme.dialog.show();\n\t\t\t\tme.render_items();\n\t\t\t\tsetTimeout(function() { me.dialog.input.focus(); }, 1000);\n\t\t\t});\n\t\t}\n\t},\n\n\tmake_dialog: function() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Add Items')\n\t\t});\n\t\tvar body = $(this.dialog.body);\n\t\tbody.html('<div><p><input type=\"text\" class=\"form-control\"></p>\\\n\t\t\t<br><div class=\"results\"></div></div>');\n\n\t\tthis.dialog.input = body.find('.form-control');\n\t\tthis.dialog.results = body.find('.results');\n\n\t\tvar me = this;\n\t\tthis.dialog.results.on('click', '.image-view-item', function() {\n\t\t\tme.add_item($(this).attr('data-name'));\n\t\t});\n\n\t\tthis.dialog.input.on('keyup', function() {\n\t\t\tif(me.timeout_id) {\n\t\t\t\tclearTimeout(me.timeout_id);\n\t\t\t}\n\t\t\tme.timeout_id = setTimeout(function() {\n\t\t\t\tme.render_items();\n\t\t\t\tme.timeout_id = undefined;\n\t\t\t}, 500);\n\t\t});\n\t},\n\n\tadd_item: function(item_code) {\n\t\t// add row or update qty\n\t\tvar added = false;\n\n\t\t// find row with item if exists\n\t\t$.each(this.frm.doc.items || [], (i, d) => {\n\t\t\tif(d[this.item_field]===item_code) {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, 'qty', d.qty + 1);\n\t\t\t\tfrappe.show_alert({message: __(\"Added {0} ({1})\", [item_code, d.qty]), indicator: 'green'});\n\t\t\t\tadded = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\tif(!added) {\n\t\t\tvar d = null;\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => { d = this.grid.add_new_row(); },\n\t\t\t\t() => frappe.model.set_value(d.doctype, d.name, this.item_field, item_code),\n\t\t\t\t() => frappe.timeout(0.1),\n\t\t\t\t() => {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, 'qty', 1);\n\t\t\t\t\tfrappe.show_alert({message: __(\"Added {0} ({1})\", [item_code, 1]), indicator: 'green'});\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\n\t},\n\n\trender_items: function() {\n\t\tlet args = {\n\t\t\tquery: this.item_query,\n\t\t\tfilters: {}\n\t\t};\n\t\targs.txt = this.dialog.input.val();\n\t\targs.as_dict = 1;\n\n\t\tif (this.get_filters) {\n\t\t\t$.extend(args.filters, this.get_filters() || {});\n\t\t}\n\n\t\tvar me = this;\n\t\tfrappe.link_search(\"Item\", args, function(r) {\n\t\t\t$.each(r.values, function(i, d) {\n\t\t\t\tif(!d.image) {\n\t\t\t\t\td.abbr = frappe.get_abbr(d.item_name);\n\t\t\t\t\td.color = frappe.get_palette(d.item_name);\n\t\t\t\t}\n\t\t\t});\n\t\t\tme.dialog.results.html(frappe.render_template('item_selector', {'data':r.values}));\n\t\t});\n\t}\n});","frappe.provide('frappe.help.help_links');\n\nfrappe.help.help_links['Form/Rename Tool'] = [\n\t{ label: 'Bulk Rename', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/data/bulk-rename' },\n]\n\n//Setup\n\nfrappe.help.help_links['List/User'] = [\n\t{ label: 'New User', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/users-and-permissions/adding-users' },\n\t{ label: 'Rename User', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/articles/rename-user' },\n]\n\nfrappe.help.help_links['permission-manager'] = [\n\t{ label: 'Role Permissions Manager', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/users-and-permissions/role-based-permissions' },\n\t{ label: 'Managing Perm Level in Permissions Manager', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/articles/managing-perm-level' },\n\t{ label: 'User Permissions', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/users-and-permissions/user-permissions' },\n\t{ label: 'Sharing', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/users-and-permissions/sharing' },\n\t{ label: 'Password', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/articles/change-password' },\n]\n\nfrappe.help.help_links['Form/System Settings'] = [\n\t{ label: 'Naming Series', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/settings/system-settings' },\n]\n\nfrappe.help.help_links['data-import-tool'] = [\n\t{ label: 'Importing and Exporting Data', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/data/data-import-tool' },\n\t{ label: 'Overwriting Data from Data Import Tool', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/articles/overwriting-data-from-data-import-tool' },\n]\n\nfrappe.help.help_links['module_setup'] = [\n\t{ label: 'Role Permissions Manager', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/users-and-permissions/role-based-permissions' },\n]\n\nfrappe.help.help_links['Form/Naming Series'] = [\n\t{ label: 'Naming Series', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/settings/naming-series' },\n\t{ label: 'Setting the Current Value for Naming Series', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/articles/naming-series-current-value' },\n]\n\nfrappe.help.help_links['Form/Global Defaults'] = [\n\t{ label: 'Global Settings', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/settings/global-defaults' },\n]\n\nfrappe.help.help_links['Form/Email Digest'] = [\n\t{ label: 'Email Digest', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/email/email-digest' },\n]\n\nfrappe.help.help_links['List/Print Heading'] = [\n\t{ label: 'Print Heading', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/print/print-headings' },\n]\n\nfrappe.help.help_links['List/Letter Head'] = [\n\t{ label: 'Letter Head', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/print/letter-head' },\n]\n\nfrappe.help.help_links['List/Address Template'] = [\n\t{ label: 'Address Template', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/print/address-template' },\n]\n\nfrappe.help.help_links['List/Terms and Conditions'] = [\n\t{ label: 'Terms and Conditions', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/print/terms-and-conditions' },\n]\n\nfrappe.help.help_links['List/Cheque Print Template'] = [\n\t{ label: 'Cheque Print Template', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/print/cheque-print-template' },\n]\n\nfrappe.help.help_links['List/Email Account'] = [\n\t{ label: 'Email Account', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/email/email-account' },\n]\n\nfrappe.help.help_links['List/Email Alert'] = [\n\t{ label: 'Email Alert', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/email/email-alerts' },\n]\n\nfrappe.help.help_links['Form/Email Alert'] = [\n\t{ label: 'Email Alert', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/email/email-alerts' },\n]\n\nfrappe.help.help_links['List/Email Digest'] = [\n\t{ label: 'Email Digest', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/email/email-digest' },\n]\n\nfrappe.help.help_links['List/Auto Email Report'] = [\n\t{ label: 'Auto Email Reports', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/email/email-reports' },\n]\n\nfrappe.help.help_links['Form/Print Settings'] = [\n\t{ label: 'Print Settings', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/print/print-settings' },\n]\n\nfrappe.help.help_links['print-format-builder'] = [\n\t{ label: 'Print Format Builder', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/print/print-settings' },\n]\n\nfrappe.help.help_links['List/Print Heading'] = [\n\t{ label: 'Print Heading', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/print/print-headings' },\n]\n\n//setup-integrations\n\nfrappe.help.help_links['Form/PayPal Settings'] = [\n\t{ label: 'PayPal Settings', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/integrations/paypal-integration' },\n]\n\nfrappe.help.help_links['Form/Razorpay Settings'] = [\n\t{ label: 'Razorpay Settings', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/integrations/razorpay-integration' },\n]\n\nfrappe.help.help_links['Form/Dropbox Settings'] = [\n\t{ label: 'Dropbox Settings', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/integrations/dropbox-backup' },\n]\n\nfrappe.help.help_links['Form/LDAP Settings'] = [\n\t{ label: 'LDAP Settings', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/integrations/ldap-integration' },\n]\n\nfrappe.help.help_links['Form/Stripe Settings'] = [\n\t{ label: 'Stripe Settings', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/integrations/stripe-integration' },\n]\n\n//Sales\n\nfrappe.help.help_links['Form/Quotation'] = [\n\t{ label: 'Quotation', url: 'https://frappe.github.io/erpnext/user/manual/en/selling/quotation' },\n\t{ label: 'Applying Discount', url: 'https://frappe.github.io/erpnext/user/manual/en/selling/articles/applying-discount' },\n\t{ label: 'Sales Person', url: 'https://frappe.github.io/erpnext/user/manual/en/selling/articles/sales-persons-in-the-sales-transactions' },\n\t{ label: 'Applying Margin', url: 'https://frappe.github.io/erpnext/user/manual/en/selling/articles/adding-margin' },\n]\n\nfrappe.help.help_links['List/Customer'] = [\n\t{ label: 'Customer', url: 'https://frappe.github.io/erpnext/user/manual/en/CRM/customer' },\n\t{ label: 'Credit Limit', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/credit-limit' },\n]\n\nfrappe.help.help_links['Form/Customer'] = [\n\t{ label: 'Customer', url: 'https://frappe.github.io/erpnext/user/manual/en/CRM/customer' },\n\t{ label: 'Credit Limit', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/credit-limit' },\n]\n\nfrappe.help.help_links['List/Sales Taxes and Charges Template'] = [\n\t{ label: 'Setting Up Taxes', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/setting-up-taxes' },\n]\n\nfrappe.help.help_links['Form/Sales Taxes and Charges Template'] = [\n\t{ label: 'Setting Up Taxes', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/setting-up-taxes' },\n]\n\nfrappe.help.help_links['List/Sales Order'] = [\n\t{ label: 'Sales Order', url: 'https://frappe.github.io/erpnext/user/manual/en/selling/sales-order' },\n\t{ label: 'Recurring Sales Order', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/recurring-orders-and-invoices' },\n\t{ label: 'Applying Discount', url: 'https://frappe.github.io/erpnext/user/manual/en/selling/articles/applying-discount' },\n]\n\nfrappe.help.help_links['Form/Sales Order'] = [\n\t{ label: 'Sales Order', url: 'https://frappe.github.io/erpnext/user/manual/en/selling/sales-order' },\n\t{ label: 'Recurring Sales Order', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/recurring-orders-and-invoices' },\n\t{ label: 'Applying Discount', url: 'https://frappe.github.io/erpnext/user/manual/en/selling/articles/applying-discount' },\n\t{ label: 'Drop Shipping', url: 'https://frappe.github.io/erpnext/user/manual/en/selling/articles/drop-shipping' },\n\t{ label: 'Sales Person', url: 'https://frappe.github.io/erpnext/user/manual/en/selling/articles/sales-persons-in-the-sales-transactions' },\n\t{ label: 'Close Sales Order', url: 'https://frappe.github.io/erpnext/user/manual/en/selling/articles/close-sales-order' },\n\t{ label: 'Applying Margin', url: 'https://frappe.github.io/erpnext/user/manual/en/selling/articles/adding-margin' },\n]\n\nfrappe.help.help_links['Form/Product Bundle'] = [\n\t{ label: 'Product Bundle', url: 'https://frappe.github.io/erpnext/user/manual/en/selling/setup/product-bundle' },\n]\n\nfrappe.help.help_links['Form/Selling Settings'] = [\n\t{ label: 'Selling Settings', url: 'https://frappe.github.io/erpnext/user/manual/en/selling/setup/selling-settings' },\n]\n\n//Buying\n\nfrappe.help.help_links['List/Supplier'] = [\n\t{ label: 'Supplier', url: 'https://frappe.github.io/erpnext/user/manual/en/buying/supplier' },\n]\n\nfrappe.help.help_links['Form/Supplier'] = [\n\t{ label: 'Supplier', url: 'https://frappe.github.io/erpnext/user/manual/en/buying/supplier' },\n]\n\nfrappe.help.help_links['Form/Request for Quotation'] = [\n\t{ label: 'Request for Quotation', url: 'https://frappe.github.io/erpnext/user/manual/en/buying/request-for-quotation' },\n\t{ label: 'RFQ Video', url: 'https://frappe.github.io/erpnext/user/videos/learn/request-for-quotation.html' },\n]\n\nfrappe.help.help_links['Form/Supplier Quotation'] = [\n\t{ label: 'Supplier Quotation', url: 'https://frappe.github.io/erpnext/user/manual/en/buying/supplier-quotation' },\n]\n\nfrappe.help.help_links['Form/Buying Settings'] = [\n\t{ label: 'Buying Settings', url: 'https://frappe.github.io/erpnext/user/manual/en/buying/setup/buying-settings' },\n]\n\nfrappe.help.help_links['List/Purchase Order'] = [\n\t{ label: 'Purchase Order', url: 'https://frappe.github.io/erpnext/user/manual/en/buying/purchase-order' },\n\t{ label: 'Recurring Purchase Order', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/recurring-orders-and-invoices' },\n]\n\nfrappe.help.help_links['Form/Purchase Order'] = [\n\t{ label: 'Purchase Order', url: 'https://frappe.github.io/erpnext/user/manual/en/buying/purchase-order' },\n\t{ label: 'Item UoM', url: 'https://frappe.github.io/erpnext/user/manual/en/buying/articles/purchasing-in-different-unit' },\n\t{ label: 'Supplier Item Code', url: 'https://frappe.github.io/erpnext/user/manual/en/buying/articles/maintaining-suppliers-part-no-in-item' },\n\t{ label: 'Recurring Purchase Order', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/recurring-orders-and-invoices' },\n\t{ label: 'Subcontracting', url: 'https://frappe.github.io/erpnext/user/manual/en/manufacturing/subcontracting' },\n]\n\nfrappe.help.help_links['List/Purchase Taxes and Charges Template'] = [\n\t{ label: 'Setting Up Taxes', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/setting-up-taxes' },\n]\n\nfrappe.help.help_links['List/POS Profile'] = [\n\t{ label: 'POS Profile', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/pos-setting' },\n]\n\nfrappe.help.help_links['List/Price List'] = [\n\t{ label: 'Price List', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/price-lists' },\n]\n\nfrappe.help.help_links['List/Authorization Rule'] = [\n\t{ label: 'Authorization Rule', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/authorization-rule' },\n]\n\nfrappe.help.help_links['Form/SMS Settings'] = [\n\t{ label: 'SMS Settings', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/sms-setting' },\n]\n\nfrappe.help.help_links['List/Stock Reconciliation'] = [\n\t{ label: 'Stock Reconciliation', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/stock-reconciliation-for-non-serialized-item' },\n]\n\nfrappe.help.help_links['Tree/Territory'] = [\n\t{ label: 'Territory', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/territory' },\n]\n\nfrappe.help.help_links['Form/Dropbox Backup'] = [\n\t{ label: 'Dropbox Backup', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/third-party-backups' },\n\t{ label: 'Setting Up Dropbox Backup', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/articles/setting-up-dropbox-backups' },\n]\n\nfrappe.help.help_links['List/Workflow'] = [\n\t{ label: 'Workflow', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/workflows' },\n]\n\nfrappe.help.help_links['List/Company'] = [\n\t{ label: 'Company', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/company-setup' },\n\t{ label: 'Managing Multiple Companies', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/articles/managing-multiple-companies' },\n\t{ label: 'Delete All Related Transactions for a Company', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/articles/delete-a-company-and-all-related-transactions' },\n]\n\n//Accounts\n\nfrappe.help.help_links['modules/Accounts'] = [\n\t{ label: 'Introduction to Accounts', url: 'http://frappe.github.io/erpnext/user/manual/en/accounts/' },\n\t{ label: 'Chart of Accounts', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/chart-of-accounts.html' },\n\t{ label: 'Multi Currency Accounting', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/multi-currency-accounting' },\n]\n\nfrappe.help.help_links['Tree/Account'] = [\n\t{ label: 'Chart of Accounts', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/chart-of-accounts' },\n\t{ label: 'Managing Tree Mastes', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/articles/managing-tree-structure-masters' },\n]\n\nfrappe.help.help_links['Form/Sales Invoice'] = [\n\t{ label: 'Sales Invoice', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/sales-invoice' },\n\t{ label: 'Accounts Opening Balance', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/opening-accounts' },\n\t{ label: 'Sales Return', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/sales-return' },\n\t{ label: 'Recurring Sales Invoice', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/recurring-orders-and-invoices' },\n]\n\nfrappe.help.help_links['List/Sales Invoice'] = [\n\t{ label: 'Sales Invoice', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/sales-invoice' },\n\t{ label: 'Accounts Opening Balance', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/opening-accounts' },\n\t{ label: 'Sales Return', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/sales-return' },\n\t{ label: 'Recurring Sales Invoice', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/recurring-orders-and-invoices' },\n]\n\nfrappe.help.help_links['pos'] = [\n\t{ label: 'Point of Sale Invoice', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/point-of-sale-pos-invoice' },\n]\n\nfrappe.help.help_links['List/POS Profile'] = [\n\t{ label: 'Point of Sale Profile', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/pos-setting' },\n]\n\nfrappe.help.help_links['List/Purchase Invoice'] = [\n\t{ label: 'Purchase Invoice', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/purchase-invoice' },\n\t{ label: 'Accounts Opening Balance', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/opening-accounts' },\n\t{ label: 'Recurring Purchase Invoice', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/recurring-orders-and-invoices' },\n]\n\nfrappe.help.help_links['List/Journal Entry'] = [\n\t{ label: 'Journal Entry', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/journal-entry' },\n\t{ label: 'Advance Payment Entry', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/advance-payment-entry' },\n\t{ label: 'Accounts Opening Balance', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/opening-accounts' },\n]\n\nfrappe.help.help_links['List/Payment Entry'] = [\n\t{ label: 'Payment Entry', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/payment-entry' },\n]\n\nfrappe.help.help_links['List/Payment Request'] = [\n\t{ label: 'Payment Request', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/payment-request' },\n]\n\nfrappe.help.help_links['List/Asset'] = [\n\t{ label: 'Managing Fixed Assets', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/managing-fixed-assets' },\n]\n\nfrappe.help.help_links['List/Asset Category'] = [\n\t{ label: 'Asset Category', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/managing-fixed-assets' },\n]\n\nfrappe.help.help_links['Tree/Cost Center'] = [\n\t{ label: 'Budgeting', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/budgeting' },\n]\n\nfrappe.help.help_links['List/Item'] = [\n\t{ label: 'Item', url: 'http://frappe.github.io/erpnext/user/manual/en/stock/item' },\n\t{ label: 'Item Price', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/item/item-price' },\t\n\t{ label: 'Barcode', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/articles/track-items-using-barcode' },\n\t{ label: 'Item Wise Taxation', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/item-wise-taxation' },\n\t{ label: 'Managing Fixed Assets', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/managing-fixed-assets' },\n\t{ label: 'Item Codification', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/item/item-codification' },\n\t{ label: 'Item Variants', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/item/item-variants' },\t\n\t{ label: 'Item Valuation', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/item/item-valuation-fifo-and-moving-average' },\t\t\t\t\n]\n\nfrappe.help.help_links['Form/Item'] = [\n\t{ label: 'Item', url: 'http://frappe.github.io/erpnext/user/manual/en/stock/item' },\n\t{ label: 'Item Price', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/item/item-price' },\t\n\t{ label: 'Barcode', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/articles/track-items-using-barcode' },\n\t{ label: 'Item Wise Taxation', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/item-wise-taxation' },\n\t{ label: 'Managing Fixed Assets', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/managing-fixed-assets' },\n\t{ label: 'Item Codification', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/item/item-codification' },\n\t{ label: 'Item Variants', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/item/item-variants' },\t\n\t{ label: 'Item Valuation', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/item/item-valuation-fifo-and-moving-average' },\t\t\t\t\n]\n\nfrappe.help.help_links['List/Purchase Receipt'] = [\n\t{ label: 'Purchase Receipt', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/purchase-receipt' },\n\t{ label: 'Barcode', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/articles/track-items-using-barcode' },\n]\n\nfrappe.help.help_links['List/Delivery Note'] = [\n\t{ label: 'Delivery Note', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/delivery-note' },\n\t{ label: 'Barcode', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/articles/track-items-using-barcode' },\n\t{ label: 'Sales Return', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/sales-return' },\n]\n\nfrappe.help.help_links['Form/Delivery Note'] = [\n\t{ label: 'Delivery Note', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/delivery-note' },\n\t{ label: 'Sales Return', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/sales-return' },\n\t{ label: 'Barcode', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/articles/track-items-using-barcode' },\n\t{ label: 'Subcontracting', url: 'https://frappe.github.io/erpnext/user/manual/en/manufacturing/subcontracting' },\n]\n\nfrappe.help.help_links['List/Installation Note'] = [\n\t{ label: 'Installation Note', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/installation-note' },\n]\n\n\nfrappe.help.help_links['Tree'] = [\n\t{ label: 'Managing Tree Structure Masters', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/articles/managing-tree-structure-masters' },\n]\n\nfrappe.help.help_links['List/Budget'] = [\n\t{ label: 'Budgeting', url: 'https://frappe.github.io/erpnext/user/manual/en/accounts/budgeting' },\n]\n\n//Stock\n\nfrappe.help.help_links['List/Material Request'] = [\n\t{ label: 'Material Request', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/material-request' },\n\t{ label: 'Auto-creation of Material Request', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/articles/auto-creation-of-material-request' },\n]\n\nfrappe.help.help_links['Form/Material Request'] = [\n\t{ label: 'Material Request', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/material-request' },\n\t{ label: 'Auto-creation of Material Request', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/articles/auto-creation-of-material-request' },\n]\n\nfrappe.help.help_links['Form/Stock Entry'] = [\n\t{ label: 'Stock Entry', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/stock-entry' },\n\t{ label: 'Stock Entry Types', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/articles/stock-entry-purpose' },\n\t{ label: 'Repack Entry', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/articles/repack-entry' },\n\t{ label: 'Opening Stock', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/opening-stock' },\n\t{ label: 'Subcontracting', url: 'https://frappe.github.io/erpnext/user/manual/en/manufacturing/subcontracting' },\n]\n\nfrappe.help.help_links['List/Stock Entry'] = [\n\t{ label: 'Stock Entry', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/stock-entry' },\n]\n\nfrappe.help.help_links['Tree/Warehouse'] = [\n\t{ label: 'Warehouse', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/warehouse' },\n]\n\nfrappe.help.help_links['List/Serial No'] = [\n\t{ label: 'Serial No', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/serial-no' },\n]\n\nfrappe.help.help_links['Form/Serial No'] = [\n\t{ label: 'Serial No', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/serial-no' },\n]\n\nfrappe.help.help_links['Form/Batch'] = [\n\t{ label: 'Batch', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/batch' },\n]\n\nfrappe.help.help_links['Form/Packing Slip'] = [\n\t{ label: 'Packing Slip', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/tools/packing-slip' },\n]\n\nfrappe.help.help_links['Form/Quality Inspection'] = [\n\t{ label: 'Quality Inspection', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/tools/quality-inspection' },\n]\n\nfrappe.help.help_links['Form/Landed Cost Voucher'] = [\n\t{ label: 'Landed Cost Voucher', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/tools/landed-cost-voucher' },\n]\n\nfrappe.help.help_links['Tree/Item Group'] = [\n\t{ label: 'Item Group', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/setup/item-group' },\n]\n\nfrappe.help.help_links['Form/Item Attribute'] = [\n\t{ label: 'Item Attribute', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/setup/item-attribute' },\n]\n\nfrappe.help.help_links['Form/UOM'] = [\n\t{ label: 'Fractions in UOM', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/articles/managing-fractions-in-uom' },\n]\n\nfrappe.help.help_links['Form/Stock Reconciliation'] = [\n\t{ label: 'Opening Stock Entry', url: 'https://frappe.github.io/erpnext/user/manual/en/stock/opening-stock' },\n]\n\n//CRM\n\nfrappe.help.help_links['Form/Lead'] = [\n\t{ label: 'Lead', url: 'https://frappe.github.io/erpnext/user/manual/en/CRM/lead' },\n]\n\nfrappe.help.help_links['Form/Opportunity'] = [\n\t{ label: 'Opportunity', url: 'https://frappe.github.io/erpnext/user/manual/en/CRM/opportunity' },\n]\n\nfrappe.help.help_links['Form/Address'] = [\n\t{ label: 'Address', url: 'https://frappe.github.io/erpnext/user/manual/en/CRM/contact' },\n]\n\nfrappe.help.help_links['Form/Contact'] = [\n\t{ label: 'Contact', url: 'https://frappe.github.io/erpnext/user/manual/en/CRM/contact' },\n]\n\nfrappe.help.help_links['Form/Newsletter'] = [\n\t{ label: 'Newsletter', url: 'https://frappe.github.io/erpnext/user/manual/en/CRM/newsletter' },\n]\n\nfrappe.help.help_links['Form/Campaign'] = [\n\t{ label: 'Campaign', url: 'https://frappe.github.io/erpnext/user/manual/en/CRM/setup/campaign' },\n]\n\nfrappe.help.help_links['Tree/Sales Person'] = [\n\t{ label: 'Sales Person', url: 'https://frappe.github.io/erpnext/user/manual/en/CRM/setup/sales-person' },\n]\n\nfrappe.help.help_links['Form/Sales Person'] = [\n\t{ label: 'Sales Person Target', url: 'https://frappe.github.io/erpnext/user/manual/en/selling/setup/sales-person-target-allocation' },\n]\n\n//Support\n\nfrappe.help.help_links['List/Feedback Trigger'] = [\n\t{ label: 'Feedback Trigger', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/feedback/setting-up-feedback' },\n]\n\nfrappe.help.help_links['List/Feedback Request'] = [\n\t{ label: 'Feedback Request', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/feedback/submit-feedback' },\n]\n\nfrappe.help.help_links['List/Feedback Request'] = [\n\t{ label: 'Feedback Request', url: 'https://frappe.github.io/erpnext/user/manual/en/setting-up/feedback/submit-feedback' },\n]\n\n//Manufacturing\n\nfrappe.help.help_links['Form/BOM'] = [\n\t{ label: 'Bill of Material', url: 'https://frappe.github.io/erpnext/user/manual/en/manufacturing/bill-of-materials' },\n\t{ label: 'Nested BOM Structure', url: 'https://frappe.github.io/erpnext/user/manual/en/manufacturing/articles/nested-bom-structure' },\n]\n\nfrappe.help.help_links['Form/Work Order'] = [\n\t{ label: 'Work Order', url: 'https://frappe.github.io/erpnext/user/manual/en/manufacturing/work-order' },\n]\n\nfrappe.help.help_links['Form/Workstation'] = [\n\t{ label: 'Workstation', url: 'https://frappe.github.io/erpnext/user/manual/en/manufacturing/workstation' },\n]\n\nfrappe.help.help_links['Form/Operation'] = [\n\t{ label: 'Operation', url: 'https://frappe.github.io/erpnext/user/manual/en/manufacturing/operation' },\n]\n\nfrappe.help.help_links['Form/Production Planning Tool'] = [\n\t{ label: 'Production Planning Tool', url: 'https://frappe.github.io/erpnext/user/manual/en/manufacturing/tools/production-planning-tool' },\n]\n\nfrappe.help.help_links['Form/BOM Update Tool'] = [\n\t{ label: 'BOM Update Tool', url: 'https://frappe.github.io/erpnext/user/manual/en/manufacturing/tools/bom-update-tool' },\n]\n\n//Customize\n\nfrappe.help.help_links['Form/Customize Form'] = [\n\t{ label: 'Custom Field', url: 'https://frappe.github.io/erpnext/user/manual/en/customize-erpnext/custom-field' },\n\t{ label: 'Customize Field', url: 'https://frappe.github.io/erpnext/user/manual/en/customize-erpnext/customize-form' },\n]\n\nfrappe.help.help_links['Form/Custom Field'] = [\n\t{ label: 'Custom Field', url: 'https://frappe.github.io/erpnext/user/manual/en/customize-erpnext/custom-field' },\n]\n\nfrappe.help.help_links['Form/Custom Field'] = [\n\t{ label: 'Custom Field', url: 'https://frappe.github.io/erpnext/user/manual/en/customize-erpnext/custom-field' },\n]","frappe.provide('agriculture');\n\nagriculture.TernaryPlot = class TernaryPlot {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\n\t\tfrappe.require('assets/frappe/js/lib/snap.svg-min.js', () => {\n\t\t\tthis.make_svg();\n\t\t\tthis.init_snap();\n\t\t\tthis.init_config();\n\t\t\tthis.make_plot();\n\t\t\tthis.make_plot_marking();\n\t\t\tthis.make_legend();\n\t\t\tthis.mark_blip();\n\t\t});\n\t}\n\n\tmake_svg() {\n\t\tthis.$svg = $('<svg height=\"350\" width=\"400\">');\n\t\t$(this.parent).append(this.$svg);\n\t}\n\n\tinit_snap() {\n\t\tthis.paper = new Snap(this.$svg.get(0));\n\t}\n\n\tinit_config() {\n\t\tthis.config = {\n\t\t\ttriangle_side: 300,\n\t\t\tspacing: 50,\n\t\t\tstrokeWidth: 1,\n\t\t\tstroke: frappe.ui.color.get('black')\n\t\t};\n\t\tthis.config.scaling_factor = this.config.triangle_side / 100;\n\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\tthis.coords = {\n\t\t\tsand: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t * Snap.cos(60), s,\n\t\t\t\t\ts, s + t * Snap.cos(30),\n\t\t\t\t\ts + t, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('peach')\n\t\t\t},\n\t\t\tloamy_sand: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 15 * p * Snap.cos(60), s + (100 - 15) * p * Snap.cos(30),\n\t\t\t\t\ts + 10 * p * Snap.cos(60), s + (100 - 10) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 85) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 70) * p, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink')\n\t\t\t},\n\t\t\tsandy_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60), s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 15 * p * Snap.cos(60), s + (100 - 15) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 75) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60) - 10 * p, s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink', 'light')\n\t\t\t},\n\t\t\tloam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60) - 22.5 * p, s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60) - 10 * p, s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('brown')\n\t\t\t},\n\t\t\tsilt_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60), s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p + 12.5 * p * Snap.cos(60), s + 90 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 12.5 * p * Snap.cos(60), s + (100 - 12.5) * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green', 'dark')\n\t\t\t},\n\t\t\tsilt: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 12.5 * p * Snap.cos(60), s + (100 - 12.5) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p + 12.5 * p * Snap.cos(60), s + 90 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + t, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green')\n\t\t\t},\n\t\t\tsilty_clay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60), s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 20 * p, s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60), s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('cyan', 'dark')\n\t\t\t},\n\t\t\tsilty_clay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 60 * p * Snap.cos(60), s + 40 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60), s + 60 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('cyan')\n\t\t\t},\n\t\t\tclay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 45 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 45 * p, s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 20 * p, s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green', 'light')\n\t\t\t},\n\t\t\tsandy_clay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 35 * p * Snap.cos(60) + 20 * p, s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60), s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60), s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 45 * p, s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink', 'dark')\n\t\t\t},\n\t\t\tsandy_clay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 55 * p * Snap.cos(60), s + (100 - 55) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60), s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60) + 20 * p, s + (100 - 35) * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('red')\n\t\t\t},\n\t\t\tclay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t * Snap.cos(60), s,\n\t\t\t\t\ts + 55 * p * Snap.cos(60), s + (100 - 55) * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 45 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 60 * p * Snap.cos(60), s + 40 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('yellow')\n\t\t\t},\n\t\t};\n\t}\n\n\tget_coords(soil_type) {\n\t\treturn this.coords[soil_type].points;\n\t}\n\n\tget_color(soil_type) {\n\t\treturn this.coords[soil_type].color;\n\t}\n\n\tmake_plot() {\n\t\tfor (let soil_type in this.coords) {\n\t\t\tthis.paper.polygon(this.get_coords(soil_type)).attr({\n\t\t\t\tfill: this.get_color(soil_type),\n\t\t\t\tstroke: this.config.stroke,\n\t\t\t\tstrokeWidth: this.config.strokeWidth\n\t\t\t});\n\t\t}\n\t}\n\n\tmake_plot_marking() {\n\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\tlet clay = this.paper.text(t * Snap.cos(60) / 2, s + t * Snap.cos(30) / 2, __(\"Clay\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tclay.transform(\"r300\");\n\n\t\tlet silt = this.paper.text(t, s + t * Snap.cos(30) / 2, __(\"Silt\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tsilt.transform(\"r60\");\n\n\t\tlet sand = this.paper.text(35 + t * Snap.cos(60), 90 + t * Snap.cos(30), __(\"Sand\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tsand.transform(\"r0\");\n\t}\n\n\tmake_legend() {\n\t\t// let side = len(this.coords)/2;\n\t\tlet index = 1;\n\t\tlet offset = 0;\n\t\tlet exec_once = true;\n\t\tfor (let soil_type in this.coords) {\n\t\t\tif (index > 6 && exec_once){\n\t\t\t\toffset = 300;\n\t\t\t\tindex = 1;\n\t\t\t\texec_once = false;\n\t\t\t}\n\t\t\tlet rect = this.paper.rect(0+offset, 0+index*20, 100, 19, 5, 5).attr({\n\t\t\t\tfill: this.get_color(soil_type),\n\t\t\t\tstroke: frappe.ui.color.get('black')\n\t\t\t});\n\t\t\tlet text = this.paper.text(5+offset, 16+index*20, soil_type).attr({\n\t\t\t\tfill: frappe.ui.color.get('black'),\n\t\t\t\t'font-size': 12\n\t\t\t});\n\t\t\tindex++;\n\t\t}\n\t}\n\n\tmark_blip({clay, sand, silt} = this) {\n\t\tif (clay + sand + silt != 0){\n\t\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\t\tlet x_blip = s + clay * p * Snap.cos(60) + silt * p;\n\t\t\tlet y_blip = s + silt * p * Snap.cos(30) + sand * p * Snap.sin(60);\n\t\t\tthis.blip = this.paper.circle(x_blip, y_blip, 4).attr({\n\t\t\t\tfill: frappe.ui.color.get(\"orange\"),\n\t\t\t\tstroke: frappe.ui.color.get(\"orange\"),\n\t\t\t\tstrokeWidth: 2\n\t\t\t});\n\t\t}\n\t}\n\n\tremove_blip() {\n\t\tif (typeof this.blip !== 'undefined')\n\t\t\tthis.blip.remove();\n\t}\n};\n","frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.ItemQuickEntryForm = frappe.ui.form.QuickEntryForm.extend({\n\tinit: function(doctype, after_insert) {\n\t\tthis._super(doctype, after_insert);\n\t},\n\n\trender_dialog: function() {\n\t\tthis.mandatory = this.get_variant_fields().concat(this.mandatory);\n\t\tthis.mandatory = this.mandatory.concat(this.get_attributes_fields());\n\t\tthis._super();\n\t\tthis.init_post_render_dialog_operations();\n\t\tthis.preset_fields_for_template();\n\t\tthis.dialog.$wrapper.find('.edit-full').text(__('Edit in full page for more options like assets, serial nos, batches etc.'))\n\t},\n\n\tinit_post_render_dialog_operations: function() {\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.append(frappe.render_template(\"item_quick_entry\"));\n\t\tthis.init_for_create_variant_trigger();\n\t\tthis.init_for_item_template_trigger();\n\t\t// explicitly hide manufacturing fields as hidden not working.\n\t\tthis.toggle_manufacturer_fields();\n\t\tthis.dialog.get_field(\"item_template\").df.hidden = 1;\n\t\tthis.dialog.get_field(\"item_template\").refresh();\n\t},\n\n\tregister_primary_action: function() {\n\t\tvar me = this;\n\t\tthis.dialog.set_primary_action(__('Save'), function() {\n\t\t\tif (me.dialog.working) return;\n\n\t\t\tvar data = me.dialog.get_values();\n\t\t\tvar variant_values = {};\n\n\t\t\tif (me.dialog.fields_dict.create_variant.$input.prop(\"checked\")) {\n\t\t\t\tvariant_values = me.get_variant_doc();\n\t\t\t\tif (!Object.keys(variant_values).length) {\n\t\t\t\t\tdata = null;\n\t\t\t\t}\n\t\t\t\tvariant_values.stock_uom = me.template_doc.stock_uom;\n\t\t\t\tvariant_values.item_group = me.template_doc.item_group;\n\t\t\t}\n\n\t\t\tif (data) {\n\t\t\t\tme.dialog.working = true;\n\t\t\t\tvar values = me.update_doc();\n\t\t\t\t//patch for manufacturer type variants as extend is overwriting it.\n\t\t\t\tif (variant_values['variant_based_on'] == \"Manufacturer\") {\n\t\t\t\t\tvalues['variant_based_on'] = \"Manufacturer\";\n\t\t\t\t}\n\t\t\t\t$.extend(variant_values, values);\n\t\t\t\tme.insert(variant_values);\n\t\t\t}\n\t\t});\n\t},\n\n\tinsert: function(variant_values) {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.insert\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: variant_values\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t// delete the old doc\n\t\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (me.after_insert) {\n\t\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.open_from_if_not_list();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function() {\n\t\t\t\t\tme.open_doc();\n\t\t\t\t},\n\t\t\t\talways: function() {\n\t\t\t\t\tme.dialog.working = false;\n\t\t\t\t\tresolve(me.dialog.doc);\n\t\t\t\t},\n\t\t\t\tfreeze: true\n\t\t\t});\n\t\t});\n\t},\n\n\topen_doc: function() {\n\t\tthis.dialog.hide();\n\t\tthis.update_doc();\n\t\tif (this.dialog.fields_dict.create_variant.$input.prop(\"checked\")) {\n\t\t\tvar template = this.dialog.fields_dict.item_template.input.value;\n\t\t\tif (template)\n\t\t\t\tfrappe.set_route(\"Form\", this.doctype, template);\n\t\t} else {\n\t\t\tfrappe.set_route('Form', this.doctype, this.doc.name);\n\t\t}\n\t},\n\n\tget_variant_fields: function() {\n\t\tvar variant_fields = [{\n\t\t\tfieldname: \"create_variant\",\n\t\t\tfieldtype: \"Check\",\n\t\t\tlabel: __(\"Create Variant\")\n\t\t},\n\t\t{\n\t\t\tfieldname: 'item_template',\n\t\t\tlabel: __('Item Template'),\n\t\t\treqd: 0,\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: \"Item\",\n\t\t\tget_query: function() {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"has_variants\": 1\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}];\n\n\t\treturn variant_fields;\n\t},\n\n\tget_manufacturing_fields: function() {\n\t\tthis.manufacturer_fields = [{\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: 'Manufacturer',\n\t\t\tlabel: 'Manufacturer',\n\t\t\tfieldname: \"manufacturer\",\n\t\t\thidden: 1,\n\t\t\treqd: 0\n\t\t}, {\n\t\t\tfieldtype: 'Data',\n\t\t\tlabel: 'Manufacturer Part Number',\n\t\t\tfieldname: 'manufacturer_part_no',\n\t\t\thidden: 1,\n\t\t\treqd: 0\n\t\t}];\n\t\treturn this.manufacturer_fields;\n\t},\n\n\tget_attributes_fields: function() {\n\t\tvar attribute_fields = [{\n\t\t\tfieldname: 'attribute_html',\n\t\t\tfieldtype: 'HTML'\n\t\t}]\n\n\t\tattribute_fields = attribute_fields.concat(this.get_manufacturing_fields());\n\t\treturn attribute_fields;\n\t},\n\n\tinit_for_create_variant_trigger: function() {\n\t\tvar me = this;\n\n\t\tthis.dialog.fields_dict.create_variant.$input.on(\"click\", function() {\n\t\t\tme.preset_fields_for_template();\n\t\t\tme.init_post_template_trigger_operations(false, [], true);\n\t\t});\n\t},\n\n\tpreset_fields_for_template: function() {\n\t\tvar for_variant = this.dialog.get_value('create_variant');\n\n\t\t// setup template field, seen and mandatory if variant\n\t\tlet template_field = this.dialog.get_field(\"item_template\");\n\t\ttemplate_field.df.reqd = for_variant;\n\t\ttemplate_field.set_value('');\n\t\ttemplate_field.df.hidden = !for_variant;\n\t\ttemplate_field.refresh();\n\n\t\t// hide properties for variant\n\t\t['item_code', 'item_name', 'item_group', 'stock_uom'].forEach((d) => {\n\t\t\tlet f = this.dialog.get_field(d);\n\t\t\tf.df.hidden = for_variant;\n\t\t\tf.refresh();\n\t\t});\n\n\t\tthis.dialog.get_field('attribute_html').toggle(false);\n\n\t\t// non mandatory for variants\n\t\t['item_code', 'stock_uom', 'item_group'].forEach((d) => {\n\t\t\tlet f = this.dialog.get_field(d);\n\t\t\tf.df.reqd = !for_variant;\n\t\t\tf.refresh();\n\t\t});\n\n\t},\n\n\tinit_for_item_template_trigger: function() {\n\t\tvar me = this;\n\n\t\tme.dialog.fields_dict[\"item_template\"].df.onchange = () => {\n\t\t\tvar template = me.dialog.fields_dict.item_template.input.value;\n\t\t\tme.template_doc = null;\n\t\t\tif (template) {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.client.get\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: \"Item\",\n\t\t\t\t\t\tname: template\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tme.template_doc = r.message;\n\t\t\t\t\t\tme.is_manufacturer = false;\n\n\t\t\t\t\t\tif (me.template_doc.variant_based_on === \"Manufacturer\") {\n\t\t\t\t\t\t\tme.init_post_template_trigger_operations(true, [], true);\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tme.init_post_template_trigger_operations(false, me.template_doc.attributes, false);\n\t\t\t\t\t\t\tme.render_attributes(me.template_doc.attributes);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tme.dialog.get_field('attribute_html').toggle(false);\n\t\t\t\tme.init_post_template_trigger_operations(false, [], true);\n\t\t\t}\n\t\t}\n\t},\n\n\tinit_post_template_trigger_operations: function(is_manufacturer, attributes, attributes_flag) {\n\t\tthis.attributes = attributes;\n\t\tthis.attribute_values = {};\n\t\tthis.attributes_count = attributes.length;\n\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").empty();\n\t\tthis.is_manufacturer = is_manufacturer;\n\t\tthis.toggle_manufacturer_fields();\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").toggleClass(\"hide-control\", attributes_flag);\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes-header\").toggleClass(\"hide-control\", attributes_flag);\n\t},\n\n\ttoggle_manufacturer_fields: function() {\n\t\tvar me = this;\n\t\t$.each(this.manufacturer_fields, function(i, dialog_field) {\n\t\t\tme.dialog.get_field(dialog_field.fieldname).df.hidden = !me.is_manufacturer;\n\t\t\tme.dialog.get_field(dialog_field.fieldname).df.reqd = dialog_field.fieldname == 'manufacturer' ? me.is_manufacturer : false;\n\t\t\tme.dialog.get_field(dialog_field.fieldname).refresh();\n\t\t});\n\t},\n\n\tinitiate_render_attributes: function() {\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").empty();\n\t\tthis.render_attributes(this.attributes);\n\t},\n\n\trender_attributes: function(attributes) {\n\t\tvar me = this;\n\n\t\tthis.dialog.get_field('attribute_html').toggle(true);\n\n\t\t$.each(attributes, function(index, row) {\n\t\t\tvar desc = \"\";\n\t\t\tvar fieldtype = \"Data\";\n\t\t\tif (row.numeric_values) {\n\t\t\t\tfieldtype = \"Float\";\n\t\t\t\tdesc = \"Min Value: \" + row.from_range + \" , Max Value: \" + row.to_range + \", in Increments of: \" + row.increment;\n\t\t\t}\n\n\t\t\tme.init_make_control(fieldtype, row);\n\t\t\tme[row.attribute].set_value(me.attribute_values[row.attribute] || \"\");\n\t\t\tme[row.attribute].$wrapper.toggleClass(\"has-error\", me.attribute_values[row.attribute] ? false : true);\n\n\t\t\t// Set Label explicitly as make_control is not displaying label\n\t\t\t$(me[row.attribute].label_area).text(__(row.attribute));\n\n\t\t\tif (desc) {\n\t\t\t\t$(repl(`<p class=\"help-box small text-muted hidden-xs\">%(desc)s</p>`, {\n\t\t\t\t\t\"desc\": desc\n\t\t\t\t})).insertAfter(me[row.attribute].input_area);\n\t\t\t}\n\n\t\t\tif (!row.numeric_values) {\n\t\t\t\tme.init_awesomplete_for_attribute(row);\n\t\t\t} else {\n\t\t\t\tme[row.attribute].$input.on(\"change\", function() {\n\t\t\t\t\tme.attribute_values[row.attribute] = $(this).val();\n\t\t\t\t\t$(this).closest(\".frappe-control\").toggleClass(\"has-error\", $(this).val() ? false : true);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tinit_make_control: function(fieldtype, row) {\n\t\tthis[row.attribute] = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\t\"fieldtype\": fieldtype,\n\t\t\t\t\"label\": row.attribute,\n\t\t\t\t\"fieldname\": row.attribute,\n\t\t\t\t\"options\": row.options || \"\"\n\t\t\t},\n\t\t\tparent: $(this.dialog.fields_dict.attribute_html.wrapper).find(\".attributes\"),\n\t\t\tonly_input: false\n\t\t});\n\t\tthis[row.attribute].make_input();\n\t},\n\n\tinit_awesomplete_for_attribute: function(row) {\n\t\tvar me = this;\n\n\t\tthis[row.attribute].input.awesomplete = new Awesomplete(this[row.attribute].input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tautoFirst: true,\n\t\t\tlist: [],\n\t\t});\n\n\t\tthis[row.attribute].$input.on('input', function(e) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get_list\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Item Attribute Value\",\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t[\"parent\", \"=\", $(e.target).attr(\"data-fieldname\")],\n\t\t\t\t\t\t[\"attribute_value\", \"like\", e.target.value + \"%\"]\n\t\t\t\t\t],\n\t\t\t\t\tfields: [\"attribute_value\"],\n\t\t\t\t\tparent: \"Item\"\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\te.target.awesomplete.list = r.message.map(function(d) {\n\t\t\t\t\t\t\treturn d.attribute_value;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}).on('focus', function(e) {\n\t\t\t$(e.target).val('').trigger('input');\n\t\t}).on(\"awesomplete-close\", function (e) {\n\t\t\tme.attribute_values[$(e.target).attr(\"data-fieldname\")] = e.target.value;\n\t\t\t$(e.target).closest(\".frappe-control\").toggleClass(\"has-error\", e.target.value ? false : true);\n\t\t});\n\t},\n\n\tget_variant_doc: function() {\n\t\tvar me = this;\n\t\tvar variant_doc = {};\n\t\tvar attribute = this.validate_mandatory_attributes();\n\n\t\tif (Object.keys(attribute).length) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.item_variant.create_variant_doc_for_quick_entry\",\n\t\t\t\targs: {\n\t\t\t\t\t\"template\": me.dialog.fields_dict.item_template.$input.val(),\n\t\t\t\t\targs: attribute\n\t\t\t\t},\n\t\t\t\tasync: false,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (Object.prototype.toString.call(r.message) == \"[object Object]\") {\n\t\t\t\t\t\tvariant_doc = r.message;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar msgprint_dialog = frappe.msgprint(__(\"Item Variant {0} already exists with same attributes\", [repl('<a class=\"strong variant-click\" data-item-code=\"%(item)s\" \\\n\t\t\t\t\t\t\t\t>%(item)s</a>', {\n\t\t\t\t\t\t\t\titem: r.message\n\t\t\t\t\t\t\t})]));\n\n\t\t\t\t\t\tmsgprint_dialog.$wrapper.find(\".variant-click\").on(\"click\", function() {\n\t\t\t\t\t\t\tmsgprint_dialog.hide();\n\t\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\t\t\tfrappe._from_link.set_value($(this).attr(\"data-item-code\"));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.set_route('Form', \"Item\", $(this).attr(\"data-item-code\"));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\treturn variant_doc;\n\t},\n\n\tvalidate_mandatory_attributes: function() {\n\t\tvar me = this;\n\t\tvar attribute = {};\n\t\tvar mandatory = [];\n\n\t\t$.each(this.attributes, function(index, attr) {\n\t\t\tvar value = me.attribute_values[attr.attribute] || \"\";\n\t\t\tif (value) {\n\t\t\t\tattribute[attr.attribute] = attr.numeric_values ? flt(value) : value;\n\t\t\t} else {\n\t\t\t\tmandatory.push(attr.attribute);\n\t\t\t}\n\t\t})\n\n\t\tif (mandatory.length) {\n\t\t\tfrappe.msgprint({\n\t\t\t\ttitle: __('Missing Values Required'),\n\t\t\t\tmessage: __('Following fields have missing values:') + '<br><br><ul><li>' + mandatory.join('<li>') + '</ul>',\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\treturn {};\n\t\t}\n\n\t\tif (this.is_manufacturer) {\n\t\t\t$.each(this.manufacturer_fields, function(index, field) {\n\t\t\t\tattribute[field.fieldname] = me.dialog.fields_dict[field.fieldname].input.value;\n\t\t\t});\n\t\t}\n\t\treturn attribute;\n\t}\n});","frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.CustomerQuickEntryForm = frappe.ui.form.QuickEntryForm.extend({\n\tinit: function(doctype, after_insert) {\n\t\tthis._super(doctype, after_insert);\n\t},\n\n\trender_dialog: function() {\n\t\tthis.mandatory = this.mandatory.concat(this.get_variant_fields());\n\t\tthis._super();\n\t},\n\n\tget_variant_fields: function() {\n\t\tvar variant_fields = [{\n\t\t\tfieldtype: \"Section Break\",\n\t\t\tlabel: __(\"Primary Contact Details\"),\n\t\t\tcollapsible: 1\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Email Id\"),\n\t\t\tfieldname: \"email_id\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Column Break\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Mobile Number\"),\n\t\t\tfieldname: \"mobile_no\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Section Break\",\n\t\t\tlabel: __(\"Primary Address Details\"),\n\t\t\tcollapsible: 1\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Address Line 1\"),\n\t\t\tfieldname: \"address_line1\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Address Line 2\"),\n\t\t\tfieldname: \"address_line2\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"ZIP Code\"),\n\t\t\tfieldname: \"pincode\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Column Break\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"City\"),\n\t\t\tfieldname: \"city\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"State\"),\n\t\t\tfieldname: \"state\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Country\"),\n\t\t\tfieldname: \"country\",\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: \"Country\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Customer POS Id\"),\n\t\t\tfieldname: \"customer_pos_id\",\n\t\t\tfieldtype: \"Data\",\n\t\t\thidden: 1\n\t\t}];\n\n\t\treturn variant_fields;\n\t},\n})","frappe.provide('erpnext.hub.pages');\n\nfrappe.views.HubFactory = frappe.views.Factory.extend({\n\tmake(route) {\n\t\tconst page_name = frappe.get_route_str();\n\t\tconst page = route[1];\n\n\t\tconst assets = {\n\t\t\t'List': [\n\t\t\t\t'/assets/erpnext/js/hub/hub_listing.js',\n\t\t\t],\n\t\t\t'Form': [\n\t\t\t\t'/assets/erpnext/js/hub/hub_form.js'\n\t\t\t]\n\t\t};\n\t\tfrappe.model.with_doc('Hub Settings', 'Hub Settings', () => {\n\t\t\tthis.hub_settings = frappe.get_doc('Hub Settings');\n\n\t\t\tif (!erpnext.hub.pages[page_name]) {\n\t\t\t\tif(!frappe.is_online()) {\n\t\t\t\t\tthis.render_offline_card();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!route[2]) {\n\t\t\t\t\tfrappe.require(assets['List'], () => {\n\t\t\t\t\t\tif(page === 'Favourites') {\n\t\t\t\t\t\t\terpnext.hub.pages[page_name] = new erpnext.hub['Favourites']({\n\t\t\t\t\t\t\t\tparent: this.make_page(true, page_name),\n\t\t\t\t\t\t\t\thub_settings: this.hub_settings\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\terpnext.hub.pages[page_name] = new erpnext.hub[page+'Listing']({\n\t\t\t\t\t\t\t\tparent: this.make_page(true, page_name),\n\t\t\t\t\t\t\t\thub_settings: this.hub_settings\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.require(assets['Form'], () => {\n\t\t\t\t\t\terpnext.hub.pages[page_name] = new erpnext.hub[page+'Page']({\n\t\t\t\t\t\t\tunique_id: route[2],\n\t\t\t\t\t\t\tdoctype: route[2],\n\t\t\t\t\t\t\tparent: this.make_page(true, page_name),\n\t\t\t\t\t\t\thub_settings: this.hub_settings\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\twindow.hub_page = erpnext.hub.pages[page_name];\n\t\t\t} else {\n\t\t\t\tfrappe.container.change_to(page_name);\n\t\t\t\twindow.hub_page = erpnext.hub.pages[page_name];\n\t\t\t}\n\t\t});\n\t},\n\n\trender_offline_card() {\n\t\tlet html = `<div class='page-card' style='margin: 140px auto;'>\n\t\t\t<div class='page-card-head'>\n\t\t\t\t<span class='indicator red'>${'Failed to connect'}</span>\n\t\t\t</div>\n\t\t\t<p>${ __(\"Please check your network connection.\") }</p>\n\t\t\t<div><a href='#Hub/Item' class='btn btn-primary btn-sm'>\n\t\t\t\t${ __(\"Reload\") }</a></div>\n\t\t</div>`;\n\n\t\tlet page = $('#body_div');\n\t\tpage.append(html);\n\n\t\treturn;\n\t}\n});\n"],"names":["frappe","provide","$","document","bind","app","name","help_feedback_link","html","urllib","get_base_url","attr","$help_menu","__","insertBefore","extend","create_routes","Customer Group","Territory","Item Group","Sales Person","Account","Cost Center","breadcrumbs","preferred","Supplier Type","Sales Partner","Brand","erpnext","get_currency","company","cur_frm","doc","get_doc","default_currency","boot","sysdefaults","currency","get_presentation_currency_list","docs","filter","d","doctype","map","toggle_naming_series","fields_dict","naming_series","toggle_display","__islocal","hide_company","companies","Object","keys","locals","length","set_value","last_selected_company","is_perpetual_inventory_enabled","enable_perpetual_inventory","stale_rate_allowed","cint","allow_stale","setup_serial_no","grid_row","open_grid_row","grid_form","serial_no","get_status","appendTo","css","margin-bottom","margin-top","$wrapper","on","ui","Dialog","title","fields","fieldtype","fieldname","options","label","get_query","filters","item_code","warehouse","is_return","get_input","get_value","val","split","concat","join","set_model_value","trim","hide","show","utils","set_party_dashboard_indicators","frm","__onload","dashboard_info","info","dashboard","add_indicator","format_currency","billing_this_year","total_unpaid","get_party_name","party_type","Customer","Supplier","Employee","Member","copy_value_in_all_row","dt","dn","table_fieldname","cl","i","refresh_field","get_terms","tc_name","callback","call","method","args","template_name","r","make_subscription","docname","doclist","model","sync","message","set_route","first_row_is_empty","child_table","isArray","remove_empty_first_row","child_table_name","const","rows","this","splice","select_alternate_items","opts","warehouse_field","item_field","data","dialog","cannot_add_rows","in_place_edit","get_data","hidden","in_list_view","read_only","default","onchange","on_grid_fields_dict","actual_qty","e","query","primary_action","get_values","alternate_item","forEach","let","row","child_doctype","qty","script_manager","trigger","then","original_item_field","child_docname","primary_action_label","condition","alternative_items","df","push","grid","refresh","map_current_doc","get_query_filters","_map","items","items_doctype","meta","get_docfield","link_fieldname","get_meta","source_doctype","already_set","item_qty_map","each","source_name","src","flt","with_doc","source_doc","msgprint","type","source_names","target_doc","exc","dirty","form","MultiSelectDialog","target","date_field","undefined","setters","action","selections","values","link_formatters","value","item_name","employee_name","datetime","is_timezone_same","set_df_property","sys_defaults","time_zone","queries","user","lead","customer","supplier","item","bom","task","customer_filter","throw","get_label","contact_query","dynamic_link","link_doctype","link_name","address_query","company_address_query","is_your_company_address","supplier_filter","lead_filter","not_a_group_filter","is_group","employee","cstr","setup_queries","query_fn","set_query","parentfield","link_fields","get_docfields","setup_warehouse_query","cdt","cdn","SMSManager","me","setup","default_msg","Lead","Opportunity","Quotation","Sales Order","quotation_no","po_no","Delivery Note","Sales Invoice","Material Request","Purchase Order","Purchase Receipt","in_list","contact_person","mobile_no","contact_no","get_contact_number","contact","ref_doctype","ref_name","contact_name","number","show_dialog","mobile_nos","make_dialog","set_values","width","reqd","send","input","onclick","btn","v","set_working","receiver_list","msg","done_working","get_party_details","party","price_list","selling_price_list","bill_date","buying_price_list","posting_date","transaction_date","validate_mandatory","updating_party_details","run_serially","add_item","is_new","prev_route","get_prev_route","add_child","get_address_display","address_field","display_field","address_dict","set_taxes","billing_address","shipping_address","shipping_address_name","get_contact_details","trigger_on","get_shipping_address","address","stock","StockController","Controller","onload","setup_posting_date_time_check","docstatus","set_posting_time","nowdate","posting_time","now_time","show_stock_ledger","add_custom_button","route_options","voucher_no","from_date","to_date","show_general_ledger","group_by_voucher","payments","make_payment","$body","body","set_payment_primary_action","make_keyboard","select_text","find","click","select","set_primary_action","index","amount","submit_invoice","empty","render_template","show_payment_details","bind_keyboard_event","clear_amount","make_multimode_payment","change_amount","payment_val","outstanding_amount","mode_of_payment","multimode_payments","idx","paid_amount","selected_mode","repl","highlight_selected_row","bind_amount_change_event","set_outstanding_amount","conversion_rate","precision","update_payment_amount","bind_form_control_event","bind_numeric_keys_event","update_paid_amount","change","write_off_amount","selected_row","removeClass","addClass","text","slice","stopPropagation","base_write_off_amount","calculate_outstanding_amount","show_amounts","calculate_write_off_amount","update_write_off","update_invoice","taxes_and_totals","apply_pricing_rule_on_item","margin_type","rate_with_margin","price_list_rate","margin_rate_or_amount","base_rate_with_margin","rate","discount_percentage","discount_value","calculate_taxes_and_totals","discount_amount_applied","_calculate_taxes_and_totals","calculate_discount_amount","calculate_total_advance","calculate_commission","calculate_contribution","refresh_fields","set_discount_amount","apply_discount_amount","validate_conversion_rate","calculate_item_values","initialize_taxes","determine_exclusive_rate","calculate_net_total","calculate_taxes","manipulate_grand_total_for_inclusive_tax","calculate_totals","_cleanup","conversion_rate_label","company_currency","get_company_currency","from_currency","to_currency","round_floats_in","net_rate","net_amount","item_tax_amount","total_weight","weight_per_unit","stock_qty","set_in_company_currency","f","tax","item_wise_tax_detail","tax_fields","charge_type","apply_discount_on","cscript","validate_taxes_and_charges","validate_inclusive_tax","has_inclusive_tax","included_in_print_rate","n","item_tax_map","_load_item_tax_rate","item_tax_rate","cumulated_tax_fraction","tax_fraction_for_current_item","get_current_tax_fraction","grand_total_fraction_for_current_item","current_tax_fraction","tax_rate","_get_tax_rate","row_id","add_deduct_tax","indexOf","account_head","total","base_total","net_total","base_net_total","base_amount","base_net_amount","rounding_adjustment","actual_tax_dict","tax_amount","current_tax_amount","get_current_tax_amount","tax_amount_for_current_item","tax_amount_after_discount_amount","category","grand_total_for_current_item","round_off_totals","set_cumulative_total","discount_amount","grand_total","row_idx","JSON","parse","actual","set_item_wise_tax","key","item_wise_tax_amount","any_inclusive_tax","taxes","last_tax","non_inclusive_tax_amount","sum","diff","Math","abs","pow","tax_count","base_grand_total","taxes_and_charges_added","taxes_and_charges_deducted","total_taxes_and_charges","set_rounded_total","disable_rounded_total","rounded_total","base_rounded_total","round_based_on_smallest_currency_fraction","base_in_words","in_words","temporary_fields","stringify","additional_discount_percentage","scrub","distributed_amount","base_discount_amount","total_for_discount_amount","get_total_for_discount_amount","discount_amount_loss","total_actual_tax","actual_taxes_dict","actual_tax_amount","total_allocated_amount","adv","allocated_amount","total_advance","calculate_paid_amount","party_account_currency","total_amount_to_pay","set_default_payment","calculate_change_amount","base_paid_amount","payment_status","is_pos","base_change_amount","payment_types","TransactionController","_super","flags","hide_serial_batch_dialog","has_margin_field","has_field","set_gross_profit","tax_table","set_dynamic_labels","via_discount_percentage","get_field","set_query_for_batch","payment_terms_template","payment_schedule","calculate_net_weight","setup_quality_inspection","defaults","get_user_default","amended_from","inspection_type","get_route_options_for_new_doc","reference_type","reference_name","description","item_serial_no","batch_no","onload_post_render","load_after_mapping","after_ajax","apply_default_taxes","setup_item_selector","setup_sms","taxes_and_charges_field","taxes_and_charges","master_doctype","tax_template","status","page","add_menu_item","send_sms","barcode","from_barcode","update_stock","show_batch_dialog","includes","validate_company_and_party","child","price_list_currency","plc_conversion_rate","order_type","is_subcontracted","ignore_pricing_rule","project","conversion_factor","weight_uom","pos_profile","toggle_conversion_factor","k","show_serial_batch_selector","grid_rows","remove","valid_serial_nos","serial_nos","replace","x","validate","set_pricing","company_doc","default_letter_head","letter_head","default_terms","apply_pricing_rule","set_party_account","party_account_field","rt","due_date","recalculate_terms","message1","message2","final_message","term","payment_term","get_exchange_rate","exchange_rate","in_apply_price_list","set_actual_charges_based_on_currency","apply_price_list","shipping_rule","fail","uom","dont_fetch_price_list_rate","fields_map","toggle_enable","stock_uom","total_net_weight","toggle_reqd","price_list_name","doc_currency","change_form_labels","change_grid_labels","set_currency_labels","item_grid","fname","set_column_disp","wrapper","recalculate","recalculate_values","calculate_charges","item_list","pricing_rule","_set_values_for_item_list","_get_args","_get_item_list","customer_group","territory","supplier_type","campaign","sales_partner","append_item","item_group","brand","parenttype","parent","children","price_list_rate_changed","l","existing_pricing_rule","reset_plc_conversion","valid","master_name","is_recurring","recurring_id","owner_email","owner","user_info","email","notification_email_address","contact_email","repeat_on_day_of_month","str_to_obj","getDate","refresh_many","months","Monthly","Quarterly","Half-yearly","Yearly","recurring_type","add_months","add_days","valuation_rate","gross_profit","get_advances","make_payment_entry","get_method_for_payment","make_payment_via_journal_entry","terms_template","on_close","require","SerialNoBatchSelector","warehouse_details","ItemSelector","Class","init","item_query","add_items_button","render_items","setTimeout","focus","results","timeout_id","clearTimeout","added","show_alert","indicator","add_new_row","timeout","txt","as_dict","get_filters","link_search","image","abbr","get_abbr","color","get_palette","help","help_links","url","agriculture","TernaryPlot","assign","make_svg","init_snap","init_config","make_plot","make_plot_marking","make_legend","mark_blip","$svg","append","paper","Snap","get","config","triangle_side","spacing","strokeWidth","stroke","scaling_factor","coords","sand","points","s","t","cos","loamy_sand","p","sandy_loam","loam","silt_loam","silt","silty_clay_loam","silty_clay","clay_loam","sandy_clay_loam","sandy_clay","clay","get_coords","soil_type","get_color","polygon","fill","transform","offset","exec_once","rect","font-size","ref","x_blip","y_blip","sin","blip","circle","remove_blip","ItemQuickEntryForm","QuickEntryForm","after_insert","render_dialog","mandatory","get_variant_fields","get_attributes_fields","init_post_render_dialog_operations","preset_fields_for_template","attribute_html","init_for_create_variant_trigger","init_for_item_template_trigger","toggle_manufacturer_fields","register_primary_action","working","variant_values","create_variant","$input","prop","get_variant_doc","template_doc","update_doc","insert","Promise","resolve","clear_doc","_from_link","update_calling_link","open_from_if_not_list","error","open_doc","always","freeze","template","item_template","has_variants","get_manufacturing_fields","manufacturer_fields","attribute_fields","init_post_template_trigger_operations","for_variant","template_field","toggle","is_manufacturer","variant_based_on","attributes","render_attributes","attributes_flag","attribute_values","attributes_count","toggleClass","dialog_field","initiate_render_attributes","desc","numeric_values","from_range","to_range","increment","init_make_control","attribute","label_area","insertAfter","input_area","closest","init_awesomplete_for_attribute","make_control","only_input","make_input","awesomplete","Awesomplete","minChars","maxItems","autoFirst","list","attribute_value","variant_doc","validate_mandatory_attributes","async","prototype","toString","msgprint_dialog","field","CustomerQuickEntryForm","collapsible","views","HubFactory","Factory","make","route","page_name","get_route_str","assets","hub_settings","hub","pages","container","change_to","window","hub_page","is_online","render_offline_card","unique_id","make_page"],"mappings":"yBAGAA,OAAOC,QAAQ,WAGfC,EAAEC,UAAUC,KAAK,gBAAiB,WACjCJ,OAAOK,IAAIC,KAAO,UAElBN,OAAOO,mBAAqB,mFAI5BL,EAAE,gBAAgBM,KAAK,kCACrBR,OAAOS,OAAOC,eAAe,2CAE/BR,EAAE,sBAAsBS,KAAK,OAAQ,qCACrCT,EAAE,wBAAwBS,KAAK,OAAQ,4CAOvC,IAAIC,EAAaV,EAAE,0CAEnBA,EAAE,wFACiBW,GAAG,cAAc,aAAaC,aAAaF,GAC9DV,EAAE,sEACiBW,GAAG,QAAQ,aAAaC,aAAaF,GACxDV,EAAE,8EACiBW,GAAG,mBAAmB,aAAaC,aAAaF,KAOpEV,EAAEa,OAAOf,OAAOgB,eACfC,iBAAkB,sBAClBC,UAAa,iBACbC,aAAc,kBACdC,eAAgB,oBAChBC,QAAW,eACXC,cAAe,qBAIhBpB,EAAEa,OAAOf,OAAOuB,YAAYC,WAC3BL,aAAc,QACdF,iBAAkB,UAClBQ,gBAAiB,SACjBP,UAAa,UACbE,eAAgB,UAChBM,gBAAiB,UACjBC,MAAS,YCrDV3B,OAAOC,QAAQ,WACfD,OAAOC,QAAQ,iBAEfC,EAAEa,OAAOa,SACRC,aAAc,SAASC,GAGtB,OAFIA,GAAWC,UACdD,EAAUC,QAAQC,IAAIF,SACpBA,GACK9B,OAAOiC,QAAQ,WAAYH,GAASI,kBAEpClC,OAAOmC,KAAKC,YAAYC,UAGjCC,0CAGC,OAFatC,OAAOmC,KAAKI,KACEC,gBAAOC,SAAmB,cAAdA,EAAEC,UAAyBC,aAAIF,UAAKA,EAAEnC,QAI9EsC,qBAAsB,WAClBb,QAAQc,YAAYC,eACtBf,QAAQgB,eAAe,kBAAiBhB,QAAQC,IAAIgB,YAItDC,aAAc,WACb,GAAGlB,QAAQc,YAAYf,QAAS,CAC/B,IAAIoB,EAAYC,OAAOC,KAAKC,OAAO,iBACX,IAArBH,EAAUI,QACRvB,QAAQC,IAAIF,SAASC,QAAQwB,UAAU,UAAWL,EAAU,IAChEnB,QAAQgB,eAAe,WAAW,IACzBnB,QAAQ4B,wBACbzB,QAAQC,IAAIF,SAASC,QAAQwB,UAAU,UAAW3B,QAAQ4B,0BAKjEC,+BAAgC,SAAS3B,GACxC,GAAGA,EACF,OAAO9B,OAAOiC,QAAQ,WAAYH,GAAS4B,4BAI7CC,8BACC,OAAOC,KAAK5D,OAAOmC,KAAKC,YAAYyB,cAGrCC,gBAAiB,WAChB,IAAIC,EAAWhC,QAAQiC,gBACnBD,GAAaA,EAASE,UAAUpB,YAAYqB,WACS,UAAxDH,EAASE,UAAUpB,YAAYqB,UAAUC,cAE/BjE,EAAE,0CAA0CW,GAAG,iBAAiB,aACzEuD,SAASlE,EAAE,SACVmE,KAAKC,gBAAiB,OAAQC,aAAc,SAC5CH,SAASL,EAASE,UAAUpB,YAAYqB,UAAUM,WAEhDC,GAAG,QAAS,WAChB,IAAIhC,EAAI,IAAIzC,OAAO0E,GAAGC,QACrBC,MAAO/D,GAAG,iBACVgE,SAEEC,UAAa,OACbC,UAAa,YACbC,QAAW,YACXC,MAASpE,GAAG,aACZqE,UAAa,WACZ,OACCC,SACCC,UAAUrB,EAAS/B,IAAIoD,UACvBC,UAAUtD,QAAQC,IAAIsD,UAAY,KAAOvB,EAAS/B,IAAIqD,eAMzDP,UAAa,SACbC,UAAa,MACbE,MAASpE,GAAG,WAKf4B,EAAE8C,UAAU,OAAOd,GAAG,QAAS,WAC9B,IAAIP,EAAYzB,EAAE+C,UAAU,aAC5B,GAAGtB,EAAW,CACb,IAAIuB,GAAO1B,EAAS/B,IAAIkC,WAAa,IAAIwB,MAAM,MAAMC,QAAQzB,IAAY0B,KAAK,MAC9E7B,EAASE,UAAUpB,YAAYqB,UAAU2B,gBAAgBJ,EAAIK,QAG9D,OADArD,EAAEsD,QACK,IAGRtD,EAAEuD,YAML9F,EAAEa,OAAOa,QAAQqE,OAChBC,+BAAgC,SAASC,GACxC,GAAGA,EAAInE,IAAIoE,UAAYD,EAAInE,IAAIoE,SAASC,eAAgB,CACvD,IAAIC,EAAOH,EAAInE,IAAIoE,SAASC,eAC5BF,EAAII,UAAUC,cAAc3F,GAAG,uBAC7B4F,gBAAgBH,EAAKI,kBAAmBJ,EAAKjE,YAAa,QAC5D8D,EAAII,UAAUC,cAAc3F,GAAG,qBAC7B4F,gBAAgBH,EAAKK,aAAcL,EAAKjE,YACzCiE,EAAKK,aAAe,SAAW,WAIlCC,eAAgB,SAASC,GAGxB,OAFYC,SAAY,gBAAiBC,SAAY,gBAAiBC,SAAY,gBACjFC,OAAU,eACCJ,IAGbK,sBAAuB,SAASlF,EAAKmF,EAAIC,EAAIC,EAAiBtC,GAC7D,IAAItC,EAAIY,OAAO8D,GAAIC,GACnB,GAAG3E,EAAEsC,GAEJ,IADA,IAAIuC,EAAKtF,EAAIqF,OACLE,EAAI,EAAGA,EAAID,EAAGhE,OAAQiE,IACzBD,EAAGC,GAAGxC,KAAYuC,EAAGC,GAAGxC,GAAatC,EAAEsC,IAG7CyC,cAAcH,IAGfI,UAAW,SAASC,EAAS1F,EAAK2F,GACjC,GAAGD,EACF,OAAO1H,OAAO4H,MACbC,OAAQ,2FACRC,MACCC,cAAeL,EACf1F,IAAKA,GAEN2F,SAAU,SAASK,GAClBL,EAASK,OAMbC,kBAAmB,SAASvF,EAASwF,GACpClI,OAAO4H,MACNC,OAAQ,uEACRC,MACCpF,QAASA,EACTwF,QAASA,GAEVP,SAAU,SAASK,GAClB,IAAIG,EAAUnI,OAAOoI,MAAMC,KAAKL,EAAEM,SAClCtI,OAAOuI,UAAU,OAAQJ,EAAQ,GAAGzF,QAASyF,EAAQ,GAAG7H,UAU3DkI,mBAAoB,SAASC,GAC5B,SAAGvI,EAAEwI,QAAQD,IAAgBA,EAAYnF,OAAS,KACzCmF,EAAY,GAAGrD,WAWzBuD,uBAAwB,SAASxC,EAAKyC,GACrCC,IAAMC,EAAO3C,EAAS,IAAEyC,GAIxB,OAHIG,KAAKP,mBAAmBM,KAC3B3C,EAAS,IAAEyC,GAAoBE,EAAKE,OAAO,IAErCF,KAITlH,QAAQqE,MAAMgD,uBAAyB,SAASC,cACzC/C,EAAM+C,EAAK/C,IACXgD,EAAkBD,EAAKC,iBAAmB,YAC1CC,EAAaF,EAAKE,YAAc,YAEtCL,KAAKM,QACLR,IAAMS,EAAS,IAAItJ,OAAO0E,GAAGC,QAC5BC,MAAO/D,GAAG,yBACVgE,SACEC,UAAU,gBAAiBG,MAAOpE,GAAG,WAErCkE,UAAW,oBAAqBD,UAAW,QAASyE,iBAAiB,EACrEC,eAAe,EAAMH,KAAMN,KAAKM,KAChCI,oBACC,OAAOV,EAAKM,MAEbxE,SACCC,UAAU,OACVC,UAAU,UACV2E,OAAQ,IAER5E,UAAU,OACVC,UAAU,YACVC,QAAS,OACT2E,aAAc,EACdC,UAAW,EACX3E,MAAOpE,GAAG,eAEViE,UAAU,OACVC,UAAU,iBACVC,QAAS,OACT6E,QAAS,GACTF,aAAc,EACd1E,MAAOpE,GAAG,kBACViJ,SAAU,sBACH1E,EAAY2D,KAAKvD,YACjBH,EAAY0D,KAAKhF,SAASgG,oBAAoB1E,UAAUG,YAC1DJ,GAAaC,GAChBrF,OAAO4H,MACNC,OAAQ,2CACRC,MACC1C,UAAWA,EACXC,UAAWA,GAEZsC,kBAAWK,GACVe,EAAKhF,SAASgG,oBACZC,WAAWzG,UAAUyE,EAAEM,SAAW,OAKxCpD,mBAAY+E,GACX,OACCC,MAAO,gFACP/E,SACCC,UAAW6E,EAAE7E,eAKhBN,UAAU,OACVC,UAAU,YACVC,QAAS,YACT6E,QAAS,GACTF,aAAc,EACd1E,MAAOpE,GAAG,aACViJ,SAAU,sBACHzE,EAAY0D,KAAKvD,YACjBJ,EAAY2D,KAAKhF,SAASgG,oBAAoB3E,UAAUI,YAC1DJ,GAAaC,GAChBrF,OAAO4H,MACNC,OAAQ,2CACRC,MACC1C,UAAWA,EACXC,UAAWA,GAEZsC,kBAAWK,GACVe,EAAKhF,SAASgG,oBACZC,WAAWzG,UAAUyE,EAAEM,SAAW,SAMxCxD,UAAU,QACVC,UAAU,aACV8E,QAAS,EACTD,UAAW,EACXD,aAAc,EACd1E,MAAOpE,GAAG,qBAIbsJ,eAAgB,WACFpB,KAAKqB,aAAgC,kBACnB5H,gBAAOC,GACrC,GAAIA,EAAE4H,gBAAkB5H,EAAE2C,WAAa3C,EAAE4H,eACxC,OAAO,IAISC,iBAAQ7H,GACzB8H,IAAIC,EAAMxK,OAAOiC,QAAQiH,EAAKuB,cAAehI,EAAEyF,SAC3CwC,EAAMF,EAAIE,IACdF,EAAIpB,GAAc3G,EAAE4H,eAEpBlE,EAAIwE,eAAeC,QAAQxB,EAAYoB,EAAI9H,QAAS8H,EAAIlK,MACtDuK,gBACA7K,OAAOoI,MAAM7E,UAAUiH,EAAI9H,QAAS8H,EAAIlK,KAAM,MAAOoK,GACrD1K,OAAOoI,MAAM7E,UAAUiH,EAAI9H,QAAS8H,EAAIlK,KACvC4I,EAAK4B,oBAAqBrI,EAAE2C,eAIhCoC,cAAc0B,EAAK6B,eACnBhC,KAAKhD,QAENiF,qBAAsBnK,GAAG,YAG1BsF,EAAInE,IAAIkH,EAAK6B,eAAeT,iBAAQ7H,GAC9ByG,EAAK+B,YAAa/B,EAAK+B,UAAUxI,IACrC6G,EAAOzG,YAAYqI,kBAAkBC,GAAG9B,KAAK+B,MAC5ClD,QAAWzF,EAAEnC,KACb8E,UAAa3C,EAAE2G,GACf/D,UAAa5C,EAAE0G,GACfa,WAAcvH,EAAEuH,eAKnBjB,KAAKM,KAAOC,EAAOzG,YAAYqI,kBAAkBC,GAAG9B,KACpDC,EAAOzG,YAAYqI,kBAAkBG,KAAKC,UAC1ChC,EAAOtD,QAGRpE,QAAQqE,MAAMsF,gBAAkB,SAASrC,GACrCA,EAAKsC,oBACPtC,EAAKhE,UAAY,WAChB,OAAQC,QAAS+D,EAAKsC,qBAGxB,IAAIC,EAAO,WACV,GAAGvL,EAAEwI,QAAQ3G,QAAQC,IAAI0J,QAAU3J,QAAQC,IAAI0J,MAAMpI,OAAS,EAAG,CAE5DvB,QAAQC,IAAI0J,MAAM,GAAGtG,YACxBrD,QAAQC,IAAI0J,MAAQ3J,QAAQC,IAAI0J,MAAM1C,OAAO,IAI9C,IAAI2C,EAAgB3L,OAAO4L,KAAKC,aAAa9J,QAAQW,QAAS,SAASsC,QAInE8G,EAAiB,KACrB9L,OAAO+L,SAASJ,GAAe9G,OAAOyF,QAAQ,SAAS7H,GACnDA,EAAEuC,UAAUkE,EAAK8C,iBAAgBF,EAAiBrJ,EAAEsC,aAGxD,IAAIkH,GAAc,EACdC,KAEJhM,EAAEiM,KAAKpK,QAAQC,IAAI0J,MAAO,SAASnE,EAAG9E,GACrCyG,EAAKkD,YAAY9B,QAAQ,SAAS+B,GAC9B5J,EAAEqJ,IAAiBO,IACrBJ,GAAc,EACVC,EAAazJ,EAAE2C,WAClB8G,EAAazJ,EAAE2C,YAAckH,IAAI7J,EAAEiI,KAEnCwB,EAAazJ,EAAE2C,WAAakH,IAAI7J,EAAEiI,UAKnCuB,GACF/C,EAAKkD,YAAY9B,QAAQ,SAAS+B,GACjCrM,OAAOoI,MAAMmE,SAASrD,EAAK8C,eAAgBK,EAAK,SAASrE,GACxD,IAAIwE,EAAaxM,OAAOoI,MAAMnG,QAAQiH,EAAK8C,eAAgBK,GAC3DnM,EAAEiM,KAAKK,EAAWd,UAAa,SAASnE,EAAGiD,GAC1C,GAAGA,EAAIE,IAAM4B,IAAIJ,EAAa1B,EAAIpF,YAEjC,OADA6G,GAAc,GACP,MAKPA,GACFjM,OAAOyM,SAAS5L,GAAG,gDACjBqI,EAAK8C,eAAgBK,OAQ3B,OAAOrM,OAAO4H,MAGb8E,KAAM,OACN7E,OAAQ,+BACRC,MACCD,OAAUqB,EAAKrB,OACf8E,aAAgBzD,EAAKkD,YACrBQ,WAAc7K,QAAQC,KAEvB2F,SAAU,SAASK,GAClB,IAAIA,EAAE6E,IAAK,CACA7M,OAAOoI,MAAMC,KAAKL,EAAEM,SAC9BvG,QAAQ+K,QACR/K,QAAQuJ,eAKZ,GAAGpC,EAAK8C,eACP,IAAIvJ,EAAI,IAAIzC,OAAO0E,GAAGqI,KAAKC,mBAC1BtK,QAASwG,EAAK8C,eACdiB,OAAQ/D,EAAK+D,OACbC,WAAYhE,EAAKgE,iBAAcC,EAC/BC,QAASlE,EAAKkE,QACdlI,UAAWgE,EAAKhE,UAChBmI,OAAQ,SAASC,EAAYxF,GAC5ByC,IAAIgD,EAASD,EACQ,IAAlBC,EAAOjK,QAIV4F,EAAKkD,YAAcmB,EACnBrE,EAAKkE,QAAUtF,EACfrF,EAAE6G,OAAOvD,OACT0F,KANCzL,OAAOyM,SAAS5L,GAAG,qBAAsBqI,EAAK8C,0BASxC9C,EAAKkD,cACdlD,EAAKkD,aAAelD,EAAKkD,aACzBX,MAIFzL,OAAO+M,KAAKS,gBAAsB,KAAI,SAASC,EAAOzL,GACrD,OAAGA,GAAOA,EAAI0L,WAAa1L,EAAI0L,YAAcD,EACrCA,EAAOA,EAAQ,KAAOzL,EAAI0L,UAAW1L,EAAI0L,UAEzCD,GAITzN,OAAO+M,KAAKS,gBAA0B,SAAI,SAASC,EAAOzL,GACzD,OAAGA,GAAOA,EAAI2L,eAAiB3L,EAAI2L,gBAAkBF,EAC7CA,EAAOA,EAAQ,KAAOzL,EAAI2L,cAAe3L,EAAI2L,cAE7CF,GAKTvN,EAAEC,UAAUsE,GAAG,YAAa,WACvBzE,OAAO4N,SAASC,oBACnB3N,EAAEiM,MAAM,uBAAwB,cAAe,qBAC9C,gBAAiB,mBAAoB,iBAAkB,SAAS5E,EAAG9E,GACnEzC,OAAO0E,GAAGqI,KAAKtI,GAAGhC,EAAG,SAAU,SAAS0D,GACvCpE,QAAQ+L,gBAAgB,eAAgB,cACvC9N,OAAO+N,aAAaC,iBC7bzBhO,OAAOC,QAAQ,mBACfC,EAAEa,OAAOa,QAAQqM,SAChBC,KAAM,WACL,OAAShE,MAAO,6CAGjBiE,KAAM,WACL,OAASjE,MAAO,2CAGjBkE,SAAU,WACT,OAASlE,MAAO,+CAGjBmE,SAAU,WACT,OAASnE,MAAO,+CAGjBoE,KAAM,SAASnJ,GACd,IAAI2C,GAASoC,MAAO,0CAEpB,OADG/E,IAAS2C,EAAc,QAAI3C,GACvB2C,GAGRyG,IAAK,WACJ,OAASrE,MAAO,oCAGjBsE,KAAM,WACL,OAAStE,MAAO,sCAGjBuE,gBAAiB,SAASzM,GAKzB,OAJIA,EAAIoM,UACPpO,OAAO0O,MAAM7N,GAAG,kBAAmBA,GAAGb,OAAO4L,KAAK+C,UAAU3M,EAAIU,QAAS,WAAYV,EAAI1B,WAGjF6E,SAAWiJ,SAAUpM,EAAIoM,YAGnCQ,cAAe,SAAS5M,GACvB,GAAGhC,OAAO6O,aAMT,OALI7M,EAAIhC,OAAO6O,aAAa9J,YAC3B/E,OAAO0O,MAAM7N,GAAG,kBACdA,GAAGb,OAAO4L,KAAK+C,UAAU3M,EAAIU,QAAS1C,OAAO6O,aAAa9J,UAAW/C,EAAI1B,WAI3E4J,MAAO,wDACP/E,SACC2J,aAAc9O,OAAO6O,aAAanM,QAClCqM,UAAW/M,EAAIhC,OAAO6O,aAAa9J,cAMvCiK,cAAe,SAAShN,GACvB,GAAGhC,OAAO6O,aAMT,OALI7M,EAAIhC,OAAO6O,aAAa9J,YAC3B/E,OAAO0O,MAAM7N,GAAG,kBACdA,GAAGb,OAAO4L,KAAK+C,UAAU3M,EAAIU,QAAS1C,OAAO6O,aAAa9J,UAAW/C,EAAI1B,WAI3E4J,MAAO,wDACP/E,SACC2J,aAAc9O,OAAO6O,aAAanM,QAClCqM,UAAW/M,EAAIhC,OAAO6O,aAAa9J,cAMvCkK,sBAAuB,SAASjN,GAC/B,OACCkI,MAAO,wDACP/E,SAAW+J,wBAAyB,EAAGJ,aAAc,UAAWC,UAAW/M,EAAIF,SAAW,MAI5FqN,gBAAiB,SAASnN,GAKzB,OAJIA,EAAIqM,UACPrO,OAAO0O,MAAM7N,GAAG,kBAAmBA,GAAGb,OAAO4L,KAAK+C,UAAU3M,EAAIU,QAAS,WAAYV,EAAI1B,WAGjF6E,SAAWkJ,SAAUrM,EAAIqM,YAGnCe,YAAa,SAASpN,GAMrB,OALIA,EAAImM,MACPnO,OAAO0O,MAAM7N,GAAG,wBACdA,GAAGb,OAAO4L,KAAK+C,UAAU3M,EAAIU,QAAS,OAAQV,EAAI1B,WAG5C6E,SAAWgJ,KAAMnM,EAAImM,QAG/BkB,mBAAoB,WACnB,OAASlK,SAAWmK,SAAU,KAG/BC,SAAU,WACT,OAASrF,MAAO,+CAGjB7E,UAAW,SAASrD,GACnB,OACCmD,UACE,YAAa,UAAW,MAAO,GAAIqK,KAAKxN,EAAIF,YAC5C,YAAa,WAAY,IAAI,QAOlCF,QAAQqM,QAAQwB,cAAgB,SAAStJ,EAAKnB,EAAS0K,GACtD,IACIC,EAAY,SAASjN,EAASkN,GACjC,IAAIC,EAAc7P,OAAO4L,KAAKkE,cAAcpN,EAASyD,EAAInE,IAAI1B,MAC3DwE,UAAa,OAAQE,QAAWA,IAClC9E,EAAEiM,KAAK0D,EAAa,SAAStI,EAAG4D,GAC5ByE,EACFzJ,EAAIwJ,UAAUxE,EAAGpG,UAAW6K,EAAaF,GAEzCvJ,EAAIwJ,UAAUxE,EAAGpG,UAAW2K,MAK/BC,EAAUxJ,EAAInE,IAAIU,SAGlBxC,EAAEiM,KAAKnM,OAAO4L,KAAKkE,cAAc3J,EAAInE,IAAIU,QAASyD,EAAInE,IAAI1B,MAAOwE,UAAa,UAC7E,SAASyC,EAAG4D,GACXwE,EAAUxE,EAAGnG,QAASmG,EAAGpG,cAQ5BnD,QAAQqM,QAAQ8B,sBAAwB,SAAS5J,GAChDA,EAAIwJ,UAAU,YAAa,QAAS,SAAS3N,EAAKgO,EAAKC,GACtD,IAAIzF,EAAOnH,OAAO2M,GAAKC,GACnB9K,EAAUvD,QAAQqM,QAAQ5I,UAAUc,EAAInE,KAK5C,OAJGwI,EAAIpF,YACNlF,EAAEa,OAAOoE,GAAU+E,MAAQ,gDAC3B/E,EAAiB,QAAEiG,MAAM,MAAO,YAAa,IAAKZ,EAAIpF,aAEhDD,KCzJTvD,QAAQsO,WAAa,SAAoBlO,GACxC,IAAImO,EAAKpH,KACTA,KAAKqH,MAAQ,WACZ,IAAIC,GACHC,KAAY,GACZC,YAAkB,yDAA2DvO,EAAI1B,KACjFkQ,UAAgB,aAAexO,EAAI1B,KAAO,oCAC1CmQ,cAAiB,eAAiBzO,EAAI1B,KAAO,8BACvC0B,EAAI0O,aAAgB,YAAc1O,EAAI0O,aAAgB,KACtD1O,EAAI2O,MAAS,iBAAmB3O,EAAI2O,MAAS,IACnDC,gBAAmB,mDAAqD5O,EAAI1B,MACtE0B,EAAI2O,MAAS,iBAAmB3O,EAAI2O,MAAS,IACnDE,gBAAiB,WAAa7O,EAAI1B,KAAO,6BACnC0B,EAAI2O,MAAS,iBAAmB3O,EAAI2O,MAAS,IACnDG,mBAAuB,oBAAsB9O,EAAI1B,KAAO,iCACxDyQ,iBAAmB,kBAAoB/O,EAAI1B,KAAO,2BAClD0Q,mBAAqB,qDAAuDhP,EAAI1B,MAG7E2Q,SAAS,YAAa,cAAe,gBAAiB,iBAAkBjP,EAAIU,SAC/EqG,KAAK/C,KAAKhE,EAAIkP,eAAgB,WAAYlP,EAAIoM,SAAU,GAAIiC,EAAYrO,EAAIU,UACpEuO,SAAS,iBAAkB,oBAAqBjP,EAAIU,SAC5DqG,KAAK/C,KAAKhE,EAAIkP,eAAgB,WAAYlP,EAAIqM,SAAU,GAAIgC,EAAYrO,EAAIU,UACrD,QAAfV,EAAIU,QACZqG,KAAK/C,KAAK,GAAI,GAAI,GAAIhE,EAAImP,UAAWd,EAAYrO,EAAIU,UAC9B,eAAfV,EAAIU,QACZqG,KAAK/C,KAAK,GAAI,GAAI,GAAIhE,EAAIoP,WAAYf,EAAYrO,EAAIU,UAC/B,oBAAfV,EAAIU,SACZqG,KAAK/C,KAAK,GAAI,GAAI,GAAI,GAAIqK,EAAYrO,EAAIU,WAI5CqG,KAAKsI,mBAAqB,SAASC,EAASC,EAAaC,GACxDxR,OAAO4H,MACNC,OAAQ,mEACRC,MACC2J,aAAcH,EACdC,YAAaA,EACbC,SAAUA,GAEX7J,SAAU,SAASK,GACfA,EAAE6E,IAAO7M,OAAOyM,SAASzE,EAAE6E,MAC9BsD,EAAGuB,OAAS1J,EAAEM,QACd6H,EAAGwB,mBAKN5I,KAAK/C,KAAO,SAASsL,EAASC,EAAaC,EAAUI,EAAYtJ,GAChES,KAAKT,QAAUA,EACXsJ,GACHzB,EAAGuB,OAASE,EACZzB,EAAGwB,eACOL,EACVvI,KAAKsI,mBAAmBC,EAASC,EAAaC,GAE9CrB,EAAGwB,eAGL5I,KAAK4I,YAAc,WACdxB,EAAG7G,QACN6G,EAAG0B,cACJ1B,EAAG7G,OAAOwI,YACTxJ,QAAW6H,EAAG7H,QACdoJ,OAAUvB,EAAGuB,SAEdvB,EAAG7G,OAAOtD,QAEX+C,KAAK8I,YAAc,WAClB,IAAIpP,EAAI,IAAIzC,OAAO0E,GAAGC,QACrBC,MAAO,WACPmN,MAAO,IACPlN,SACEE,UAAU,SAAUD,UAAU,OAAQG,MAAM,gBAAiB+M,KAAK,IAClEjN,UAAU,UAAWD,UAAU,OAAQG,MAAM,UAAW+M,KAAK,IAC7DjN,UAAU,OAAQD,UAAU,SAAUG,MAAM,WAG/CxC,EAAEI,YAAYoP,KAAKC,MAAMC,QAAU,WAClC,IAAIC,EAAM3P,EAAEI,YAAYoP,KAAKC,MACzBG,EAAIlC,EAAG7G,OAAOc,aACfiI,IACFnS,EAAEkS,GAAKE,cACPtS,OAAO4H,MACNC,OAAQ,yDACRC,MACCyK,eAAgBF,EAAEX,QAClBc,IAAKH,EAAE/J,SAERX,SAAU,SAASK,GAClB9H,EAAEkS,GAAKK,eACJzK,EAAE6E,IAAM7M,OAAOyM,SAASzE,EAAE6E,KAC7BsD,EAAG7G,OAAOvD,YAKdgD,KAAKO,OAAS7G,GAEfsG,KAAKqH,SCnGNpQ,OAAOC,QAAQ,iBAEf2B,QAAQqE,MAAMyM,kBAAoB,SAASvM,EAAK0B,EAAQC,EAAMH,GACzDE,IACHA,EAAS,4CAENC,IACe,kBAAf3B,EAAIzD,SAA+ByD,EAAInE,IAAIoM,SAC7CtG,GACC6K,MAAOxM,EAAInE,IAAIoM,SACfvH,WAAY,WACZ+L,WAAYzM,EAAInE,IAAI6Q,oBAEZ1M,EAAInE,IAAIqM,WACjBvG,GACC6K,MAAOxM,EAAInE,IAAIqM,SACfxH,WAAY,WACZiM,UAAW3M,EAAInE,IAAI8Q,UACnBF,WAAYzM,EAAInE,IAAI+Q,oBAIlBjL,IACHA,EAAKkL,aAAe7M,EAAInE,IAAIgR,cAAgB7M,EAAInE,IAAIiR,mBAGlDnL,IAED9H,OAAO4L,KAAKC,aAAa1F,EAAInE,IAAIU,QAAS,WACxCd,QAAQqE,MAAMiN,mBAAmB/M,EAAK,2BACzC2B,EAAKkL,aAA+B,YAAjBlL,EAAKjB,WAAyB,WAAY,cAG/DiB,EAAKzF,SAAW8D,EAAInE,IAAIK,SACxByF,EAAKhG,QAAUqE,EAAInE,IAAIF,QACvBgG,EAAKpF,QAAUyD,EAAInE,IAAIU,QACvB1C,OAAO4H,MACNC,OAAQA,EACRC,KAAMA,EACNH,SAAU,SAASK,GACfA,EAAEM,UACJnC,EAAIgN,wBAAyB,EAC7BnT,OAAOoT,gCACAjN,EAAI5C,UAAUyE,EAAEM,qBAErBnC,EAAIgN,wBAAyB,EAC1BxL,GAAUA,IACbxB,EAAImF,UACJ1J,QAAQqE,MAAMoN,SAASlN,aAQ7BvE,QAAQqE,MAAMoN,SAAW,SAASlN,GACjC,GAAGA,EAAImN,SAAU,CAChB,IAAIC,EAAavT,OAAOwT,iBACxB,KAAmB,SAAhBD,EAAW,IAAiBpN,EAAInE,IAAI0J,OAASvF,EAAInE,IAAI0J,MAAMpI,QAAS,CAEtE,IAAIgL,EAAOnI,EAAIsN,UAAU,SACzBtN,EAAIqB,cAAc,SAGlBxH,OAAOoI,MAAM7E,UAAU+K,EAAK5L,QAAS4L,EAAKhO,KAAM,YAAaiT,EAAW,OAK3E3R,QAAQqE,MAAMyN,oBAAsB,SAASvN,EAAKwN,EAAeC,EAAe1E,GAC/E,IAAG/I,EAAIgN,uBAAP,CAEA,IAAIQ,EACH,GAAkB,kBAAfxN,EAAIzD,SAA+ByD,EAAInE,IAAIoM,SAC7CuF,EAAgB,uBACV,CAAA,IAAGxN,EAAInE,IAAIqM,SAEX,OADNsF,EAAgB,mBAIdC,IAAeA,EAAgB,mBAChCzN,EAAInE,IAAI2R,GACV3T,OAAO4H,MACNC,OAAQ,8DACRC,MAAO+L,aAAgB1N,EAAInE,IAAI2R,IAC/BhM,SAAU,SAASK,GACfA,EAAEM,SACJnC,EAAI5C,UAAUqQ,EAAe5L,EAAEM,SAEhC1G,QAAQqE,MAAM6N,UAAU3N,EAAKwN,EAAeC,EAAe1E,MAI7D/I,EAAI5C,UAAUqQ,EAAe,MAI/BhS,QAAQqE,MAAM6N,UAAY,SAAS3N,EAAKwN,EAAeC,EAAe1E,GAerE,IAAIrI,EAAY8L,EAdb3S,OAAO4L,KAAKC,aAAa1F,EAAInE,IAAIU,QAAS,WAAawM,IACrDtN,QAAQqE,MAAMiN,mBAAmB/M,EAAK,yBACzCA,EAAInE,IAAIoM,UAAYjI,EAAInE,IAAIqM,UAAYlI,EAAInE,IAAImM,KAAMwF,IAInD/R,QAAQqE,MAAMiN,mBAAmB/M,EAAK,2BACzCA,EAAInE,IAAIgR,cAAgB7M,EAAInE,IAAIiR,iBAAkBU,KAQhDxN,EAAInE,IAAImM,MACXtH,EAAa,OACb8L,EAAQxM,EAAInE,IAAImM,MACNhI,EAAInE,IAAIoM,UAClBvH,EAAa,WACb8L,EAAQxM,EAAInE,IAAIoM,UACNjI,EAAInE,IAAIqM,WAClBxH,EAAa,WACb8L,EAAQxM,EAAInE,IAAIqM,UAGjBrO,OAAO4H,MACNC,OAAQ,mCACRC,MACC6K,MAASA,EACT9L,WAAcA,EACdmM,aAAgB7M,EAAInE,IAAIgR,cAAgB7M,EAAInE,IAAIiR,iBAChDnR,QAAWqE,EAAInE,IAAIF,QACnBiS,gBAAqB5N,EAAInE,IAAIoM,UAAYjI,EAAInE,IAAImM,KAAShI,EAAInE,IAAoB,iBAAKmE,EAAInE,IAAoB,iBAC/GgS,iBAAoB7N,EAAInE,IAAIiS,uBAE7BtM,SAAU,SAASK,GACfA,EAAEM,SACJnC,EAAI5C,UAAU,oBAAqByE,EAAEM,eAMzC1G,QAAQqE,MAAMiO,oBAAsB,SAAS/N,GACzCA,EAAIgN,wBAEJhN,EAAInE,IAAoB,gBAC1BhC,OAAO4H,MACNC,OAAQ,8DACRC,MAAOwJ,QAASnL,EAAInE,IAAIkP,gBACxBvJ,SAAU,SAASK,GACfA,EAAEM,SACJnC,EAAI5C,UAAUyE,EAAEM,aAMrB1G,QAAQqE,MAAMiN,mBAAqB,SAAS/M,EAAKlB,EAAOwI,EAAO0G,GAC9D,QAAI1G,IACHtH,EAAInE,IAAImS,GAAc,GACtB3M,cAAc2M,GACdnU,OAAOyM,SAAS5L,GAAG,0BAA2BoE,MACvC,IAKTrD,QAAQqE,MAAMmO,qBAAuB,SAASjO,EAAKwB,GAClD3H,OAAO4H,MACNC,OAAQ,+DACRC,MACChG,QAASqE,EAAInE,IAAIF,QACjBuS,QAASlO,EAAInE,IAAIgS,kBAElBrM,SAAU,SAASK,GAMlB,GALGA,EAAEM,UACJnC,EAAI5C,UAAU,mBAAoByE,EAAEM,QAAQ,IAC5CnC,EAAI5C,UAAU,2BAA4ByE,EAAEM,QAAQ,KAGlDX,EACF,OAAOA,o1ECtLX3H,OAAOC,QAAQ,iBAEf2B,QAAQ0S,MAAMC,gBAAkBvU,OAAO0E,GAAGqI,KAAKyH,WAAWzT,QACzD0T,OAAQ,WAEH1L,KAAK5C,IAAItD,YAAYf,SACxBiH,KAAKgH,yBAIPA,sBAAuB,WACtB,IAAII,EAAKpH,KACTnH,QAAQqM,QAAQwB,cAAc1G,KAAK5C,IAAK,YAAa,WACpD,OAAOvE,QAAQqM,QAAQ5I,UAAU8K,EAAGhK,IAAInE,QAI1C0S,8BAA+B,WAE9B1U,OAAO0E,GAAGqI,KAAKtI,GAAGsE,KAAK5C,IAAIzD,QAAS,sCAAuC,SAASyD,GAC3D,GAArBA,EAAInE,IAAI2S,WAAkBxO,EAAInE,IAAI4S,kBACpCzO,EAAI2H,gBAAgB,eAAgB,YAAa,GACjD3H,EAAI2H,gBAAgB,eAAgB,YAAa,KAEjD3H,EAAI2H,gBAAgB,eAAgB,YAAa,GACjD3H,EAAI2H,gBAAgB,eAAgB,YAAa,MAInD9N,OAAO0E,GAAGqI,KAAKtI,GAAGsE,KAAK5C,IAAIzD,QAAS,mBAAoB,SAASyD,GAChEA,EAAIyE,QAAQ,yCAGb5K,OAAO0E,GAAGqI,KAAKtI,GAAGsE,KAAK5C,IAAIzD,QAAS,UAAW,SAASyD,GAEjC,GAAnBA,EAAInE,IAAI2S,YACNxO,EAAInE,IAAIgR,cACX7M,EAAI5C,UAAU,eAAgBvD,OAAO4N,SAASiH,WAE3C1O,EAAInE,IAAI8S,cACX3O,EAAI5C,UAAU,eAAgBvD,OAAO4N,SAASmH,YAE/C5O,EAAIyE,QAAQ,2CAKfoK,kBAAmB,WAClB,IAAI7E,EAAKpH,KACmB,IAAzBA,KAAK5C,IAAInE,IAAI2S,WACf5S,QAAQkT,kBAAkBpU,GAAG,gBAAiB,WAC7Cb,OAAOkV,eACNC,WAAYhF,EAAGhK,IAAInE,IAAI1B,KACvB8U,UAAWjF,EAAGhK,IAAInE,IAAIgR,aACtBqC,QAASlF,EAAGhK,IAAInE,IAAIgR,aACpBlR,QAASqO,EAAGhK,IAAInE,IAAIF,SAErB9B,OAAOuI,UAAU,eAAgB,iBAC/B1H,GAAG,UAKRyU,oBAAqB,WACpB,IAAInF,EAAKpH,KACmB,IAAzBA,KAAK5C,IAAInE,IAAI2S,WACf5S,QAAQkT,kBAAkBpU,GAAG,qBAAsB,WAClDb,OAAOkV,eACNC,WAAYhF,EAAGhK,IAAInE,IAAI1B,KACvB8U,UAAWjF,EAAGhK,IAAInE,IAAIgR,aACtBqC,QAASlF,EAAGhK,IAAInE,IAAIgR,aACpBlR,QAASqO,EAAGhK,IAAInE,IAAIF,QACpByT,kBAAkB,GAEnBvV,OAAOuI,UAAU,eAAgB,mBAC/B1H,GAAG,YC3ETe,QAAQ4T,SAAW5T,QAAQ0S,MAAMC,gBAAgBxT,QAChD0U,aAAc,WACb1M,KAEKO,OAAS,IAAItJ,OAAO0E,GAAGC,QAC3BC,MAAO,YAGRmE,KAAKO,OAAOtD,OACZ+C,KAAK2M,MAAQ3M,KAAKO,OAAOqM,KACzB5M,KAAK6M,6BACL7M,KAAK8M,gBACL9M,KAAK+M,eAGNA,YAAa,WACZ5V,EACE6I,KAAK2M,OAAOK,KAAK,iBAAiBC,MAAM,WACzC9V,EAAE6I,MAAMkN,YAIVL,2BAA4B,WAC3B,IAAIzF,EAAKpH,KAETA,KAAKO,OAAO4M,mBAAmBrV,GAAG,UAAW,WAE5CX,EAAEiM,KAAKgE,EAAGhK,IAAInE,IAAIwT,SAAU,SAAUW,EAAO9M,GAC5C,GAAmB,GAAfA,EAAK+M,OAGR,OAFAjG,EAAG7G,OAAOvD,YACVoK,EAAGkG,sBAOPR,cAAe,WACd3V,EACE6I,KAAK2M,OAAOY,QACdpW,EAAE6I,KAAK2M,OAAOlV,KAAKR,OAAOuW,gBAAgB,cAAexN,KAAK5C,IAAInE,MAClE+G,KAAKyN,uBACLzN,KAAK0N,sBACL1N,KAAK2N,gBAGNC,uBAAwB,WAGpB5N,KAAK5C,IAAInE,IAAI4U,cAAgB,IAFvB7N,KAGL8N,YAHK9N,KAGY/G,IAAI8U,oBAGzB/N,KAAKyM,SAAWxV,OAAOoI,MAAMqL,UAAU1K,KAAK5C,IAAInE,IAAK,qBAAsB,YAC3E+G,KAAKyM,SAASuB,gBAAkBhO,KAAKO,OAAOzG,YAAYkU,gBAAgBvR,YACxEuD,KAAKyM,SAASY,OAAS9J,IAAIvD,KAAK8N,cAGjCL,qBAAsB,WACrB,IAAIrG,EAAKpH,KACLiO,EAAqB9W,EAAE6I,KAAK2M,OAAOK,KAAK,uBAAuBO,QAChEvN,KAAK5C,IAAInE,IAAIwT,SAASlS,OACxBpD,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAIwT,SAAU,SAASW,EAAO9M,GAC7CnJ,EAAEF,OAAOuW,gBAAgB,mBACxBQ,gBAAiB1N,EAAK0N,gBACtBX,OAAQ/M,EAAK+M,OACba,IAAK5N,EAAK4N,IACV5U,SAAU8N,EAAGhK,IAAInE,IAAIK,SACrBqK,KAAMrD,EAAKqD,QACRtI,SAAS4S,GAEI,QAAb3N,EAAKqD,MAAkBrD,EAAK+M,QAAUjG,EAAGhK,IAAInE,IAAIkV,cACpD/G,EAAG8G,IAAM5N,EAAK4N,IACd9G,EAAGgH,cAAgBjX,EAAEiQ,EAAGuF,OAAOK,KAAKqB,KAAK,wBAAwBH,IAAO9G,EAAG8G,OAC3E9G,EAAGkH,yBACHlH,EAAGmH,8BAILpX,EAAE,kDAAkDkE,SAAS4S,IAI/DO,uBAAwB,WACvBxO,KAAKoO,cAAgBjX,EAAE6I,KAAK2M,OAAOK,KAAKqB,KAAK,wBAAwBH,IAAOlO,KAAKkO,OACjFlO,KAAKsO,yBACLtO,KAAK8N,YAAc,EAChB9N,KAAK5C,IAAInE,IAAI8U,mBAAqB,GAAsC,GAAjCxK,IAAIvD,KAAKoO,cAAc1R,QAEhEsD,KAAK8N,YAAcvK,IAAIvD,KAAK5C,IAAInE,IAAI8U,mBAAqB/N,KAAK5C,IAAInE,IAAIwV,gBAAiBC,UAAU,uBACjG1O,KAAKoO,cAAc1R,IAAIgB,gBAAgBsC,KAAK8N,YAAa9N,KAAK5C,IAAInE,IAAIK,WACtE0G,KAAK2O,yBACGpL,IAAIvD,KAAKoO,cAAc1R,OAAS,IAExCsD,KAAK8N,YAAcvK,IAAIvD,KAAKoO,cAAc1R,QAE3CsD,KAAKoO,cAAclB,SACnBlN,KAAKuO,4BAGNb,oBAAqB,WACpB1N,KACK8N,YAAc,GACnB9N,KAAK4O,0BACL5O,KAAK6O,2BAGND,wBAAyB,WACxB,IAAIxH,EAAKpH,KACT7I,EAAE6I,KAAK2M,OAAOK,KAAK,oBAAoBC,MAAM,WAC5C7F,EAAG8G,IAAM/W,EAAE6I,MAAMpI,KAAK,OACtBwP,EAAGoH,2BAGJrX,EAAE6I,KAAK2M,OAAOK,KAAK,iBAAiBC,MAAM,WACzC7F,EAAG8G,IAAM/W,EAAE6I,MAAMpI,KAAK,OACtBwP,EAAGoH,yBACHpH,EAAG0H,oBAAmB,KAGvB3X,EAAE6I,KAAK2M,OAAOK,KAAK,qBAAqB+B,OAAO,WAC9C3H,EAAG4H,iBAAiBzL,IAAIpM,EAAE6I,MAAMtD,OAAQgS,UAAU,uBAGnDvX,EAAE6I,KAAK2M,OAAOK,KAAK,kBAAkB+B,OAAO,WAC3C3H,EAAGyG,cAActK,IAAIpM,EAAE6I,MAAMtD,OAAQgS,UAAU,qBAIjDJ,uBAAwB,WACvB,IACIW,EAAe9X,EAAE6I,KAAK2M,OAAOK,KAAKqB,KAAK,mCAAmCH,IAAOlO,KAAKkO,OAC1F/W,EAAE6I,KAAK2M,OAAOK,KAAK,oBAAoBkC,YAAY,yBACnDD,EAAaE,SAAS,yBACtBhY,EAAE6I,KAAK2M,OAAOK,KAAK,WAAWpV,KAAK,YAAY,GAC/CoI,KAAKoO,cAAcxW,KAAK,YAAY,IAGrCiX,wBAAyB,WACxB,IAAIzH,EAAKpH,KACT7I,EAAE6I,KAAK2M,OAAOK,KAAK,qBAAqBC,MAAM,WAC7C7F,EAAG0G,aAAe3W,EAAE6I,MAAMoP,OAC1BhI,EAAGgH,cAAc1R,IAAIgB,gBAAgB0J,EAAG0G,YAAa1G,EAAGhK,IAAInE,IAAIK,WAChE8N,EAAG8G,IAAM9G,EAAGgH,cAAcxW,KAAK,OAC/BwP,EAAG0H,uBAGJ3X,EAAE6I,KAAK2M,OAAOK,KAAK,eAAeC,MAAM,WACvC7F,EAAG0G,YAAerH,KAAKlD,IAAI6D,EAAGgH,cAAc1R,QAAQ2S,MAAM,GAAI,GAC9DjI,EAAGgH,cAAc1R,IAAIgB,gBAAgB0J,EAAG0G,YAAa1G,EAAGhK,IAAInE,IAAIK,WAChE8N,EAAG8G,IAAM9G,EAAGgH,cAAcxW,KAAK,OAC/BwP,EAAG0H,wBAKLP,yBAA0B,WACzB,IAAInH,EAAKpH,KACTA,KAAKoO,cAAcW,OAAO,WACzB3H,EAAG0G,YAAevK,IAAIpM,EAAE6I,MAAMtD,QAAU,EACxC0K,EAAGgH,cAAc1R,IAAIgB,gBAAgB0J,EAAG0G,YAAa1G,EAAGhK,IAAInE,IAAIK,WAChE8N,EAAG8G,IAAM9G,EAAGgH,cAAcxW,KAAK,OAC/BwP,EAAGuH,2BAILhB,aAAc,WACb,IAAIvG,EAAKpH,KACT7I,EAAE6I,KAAK2M,OAAOK,KAAK,QAAQC,MAAM,SAAS/L,GACzCA,EAAEoO,kBACFlI,EAAG8G,IAAM/W,EAAE6I,MAAMpI,KAAK,OACtBwP,EAAGgH,cAAgBjX,EAAEiQ,EAAGuF,OAAOK,KAAKqB,KAAK,wBAAwBH,IAAO9G,EAAG8G,OAC3E9G,EAAG0G,YAAc,EACjB1G,EAAGgH,cAAc1R,IAAI,GACrB0K,EAAGkH,yBACHlH,EAAGuH,2BAILK,iBAAkB,SAASA,GAC1BhP,KAEK5C,IAAInE,IAAI+V,iBAAmBzL,IAAIyL,EAAkBN,UAAU,qBAChE1O,KAAK5C,IAAInE,IAAIsW,sBAAwBhM,IAAIvD,KAAK5C,IAAInE,IAAI+V,iBAAmBhP,KAAK5C,IAAInE,IAAIwV,gBACrFC,UAAU,0BACX1O,KAAKwP,8BAA6B,GAClCxP,KAAKyP,gBAGN5B,cAAe,SAASA,GACvB7N,KAEK5C,IAAInE,IAAI4U,cAAgBtK,IAAIsK,EAAea,UAAU,kBAC1D1O,KAAK0P,6BACL1P,KAAKyP,gBAGNX,mBAAoB,SAASa,GAC5B,IAAIvI,EAAKpH,KACT,GAAGkI,SAAS,gBAAiB,oBAAqBlI,KAAKkO,KAAK,CAC3D,IAAIxJ,EAAQ0C,EAAGgH,cAAc1R,MAChB,iBAAV0K,EAAG8G,IACL9G,EAAGyG,cAAcnJ,IAEA,GAAdnB,IAAImB,IAAeiL,GAAoBvI,EAAGhK,IAAInE,IAAI8U,mBAAqB,IACzErJ,EAAQnB,IAAI6D,EAAGhK,IAAInE,IAAI8U,mBAAqB3G,EAAGhK,IAAInE,IAAIwV,gBAAiBC,UAAUtH,EAAG8G,OAEtF9G,EAAG4H,iBAAiBtK,SAGrB1E,KAAK2O,yBAIPA,sBAAuB,WACtB,IAAIvH,EAAKpH,KAET7I,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAIwT,SAAU,SAASW,EAAO9M,GAC1CzF,KAAKuM,EAAG8G,MAAQrT,KAAKyF,EAAK4N,OAC5B5N,EAAK+M,OAAS9J,IAAI6D,EAAGgH,cAAc1R,MAAO,MAI5CsD,KAAKwP,8BAA6B,GAClCxP,KAAKyP,gBAGNA,aAAc,WACbtY,EACE6I,KAAK2M,OAAOK,KAAK,qBAAqBtQ,IAAIgB,gBAAgBsC,KAAK5C,IAAInE,IAAI+V,iBAAkBhP,KAAK5C,IAAInE,IAAIK,WACxGnC,EAAE6I,KAAK2M,OAAOK,KAAK,gBAAgBoC,KAAK1R,gBAAgBsC,KAAK5C,IAAInE,IAAIkV,YAAanO,KAAK5C,IAAInE,IAAIK,WAC/FnC,EAAE6I,KAAK2M,OAAOK,KAAK,kBAAkBtQ,IAAIgB,gBAAgBsC,KAAK5C,IAAInE,IAAI4U,cAAe7N,KAAK5C,IAAInE,IAAIK,WAClGnC,EAAE6I,KAAK2M,OAAOK,KAAK,uBAAuBoC,KAAK1R,gBAAgBsC,KAAK5C,IAAInE,IAAI8U,mBAAoB9W,OAAOiC,QAAQ,WAAY8G,KAAK5C,IAAInE,IAAIF,SAASI,mBACjJ6G,KAAK4P,oBCzOP/W,QAAQgX,iBAAmBhX,QAAQ4T,SAASzU,QAC3CqP,MAAO,aACPyI,2BAA4B,SAASvK,GAYpC,GAVuB,cAApBA,EAAKwK,YACPxK,EAAKyK,iBAAmBzM,IAAIgC,EAAK0K,iBAC9B1M,IAAIgC,EAAK0K,kBAAqB1M,IAAIgC,EAAK2K,uBAAyB,MAEnE3K,EAAKyK,iBAAmBzM,IAAIgC,EAAK0K,iBAAmB1M,IAAIgC,EAAK2K,uBAC7D3K,EAAK4K,sBAAwB5M,IAAIgC,EAAKyK,kBAAoBzM,IAAIvD,KAAK5C,IAAInE,IAAIwV,kBAG5ElJ,EAAK6K,KAAO7M,IAAIgC,EAAKyK,iBAAmBtB,UAAU,OAAQnJ,IAEvDA,EAAK8K,oBAAoB,CAC3B,IAAIC,EAAiB/M,IAAIgC,EAAKyK,kBAAoBzM,IAAIgC,EAAK8K,qBAAuB,IAClF9K,EAAK6K,KAAO7M,IAAKgC,EAAqB,mBAAsBmJ,UAAU,OAAQnJ,MAIhFgL,2BAA4B,SAASzB,GACpC9O,KAAKwQ,yBAA0B,EAC/BxQ,KAAKyQ,8BACLzQ,KAAK0Q,4BAGFxI,SAAS,gBAAiB,oBAAqBlI,KAAK5C,IAAInE,IAAIU,UAC3DqG,KAAK5C,IAAInE,IAAI2S,UAAY,IAAM5L,KAAK5C,IAAInE,IAAIsD,WAC/CyD,KAAK2Q,wBAAwB7B,GAI3B5G,SAAS,YAAa,cAAe,gBAAiB,iBAAkBlI,KAAK5C,IAAInE,IAAIU,WACvFqG,KAAK4Q,uBACL5Q,KAAK6Q,0BAGN7Q,KAAK5C,IAAI0T,kBAGVJ,0BAA2B,WACtBzZ,OAAO4L,KAAKC,aAAa9C,KAAK5C,IAAInE,IAAIU,QAAS,qBAClDqG,KAAK+Q,sBACL/Q,KAAKgR,0BAIPP,4BAA6B,WAC5BzQ,KAAKiR,2BACLjR,KAAKkR,wBACLlR,KAAKmR,mBACLnR,KAAKoR,2BACLpR,KAAKqR,sBACLrR,KAAKsR,kBACLtR,KAAKuR,2CACLvR,KAAKwR,mBACLxR,KAAKyR,YAGNR,yBAA0B,WACzBjR,KAAK5C,IAAInE,IAAIwV,gBAAkBlL,IAAIvD,KAAK5C,IAAInE,IAAIwV,gBAAiB,QAAYC,UAAU,mBAAqB,GAC5G,IAAIgD,EAAwBza,OAAO4L,KAAK+C,UAAU5F,KAAK5C,IAAInE,IAAIU,QAAS,kBACvEqG,KAAK5C,IAAInE,IAAI1B,MACVoa,EAAmB3R,KAAK4R,uBAExB5R,KAAK5C,IAAInE,IAAIwV,kBACbzO,KAAK5C,IAAInE,IAAIK,UAAYqY,EAC3B3R,KAAK5C,IAAI5C,UAAU,kBAAmB,GAEtCvD,OAAO0O,MAAM0I,KAAK,4BACjBvW,GAAG,qEACJ,oBAAsBA,GAAG,QAAU,mBAClC4Z,sBAAyBA,EACzBG,cAAiB7R,KAAK5C,IAAInE,IAAIK,SAC9BwY,YAAeH,OAOnBT,sBAAuB,WACtB,IAAI9J,EAAKpH,KAEJA,KAAKwQ,yBACTrZ,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAW,UAAS,SAASuF,EAAG+G,GAC/CtO,OAAOoI,MAAM0S,gBAAgBxM,GAC7BA,EAAKyM,SAAWzM,EAAK6K,KACrB7K,EAAK8H,OAAS9J,IAAIgC,EAAK6K,KAAO7K,EAAK5D,IAAK+M,UAAU,SAAUnJ,IAC5DA,EAAK0M,WAAa1M,EAAK8H,OACvB9H,EAAK2M,gBAAkB,EACvB3M,EAAK4M,aAAe5O,IAAIgC,EAAK6M,gBAAkB7M,EAAK8M,WAEpDjL,EAAGkL,wBAAwB/M,GAAO,kBAAmB,OAAQ,SAAU,WAAY,kBAKtF+M,wBAAyB,SAASrZ,EAAK6C,GACtC,IAAIsL,EAAKpH,KACT7I,EAAEiM,KAAKtH,EAAQ,SAAS0C,EAAG+T,GAC1BtZ,EAAI,QAAQsZ,GAAKhP,IAAIA,IAAItK,EAAIsZ,GAAI7D,UAAU6D,EAAGtZ,IAAQmO,EAAGhK,IAAInE,IAAIwV,gBAAiBC,UAAU,QAAU6D,EAAGtZ,OAI3GkY,iBAAkB,WACjB,IAAI/J,EAAKpH,KAET7I,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAW,UAAS,SAASuF,EAAGgU,GAC/CA,EAAIC,wBACJ,IAAIC,GAAc,QAAS,mCAC1B,8BAA+B,+BAC/B,gCAAiC,yCAEL,UAAzBjM,KAAK+L,EAAIG,cACVvL,EAAGoJ,yBAAyD,eAA9BpJ,EAAGhK,IAAInE,IAAI2Z,mBAC3CF,EAAWrQ,KAAK,cAGjBlL,EAAEiM,KAAKsP,EAAY,SAASlU,EAAGxC,GAAawW,EAAIxW,GAAa,KAExDgE,KAAKwQ,yBAA2BxX,UACpCA,QAAQ6Z,QAAQC,2BAA2BN,EAAI7Y,QAAS6Y,EAAIjb,MAC5D6P,EAAG2L,uBAAuBP,IAE3Bvb,OAAOoI,MAAM0S,gBAAgBS,MAI/BpB,yBAA0B,WACzB,IAAIhK,EAAKpH,KAELgT,GAAoB,EACxB7b,EAAEiM,KAAKgE,EAAGhK,IAAInE,IAAW,UAAS,SAASuF,EAAGiD,GAC1C5G,KAAK4G,EAAIwR,0BAAyBD,GAAoB,KAEpC,GAAnBA,GAEH7b,EAAEiM,KAAKgE,EAAGhK,IAAInE,IAAW,UAAS,SAASia,EAAG3N,GAC7C,IAAI4N,EAAe/L,EAAGgM,oBAAoB7N,EAAK8N,eAC3CC,EAAyB,EAE7Bnc,EAAEiM,KAAKgE,EAAGhK,IAAInE,IAAW,UAAS,SAASuF,EAAGgU,GAC7CA,EAAIe,8BAAgCnM,EAAGoM,yBAAyBhB,EAAKW,GAGpEX,EAAIiB,sCADC,GAAHjV,EAC0C,EAAIgU,EAAIe,8BAGnDnM,EAAGhK,IAAInE,IAAW,MAAEuF,EAAE,GAAGiV,sCACzBjB,EAAIe,8BAGND,GAA0Bd,EAAIe,gCAG5BD,IAA2BlM,EAAGoJ,0BAChCjL,EAAK0M,WAAa1O,IAAIgC,EAAK8H,QAAU,EAAIiG,IACzC/N,EAAKyM,SAAWzO,IAAIgC,EAAK0M,WAAa1M,EAAK5D,IAAK+M,UAAU,WAAYnJ,IAEtE6B,EAAGkL,wBAAwB/M,GAAO,WAAY,mBAKjDiO,yBAA0B,SAAShB,EAAKW,GAGvC,IAAIO,EAAuB,EAE3B,GAAG7Y,KAAK2X,EAAIS,wBAAyB,CACpC,IAAIU,EAAW3T,KAAK4T,cAAcpB,EAAKW,GAEjB,gBAAnBX,EAAIG,YACNe,EAAwBC,EAAW,IAEP,0BAAnBnB,EAAIG,YACbe,EAAwBC,EAAW,IAClC3T,KAAK5C,IAAInE,IAAW,MAAE4B,KAAK2X,EAAIqB,QAAU,GAAGN,8BAEjB,yBAAnBf,EAAIG,cACbe,EAAwBC,EAAW,IAClC3T,KAAK5C,IAAInE,IAAW,MAAE4B,KAAK2X,EAAIqB,QAAU,GAAGJ,uCAO/C,OAHGjB,EAAIsB,iBACNJ,GAA+C,UAAtBlB,EAAIsB,gBAA+B,EAAM,GAE5DJ,GAGRE,cAAe,SAASpB,EAAKW,GAC5B,OAAgE,GAAxD/Y,OAAOC,KAAK8Y,GAAcY,QAAQvB,EAAIwB,cAC7CzQ,IAAI4P,EAAaX,EAAIwB,cAAetF,UAAU,OAAQ8D,IAAQA,EAAIpC,MAGpEiB,oBAAqB,WACpB,IAAIjK,EAAKpH,KACTA,KAAK5C,IAAInE,IAAIgb,MAAQjU,KAAK5C,IAAInE,IAAIib,WAAalU,KAAK5C,IAAInE,IAAIkb,UAAYnU,KAAK5C,IAAInE,IAAImb,eAAiB,EAEtGjd,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAW,UAAS,SAASuF,EAAG+G,GAC/C6B,EAAGhK,IAAInE,IAAIgb,OAAS1O,EAAK8H,OACzBjG,EAAGhK,IAAInE,IAAIib,YAAc3O,EAAK8O,YAC9BjN,EAAGhK,IAAInE,IAAIkb,WAAa5O,EAAK0M,WAC7B7K,EAAGhK,IAAInE,IAAImb,gBAAkB7O,EAAK+O,kBAInCrd,OAAOoI,MAAM0S,gBAAgB/R,KAAK5C,IAAInE,KAAM,QAAS,aAAc,YAAa,oBAGjFqY,gBAAiB,WAChB,IAAIlK,EAAKpH,KACTA,KAAK5C,IAAInE,IAAIsb,oBAAsB,EACnC,IAAIC,KAGJrd,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAW,UAAS,SAASuF,EAAGgU,GACxB,UAAnBA,EAAIG,cACP6B,EAAgBhC,EAAItE,KAAO3K,IAAIiP,EAAIiC,WAAY/F,UAAU,aAAc8D,OAIzErb,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAW,UAAS,SAASia,EAAG3N,GAC/C,IAAI4N,EAAe/L,EAAGgM,oBAAoB7N,EAAK8N,eAC/Clc,EAAEiM,KAAKgE,EAAGhK,IAAInE,IAAW,UAAS,SAASuF,EAAGgU,GAE7C,IAAIkC,EAAqBtN,EAAGuN,uBAAuBpP,EAAMiN,EAAKW,GAGvC,UAAnBX,EAAIG,cACP6B,EAAgBhC,EAAItE,MAAQwG,EACxBxB,GAAK9L,EAAGhK,IAAInE,IAAW,MAAEsB,OAAS,IACrCma,GAAsBF,EAAgBhC,EAAItE,OAKrB,UAAnBsE,EAAIG,aACLvL,EAAGoJ,yBAAyD,eAA9BpJ,EAAGhK,IAAInE,IAAI2Z,oBAC3CJ,EAAIiC,YAAcC,GAKnBlC,EAAIoC,4BAA8BF,EAGlClC,EAAIqC,kCAAoCH,EAGrClC,EAAIsC,WAGNJ,EAAsC,aAAhBlC,EAAIsC,SAA2B,EAAMJ,EAE3DA,GAA6C,UAAtBlC,EAAIsB,gBAA+B,EAAM,GAMhEtB,EAAIuC,6BADC,GAAHvW,EACiC+E,IAAIgC,EAAK0M,WAAayC,GAGxDnR,IAAI6D,EAAGhK,IAAInE,IAAW,MAAEuF,EAAE,GAAGuW,6BAA+BL,GAI1DxB,GAAK9L,EAAGhK,IAAInE,IAAW,MAAEsB,OAAS,IACrC6M,EAAG4N,iBAAiBxC,GAGpBpL,EAAG6N,qBAAqBzW,EAAGgU,GAE3BpL,EAAGkL,wBAAwBE,GACzB,QAAS,aAAc,qCAGpBhU,GAAK4I,EAAGhK,IAAInE,IAAW,MAAEsB,OAAS,GAAM6M,EAAGoJ,yBACZ,eAAhCpJ,EAAGhK,IAAInE,IAAI2Z,mBAAsCxL,EAAGhK,IAAInE,IAAIic,kBAC/D9N,EAAGhK,IAAInE,IAAIsb,oBAAsBhR,IAAI6D,EAAGhK,IAAInE,IAAIkc,YAC/C5R,IAAI6D,EAAGhK,IAAInE,IAAIic,iBAAmB1C,EAAIyB,MAAOvF,UAAU,+BAO7DuG,qBAAsB,SAASG,EAAS5C,GACvC,IAAIiC,EAAajC,EAAIqC,iCACD,aAAhBrC,EAAIsC,WACPL,EAAa,GAGY,UAAtBjC,EAAIsB,iBAA8BW,IAAc,GAGnDjC,EAAIyB,MADO,GAATmB,EACU7R,IAAIvD,KAAK5C,IAAInE,IAAIkb,UAAYM,EAAY/F,UAAU,QAAS8D,IAE5DjP,IAAIvD,KAAK5C,IAAInE,IAAW,MAAEmc,EAAQ,GAAGnB,MAAQQ,EAAY/F,UAAU,QAAS8D,KAI1FY,oBAAqB,SAASC,GAC7B,OAAOA,EAAgBgC,KAAKC,MAAMjC,OAGnCsB,uBAAwB,SAASpP,EAAMiN,EAAKW,GAC3C,IAAIQ,EAAW3T,KAAK4T,cAAcpB,EAAKW,GACnCuB,EAAqB,EAEzB,GAAsB,UAAnBlC,EAAIG,YAAyB,CAE/B,IAAI4C,EAAShS,IAAIiP,EAAIiC,WAAY/F,UAAU,aAAc8D,IACzDkC,EAAqB1U,KAAK5C,IAAInE,IAAIkb,UAC/B5O,EAAK0M,WAAajS,KAAK5C,IAAInE,IAAIkb,UAAaoB,EAAU,MAE7B,gBAAnB/C,EAAIG,YACb+B,EAAsBf,EAAW,IAASpO,EAAK0M,WACnB,0BAAnBO,EAAIG,YACb+B,EAAsBf,EAAW,IAChC3T,KAAK5C,IAAInE,IAAW,MAAE4B,KAAK2X,EAAIqB,QAAU,GAAGe,4BAEjB,yBAAnBpC,EAAIG,cACb+B,EAAsBf,EAAW,IAChC3T,KAAK5C,IAAInE,IAAW,MAAE4B,KAAK2X,EAAIqB,QAAU,GAAGkB,8BAK9C,OAFA/U,KAAKwV,kBAAkBjQ,EAAMiN,EAAKmB,EAAUe,GAErCA,GAGRc,kBAAmB,SAASjQ,EAAMiN,EAAKmB,EAAUe,GAEhD,IAAIe,EAAMlQ,EAAKlJ,WAAakJ,EAAKZ,UAC7B+Q,EAAuBhB,EAAqB1U,KAAK5C,IAAInE,IAAIwV,gBACzD+D,EAAIC,sBAAwBD,EAAIC,qBAAqBgD,KACxDC,GAAwBlD,EAAIC,qBAAqBgD,GAAK,IAEvDjD,EAAIC,qBAAqBgD,IAAQ9B,EAAUpQ,IAAImS,EAAsBhH,UAAU,kBAAmB8D,MAGnGwC,iBAAkB,SAASxC,GAC1BA,EAAIiC,WAAalR,IAAIiP,EAAIiC,WAAY/F,UAAU,aAAc8D,IAC7DA,EAAIqC,iCAAmCtR,IAAIiP,EAAIqC,iCAAkCnG,UAAU,aAAc8D,KAG1GjB,yCAA0C,WAGzC,GAAIvR,KAAK5C,IAAInE,IAAW,OAAK+G,KAAK5C,IAAInE,IAAW,MAAEsB,OAAQ,CAC1D,IAAIob,GAAoB,EAIxB,GAHAxe,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAI2c,UAAa,SAASpX,EAAG9E,GACzCmB,KAAKnB,EAAEuZ,0BAAyB0C,GAAoB,KAEpDA,EAAmB,CACtB,IAAIE,EARG7V,KAQW5C,IAAInE,IAAW,MAAEoW,OAAO,GAAG,GACzCyG,EAA2B7e,OAAOiG,MAAM6Y,IAAI5e,EAAEyC,IAAIoG,KAAK5C,IAAInE,IAAI2c,UAClE,SAASlc,GACR,IAAIA,EAAEuZ,uBACL,OAAO1P,IAAI7J,EAAEmb,qCAIZmB,EAhBGhW,KAgBO5C,IAAInE,IAAIgb,MAAQ6B,EAC3BvS,IAAIsS,EAAS5B,MAAOvF,UAAU,gBAE5BsH,GAAQC,KAAKC,IAAIF,IAAU,EAAMC,KAAKE,IAAI,GAAIzH,UAAU,aAAcmH,MAC1E7V,KAAK5C,IAAInE,IAAIsb,oBAAsBhR,IAAIA,IAAIvD,KAAK5C,IAAInE,IAAIsb,qBAAuByB,EAC9EtH,UAAU,4BAMf8C,iBAAkB,WAEjB,IAAIpK,EAAKpH,KACLoW,EAAYpW,KAAK5C,IAAInE,IAAW,MAAI+G,KAAK5C,IAAInE,IAAW,MAAEsB,OAAS,EACvEyF,KAAK5C,IAAInE,IAAIkc,YAAc5R,IAAI6S,EAC5BpW,KAAK5C,IAAInE,IAAW,MAAEmd,EAAY,GAAGnC,MAAQ1Q,IAAIvD,KAAK5C,IAAInE,IAAIsb,qBAC9DvU,KAAK5C,IAAInE,IAAIkb,WAEbjM,SAAS,YAAa,cAAe,gBAAiB,iBAAkBlI,KAAK5C,IAAInE,IAAIU,SACvFqG,KAAK5C,IAAInE,IAAIod,iBAAoBrW,KAAK5C,IAAInE,IAA2B,wBACpEsK,IAAIvD,KAAK5C,IAAInE,IAAIkc,YAAcnV,KAAK5C,IAAInE,IAAIwV,iBAAmBzO,KAAK5C,IAAInE,IAAImb,gBAG7EpU,KAAK5C,IAAInE,IAAIqd,wBAA0BtW,KAAK5C,IAAInE,IAAIsd,2BAA6B,EAC9EH,IACFjf,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAW,UAAS,SAASuF,EAAGgU,GAC3CtK,SAAS,sBAAuB,SAAUsK,EAAIsC,YACxB,OAAtBtC,EAAIsB,eACN1M,EAAGhK,IAAInE,IAAIqd,yBAA2B/S,IAAIiP,EAAIqC,kCAE9CzN,EAAGhK,IAAInE,IAAIsd,4BAA8BhT,IAAIiP,EAAIqC,qCAKpD5d,OAAOoI,MAAM0S,gBAAgB/R,KAAK5C,IAAInE,KACpC,0BAA2B,gCAG9B+G,KAAK5C,IAAInE,IAAIod,iBAAmB9S,IAAKvD,KAAK5C,IAAInE,IAAIqd,yBAA2BtW,KAAK5C,IAAInE,IAAIsd,2BACzFhT,IAAIvD,KAAK5C,IAAInE,IAAIkc,YAAcnV,KAAK5C,IAAInE,IAAIwV,iBAAmBzO,KAAK5C,IAAInE,IAAImb,gBAE7EpU,KAAKsS,wBAAwBtS,KAAK5C,IAAInE,KACpC,0BAA2B,gCAG9B+G,KAAK5C,IAAInE,IAAIud,wBAA0BjT,IAAIvD,KAAK5C,IAAInE,IAAIkc,YAAcnV,KAAK5C,IAAInE,IAAIkb,UAChF5Q,IAAIvD,KAAK5C,IAAInE,IAAIsb,qBAAsB7F,UAAU,4BAEpD1O,KAAKsS,wBAAwBtS,KAAK5C,IAAInE,KAAM,0BAA2B,wBAGvEhC,OAAOoI,MAAM0S,gBAAgB/R,KAAK5C,IAAInE,KAAM,cAAe,qBAG3D+G,KAAKyW,qBAGNA,kBAAmB,WAClB,IAAIC,EAAwB,EAO5B,GANGzf,OAAO4L,KAAKC,aAAa9C,KAAK5C,IAAInE,IAAIU,QAAS,wBAAyBqG,KAAK5C,IAAInE,IAAI1B,MACvFmf,EAAwB1W,KAAK5C,IAAInE,IAAIyd,sBAC3Bzf,OAAO+N,aAAa0R,wBAC9BA,EAAwBzf,OAAO+N,aAAa0R,uBAGzC7b,KAAK6b,GAGR,OAFA1W,KAAK5C,IAAInE,IAAI0d,cAAgB,OAC7B3W,KAAK5C,IAAInE,IAAI2d,mBAAqB,GAIhC3f,OAAO4L,KAAKC,aAAa9C,KAAK5C,IAAInE,IAAIU,QAAS,gBAAiBqG,KAAK5C,IAAInE,IAAI1B,QAC/EyI,KAAK5C,IAAInE,IAAI0d,cAAgBE,0CAA0C7W,KAAK5C,IAAInE,IAAIkc,YACnFnV,KAAK5C,IAAInE,IAAIK,SAAUoV,UAAU,kBAClC1O,KAAK5C,IAAInE,IAAIsb,qBAAuBhR,IAAIvD,KAAK5C,IAAInE,IAAI0d,cAAgB3W,KAAK5C,IAAInE,IAAIkc,YACjFzG,UAAU,wBAEX1O,KAAKsS,wBAAwBtS,KAAK5C,IAAInE,KAAM,sBAAuB,oBAIrEwY,SAAU,WAWT,GAVAzR,KAAK5C,IAAInE,IAAI6d,cAAgB9W,KAAK5C,IAAInE,IAAI8d,SAAW,GAElD/W,KAAK5C,IAAInE,IAAW,OAAK+G,KAAK5C,IAAInE,IAAW,MAAEsB,SAC7CtD,OAAO4L,KAAKC,aAAa9C,KAAK5C,IAAInE,IAAW,MAAE,GAAGU,QAAS,kBAAmBqG,KAAK5C,IAAIzD,UAC1FxC,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAW,UAAS,SAASuF,EAAG+G,UACxCA,EAAsB,mBAK7BvF,KAAK5C,IAAInE,IAAW,OAAK+G,KAAK5C,IAAInE,IAAW,MAAEsB,OAAQ,CACzD,IAAIyc,GAAoB,8BAA+B,+BACtD,gCAAiC,yCAE9B/f,OAAO4L,KAAKC,aAAa9C,KAAK5C,IAAInE,IAAW,MAAE,GAAGU,QAAS,mCAAoCqG,KAAK5C,IAAIzD,UAC3Gqd,EAAiB3U,KAAK,oCAGvBlL,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAW,UAAS,SAASuF,EAAGgU,GAC/Crb,EAAEiM,KAAK4T,EAAkB,SAASxY,EAAGxC,UAC7BwW,EAAIxW,KAGZwW,EAAIC,qBAAuB4C,KAAK4B,UAAUzE,EAAIC,0BAKjD1B,oBAAqB,WACjB/Q,KAAK5C,IAAInE,IAAIie,iCACflX,KAAK5C,IAAInE,IAAIic,gBAAkB3R,IAAIA,IAAIvD,KAAK5C,IAAInE,IAAIhC,OAAOkgB,MAAMnX,KAAK5C,IAAInE,IAAI2Z,qBAC3E5S,KAAK5C,IAAInE,IAAIie,+BAAiC,IAAKxI,UAAU,sBAIlEsC,sBAAuB,WACtB,IAAI5J,EAAKpH,KACLoX,EAAqB,EAGzB,GAFApX,KAAK5C,IAAInE,IAAIoe,qBAAuB,EAEhCrX,KAAK5C,IAAInE,IAAIic,gBAAiB,CAC7BlV,KAAK5C,IAAInE,IAAI2Z,mBAChB3b,OAAO0O,MAAM7N,GAAG,oCAEjBkI,KAAK5C,IAAInE,IAAIoe,qBAAuB9T,IAAIvD,KAAK5C,IAAInE,IAAIic,gBAAkBlV,KAAK5C,IAAInE,IAAIwV,gBACnFC,UAAU,yBAEX,IAAI4I,EAA4BtX,KAAKuX,gCACjCpD,EAAY,EAEZmD,IACHngB,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAW,UAAS,SAASuF,EAAG+G,GAO/C,GANA6R,EAAqB7T,IAAI6D,EAAGhK,IAAInE,IAAIic,iBAAmB3P,EAAK0M,WAAaqF,EACzE/R,EAAK0M,WAAa1O,IAAIgC,EAAK0M,WAAamF,EACvC1I,UAAU,cAAenJ,IAC1B4O,GAAa5O,EAAK0M,cAGX7K,EAAGhK,IAAInE,IAAI2c,WAAarb,QAA2C,aAAhC6M,EAAGhK,IAAInE,IAAI2Z,oBAChDpU,IAAM4I,EAAGhK,IAAInE,IAAI0J,WAAapI,OAAS,EAAG,CAC9C,IAAIid,EAAuBjU,IAAI6D,EAAGhK,IAAInE,IAAIkb,UAAYA,EACnD/M,EAAGhK,IAAInE,IAAIic,gBAAiBxG,UAAU,cACzCnJ,EAAK0M,WAAa1O,IAAIgC,EAAK0M,WAAauF,EACvC9I,UAAU,aAAcnJ,IAE1BA,EAAKyM,SAAWzO,IAAIgC,EAAK0M,WAAa1M,EAAK5D,IAAK+M,UAAU,WAAYnJ,IACtE6B,EAAGkL,wBAAwB/M,GAAO,WAAY,iBAG/CvF,KAAKwQ,yBAA0B,EAC/BxQ,KAAKyQ,iCAKR8G,8BAA+B,WAC9B,GAAqC,aAAlCvX,KAAK5C,IAAInE,IAAI2Z,kBACf,OAAO5S,KAAK5C,IAAInE,IAAIkb,UAEpB,IAAIsD,EAAmB,EACnBC,KAiBJ,OAfAvgB,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAW,UAAS,SAASuF,EAAGgU,GAC/C,GAAuB,UAAnBA,EAAIG,YAAyB,CAChC,IAAI8B,EAA8B,aAAhBjC,EAAIsC,SAA2B,EAAMtC,EAAIiC,WAC3DA,GAAqC,UAAtBjC,EAAIsB,gBAA+B,EAAM,EACxD4D,EAAkBlF,EAAItE,KAAOuG,OACvB,GAAsC,OAAlCiD,EAAkBlF,EAAIqB,QAAkB,CAClD,IAAI8D,EAAoBpU,IAAImU,EAAkBlF,EAAIqB,SAAWtQ,IAAIiP,EAAIpC,MAAQ,IAC7EsH,EAAkBlF,EAAItE,KAAOyJ,KAI/BxgB,EAAEiM,KAAKsU,EAAmB,SAASjC,EAAK/Q,GACnCA,IAAO+S,GAAoB/S,KAGzBnB,IAAIvD,KAAK5C,IAAInE,IAAIkc,YAAcsC,EAAkB/I,UAAU,iBAIpEiC,wBAAyB,SAAS7B,GACjC,IAAI8I,EAAyB3gB,OAAOiG,MAAM6Y,IAAI5e,EAAEyC,IAAIoG,KAAK5C,IAAInE,IAAc,aAAS,SAAS4e,GAC5F,OAAOtU,IAAIsU,EAAIC,iBAAkBpJ,UAAU,mBAAoBmJ,OAEhE7X,KAAK5C,IAAInE,IAAI8e,cAAgBxU,IAAIqU,EAAwBlJ,UAAU,kBAEnE1O,KAAKwP,6BAA6BV,IAGnCU,6BAA8B,SAASV,GAStC,GAJ2B,iBAAxB9O,KAAK5C,IAAInE,IAAIU,SAA8BqG,KAAK5C,IAAInE,IAAIsD,WAC1DyD,KAAKgY,0BAGHhY,KAAK5C,IAAInE,IAAIsD,WAAayD,KAAK5C,IAAInE,IAAI2S,UAAY,KAEtD3U,OAAOoI,MAAM0S,gBAAgB/R,KAAK5C,IAAInE,KAAM,cAAe,gBAAiB,qBAEzEiP,SAAS,gBAAiB,oBAAqBlI,KAAK5C,IAAInE,IAAIU,UAAU,CACxE,IAAIwb,EAAcnV,KAAK5C,IAAInE,IAAI0d,eAAiB3W,KAAK5C,IAAInE,IAAIkc,YAE7D,GAAGnV,KAAK5C,IAAInE,IAAIgf,wBAA0BjY,KAAK5C,IAAInE,IAAIK,SACtD,IAAI4e,EAAsB3U,IAAK4R,EAAcnV,KAAK5C,IAAInE,IAAI8e,cACvD/X,KAAK5C,IAAInE,IAAI+V,iBAAmBN,UAAU,qBAEzCwJ,EAAsB3U,IACxBA,IAAI4R,EAAYnV,KAAK5C,IAAInE,IAAIwV,gBAAiBC,UAAU,gBACtD1O,KAAK5C,IAAInE,IAAI8e,cAAgB/X,KAAK5C,IAAInE,IAAIsW,sBAC7Cb,UAAU,qBAIZzX,OAAOoI,MAAM0S,gBAAgB/R,KAAK5C,IAAInE,KAAM,gBAC5C+G,KAAKsS,wBAAwBtS,KAAK5C,IAAInE,KAAM,gBAEzC+G,KAAK5C,IAAIqB,gBACXuB,KAAK5C,IAAIqB,cAAc,eACvBuB,KAAK5C,IAAIqB,cAAc,qBAGG,iBAAxBuB,KAAK5C,IAAInE,IAAIU,UACfqG,KAAKmY,oBAAoBD,EAAqBpJ,GAC9C9O,KAAKgY,yBAENhY,KAAKoY,0BAEL,IAAIjK,EAAenO,KAAK5C,IAAInE,IAAIgf,wBAA0BjY,KAAK5C,IAAInE,IAAIK,SACtE0G,KAAK5C,IAAInE,IAAIkV,YAAcnO,KAAK5C,IAAInE,IAAIof,iBAEzCrY,KAAK5C,IAAInE,IAAI8U,mBAAsBxK,IAAI2U,EAAsB3U,IAAI4K,GAChE5K,IAAIvD,KAAK5C,IAAInE,IAAI4U,cAAgB7N,KAAK5C,IAAInE,IAAIwV,iBAAkBC,UAAU,yBAI7EyJ,oBAAqB,SAASD,EAAqBpJ,GAClD,IAAI1H,EAAKpH,KACLsY,GAAiB,EAClBtY,KAAK5C,IAAInE,IAAIsf,cAAgCnU,IAArB0K,GAAkCA,IAC5D3X,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAc,aAAS,SAASmU,EAAO9M,GACnDA,EAAKQ,SAAWwX,GAAkBJ,EAAsB,GAC1D5X,EAAK+T,YAAc9Q,IAAI2U,EAAqBxJ,UAAU,gBACtDpO,EAAK+M,OAAS9J,IAAI2U,EAAsB9Q,EAAGhK,IAAInE,IAAIwV,gBAAiBC,UAAU,WAC9E4J,GAAiB,GACTlR,EAAGhK,IAAInE,IAAIkV,cACnB7N,EAAK+M,OAAS,MAMlB2K,sBAAuB,WACtB,IAAI5Q,EAAKpH,KACLmO,EAAc,EACdkK,EAAmB,EACpBrY,KAAK5C,IAAInE,IAAIsf,OACfphB,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAc,aAAS,SAASmU,EAAO9M,GACtDA,EAAK+T,YAAc9Q,IAAIjD,EAAK+M,OAASjG,EAAGhK,IAAInE,IAAIwV,gBAAiBC,UAAU,gBAC3EP,GAAe7N,EAAK+M,OACpBgL,GAAoB/X,EAAK+T,cAEhBrU,KAAK5C,IAAInE,IAAIsD,YACvByD,KAAK5C,IAAInE,IAAIwT,aAGdzM,KAAK5C,IAAInE,IAAIkV,YAAc5K,IAAI4K,EAAaO,UAAU,gBACtD1O,KAAK5C,IAAInE,IAAIof,iBAAmB9U,IAAI8U,EAAkB3J,UAAU,sBAGjE0J,wBAAyB,WAGxB,GAFApY,KAAK5C,IAAInE,IAAI4U,cAAgB,EAC7B7N,KAAK5C,IAAInE,IAAIuf,mBAAqB,EACP,iBAAxBxY,KAAK5C,IAAInE,IAAIU,SACZqG,KAAK5C,IAAInE,IAAIkV,YAAcnO,KAAK5C,IAAInE,IAAIkc,cAAgBnV,KAAK5C,IAAInE,IAAIsD,UAAW,CAEnF,IAAIkc,EAAgBthB,EAAEyC,IAAIoG,KAAK5C,IAAInE,IAAIwT,SAAU,SAAS/S,GAAK,OAAOA,EAAEiK,OACxE,GAAIuE,QAAQuQ,EAAe,QAAS,CACnC,IAAItD,EAAcnV,KAAK5C,IAAInE,IAAI0d,eAAiB3W,KAAK5C,IAAInE,IAAIkc,YACzDkB,EAAmBrW,KAAK5C,IAAInE,IAAI2d,oBAAsB5W,KAAK5C,IAAInE,IAAIod,iBAEvErW,KAAK5C,IAAInE,IAAI4U,cAAgBtK,IAAIvD,KAAK5C,IAAInE,IAAIkV,YAAcgH,EAC3DnV,KAAK5C,IAAInE,IAAI+V,iBAAkBN,UAAU,kBAE1C1O,KAAK5C,IAAInE,IAAIuf,mBAAqBjV,IAAIvD,KAAK5C,IAAInE,IAAIof,iBAClDhC,EAAmBrW,KAAK5C,IAAInE,IAAIsW,sBAChCb,UAAU,0BAKdgB,2BAA4B,WACxB1P,KAAK5C,IAAInE,IAAIkV,YAAcnO,KAAK5C,IAAInE,IAAIkc,aAC1CnV,KAAK5C,IAAInE,IAAI+V,iBAAmBzL,IAAIvD,KAAK5C,IAAInE,IAAIkc,YAAcnV,KAAK5C,IAAInE,IAAIkV,YACzEnO,KAAK5C,IAAInE,IAAI4U,cAAea,UAAU,qBAEzC1O,KAAK5C,IAAInE,IAAIsW,sBAAwBhM,IAAIvD,KAAK5C,IAAInE,IAAI+V,iBAAmBhP,KAAK5C,IAAInE,IAAIwV,gBACrFC,UAAU,2BAEX1O,KAAK5C,IAAInE,IAAIkV,YAAc,EAE5BnO,KAAKwP,8BAA6B,MCnqBpC3W,QAAQ6f,sBAAwB7f,QAAQgX,iBAAiB7X,QACxDqP,MAAO,WACNrH,KAAK2Y,SACL1hB,OAAO2hB,MAAMC,0BAA2B,EACxC5hB,OAAO0E,GAAGqI,KAAKtI,GAAGsE,KAAK5C,IAAIzD,QAAU,QAAS,OAAQ,SAASyD,EAAK6J,EAAKC,GACxE,IAAI3B,EAAOtO,OAAOiC,QAAQ+N,EAAKC,GAC3B4R,EAAmB7hB,OAAO4L,KAAKkW,UAAU9R,EAAK,eAElDhQ,OAAOoI,MAAM0S,gBAAgBxM,GAAO,OAAQ,oBAEzCA,EAAK0K,gBACJ1K,EAAK6K,KAAO7K,EAAK0K,iBAAmB6I,GAGtCvT,EAAK8K,oBAAsB,EAC3B9K,EAAKwK,YAAc,SACnBxK,EAAK2K,sBAAwB3M,IAAIgC,EAAK6K,KAAO7K,EAAK0K,gBACjDvB,UAAU,wBAAyBnJ,IACpCA,EAAKyK,iBAAmBzK,EAAK6K,OAE7B7K,EAAK8K,oBAAsB9M,IAA6C,KAAxC,EAAIgC,EAAK6K,KAAO7K,EAAK0K,iBACpDvB,UAAU,sBAAuBnJ,IAClCA,EAAKwK,YAAc,GACnBxK,EAAK2K,sBAAwB,EAC7B3K,EAAKyK,iBAAmB,IAGzBzK,EAAK8K,oBAAsB,EAC3B9K,EAAKwK,YAAc,GACnBxK,EAAK2K,sBAAwB,EAC7B3K,EAAKyK,iBAAmB,GAGzBhX,QAAQ6Z,QAAQmG,iBAAiBzT,GACjCvM,QAAQ6Z,QAAQtC,+BAMjBtZ,OAAO0E,GAAGqI,KAAKtI,GAAGsE,KAAK5C,IAAIyV,QAAQoG,UAAW,OAAQ,SAAS7b,EAAK6J,EAAKC,GACxElO,QAAQ6Z,QAAQtC,+BAGjBtZ,OAAO0E,GAAGqI,KAAKtI,GAAGsE,KAAK5C,IAAIyV,QAAQoG,UAAW,aAAc,SAAS7b,EAAK6J,EAAKC,GAC9ElO,QAAQ6Z,QAAQtC,+BAGjBtZ,OAAO0E,GAAGqI,KAAKtI,GAAGsE,KAAK5C,IAAIyV,QAAQoG,UAAW,SAAU,SAAS7b,EAAK6J,EAAKC,GAC1ElO,QAAQ6Z,QAAQtC,+BAGjBtZ,OAAO0E,GAAGqI,KAAKtI,GAAGsE,KAAK5C,IAAIyV,QAAQoG,UAAW,yBAA0B,SAAS7b,EAAK6J,EAAKC,GAC1FlO,QAAQ6Z,QAAQqG,qBAChBlgB,QAAQ6Z,QAAQtC,+BAGjBtZ,OAAO0E,GAAGqI,KAAKtI,GAAGsE,KAAK5C,IAAIzD,QAAS,oBAAqB,SAASyD,GAC9DA,EAAInE,IAAIie,+BACV9Z,EAAIyE,QAAQ,kCAEZ7I,QAAQ6Z,QAAQtC,+BAIlBtZ,OAAO0E,GAAGqI,KAAKtI,GAAGsE,KAAK5C,IAAIzD,QAAS,iCAAkC,SAASyD,GAC9E,GAAIA,EAAInE,IAAI2Z,kBAAZ,CAKAxV,EAAI+b,yBAA0B,EAE3B/b,EAAInE,IAAIie,gCAAkC9Z,EAAInE,IAAIic,kBAEpD9X,EAAInE,IAAIic,gBAAkB,EAC1B9X,EAAIyV,QAAQtC,8BAGb,IAAI0D,EAAQ1Q,IAAInG,EAAInE,IAAIhC,OAAOoI,MAAM8X,MAAM/Z,EAAInE,IAAI2Z,qBAC/CsC,EAAkB3R,IAAI0Q,EAAM1Q,IAAInG,EAAInE,IAAIie,gCAAkC,IAC7ExI,UAAU,oBAEXtR,EAAI5C,UAAU,kBAAmB0a,GAC/BpT,8BAAkB1E,EAAI+b,+BAjBvBliB,OAAOyM,SAAS5L,GAAG,gDAoBrBb,OAAO0E,GAAGqI,KAAKtI,GAAGsE,KAAK5C,IAAIzD,QAAS,kBAAmB,SAASyD,GAC/DA,EAAIyV,QAAQqG,qBAEP9b,EAAI+b,0BACR/b,EAAInE,IAAIie,+BAAiC,GAG1C9Z,EAAIyV,QAAQtC,+BAGb,IAAInJ,EAAKpH,KACNA,KAAK5C,IAAItD,YAAmB,MAAEwI,KAAK8W,UAAU,aAC/CpZ,KAAK5C,IAAIwJ,UAAU,WAAY,QAAS,SAAS3N,EAAKgO,EAAKC,GAC1D,OAAOE,EAAGiS,oBAAoBpgB,EAAKgO,EAAKC,KAKzClH,KAAK5C,IAAIwO,UAAY,GAClB5L,KAAK5C,IAAItD,YAAoC,wBAC7CkG,KAAK5C,IAAItD,YAA8B,kBACvCkG,KAAK5C,IAAInE,IAAIqgB,yBACZtZ,KAAK5C,IAAInE,IAAIsgB,iBAAiBhf,QAElCyF,KAAK5C,IAAIyE,QAAQ,0BAGf7B,KAAK5C,IAAItD,YAAmB,QAC9BkG,KAAmB,aAAIA,KAAKuQ,4BAG1BvQ,KAAK5C,IAAItD,YAAmB,QAC9BkG,KAAmB,aAAIA,KAAKwZ,sBAG1BxZ,KAAK5C,IAAItD,YAAoC,wBAC/CkG,KAAK5C,IAAIwJ,UAAU,yBAA0B,SAAS3N,GACrD,OACCmD,UACE,eAAgB,WAAY,IAAKpD,QAAQW,aAM3CqG,KAAK5C,IAAItD,YAA4B,gBACvCkG,KAAK5C,IAAIwJ,UAAU,iBAAkB,SAAS3N,GAC7C,IAAImD,GACHwP,UAAa,EACbrP,UAAa,EACbxD,QAAWE,EAAIF,SAKhB,OAHIqO,EAAGhK,IAAItD,YAAsB,UAAKb,EAAIoM,WAAUjJ,EAAkB,SAAInD,EAAIoM,UAC1E+B,EAAGhK,IAAItD,YAAsB,UAAKb,EAAIqM,WAAUlJ,EAAkB,SAAInD,EAAIqM,WAG7ElJ,QAASA,MAKbsP,OAAQ,sBACHtE,EAAKpH,KAIT,GAFAA,KAAKyZ,2BAEFzZ,KAAK5C,IAAInE,IAAIgB,UAAW,CAC1B,IAAIX,EAAWrC,OAAOyiB,SAASC,iBAAiB,YAE5Cnf,WAAawB,EAAW0I,GAC3B,GAAG0C,EAAGhK,IAAItD,YAAYkC,KAAeoL,EAAGhK,IAAInE,IAAI+C,GAC/C,OAAOoL,EAAGhK,IAAI5C,UAAUwB,EAAW0I,IAIrC,OAAOzN,OAAOoT,gCACP7P,EAAU,WAAYlB,sBACtBkB,EAAU,sBAAuBlB,sBACjCkB,EAAU,SAAU,4BACpBA,EAAU,mBAAoB,kBAEhCwF,EAAK5C,IAAInE,IAAIF,UAAYiH,EAAK5C,IAAInE,IAAI2gB,cACxC5Z,EAAK5C,IAAIyE,QAAQ,gBAOtB4X,yBAA0B,WACzB,GAAIvR,SAAS,gBAAiB,gBAAiB,mBAAoB,oBAAqBlI,KAAK5C,IAAInE,IAAIU,SAArG,CAGA,IAAIyN,EAAKpH,KACL6Z,EAAkB3R,SAAS,mBAAoB,oBAAqBlI,KAAK5C,IAAInE,IAAIU,SAClF,WAAa,WAEeqG,KAAK5C,IAAI0F,aAAa,QAAS,sBACrCgX,8BAAgC,SAASrY,GACjE,IAAG2F,EAAGhK,IAAImN,SACV,OACCsP,gBAAmBA,EACnBE,eAAkB3S,EAAGhK,IAAInE,IAAIU,QAC7BqgB,eAAkB5S,EAAGhK,IAAInE,IAAI1B,KAC7B8E,UAAaoF,EAAIxI,IAAIoD,UACrB4d,YAAexY,EAAIxI,IAAIghB,YACvBC,eAAkBzY,EAAIxI,IAAIkC,UAAYsG,EAAIxI,IAAIkC,UAAUwB,MAAM,MAAM,GAAK,KACzEwd,SAAY1Y,EAAIxI,IAAIkhB,WAItBna,KAAK5C,IAAIwJ,UAAU,qBAAsB,QAAS,SAAS3N,EAAKgO,EAAKC,GACpE,IAAIxN,EAAIY,OAAO2M,GAAKC,GACpB,OACC9K,SACCwP,UAAW,EACXiO,gBAAiBA,EACjBG,eAAgB/gB,EAAI1B,KACpB8E,UAAW3C,EAAE2C,gBAMjB+d,mBAAoB,uBAChBpa,KAAK5C,IAAInE,IAAIgB,YAAe+F,KAAK5C,IAAInE,IAAI2c,WAAarb,QACnDyF,KAAK5C,IAAInE,IAAIoE,UAAW2C,KAAK5C,IAAInE,IAAIoE,SAASgd,mBAE1Cra,KAAK5C,IAAInE,IAAIgB,WAAa+F,KAAK5C,IAAInE,IAAIF,SAAWiH,KAAK5C,IAAInE,IAAW,QAC3E+G,KAAK5C,IAAInE,IAAIsf,QACjBthB,OAAOqjB,6BAAiBta,EAAKuQ,+BAH7BtZ,OAAOqjB,6BAAiBta,EAAKua,wBAK3BtjB,OAAO4L,KAAKC,aAAa9C,KAAK5C,IAAInE,IAAIU,QAAU,QAAS,cAC3DqG,KAAKwa,uBAIPjY,QAAS,WACR1J,QAAQgB,uBACRhB,QAAQqB,eACR8F,KAAKkZ,qBACLlZ,KAAKya,aAGNF,oBAAqB,WACpB,IAAInT,EAAKpH,KACL0a,EAA0BzjB,OAAO4L,KAAKC,aAAasE,EAAGhK,IAAInE,IAAIU,QAAS,oBAC1EyN,EAAGhK,IAAInE,IAAI1B,MAEZ,GAAKyI,KAAK5C,IAAInE,IAAI0hB,oBAAqB3a,KAAK5C,IAAInE,IAAI2c,MAIpD,OAAI8E,EACIzjB,OAAO4H,MACbC,OAAQ,wEACRC,MACC6b,eAAkBF,EAAwBze,QAC1C4e,aAAgBzT,EAAGhK,IAAInE,IAAI0hB,kBAC3B5hB,QAAWqO,EAAGhK,IAAInE,IAAIF,SAEvB6F,SAAU,SAASK,IACdA,EAAE6E,KAAO7E,EAAEM,SACdtI,OAAOoT,yBAGFpL,EAAEM,QAAQob,oBACZvT,EAAGhK,IAAInE,IAAI0hB,kBAAoB1b,EAAEM,QAAQob,mBAIvC1b,EAAEM,QAAQqW,OACZxO,EAAGhK,IAAI5C,UAAU,QAASyE,EAAEM,QAAQqW,0BAGhCxO,EAAGmJ,wCAtBd,GA8BDkK,UAAW,WACV,IAAIrT,EAAKpH,KACmB,IAAzBA,KAAK5C,IAAInE,IAAI2S,WAAkB1D,SAAS,OAAQ,UAAW,UAAWlI,KAAK5C,IAAInE,IAAI6hB,SAC9D,oBAApB9a,KAAK5C,IAAIzD,SACZqG,KAAK5C,IAAI2d,KAAKC,cAAcljB,GAAG,YAAa,WAAasP,EAAG6T,cAI9DA,SAAU,WACK,IAAIpiB,QAAQsO,WAAWnH,KAAK5C,IAAInE,MAG/CiiB,QAAS,SAASjiB,EAAKgO,EAAKC,GAC3B,IAAIxN,EAAIY,OAAO2M,GAAKC,GACN,IAAXxN,EAAEwhB,SAA0B,MAAXxhB,EAAEwhB,UAErBxhB,EAAE2C,UAAY,IAEf2D,KAAK3D,UAAUpD,EAAKgO,EAAKC,GAAK,IAG/B7K,UAAW,SAASpD,EAAKgO,EAAKC,EAAKiU,GAClC,IAAI/T,EAAKpH,KACLuF,EAAOtO,OAAOiC,QAAQ+N,EAAKC,GAC3BkU,EAAe,EAAGC,EAAoB,EAe1C,IAbI,iBAAiBC,SAAStb,KAAK5C,IAAInE,IAAIU,UAC1CyhB,EAAevgB,KAAKuM,EAAGhK,IAAInE,IAAImiB,cAC/BC,EAAoBD,IAEe,qBAAzBpb,KAAK5C,IAAInE,IAAIU,SAAkCyN,EAAGhK,IAAInE,IAAIsD,WAC3C,kBAAzByD,KAAK5C,IAAInE,IAAIU,WACb0hB,EAAoB,GAIjBF,IACH5V,EAAK2V,QAAU,MAEb3V,EAAKlJ,WAAakJ,EAAK2V,SAAW3V,EAAKpK,UAAW,CACpD,GAAI6E,KAAKub,6BAGR,OAAOvb,KAAK5C,IAAIyB,MACfC,OAAQ,kDACR0c,MAAOjW,EACPxG,MACCA,MACC1C,UAAWkJ,EAAKlJ,UAChB6e,QAAS3V,EAAK2V,QACd/f,UAAWoK,EAAKpK,UAChBmB,UAAWiJ,EAAKjJ,UAChB+I,SAAU+B,EAAGhK,IAAInE,IAAIoM,SACrBC,SAAU8B,EAAGhK,IAAInE,IAAIqM,SACrBhM,SAAU8N,EAAGhK,IAAInE,IAAIK,SACrB8hB,aAAcA,EACd3M,gBAAiBrH,EAAGhK,IAAInE,IAAIwV,gBAC5B5E,WAAYzC,EAAGhK,IAAInE,IAAI6Q,oBAAsB1C,EAAGhK,IAAInE,IAAI+Q,kBACxDyR,oBAAqBrU,EAAGhK,IAAInE,IAAIwiB,oBAChCC,oBAAqBtU,EAAGhK,IAAInE,IAAIyiB,oBAChC3iB,QAASqO,EAAGhK,IAAInE,IAAIF,QACpB4iB,WAAYvU,EAAGhK,IAAInE,IAAI0iB,WACvBpD,OAAQ1d,KAAKuM,EAAGhK,IAAInE,IAAIsf,QACxBqD,iBAAkBxU,EAAGhK,IAAInE,IAAI2iB,iBAC7B1R,iBAAkB9C,EAAGhK,IAAInE,IAAIiR,kBAAoB9C,EAAGhK,IAAInE,IAAIgR,aAC5D4R,oBAAqBzU,EAAGhK,IAAInE,IAAI4iB,oBAChCliB,QAASyN,EAAGhK,IAAInE,IAAIU,QACpBpC,KAAM6P,EAAGhK,IAAInE,IAAI1B,KACjBukB,QAASvW,EAAKuW,SAAW1U,EAAGhK,IAAInE,IAAI6iB,QACpCna,IAAK4D,EAAK5D,KAAO,EACjB0Q,UAAW9M,EAAK8M,UAChB0J,kBAAmBxW,EAAKwW,kBACxB3J,gBAAiB7M,EAAK6M,gBACtB4J,WAAYzW,EAAKyW,WACjBC,YAAmC,iBAAtB7U,EAAGhK,IAAInE,IAAIU,QAA6ByN,EAAGhK,IAAInE,IAAIgjB,YAAc,KAIhFrd,SAAU,SAASK,GACdA,EAAE6E,KACL7M,OAAOoT,gCACAjD,EAAGhK,IAAIwE,eAAeC,QAAQ,kBAAmBoF,EAAKC,sBACtDE,EAAG8U,yBAAyB3W,eAEjC,GAAG8V,IAAsBpkB,OAAO2hB,MAAMC,yBAA0B,CAC/D,IAAInf,EAAIY,OAAO2M,GAAKC,GACpB/P,EAAEiM,KAAKnE,EAAEM,QAAS,SAAS4c,EAAG7S,GACzB5P,EAAEyiB,KAAIziB,EAAEyiB,GAAK7S,KAGlBzQ,QAAQujB,2BAA2BhV,EAAGhK,IAAK1D,WAAI6L,GAC9C6B,EAAGhK,IAAIwE,eAAeC,QAAQ,MAAO0D,EAAK5L,QAAS4L,EAAKhO,4BAIrD6P,EAAG2U,kBAAkB9iB,EAAKgO,EAAKC,GAAK,SAtD9ClH,KAAK5C,IAAItD,YAAmB,MAAEwI,KAAK+Z,UAAU9W,EAAK2I,IAAM,GAAGoO,WA+D9DnhB,UAAW,SAASlC,EAAKgO,EAAKC,GAC7B,IACI3B,EAAOtO,OAAOiC,QAAQ+N,EAAKC,GAE/B,GAAI3B,EAAKpK,UACR,GAAKoK,EAAKlJ,UAGL,CACJ,IAAIkgB,KAGAC,EAAajX,EAAKpK,UAAU4B,OAAO0f,QAAQ,KAAM,MAErDD,EAAaA,EAAWzf,OAAOJ,MAAM,MAGrC,IAAK,IAAI+f,EAAE,EAAGA,GAAGF,EAAWjiB,OAAS,EAAGmiB,IACX,IAAxBF,EAAWE,GAAG3f,SAAmE,GAAnDwf,EAAiBxI,QAAQyI,EAAWE,GAAG3f,SACxEwf,EAAiBla,KAAKma,EAAWE,GAAG3f,QAKtCwI,EAAKpK,UAAYohB,EAAiB1f,KAAK,MAEvC4B,cAAc,YAAa8G,EAAKhO,KAAMgO,EAAKsB,aACvC5N,EAAIsD,YACPtF,OAAOoI,MAAM7E,UAAU+K,EAAK5L,QAAS4L,EAAKhO,KACzC,MAAOglB,EAAiBhiB,OAASgL,EAAKwW,mBACvC9kB,OAAOoI,MAAM7E,UAAU+K,EAAK5L,QAAS4L,EAAKhO,KAAM,YAAaglB,EAAiBhiB,cAxB/EyF,KAAK5C,IAAIyE,QAAQ,YAAaoF,EAAKC,IA8BtCyV,SAAU,WACT3c,KAAKuQ,4BAA2B,IAGjCxX,QAAS,WACR,IAAIqO,EAAKpH,KACL4c,EAAc,WACjB,GAAGxV,EAAGhK,IAAInE,IAAIF,SAAWqO,EAAGhK,IAAItD,YAAYR,SAAU,CACrD,IAAIqY,EAAmBvK,EAAGwK,uBACtBiL,EAAc5lB,OAAOiC,QAAQ,WAAYkO,EAAGhK,IAAInE,IAAIF,SAEnDqO,EAAGhK,IAAInE,IAAIK,UACf8N,EAAGhK,IAAI5C,UAAU,WAAYmX,GAG1BvK,EAAGhK,IAAInE,IAAIK,UAAYqY,GAC1BvK,EAAGhK,IAAI5C,UAAU,kBAAmB,GAEjC4M,EAAGhK,IAAInE,IAAIwiB,qBAAuB9J,GACrCvK,EAAGhK,IAAI5C,UAAU,sBAAuB,GAErCqiB,EAAYC,qBACZ1V,EAAGhK,IAAItD,YAAYijB,aACrB3V,EAAGhK,IAAI5C,UAAU,cAAeqiB,EAAYC,qBAG1CD,EAAYG,eAAuC,oBAAtB5V,EAAGhK,IAAInE,IAAIU,SAAiC1C,OAAO4L,KAAKkW,UAAU3R,EAAGhK,IAAInE,IAAIU,QAAS,YACtHyN,EAAGhK,IAAI5C,UAAU,UAAWqiB,EAAYG,eAGzC/lB,OAAOoT,gCACAjD,EAAGhK,IAAIwE,eAAeC,QAAQ,+BAC9BuF,EAAGmT,yCACHnT,EAAG6V,0BAKRC,EAAoB,SAASN,GAChC,GAAI1U,SAAS,gBAAiB,oBAAqBd,EAAGhK,IAAInE,IAAIU,SAAU,CACvE,GAAuB,iBAApByN,EAAGhK,IAAInE,IAAIU,QACb,IAAImE,EAAa,WACbqf,EAAsB,gBAEtBrf,EAAa,WACbqf,EAAsB,YAG3B,IAAIvT,EAAQxC,EAAGhK,IAAInE,IAAIhC,OAAOoI,MAAM8X,MAAMrZ,IAC1C,GAAG8L,GAASxC,EAAGhK,IAAInE,IAAIF,QACtB,OAAO9B,OAAO4H,MACbC,OAAQ,2CACRC,MACChG,QAASqO,EAAGhK,IAAInE,IAAIF,QACpB+E,WAAYA,EACZ8L,MAAOA,GAERhL,SAAU,SAASK,IACdA,EAAE6E,KAAO7E,EAAEM,UACd6H,EAAGhK,IAAI5C,UAAU2iB,EAAqBle,EAAEM,SACxCqd,QAKHA,SAGDA,KAKF,GAAI5c,KAAK5C,IAAInE,IAAIgR,aAAyBjK,KAAK5C,IAAInE,IAAIgR,kBACvCjK,KAAK5C,IAAInE,IAAIiR,iBAEzBjT,OAAO4L,KAAKC,aAAa9C,KAAK5C,IAAIzD,QAAS,qBAC9CuO,SAAS,iBAAkB,mBAAoB,oBAAqBlI,KAAK5C,IAAIzD,SAC7Ed,QAAQqE,MAAMmO,qBAAqBrL,KAAK5C,IAAK,WAC5C8f,EAAkBN,KAGnBM,EAAkBN,GAGhB5c,KAAK5C,IAAInE,IAAIF,UACfF,QAAQ4B,sBAAwBuF,KAAK5C,IAAInE,IAAIF,UAI/CmR,iBAAkB,WACblK,KAAK5C,IAAInE,IAAIiR,mBAChBlK,KAAK5C,IAAI8M,iBAAmBlK,KAAK5C,IAAInE,IAAIiR,iBACzCjT,OAAO0E,GAAGqI,KAAKnC,QAAQ7B,KAAK5C,IAAInE,IAAIU,QAAS,cAI/CsQ,aAAc,WACb,IAAI7C,EAAKpH,KACT,GAAIA,KAAK5C,IAAInE,IAAIgR,aAAc,CAG9B,GAFAjK,KAAK5C,IAAI6M,aAAejK,KAAK5C,IAAInE,IAAIgR,aAER,iBAAxBjK,KAAK5C,IAAInE,IAAIU,SAA8BqG,KAAK5C,IAAInE,IAAIoM,UACnC,oBAAxBrF,KAAK5C,IAAInE,IAAIU,SAAiCqG,KAAK5C,IAAInE,IAAIqM,SAC5D,OAAOrO,OAAO4H,MACbC,OAAQ,sCACRC,MACCkL,aAAgB7C,EAAGhK,IAAInE,IAAIgR,aAC3BnM,WAAoC,iBAAtBsJ,EAAGhK,IAAInE,IAAIU,QAA6B,WAAa,WACnEoQ,UAAa3C,EAAGhK,IAAInE,IAAI8Q,UACxBH,MAA+B,iBAAtBxC,EAAGhK,IAAInE,IAAIU,QAA6ByN,EAAGhK,IAAInE,IAAIoM,SAAW+B,EAAGhK,IAAInE,IAAIqM,SAClFvM,QAAWqO,EAAGhK,IAAInE,IAAIF,SAEvB6F,SAAU,SAASK,EAAGme,GAClBne,EAAEM,UACJ6H,EAAGhK,IAAInE,IAAIokB,SAAWpe,EAAEM,QACxBd,cAAc,YACdxH,OAAO0E,GAAGqI,KAAKnC,QAAQuF,EAAGhK,IAAInE,IAAIU,QAAS,YAC3CyN,EAAGkW,wBAKNrmB,OAAO0E,GAAGqI,KAAKnC,QAAQuF,EAAGhK,IAAInE,IAAIU,QAAS,cAK9C0jB,SAAU,WAGT,GAAIrd,KAAK5C,IAAInE,IAAIokB,WAAard,KAAK5C,IAAIgN,yBAA2BpK,KAAK5C,IAAInE,IAAIsf,SAC1EvY,KAAK5C,IAAInE,IAAIqgB,wBACftZ,KAAK5C,IAAInE,IAAIsgB,kBAAoBvZ,KAAK5C,IAAInE,IAAIsgB,iBAAiBhf,QAAS,CACzE,IAAIgjB,EAAW,GACXC,EAAW,GACXC,EAAgB,oBAEhBzd,KAAK5C,IAAInE,IAAIqgB,yBAEhBmE,GADAF,EAAW,oCAIPvd,KAAK5C,IAAInE,IAAIsgB,sBAAwBhf,SACzCijB,EAAW,yBACa,IAApBD,EAAShjB,SAAcijB,EAAW,QAAUA,GAChDC,GAAgCD,GAEjCvmB,OAAOyM,SAAS+Z,KAKnB1T,UAAW,WACV/J,KAAKiK,gBAGNqT,kBAAmB,WAClBxd,IAAM7G,EAAM+G,KAAK5C,IAAInE,IACrB,GAAIA,EAAIqgB,uBACPtZ,KAAKsZ,8BACC,GAAIrgB,EAAIsgB,iBAAkB,CAChCzZ,IAAMsH,EAAKpH,KACX/G,EAAIsgB,iBAAiBhY,QACpB,SAASmc,GACJA,EAAKC,aACRvW,EAAGuW,aAAa1kB,EAAKykB,EAAK/jB,QAAS+jB,EAAKnmB,MAExCN,OAAOoI,MAAM7E,UACZkjB,EAAK/jB,QAAS+jB,EAAKnmB,KAAM,WACzB0B,EAAIgR,cAAgBhR,EAAIiR,sBAQ9B0H,qBAAsB,WACrB,OAAO/Y,QAAQC,aAAakH,KAAK5C,IAAInE,IAAIF,UAG1CoP,eAAgB,WACftP,QAAQqE,MAAMiO,oBAAoBnL,KAAK5C,MAGxC9D,SAAU,WAET,IAAI4Q,EAAmBlK,KAAK5C,IAAInE,IAAIiR,kBAAoBlK,KAAK5C,IAAInE,IAAIgR,aAGjE7C,EAAKpH,KACTA,KAAKkZ,qBAEL,IAAIvH,EAAmB3R,KAAK4R,uBAEzB5R,KAAK5C,IAAInE,IAAIK,UAAY0G,KAAK5C,IAAInE,IAAIK,WAAaqY,IAChD3R,KAAK5C,IAAInE,IAAI4iB,oBAClB7b,KAAK4d,kBAAkB1T,EAAkBlK,KAAK5C,IAAInE,IAAIK,SAAUqY,EAC/D,SAASkM,GACRzW,EAAGhK,IAAI5C,UAAU,kBAAmBqjB,KAGtC7d,KAAKyO,mBAIPA,gBAAiB,WACLzO,KAAK5C,IACb4C,KAAK5C,IAAInE,IAAIK,WAAa0G,KAAK4R,wBACjC5R,KAAK5C,IAAI5C,UAAU,kBAAmB,GAEpCwF,KAAK5C,IAAInE,IAAIK,WAAa0G,KAAK5C,IAAInE,IAAIwiB,qBACzCzb,KAAK5C,IAAInE,IAAIyiB,sBAAwB1b,KAAK5C,IAAInE,IAAIwV,iBAClDzO,KAAK5C,IAAI5C,UAAU,sBAAuBwF,KAAK5C,IAAInE,IAAIwV,iBAGrDlL,IAAIvD,KAAK5C,IAAInE,IAAIwV,iBAAiB,IACjCzO,KAAK5C,IAAInE,IAAI4iB,oBACf7b,KAAKuQ,6BACMvQ,KAAK8d,sBAChB9d,KAAK+d,uCACL/d,KAAKge,qBAKPhe,KAAK5C,IAAI2H,gBAAgB,kBAAmB,YAAalM,QAAQ+B,qBAAuB,EAAI,IAG7FqjB,cAAe,sBACV7W,EAAKpH,KACT,GAAGA,KAAK5C,IAAInE,IAAIglB,cACf,OAAOje,KAAK5C,IAAIyB,MACf5F,IAAK+G,KAAK5C,IAAInE,IACd6F,OAAQ,sBACRF,SAAU,SAASK,GACdA,EAAE6E,KACLsD,EAAGmJ,gCAGH2N,uBAAWle,EAAK5C,IAAI5C,UAAU,gBAAiB,MAGlD4M,EAAGmJ,8BAILwN,qCAAsC,WACrC,IAAI3W,EAAKpH,KACT7I,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAI2c,UAAa,SAASpX,EAAG9E,GACxB,UAAjBA,EAAEiZ,aACJ1b,OAAOoI,MAAM7E,UAAUd,EAAEC,QAASD,EAAEnC,KAAM,aACzCgM,IAAI7J,EAAE+a,YAAclR,IAAI6D,EAAGhK,IAAInE,IAAIwV,qBAKvCmP,kBAAmB,SAAS1T,EAAkB2H,EAAeC,EAAalT,GACzE,GAAKsL,GAAqB2H,GAAkBC,EAC5C,OAAO7a,OAAO4H,MACbC,OAAQ,wCACRC,MACCmL,iBAAkBA,EAClB2H,cAAeA,EACfC,YAAaA,GAEdlT,SAAU,SAASK,GAClBL,EAAS2E,IAAItE,EAAEM,cAKlBkc,oBAAqB,WACpB,IAAIrU,EAAGpH,KACPA,KAAKkZ,qBAEL,IAAIvH,EAAmB3R,KAAK4R,uBAEzB5R,KAAK5C,IAAInE,IAAIwiB,sBAAwB9J,GAAsB3R,KAAK5C,IAAInE,IAAI4iB,oBAM1E7b,KAAK0b,sBALL1b,KAAK4d,kBAAkB5d,KAAK5C,IAAInE,IAAIgR,aAAcjK,KAAK5C,IAAInE,IAAIwiB,oBAAqB9J,EACnF,SAASkM,GACRzW,EAAGhK,IAAI5C,UAAU,sBAAuBqjB,MAO5CnC,oBAAqB,WACjB1b,KAAK5C,IAAInE,IAAIwiB,sBAAwBzb,KAAK4R,uBAC5C5R,KAAK5C,IAAI5C,UAAU,sBAAuB,GACjCwF,KAAK5C,IAAInE,IAAIwiB,sBAAwBzb,KAAK5C,IAAInE,IAAIK,UACxD0G,KAAK5C,IAAInE,IAAIyiB,qBAAiE,GAA1C7gB,KAAKmF,KAAK5C,IAAInE,IAAIyiB,sBACzD7gB,KAAKmF,KAAK5C,IAAInE,IAAIyiB,sBAAwB7gB,KAAKmF,KAAK5C,IAAInE,IAAIwV,kBAC5DzO,KAAK5C,IAAI5C,UAAU,kBAAmBwF,KAAK5C,IAAInE,IAAIyiB,qBAGhD1b,KAAK8d,qBACR9d,KAAKge,iBAAiB,MAAM,IAI9BG,IAAK,SAASllB,EAAKgO,EAAKC,GACvB,IAAIE,EAAKpH,KACLuF,EAAOtO,OAAOiC,QAAQ+N,EAAKC,GAC/B,GAAG3B,EAAKlJ,WAAakJ,EAAK4Y,IACzB,OAAOne,KAAK5C,IAAIyB,MACfC,OAAQ,uDACR0c,MAAOjW,EACPxG,MACC1C,UAAWkJ,EAAKlJ,UAChB8hB,IAAK5Y,EAAK4Y,KAEXvf,SAAU,SAASK,GACdA,EAAE6E,KACLsD,EAAG2U,kBAAkB3U,EAAGhK,IAAInE,IAAKgO,EAAKC,OAO3C6U,kBAAmB,SAAS9iB,EAAKgO,EAAKC,EAAKkX,GAC1C,GAAGnnB,OAAO4L,KAAKC,aAAamE,EAAK,YAAaC,GAAM,CACnD,IAAI3B,EAAOtO,OAAOiC,QAAQ+N,EAAKC,GAC/BjQ,OAAOoI,MAAM0S,gBAAgBxM,GAAO,MAAO,sBAC3CA,EAAK8M,UAAY9O,IAAIgC,EAAK5D,IAAM4D,EAAKwW,kBAAmBrN,UAAU,YAAanJ,IAC/EA,EAAK4M,aAAe5O,IAAIgC,EAAK8M,UAAY9M,EAAK6M,iBAC9C3T,cAAc,YAAa8G,EAAKhO,KAAMgO,EAAKsB,aAC3CpI,cAAc,eAAgB8G,EAAKhO,KAAMgO,EAAKsB,aAC9C7G,KAAKkc,yBAAyB3W,GAC9BvF,KAAKwZ,wBACA4E,GACJnnB,OAAO4L,KAAKkW,UAAU9f,EAAIU,QAAS,wBACnCqG,KAAKge,iBAAiBzY,GAAM,KAK/B2W,yBAA0B,SAAS3W,GAE/BvF,KAAK5C,IAAIgc,UAAU,SAAS9W,KAAK+b,WAAWtC,mBAC9C/b,KAAK5C,IAAItD,YAAY6I,MAAML,KAAKgc,cAAc,oBAC3C/Y,EAAK4Y,KAAO5Y,EAAKgZ,YAAetnB,OAAO4L,KAAKC,aAAa9J,QAAQc,YAAY6I,MAAML,KAAK3I,QAAS,qBAAqBkH,YAK3Hc,IAAK,SAAS1I,EAAKgO,EAAKC,GACvBlH,KAAK+b,kBAAkB9iB,EAAKgO,EAAKC,GAAK,GACtClH,KAAKid,mBAAmBhmB,OAAOiC,QAAQ+N,EAAKC,IAAM,IAGnDsS,qBAAsB,WAErB,IAAIpS,EAAKpH,KACTA,KAAK5C,IAAInE,IAAIulB,iBAAkB,EAE/BrnB,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAW,UAAS,SAASuF,EAAG+G,GAC/C6B,EAAGhK,IAAInE,IAAIulB,kBAAoBjb,IAAIgC,EAAK4M,gBAEzC1T,cAAc,oBACduB,KAAKie,iBAGN/E,mBAAoB,WAKnB,GAHAlZ,KAAK5C,IAAIqhB,YAAY,yBACjBze,KAAK5C,IAAInE,IAAIylB,kBAAmB1e,KAAK5C,IAAInE,IAAIwiB,sBAE9Czb,KAAK5C,IAAIuhB,eAAe3e,KAAK5C,IAAInE,IAAIK,UACpC0G,KAAK5C,IAAIuhB,eAAe3e,KAAK5C,IAAInE,IAAIwiB,oBAAqB,CAG7D,IAAI9J,EAAmB3R,KAAK4R,uBAC5B5R,KAAK4e,mBAAmBjN,GACxB3R,KAAK6e,mBAAmBlN,GACxB3R,KAAK5C,IAAI0T,iBACT9Q,KAAK5C,IAAIuhB,aAAe3e,KAAK5C,IAAInE,IAAIK,WAIvCslB,mBAAoB,SAASjN,GAG5B3R,KAAK5C,IAAI0hB,qBAAqB,aAAc,iBAAkB,+BAC7D,uBAAwB,mBAAoB,qBAAsB,gBAClE,+BAAgC,kCAAmC,sBACnE,mBAAoB,wBAAyB,qBAAsB,sBACnE,yBAA0B,kBAAmB,2BAC7C,4BAA6BnN,GAE9B3R,KAAK5C,IAAI0hB,qBAAqB,QAAS,YAAa,0BAA2B,kBAC9E,cAAe,0BAA2B,6BAC1C,gBAAiB,WAAY,cAAe,mBAAoB,iBAChE,sBAAuB,sBAAuB,oBAC9C,cAAe9e,KAAK5C,IAAInE,IAAIK,UAE7B0G,KAAK5C,IAAI0hB,qBAAqB,qBAAsB,iBACnD9e,KAAK5C,IAAInE,IAAIgf,wBAEdjf,QAAQ+L,gBAAgB,kBAAmB,cAAe,KAAO/E,KAAK5C,IAAInE,IAAIK,SAC3E,UAAYqY,GAEZ3R,KAAK5C,IAAInE,IAAIwiB,qBAAuBzb,KAAK5C,IAAInE,IAAIwiB,qBAAqB9J,GACxE3Y,QAAQ+L,gBAAgB,sBAAuB,cAAe,KAC3D/E,KAAK5C,IAAInE,IAAIwiB,oBAAsB,UAAY9J,GAInD3R,KAAK5C,IAAIpD,gBAAgB,kBAAmB,aAAc,iBACzD,+BAAgC,+BAAgC,kCAChE,mBAAoB,qBAAsB,gBAAiB,uBAC3D,mBAAoB,wBAAyB,sBAAuB,yBACpE,kBAAmB,2BAA4B,4BAChDgG,KAAK5C,IAAInE,IAAIK,UAAYqY,GAEzB3R,KAAK5C,IAAIpD,gBAAgB,sBAAuB,uBAC/CgG,KAAK5C,IAAInE,IAAIwiB,qBAAuB9J,GAErC,IAAI1U,EAAOpC,KAAK7B,QAAQC,IAAIic,mBACxBlc,QAAQC,IAAI2c,WAAanc,OAAO,SAASC,GAAI,OAAkC,IAA3BA,EAAEuZ,yBAAmC,OAE1Fhc,OAAO4L,KAAKC,aAAa9J,QAAQW,QAAS,cAC5CX,QAAQgB,eAAe,YAAaiD,GAElChG,OAAO4L,KAAKC,aAAa9J,QAAQW,QAAS,mBAC5CX,QAAQgB,eAAe,iBAAmBiD,GA5ClC+C,KA4C8C5C,IAAInE,IAAIK,UAAYqY,IAI5EkN,mBAAoB,SAASlN,GAC5B,IAAIvK,EAAKpH,KAQT,GANAA,KAAK5C,IAAI0hB,qBAAqB,YAAa,gBAAiB,uBAAwB,cAAe,mBAClGnN,EAAkB,SAEnB3R,KAAK5C,IAAI0hB,qBAAqB,OAAQ,WAAY,kBAAmB,SAAU,cAC9E9e,KAAK5C,IAAInE,IAAIK,SAAU,SAErB0G,KAAK5C,IAAItD,YAAwB,WAAG,CACtCkG,KAAK5C,IAAI0hB,qBAAqB,iBAAkB,aAAc9e,KAAK5C,IAAInE,IAAIK,SAAU,cACrF0G,KAAK5C,IAAI0hB,qBAAqB,sBAAuB,kBAAmBnN,EAAkB,cAE1F,IAAIoN,EAAY/e,KAAK5C,IAAItD,YAAwB,WAAEwI,KACnDnL,EAAEiM,MAAM,sBAAuB,kBAAmB,SAAS5E,EAAGwgB,GAC1D/nB,OAAO4L,KAAKC,aAAaic,EAAUplB,QAASqlB,IAC9CD,EAAUE,gBAAgBD,EAAO5X,EAAGhK,IAAInE,IAAIK,UAAYqY,KAI3D,GAAG3R,KAAK5C,IAAItD,YAAyB,YAAG,CACvCkG,KAAK5C,IAAI0hB,qBAAqB,OAAQ,UAAW9e,KAAK5C,IAAInE,IAAIK,SAAU,eACxE0G,KAAK5C,IAAI0hB,qBAAqB,YAAa,eAAgBnN,EAAkB,eAEzEoN,EAAY/e,KAAK5C,IAAItD,YAAyB,YAAEwI,KACpDnL,EAAEiM,MAAM,YAAa,eAAgB,SAAS5E,EAAGwgB,GAC7C/nB,OAAO4L,KAAKC,aAAaic,EAAUplB,QAASqlB,IAC9CD,EAAUE,gBAAgBD,EAAO5X,EAAGhK,IAAInE,IAAIK,UAAYqY,KAIxD3R,KAAK5C,IAAItD,YAAmB,QAC9BkG,KAAK5C,IAAI0hB,qBAAqB,aAAc,QAAS,6BAA8B9e,KAAK5C,IAAInE,IAAIK,SAAU,SAE1G0G,KAAK5C,IAAI0hB,qBAAqB,kBAAmB,aAAc,kCAAmCnN,EAAkB,UAGlH3R,KAAK5C,IAAItD,YAAsB,UACjCkG,KAAK5C,IAAI0hB,qBAAqB,iBAAkB,oBAC/C9e,KAAK5C,IAAInE,IAAIgf,uBAAwB,YAInC8G,EAAY/e,KAAK5C,IAAItD,YAAmB,MAAEwI,KAC9CnL,EAAEiM,MAAM,YAAa,uBAAwB,eAAgB,SAAS5E,EAAGwgB,GACrE/nB,OAAO4L,KAAKC,aAAaic,EAAUplB,QAASqlB,IAC9CD,EAAUE,gBAAgBD,EAAO5X,EAAGhK,IAAInE,IAAIK,UAAYqY,KAG1D,IAAI1U,EAAQpC,KAAK7B,QAAQC,IAAIic,mBAC1Blc,QAAQC,IAAI2c,WAAanc,OAAO,SAASC,GAAI,OAAkC,IAA3BA,EAAEuZ,yBAAmC,OAE5F9b,EAAEiM,MAAM,WAAY,cAAe,SAAS5E,EAAGwgB,GAC3C/nB,OAAO4L,KAAKC,aAAaic,EAAUplB,QAASqlB,IAC9CD,EAAUE,gBAAgBD,EAAO/hB,KAGnC9F,EAAEiM,MAAM,gBAAiB,mBAAoB,SAAS5E,EAAGwgB,GACrD/nB,OAAO4L,KAAKC,aAAaic,EAAUplB,QAASqlB,IAC9CD,EAAUE,gBAAgBD,EAAQ/hB,GAASmK,EAAGhK,IAAInE,IAAIK,UAAYqY,KAIrDxa,EAAE6I,KAAK5C,IAAI8hB,UAG3BC,YAAa,WACZnf,KAAKuQ,8BAGN6O,mBAAoB,WACnBpf,KAAKuQ,8BAGN8O,kBAAmB,WAClBrf,KAAKuQ,8BAGNsL,oBAAqB,WACpB,GAAG7b,KAAK5C,IAAInE,IAAI4iB,oBAAqB,CACpC,IAAIzU,EAAKpH,KACLsf,KAWJ,OATAnoB,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAW,UAAS,SAASuF,EAAG9E,GAC3CA,EAAE2C,WACLijB,EAAUjd,MACT1I,QAAWD,EAAEC,QACbpC,KAAQmC,EAAEnC,KACVgoB,aAAgB7lB,EAAE6lB,iBAIdvf,KAAK5C,IAAIyB,MACfC,OAAQ,0EACRC,MAAQugB,UAAWA,GACnB1gB,SAAU,SAASK,IACbA,EAAE6E,KAAO7E,EAAEM,UACf6H,EAAGoY,0BAA0BvgB,EAAEM,SAC/B6H,EAAGmJ,6BACAnJ,EAAGhK,IAAInE,IAAI2Z,mBAAmBxL,EAAGhK,IAAIyE,QAAQ,yBAKnD7B,KAAKid,sBAIPA,mBAAoB,SAAS1X,EAAMgL,GAClC,IAAInJ,EAAKpH,KACLjB,EAAOiB,KAAKyf,UAAUla,GAC1B,GAAMxG,EAAK4D,OAAS5D,EAAK4D,MAAMpI,OAI/B,OAAOyF,KAAK5C,IAAIyB,MACfC,OAAQ,wEACRC,MAAQA,KAAMA,GACdH,SAAU,SAASK,IACbA,EAAE6E,KAAO7E,EAAEM,UACf6H,EAAGoY,0BAA0BvgB,EAAEM,SAC5BgG,GAAM6B,EAAG4R,iBAAiBzT,GAC1BgL,GAA4BnJ,EAAGmJ,6BAC/BnJ,EAAGhK,IAAInE,IAAI2Z,mBAAmBxL,EAAGhK,IAAIyE,QAAQ,yBAX/C0O,GAA4BnJ,EAAGmJ,8BAiBpCkP,UAAW,SAASla,GACnB,IAAI6B,EAAKpH,KACT,OACC2C,MAAS3C,KAAK0f,eAAena,GAC7BF,SAAY+B,EAAGhK,IAAInE,IAAIoM,SACvBsa,eAAkBvY,EAAGhK,IAAInE,IAAI0mB,eAC7BC,UAAaxY,EAAGhK,IAAInE,IAAI2mB,UACxBta,SAAY8B,EAAGhK,IAAInE,IAAIqM,SACvBua,cAAiBzY,EAAGhK,IAAInE,IAAI4mB,cAC5BvmB,SAAY8N,EAAGhK,IAAInE,IAAIK,SACvBmV,gBAAmBrH,EAAGhK,IAAInE,IAAIwV,gBAC9B5E,WAAczC,EAAGhK,IAAInE,IAAI6Q,oBAAsB1C,EAAGhK,IAAInE,IAAI+Q,kBAC1DyR,oBAAuBrU,EAAGhK,IAAInE,IAAIwiB,oBAClCC,oBAAuBtU,EAAGhK,IAAInE,IAAIyiB,oBAClC3iB,QAAWqO,EAAGhK,IAAInE,IAAIF,QACtBmR,iBAAoB9C,EAAGhK,IAAInE,IAAIiR,kBAAoB9C,EAAGhK,IAAInE,IAAIgR,aAC9D6V,SAAY1Y,EAAGhK,IAAInE,IAAI6mB,SACvBC,cAAiB3Y,EAAGhK,IAAInE,IAAI8mB,cAC5BlE,oBAAuBzU,EAAGhK,IAAInE,IAAI4iB,oBAClCliB,QAAWyN,EAAGhK,IAAInE,IAAIU,QACtBpC,KAAQ6P,EAAGhK,IAAInE,IAAI1B,KACnBgF,UAAa1B,KAAKuM,EAAGhK,IAAInE,IAAIsD,WAC7B6e,aAAgBlT,SAAS,gBAAiB,oBAAqBd,EAAGhK,IAAInE,IAAIU,SAAWkB,KAAKuM,EAAGhK,IAAInE,IAAImiB,cAAgB,EACrHW,kBAAqB3U,EAAGhK,IAAInE,IAAI8iB,kBAChCE,YAAqC,iBAAtB7U,EAAGhK,IAAInE,IAAIU,QAA6ByN,EAAGhK,IAAInE,IAAIgjB,YAAc,KAIlFyD,eAAgB,SAASna,GACxB,IAAI+Z,KACAU,EAAc,SAAStmB,GACtBA,EAAE2C,YACLijB,EAAUjd,MACT1I,QAAWD,EAAEC,QACbpC,KAAQmC,EAAEnC,KACV8E,UAAa3C,EAAE2C,UACf4jB,WAAcvmB,EAAEumB,WAChBC,MAASxmB,EAAEwmB,MACXve,IAAOjI,EAAEiI,IACTwe,WAAczmB,EAAEymB,WAChBC,OAAU1mB,EAAE0mB,OACZb,aAAgB7lB,EAAE6lB,aAClBjjB,UAAa5C,EAAE4C,UACfnB,UAAazB,EAAEyB,UACfkV,oBAAuB3W,EAAE2W,qBAAuB,EAChD0L,kBAAqBriB,EAAEqiB,mBAAqB,IAIzC7T,SAAS,iBAAkB,mBAAoB,qBAAsB,uBAAwBxO,EAAEC,UAClG2lB,EAAU,GAAgB,YAAI5lB,EAAEqW,YAChCuP,EAAU,GAA0B,sBAAI5lB,EAAEwW,yBAY7C,OAPI3K,EACHya,EAAYza,GAEZpO,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAW,UAAS,SAASuF,EAAG9E,GAC/CsmB,EAAYtmB,KAGP4lB,GAGRE,0BAA2B,SAASa,GAGnC,IAFA,IACIC,GAA0B,EACtB9hB,EAAE,EAAG+hB,EAAEF,EAAS9lB,OAAQiE,EAAE+hB,EAAG/hB,IAAK,CACzC,IAAI9E,EAAI2mB,EAAS7hB,GACbgiB,EAAwBvpB,OAAOoI,MAAM5C,UAAU/C,EAAEC,QAASD,EAAEnC,KAAM,gBACtE,IAAI,IAAI4kB,KAAKziB,EAAG,CACf,IAAI4P,EAAI5P,EAAEyiB,IAC4B,KAAjC,UAAW,QAAQpI,QAAQoI,KACzB,mBAAHA,GACC5Y,IAAI+F,IAAM/F,IAAI7J,EAAEuW,mBAAkBqQ,GAA0B,GAEhErpB,OAAOoI,MAAM7E,UAAUd,EAAEC,QAASD,EAAEnC,KAAM4kB,EAAG7S,IAXvCtJ,KAgBD5C,IAAInE,IAAI4iB,sBAAuB2E,GAA0B9mB,EAAE6lB,cAhB1Dvf,KAiBJge,iBAAiB/mB,OAAOiC,QAAQQ,EAAEC,QAASD,EAAEnC,OAI9C+oB,GArBKtgB,KAqBuBuQ,8BAGjCyN,iBAAkB,SAASzY,EAAMkb,GAG3BA,GACJzgB,KAAK5C,IAAI5C,UAAU,sBAAuB,IAG3C,IAAI4M,EAAKpH,KACLjB,EAAOiB,KAAKyf,UAAUla,GAC1B,IAAOxG,EAAK4D,OAAS5D,EAAK4D,MAAMpI,QAAWwE,EAAK8K,aAIlB,GAA1BzC,EAAG0W,oBAGP,OADA1W,EAAG0W,qBAAsB,EAClB9d,KAAK5C,IAAIyB,MACfC,OAAQ,kDACRC,MAAQA,KAAMA,GACdH,SAAU,SAASK,GACbA,EAAE6E,IAaNsD,EAAG0W,qBAAsB,EAZzB7mB,OAAOoT,gCACAjD,EAAGhK,IAAI5C,UAAU,sBAAuByE,EAAEM,QAAQ6gB,OAAO3E,wCACzDrU,EAAGhK,IAAI5C,UAAU,sBAAuByE,EAAEM,QAAQ6gB,OAAO1E,iCAE3D3c,EAAK4D,MAAMpI,QACb6M,EAAGoY,0BAA0BvgB,EAAEM,QAAQ8gB,sBAGjCjZ,EAAG0W,qBAAsB,SAUtCvC,2BAA4B,WAC3B,IAAInU,EAAKpH,KACL0gB,GAAQ,EAYZ,OAVAvpB,EAAEiM,MAAM,UAAW,YAAa,SAAS5E,EAAGxC,GACxC/E,OAAO4L,KAAKkW,UAAU3R,EAAGhK,IAAInE,IAAIU,QAASqC,IAAoC,kBAAtBoL,EAAGhK,IAAInE,IAAIU,UAChEyN,EAAGhK,IAAInE,IAAI+C,KACf/E,OAAOyM,SAAS5L,GAAG,kBAAoB,KACtCb,OAAO4L,KAAK+C,UAAUwB,EAAGhK,IAAInE,IAAIU,QAASqC,EAAWoL,EAAGhK,IAAInE,IAAI1B,MAChE,KAAOO,GAAG,wCACX4oB,GAAQ,MAIJA,GAGRhiB,UAAW,WACV,IAAI0I,EAAKpH,KAETnH,QAAQqE,MAAMwB,UAAUsB,KAAK5C,IAAInE,IAAI0F,QAASqB,KAAK5C,IAAInE,IAAK,SAASgG,GAChEA,EAAE6E,KACLsD,EAAGhK,IAAI5C,UAAU,QAASyE,EAAEM,YAK/Bob,kBAAmB,WAClB,IAAIvT,EAAKpH,KACT,GAAGA,KAAK5C,IAAInE,IAAI0hB,kBACf,OAAO3a,KAAK5C,IAAIyB,MACfC,OAAQ,gEACRC,MACC6b,eAAkB3jB,OAAO4L,KAAKC,aAAa9C,KAAK5C,IAAInE,IAAIU,QAAS,oBAChEqG,KAAK5C,IAAInE,IAAI1B,MAAM0E,QACpB0kB,YAAe3gB,KAAK5C,IAAInE,IAAI0hB,mBAE7B/b,SAAU,SAASK,GACdA,EAAE6E,MACLsD,EAAGhK,IAAI5C,UAAU,QAASyE,EAAEM,SAC5B6H,EAAGmJ,kCAORqQ,aAAc,WAEb,GAAG5gB,KAAK5C,IAAInE,IAAI2nB,cAAgB5gB,KAAK5C,IAAInE,IAAIgB,UAG5C,OAFAhD,OAAOyM,SAAS5L,GAAG,2CACnBkI,KAAK5C,IAAI5C,UAAU,eAAgB,GAIpC,GAAGwF,KAAK5C,IAAInE,IAAI2nB,aAAc,CACzB5gB,KAAK5C,IAAInE,IAAI4nB,cAChB7gB,KAAK5C,IAAI5C,UAAU,eAAgBwF,KAAK5C,IAAInE,IAAI1B,MAGjD,IAAIupB,EAAkC,iBAApB9gB,KAAK5C,IAAInE,IAAI8nB,MAC5B9pB,OAAO+pB,UAAU,iBAAiBC,MAClCjhB,KAAK5C,IAAInE,IAAI8nB,MAEhB/gB,KAAK5C,IAAInE,IAAIioB,2BAA6B/pB,EAAEyC,KAAK6M,KAAKqa,GACrDra,KAAKzG,KAAK5C,IAAInE,IAAIkoB,gBAAiB,SAAS7X,GAAK,OAAOA,GAAK,OAASzM,KAAK,MAC5EmD,KAAK5C,IAAInE,IAAImoB,uBAAyBnqB,OAAO4N,SAASwc,WAAWrhB,KAAK5C,IAAInE,IAAIgR,cAAcqX,UAG7FC,cAAc,6BAA8B,4BAG7ClV,UAAW,WAEV,GAAGrM,KAAK5C,IAAInE,IAAIoT,UAAW,CAC1B,IAGImV,GAHsBC,QAAW,EAAGC,UAAa,EAAGC,cAAe,EACtEC,OAAU,IAEqB5hB,KAAK5C,IAAInE,IAAI4oB,gBAC7C,GAAGL,EAAQ,CACV,IAAIlV,EAAUrV,OAAO4N,SAASid,WAAW9hB,KAAK5C,IAAInE,IAAIoT,UACrDmV,GACDxhB,KAAK5C,IAAInE,IAAIqT,QAAUrV,OAAO4N,SAASkd,SAASzV,GAAU,GAC1D7N,cAAc,cAKjBua,iBAAkB,SAASzT,GAC1B,GAA4B,eAAxBvF,KAAK5C,IAAInE,IAAIU,SAA4B4L,EAAKyc,eAAgB,CACjE,IAAI5R,EAAO7M,IAAIgC,EAAK6K,MAAQ7M,IAAIvD,KAAK5C,IAAInE,IAAIwV,iBAAmB,GAChElJ,EAAK0c,aAAe1e,KAAM6M,EAAO7K,EAAKyc,gBAAkBzc,EAAK8M,UAAY3D,UAAU,SAAUnJ,MAI/FiV,oBAAqB,aASrB0H,aAAc,WACb,IAAIliB,KAAK5C,IAAIb,UACZ,OAAOyD,KAAK5C,IAAIyB,MACfC,OAAQ,eACR7F,IAAK+G,KAAK5C,IAAInE,IACd2F,SAAU,SAASK,EAAGme,GACrB3e,cAAc,gBAMlB0jB,mBAAoB,WACnB,OAAOlrB,OAAO4H,MACbC,OAAQ9F,QAAQ6Z,QAAQuP,yBACxBrjB,MACCX,GAAMpF,QAAQC,IAAIU,QAClB0E,GAAMrF,QAAQC,IAAI1B,MAEnBqH,SAAU,SAASK,GAClB,IAAIG,EAAUnI,OAAOoI,MAAMC,KAAKL,EAAEM,SAClCtI,OAAOuI,UAAU,OAAQJ,EAAQ,GAAGzF,QAASyF,EAAQ,GAAG7H,UAM3D6qB,uBAAwB,WACvB,IAAItjB,EAAS,yEASb,OARG9F,QAAQC,IAAIoE,UAAYrE,QAAQC,IAAIoE,SAASglB,iCAE9CvjB,EADEoJ,SAAS,gBAAiB,oBAAsBlP,QAAQC,IAAIU,SACrD,yFAED,wFAIHmF,GAGRua,oBAAqB,SAASpgB,EAAKgO,EAAKC,GAGvC,IACI3B,EAAOtO,OAAOiC,QAAQ+N,EAAKC,GAE/B,GAAI3B,EAAKlJ,UAEF,CAAA,GAAmB,oBAAfpD,EAAIU,SACE,oBAAfV,EAAIU,SAAiCV,EAAImiB,aAE1C,OACChf,SAAUmJ,KAAQA,EAAKlJ,YAGxBmF,IAAIpF,GACHC,UAAakJ,EAAKlJ,UAClB4N,aAdOjK,KAcY5C,IAAInE,IAAIgR,cAAgBhT,OAAO4N,SAASiH,WAI5D,OAFIvG,EAAKjJ,YAAWF,EAAmB,UAAImJ,EAAKjJ,YAG/C6E,MAAQ,2CACR/E,QAASA,GAhBVnF,OAAO0O,MAAM7N,GAAG,4CAqBlBwhB,uBAAwB,WACvB,IAAIlS,EAAKpH,KACH/G,EAAM+G,KAAK5C,IAAInE,IACrB,GAAGA,EAAIqgB,wBAA0C,kBAAhBrgB,EAAIU,QAA6B,CACjE,IAAIsQ,EAAehR,EAAIgR,cAAgBhR,EAAIiR,iBAC3CjT,OAAO4H,MACNC,OAAQ,4DACRC,MACCujB,eAAgBrpB,EAAIqgB,uBACpBrP,aAAcA,EACdkL,YAAalc,EAAI0d,eAAiB1d,EAAIkc,YACtCpL,UAAW9Q,EAAI8Q,WAEhBnL,SAAU,SAASK,GACfA,EAAEM,UAAYN,EAAE6E,KAClBsD,EAAGhK,IAAI5C,UAAU,mBAAoByE,EAAEM,cAO5Coe,aAAc,SAAS1kB,EAAKgO,EAAKC,GAChC,IAAIzF,EAAMnH,OAAO2M,GAAKC,GACnBzF,EAAIkc,cACN1mB,OAAO4H,MACNC,OAAQ,mEACRC,MACC2e,KAAMjc,EAAIkc,aACV5T,UAAW/J,KAAK5C,IAAInE,IAAI8Q,UACxBE,aAAcjK,KAAK5C,IAAInE,IAAIgR,cAAgBjK,KAAK5C,IAAInE,IAAIiR,iBACxDiL,YAAanV,KAAK5C,IAAInE,IAAI0d,eAAiB3W,KAAK5C,IAAInE,IAAIkc,aAEzDvW,SAAU,SAASK,GAClB,GAAGA,EAAEM,UAAYN,EAAE6E,IAClB,IAAK,IAAIpK,KAAKuF,EAAEM,QACftI,OAAOoI,MAAM7E,UAAUyM,EAAKC,EAAKxN,EAAGuF,EAAEM,QAAQ7F,UASrDb,QAAQujB,2BAA6B,SAAShf,EAAK1D,EAAGkF,EAAU2jB,EAAU3Z,GACzE3R,OAAOurB,QAAQ,sDAAuD,WACrE,IAAI3pB,QAAQ4pB,uBACXrlB,IAAKA,EACLmI,KAAM7L,EACNgpB,mBACC/e,KAAM,YACNpM,KAAMmC,EAAE4C,WAETsC,SAAUA,EACV2jB,SAAUA,GACR3Z,y/cCpzCL/P,QAAQ8pB,aAAeC,MAAM5qB,QAC5B6qB,KAAM,SAAS1iB,GACdhJ,EAAEa,OAAOgI,KAAMG,GAEVH,KAAKK,aACTL,KAAKK,WAAa,aAGdL,KAAK8iB,aACT9iB,KAAK8iB,WAAajqB,QAAQqM,QAAQK,OAAOpE,OAG1CnB,KAAKsC,KAAOtC,KAAK5C,IAAIgc,UAAU,SAAS9W,KACxCtC,KAAKqH,SAGNA,MAAO,WACN,IAAID,EAAKpH,KACLA,KAAKsC,KAAKygB,mBACb/iB,KAAKsC,KAAKygB,iBAAmB/iB,KAAKsC,KAAK4J,kBAAkBpU,GAAG,aAAc,WACrEsP,EAAG7G,QACN6G,EAAG0B,cAEJ1B,EAAG7G,OAAOtD,OACVmK,EAAG4b,eACHC,WAAW,WAAa7b,EAAG7G,OAAO4I,MAAM+Z,SAAY,SAKvDpa,YAAa,WACZ9I,KAAKO,OAAS,IAAItJ,OAAO0E,GAAGC,QAC3BC,MAAO/D,GAAG,eAEX,IAAI8U,EAAOzV,EAAE6I,KAAKO,OAAOqM,MACzBA,EAAKnV,KAAK,mGAGVuI,KAAKO,OAAO4I,MAAQyD,EAAKI,KAAK,iBAC9BhN,KAAKO,OAAO4iB,QAAUvW,EAAKI,KAAK,YAEhC,IAAI5F,EAAKpH,KACTA,KAAKO,OAAO4iB,QAAQznB,GAAG,QAAS,mBAAoB,WACnD0L,EAAGkD,SAASnT,EAAE6I,MAAMpI,KAAK,gBAG1BoI,KAAKO,OAAO4I,MAAMzN,GAAG,QAAS,WAC1B0L,EAAGgc,YACLC,aAAajc,EAAGgc,YAEjBhc,EAAGgc,WAAaH,WAAW,WAC1B7b,EAAG4b,eACH5b,EAAGgc,gBAAahf,GACd,QAILkG,SAAU,SAASjO,cAEdinB,GAAQ,EAYZ,GATAnsB,EAAEiM,KAAKpD,KAAK5C,IAAInE,IAAI0J,mBAAcnE,EAAG9E,GACpC,GAAGA,EAAEsG,EAAKK,cAAchE,EAIvB,OAHApF,OAAOoI,MAAM7E,UAAUd,EAAEC,QAASD,EAAEnC,KAAM,MAAOmC,EAAEiI,IAAM,GACzD1K,OAAOssB,YAAYhkB,QAASzH,GAAG,mBAAoBuE,EAAW3C,EAAEiI,MAAO6hB,UAAW,UAClFF,GAAQ,GACD,KAILA,EAAO,CACV,IAAI5pB,EAAI,KACRzC,OAAOoT,yBACE3Q,EAAIsG,EAAKsC,KAAKmhB,iCAChBxsB,OAAOoI,MAAM7E,UAAUd,EAAEC,QAASD,EAAEnC,KAAMyI,EAAKK,WAAYhE,sBAC3DpF,OAAOysB,QAAQ,gBAEpBzsB,OAAOoI,MAAM7E,UAAUd,EAAEC,QAASD,EAAEnC,KAAM,MAAO,GACjDN,OAAOssB,YAAYhkB,QAASzH,GAAG,mBAAoBuE,EAAW,IAAKmnB,UAAW,eAOlFR,aAAc,WACbxhB,IAAIzC,GACHoC,MAAOnB,KAAK8iB,WACZ1mB,YAED2C,EAAK4kB,IAAM3jB,KAAKO,OAAO4I,MAAMzM,MAC7BqC,EAAK6kB,QAAU,EAEX5jB,KAAK6jB,aACR1sB,EAAEa,OAAO+G,EAAK3C,QAAS4D,KAAK6jB,mBAG7B,IAAIzc,EAAKpH,KACT/I,OAAO6sB,YAAY,OAAQ/kB,EAAM,SAASE,GACzC9H,EAAEiM,KAAKnE,EAAEuF,OAAQ,SAAShG,EAAG9E,GACxBA,EAAEqqB,QACLrqB,EAAEsqB,KAAO/sB,OAAOgtB,SAASvqB,EAAEiL,WAC3BjL,EAAEwqB,MAAQjtB,OAAOktB,YAAYzqB,EAAEiL,cAGjCyC,EAAG7G,OAAO4iB,QAAQ1rB,KAAKR,OAAOuW,gBAAgB,iBAAkBlN,KAAOrB,EAAEuF,eC1G5EvN,OAAOC,QAAQ,0BAEfD,OAAOmtB,KAAKC,WAAW,sBACpBnoB,MAAO,cAAeooB,IAAK,gFAK9BrtB,OAAOmtB,KAAKC,WAAW,eACpBnoB,MAAO,WAAYooB,IAAK,kGACxBpoB,MAAO,cAAeooB,IAAK,oFAG9BrtB,OAAOmtB,KAAKC,WAAW,wBACpBnoB,MAAO,2BAA4BooB,IAAK,4GACxCpoB,MAAO,6CAA8CooB,IAAK,4FAC1DpoB,MAAO,mBAAoBooB,IAAK,sGAChCpoB,MAAO,UAAWooB,IAAK,6FACvBpoB,MAAO,WAAYooB,IAAK,wFAG3BrtB,OAAOmtB,KAAKC,WAAW,0BACpBnoB,MAAO,gBAAiBooB,IAAK,wFAGhCrtB,OAAOmtB,KAAKC,WAAW,sBACpBnoB,MAAO,+BAAgCooB,IAAK,qFAC5CpoB,MAAO,yCAA0CooB,IAAK,+GAGzDrtB,OAAOmtB,KAAKC,WAAyB,eAClCnoB,MAAO,2BAA4BooB,IAAK,4GAG3CrtB,OAAOmtB,KAAKC,WAAW,wBACpBnoB,MAAO,gBAAiBooB,IAAK,sFAC7BpoB,MAAO,8CAA+CooB,IAAK,oGAG9DrtB,OAAOmtB,KAAKC,WAAW,0BACpBnoB,MAAO,kBAAmBooB,IAAK,wFAGlCrtB,OAAOmtB,KAAKC,WAAW,uBACpBnoB,MAAO,eAAgBooB,IAAK,kFAG/BrtB,OAAOmtB,KAAKC,WAAW,wBACpBnoB,MAAO,gBAAiBooB,IAAK,oFAGhCrtB,OAAOmtB,KAAKC,WAAW,sBACpBnoB,MAAO,cAAeooB,IAAK,iFAG9BrtB,OAAOmtB,KAAKC,WAAW,2BACpBnoB,MAAO,mBAAoBooB,IAAK,sFAGnCrtB,OAAOmtB,KAAKC,WAAW,+BACpBnoB,MAAO,uBAAwBooB,IAAK,0FAGvCrtB,OAAOmtB,KAAKC,WAAW,gCACpBnoB,MAAO,wBAAyBooB,IAAK,2FAGxCrtB,OAAOmtB,KAAKC,WAAW,wBACpBnoB,MAAO,gBAAiBooB,IAAK,mFAGhCrtB,OAAOmtB,KAAKC,WAAW,sBACpBnoB,MAAO,cAAeooB,IAAK,kFAG9BrtB,OAAOmtB,KAAKC,WAAW,sBACpBnoB,MAAO,cAAeooB,IAAK,kFAG9BrtB,OAAOmtB,KAAKC,WAAW,uBACpBnoB,MAAO,eAAgBooB,IAAK,kFAG/BrtB,OAAOmtB,KAAKC,WAAW,4BACpBnoB,MAAO,qBAAsBooB,IAAK,mFAGrCrtB,OAAOmtB,KAAKC,WAAW,yBACpBnoB,MAAO,iBAAkBooB,IAAK,oFAGjCrtB,OAAOmtB,KAAKC,WAAW,0BACpBnoB,MAAO,uBAAwBooB,IAAK,oFAGvCrtB,OAAOmtB,KAAKC,WAAW,wBACpBnoB,MAAO,gBAAiBooB,IAAK,oFAKhCrtB,OAAOmtB,KAAKC,WAAW,0BACpBnoB,MAAO,kBAAmBooB,IAAK,+FAGlCrtB,OAAOmtB,KAAKC,WAAW,4BACpBnoB,MAAO,oBAAqBooB,IAAK,iGAGpCrtB,OAAOmtB,KAAKC,WAAW,2BACpBnoB,MAAO,mBAAoBooB,IAAK,2FAGnCrtB,OAAOmtB,KAAKC,WAAW,wBACpBnoB,MAAO,gBAAiBooB,IAAK,6FAGhCrtB,OAAOmtB,KAAKC,WAAW,0BACpBnoB,MAAO,kBAAmBooB,IAAK,+FAKlCrtB,OAAOmtB,KAAKC,WAAW,oBACpBnoB,MAAO,YAAaooB,IAAK,sEACzBpoB,MAAO,oBAAqBooB,IAAK,uFACjCpoB,MAAO,eAAgBooB,IAAK,6GAC5BpoB,MAAO,kBAAmBooB,IAAK,mFAGlCrtB,OAAOmtB,KAAKC,WAAW,mBACpBnoB,MAAO,WAAYooB,IAAK,iEACxBpoB,MAAO,eAAgBooB,IAAK,0EAG/BrtB,OAAOmtB,KAAKC,WAAW,mBACpBnoB,MAAO,WAAYooB,IAAK,iEACxBpoB,MAAO,eAAgBooB,IAAK,0EAG/BrtB,OAAOmtB,KAAKC,WAAW,2CACpBnoB,MAAO,mBAAoBooB,IAAK,gFAGnCrtB,OAAOmtB,KAAKC,WAAW,2CACpBnoB,MAAO,mBAAoBooB,IAAK,gFAGnCrtB,OAAOmtB,KAAKC,WAAW,sBACpBnoB,MAAO,cAAeooB,IAAK,wEAC3BpoB,MAAO,wBAAyBooB,IAAK,2FACrCpoB,MAAO,oBAAqBooB,IAAK,uFAGpCrtB,OAAOmtB,KAAKC,WAAW,sBACpBnoB,MAAO,cAAeooB,IAAK,wEAC3BpoB,MAAO,wBAAyBooB,IAAK,2FACrCpoB,MAAO,oBAAqBooB,IAAK,uFACjCpoB,MAAO,gBAAiBooB,IAAK,mFAC7BpoB,MAAO,eAAgBooB,IAAK,6GAC5BpoB,MAAO,oBAAqBooB,IAAK,uFACjCpoB,MAAO,kBAAmBooB,IAAK,mFAGlCrtB,OAAOmtB,KAAKC,WAAW,yBACpBnoB,MAAO,iBAAkBooB,IAAK,iFAGjCrtB,OAAOmtB,KAAKC,WAAW,2BACpBnoB,MAAO,mBAAoBooB,IAAK,mFAKnCrtB,OAAOmtB,KAAKC,WAAW,mBACpBnoB,MAAO,WAAYooB,IAAK,oEAG3BrtB,OAAOmtB,KAAKC,WAAW,mBACpBnoB,MAAO,WAAYooB,IAAK,oEAG3BrtB,OAAOmtB,KAAKC,WAAW,gCACpBnoB,MAAO,wBAAyBooB,IAAK,iFACrCpoB,MAAO,YAAaooB,IAAK,kFAG5BrtB,OAAOmtB,KAAKC,WAAW,6BACpBnoB,MAAO,qBAAsBooB,IAAK,8EAGrCrtB,OAAOmtB,KAAKC,WAAW,0BACpBnoB,MAAO,kBAAmBooB,IAAK,iFAGlCrtB,OAAOmtB,KAAKC,WAAW,yBACpBnoB,MAAO,iBAAkBooB,IAAK,0EAC9BpoB,MAAO,2BAA4BooB,IAAK,2FAG3CrtB,OAAOmtB,KAAKC,WAAW,yBACpBnoB,MAAO,iBAAkBooB,IAAK,0EAC9BpoB,MAAO,WAAYooB,IAAK,iGACxBpoB,MAAO,qBAAsBooB,IAAK,0GAClCpoB,MAAO,2BAA4BooB,IAAK,2FACxCpoB,MAAO,iBAAkBooB,IAAK,iFAGjCrtB,OAAOmtB,KAAKC,WAAW,8CACpBnoB,MAAO,mBAAoBooB,IAAK,gFAGnCrtB,OAAOmtB,KAAKC,WAAW,sBACpBnoB,MAAO,cAAeooB,IAAK,2EAG9BrtB,OAAOmtB,KAAKC,WAAW,qBACpBnoB,MAAO,aAAcooB,IAAK,2EAG7BrtB,OAAOmtB,KAAKC,WAAW,6BACpBnoB,MAAO,qBAAsBooB,IAAK,kFAGrCrtB,OAAOmtB,KAAKC,WAAW,uBACpBnoB,MAAO,eAAgBooB,IAAK,2EAG/BrtB,OAAOmtB,KAAKC,WAAW,+BACpBnoB,MAAO,uBAAwBooB,IAAK,4GAGvCrtB,OAAOmtB,KAAKC,WAAW,oBACpBnoB,MAAO,YAAaooB,IAAK,yEAG5BrtB,OAAOmtB,KAAKC,WAAW,yBACpBnoB,MAAO,iBAAkBooB,IAAK,mFAC9BpoB,MAAO,4BAA6BooB,IAAK,mGAG5CrtB,OAAOmtB,KAAKC,WAAW,mBACpBnoB,MAAO,WAAYooB,IAAK,yEAG3BrtB,OAAOmtB,KAAKC,WAAW,kBACpBnoB,MAAO,UAAWooB,IAAK,6EACvBpoB,MAAO,8BAA+BooB,IAAK,oGAC3CpoB,MAAO,gDAAiDooB,IAAK,sHAKhErtB,OAAOmtB,KAAKC,WAAW,sBACpBnoB,MAAO,2BAA4BooB,IAAK,6DACxCpoB,MAAO,oBAAqBooB,IAAK,oFACjCpoB,MAAO,4BAA6BooB,IAAK,uFAG5CrtB,OAAOmtB,KAAKC,WAAW,kBACpBnoB,MAAO,oBAAqBooB,IAAK,+EACjCpoB,MAAO,uBAAwBooB,IAAK,wGAGvCrtB,OAAOmtB,KAAKC,WAAW,wBACpBnoB,MAAO,gBAAiBooB,IAAK,2EAC7BpoB,MAAO,2BAA4BooB,IAAK,8EACxCpoB,MAAO,eAAgBooB,IAAK,uEAC5BpoB,MAAO,0BAA2BooB,IAAK,2FAG1CrtB,OAAOmtB,KAAKC,WAAW,wBACpBnoB,MAAO,gBAAiBooB,IAAK,2EAC7BpoB,MAAO,2BAA4BooB,IAAK,8EACxCpoB,MAAO,eAAgBooB,IAAK,uEAC5BpoB,MAAO,0BAA2BooB,IAAK,2FAG1CrtB,OAAOmtB,KAAKC,WAAgB,MACzBnoB,MAAO,wBAAyBooB,IAAK,uFAGxCrtB,OAAOmtB,KAAKC,WAAW,sBACpBnoB,MAAO,wBAAyBooB,IAAK,2EAGxCrtB,OAAOmtB,KAAKC,WAAW,2BACpBnoB,MAAO,mBAAoBooB,IAAK,8EAChCpoB,MAAO,2BAA4BooB,IAAK,8EACxCpoB,MAAO,6BAA8BooB,IAAK,2FAG7CrtB,OAAOmtB,KAAKC,WAAW,wBACpBnoB,MAAO,gBAAiBooB,IAAK,2EAC7BpoB,MAAO,wBAAyBooB,IAAK,mFACrCpoB,MAAO,2BAA4BooB,IAAK,8EAG3CrtB,OAAOmtB,KAAKC,WAAW,wBACpBnoB,MAAO,gBAAiBooB,IAAK,2EAGhCrtB,OAAOmtB,KAAKC,WAAW,0BACpBnoB,MAAO,kBAAmBooB,IAAK,6EAGlCrtB,OAAOmtB,KAAKC,WAAW,gBACpBnoB,MAAO,wBAAyBooB,IAAK,mFAGxCrtB,OAAOmtB,KAAKC,WAAW,yBACpBnoB,MAAO,iBAAkBooB,IAAK,mFAGjCrtB,OAAOmtB,KAAKC,WAAW,sBACpBnoB,MAAO,YAAaooB,IAAK,uEAG5BrtB,OAAOmtB,KAAKC,WAAW,eACpBnoB,MAAO,OAAQooB,IAAK,8DACpBpoB,MAAO,aAAcooB,IAAK,0EAC1BpoB,MAAO,UAAWooB,IAAK,6FACvBpoB,MAAO,qBAAsBooB,IAAK,gFAClCpoB,MAAO,wBAAyBooB,IAAK,mFACrCpoB,MAAO,oBAAqBooB,IAAK,iFACjCpoB,MAAO,gBAAiBooB,IAAK,6EAC7BpoB,MAAO,iBAAkBooB,IAAK,sGAGjCrtB,OAAOmtB,KAAKC,WAAW,eACpBnoB,MAAO,OAAQooB,IAAK,8DACpBpoB,MAAO,aAAcooB,IAAK,0EAC1BpoB,MAAO,UAAWooB,IAAK,6FACvBpoB,MAAO,qBAAsBooB,IAAK,gFAClCpoB,MAAO,wBAAyBooB,IAAK,mFACrCpoB,MAAO,oBAAqBooB,IAAK,iFACjCpoB,MAAO,gBAAiBooB,IAAK,6EAC7BpoB,MAAO,iBAAkBooB,IAAK,sGAGjCrtB,OAAOmtB,KAAKC,WAAW,2BACpBnoB,MAAO,mBAAoBooB,IAAK,2EAChCpoB,MAAO,UAAWooB,IAAK,6FAG1BrtB,OAAOmtB,KAAKC,WAAW,wBACpBnoB,MAAO,gBAAiBooB,IAAK,wEAC7BpoB,MAAO,UAAWooB,IAAK,6FACvBpoB,MAAO,eAAgBooB,IAAK,uEAG/BrtB,OAAOmtB,KAAKC,WAAW,wBACpBnoB,MAAO,gBAAiBooB,IAAK,wEAC7BpoB,MAAO,eAAgBooB,IAAK,uEAC5BpoB,MAAO,UAAWooB,IAAK,6FACvBpoB,MAAO,iBAAkBooB,IAAK,iFAGjCrtB,OAAOmtB,KAAKC,WAAW,4BACpBnoB,MAAO,oBAAqBooB,IAAK,4EAIpCrtB,OAAOmtB,KAAKC,WAAiB,OAC1BnoB,MAAO,kCAAmCooB,IAAK,wGAGlDrtB,OAAOmtB,KAAKC,WAAW,iBACpBnoB,MAAO,YAAaooB,IAAK,uEAK5BrtB,OAAOmtB,KAAKC,WAAW,2BACpBnoB,MAAO,mBAAoBooB,IAAK,2EAChCpoB,MAAO,oCAAqCooB,IAAK,qGAGpDrtB,OAAOmtB,KAAKC,WAAW,2BACpBnoB,MAAO,mBAAoBooB,IAAK,2EAChCpoB,MAAO,oCAAqCooB,IAAK,qGAGpDrtB,OAAOmtB,KAAKC,WAAW,sBACpBnoB,MAAO,cAAeooB,IAAK,sEAC3BpoB,MAAO,oBAAqBooB,IAAK,uFACjCpoB,MAAO,eAAgBooB,IAAK,gFAC5BpoB,MAAO,gBAAiBooB,IAAK,wEAC7BpoB,MAAO,iBAAkBooB,IAAK,iFAGjCrtB,OAAOmtB,KAAKC,WAAW,sBACpBnoB,MAAO,cAAeooB,IAAK,sEAG9BrtB,OAAOmtB,KAAKC,WAAW,oBACpBnoB,MAAO,YAAaooB,IAAK,oEAG5BrtB,OAAOmtB,KAAKC,WAAW,oBACpBnoB,MAAO,YAAaooB,IAAK,oEAG5BrtB,OAAOmtB,KAAKC,WAAW,oBACpBnoB,MAAO,YAAaooB,IAAK,oEAG5BrtB,OAAOmtB,KAAKC,WAAW,gBACpBnoB,MAAO,QAASooB,IAAK,gEAGxBrtB,OAAOmtB,KAAKC,WAAW,uBACpBnoB,MAAO,eAAgBooB,IAAK,6EAG/BrtB,OAAOmtB,KAAKC,WAAW,6BACpBnoB,MAAO,qBAAsBooB,IAAK,mFAGrCrtB,OAAOmtB,KAAKC,WAAW,8BACpBnoB,MAAO,sBAAuBooB,IAAK,oFAGtCrtB,OAAOmtB,KAAKC,WAAW,qBACpBnoB,MAAO,aAAcooB,IAAK,2EAG7BrtB,OAAOmtB,KAAKC,WAAW,yBACpBnoB,MAAO,iBAAkBooB,IAAK,+EAGjCrtB,OAAOmtB,KAAKC,WAAW,cACpBnoB,MAAO,mBAAoBooB,IAAK,6FAGnCrtB,OAAOmtB,KAAKC,WAAW,+BACpBnoB,MAAO,sBAAuBooB,IAAK,wEAKtCrtB,OAAOmtB,KAAKC,WAAW,eACpBnoB,MAAO,OAAQooB,IAAK,6DAGvBrtB,OAAOmtB,KAAKC,WAAW,sBACpBnoB,MAAO,cAAeooB,IAAK,oEAG9BrtB,OAAOmtB,KAAKC,WAAW,kBACpBnoB,MAAO,UAAWooB,IAAK,gEAG1BrtB,OAAOmtB,KAAKC,WAAW,kBACpBnoB,MAAO,UAAWooB,IAAK,gEAG1BrtB,OAAOmtB,KAAKC,WAAW,qBACpBnoB,MAAO,aAAcooB,IAAK,mEAG7BrtB,OAAOmtB,KAAKC,WAAW,mBACpBnoB,MAAO,WAAYooB,IAAK,uEAG3BrtB,OAAOmtB,KAAKC,WAAW,uBACpBnoB,MAAO,eAAgBooB,IAAK,2EAG/BrtB,OAAOmtB,KAAKC,WAAW,uBACpBnoB,MAAO,sBAAuBooB,IAAK,iGAKtCrtB,OAAOmtB,KAAKC,WAAW,2BACpBnoB,MAAO,mBAAoBooB,IAAK,4FAGnCrtB,OAAOmtB,KAAKC,WAAW,2BACpBnoB,MAAO,mBAAoBooB,IAAK,wFAGnCrtB,OAAOmtB,KAAKC,WAAW,2BACpBnoB,MAAO,mBAAoBooB,IAAK,wFAKnCrtB,OAAOmtB,KAAKC,WAAW,cACpBnoB,MAAO,mBAAoBooB,IAAK,oFAChCpoB,MAAO,uBAAwBooB,IAAK,gGAGvCrtB,OAAOmtB,KAAKC,WAAW,qBACpBnoB,MAAO,aAAcooB,IAAK,6EAG7BrtB,OAAOmtB,KAAKC,WAAW,sBACpBnoB,MAAO,cAAeooB,IAAK,8EAG9BrtB,OAAOmtB,KAAKC,WAAW,oBACpBnoB,MAAO,YAAaooB,IAAK,4EAG5BrtB,OAAOmtB,KAAKC,WAAW,mCACpBnoB,MAAO,2BAA4BooB,IAAK,iGAG3CrtB,OAAOmtB,KAAKC,WAAW,0BACpBnoB,MAAO,kBAAmBooB,IAAK,wFAKlCrtB,OAAOmtB,KAAKC,WAAW,yBACpBnoB,MAAO,eAAgBooB,IAAK,mFAC5BpoB,MAAO,kBAAmBooB,IAAK,qFAGlCrtB,OAAOmtB,KAAKC,WAAW,uBACpBnoB,MAAO,eAAgBooB,IAAK,mFAG/BrtB,OAAOmtB,KAAKC,WAAW,uBACpBnoB,MAAO,eAAgBooB,IAAK,mFC9gB/BrtB,OAAOC,QAAQ,eAEfqtB,YAAYC,uBACX,WAAYrkB,cACX/F,OAAOqqB,OAAOzkB,KAAMG,GAEpBlJ,OAAOurB,QAAQ,kDACdxiB,EAAK0kB,WACL1kB,EAAK2kB,YACL3kB,EAAK4kB,cACL5kB,EAAK6kB,YACL7kB,EAAK8kB,oBACL9kB,EAAK+kB,cACL/kB,EAAKglB,iCAIPN,oBACC1kB,KAAKilB,KAAO9tB,EAAE,kCACdA,EAAE6I,KAAKogB,QAAQ8E,OAAOllB,KAAKilB,mBAG5BN,qBACC3kB,KAAKmlB,MAAQ,IAAIC,KAAKplB,KAAKilB,KAAKI,IAAI,iBAGrCT,uBACC5kB,KAAKslB,QACJC,cAAe,IACfC,QAAS,GACTC,YAAa,EACbC,OAAQzuB,OAAO0E,GAAGuoB,MAAMmB,IAAI,UAE7BrlB,KAAKslB,OAAOK,eAAiB3lB,KAAKslB,OAAOC,cAAgB,IACzD,MAA0DvlB,KAAKslB,wDAE/DtlB,KAAK4lB,QACJC,MACCC,QACCC,EAAIC,EAAIZ,KAAKa,IAAI,IAAKF,EACtBA,EAAGA,EAAIC,EAAIZ,KAAKa,IAAI,IACpBF,EAAIC,EAAGD,EAAIC,EAAIZ,KAAKa,IAAI,KAEzB/B,MAAOjtB,OAAO0E,GAAGuoB,MAAMmB,IAAI,UAE5Ba,YACCJ,QACCC,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAaI,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IACrCF,EAAI,GAAaI,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,KAEtC/B,MAAOjtB,OAAO0E,GAAGuoB,MAAMmB,IAAI,SAE5Be,YACCN,QACCC,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAM,KAAOE,EAAGJ,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACpEF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAaI,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IACrCF,EAAI,GAAaI,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IACrCF,EAAI,GAAaI,EAAI,IAAMA,EAAIf,KAAKa,IAAI,IAAKF,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,IAAME,EAAIf,KAAKa,IAAI,IACvFF,EAAI,GAAaI,EAAI,IAAMA,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,IAAME,EAAIf,KAAKa,IAAI,KAEjG/B,MAAOjtB,OAAO0E,GAAGuoB,MAAMmB,IAAI,OAAQ,UAEpCgB,MACCP,QACCC,EAAI,GAAaI,EAAI,KAAOA,EAAIf,KAAKa,IAAI,IAAKF,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,KAAOE,EAAIf,KAAKa,IAAI,IACzFF,EAAI,GAAaI,EAAI,KAAOA,EAAIf,KAAKa,IAAI,IAAM,KAAOE,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,KAAOE,EAAIf,KAAKa,IAAI,IACpGF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAM,KAAOE,EAAGJ,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACpEF,EAAI,GAAaI,EAAI,IAAMA,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,IAAME,EAAIf,KAAKa,IAAI,IAChGF,EAAI,GAAaI,EAAI,IAAMA,EAAIf,KAAKa,IAAI,IAAKF,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,IAAME,EAAIf,KAAKa,IAAI,KAExF/B,MAAOjtB,OAAO0E,GAAGuoB,MAAMmB,IAAI,UAE5BiB,WACCR,QACCC,EAAIC,EAAI,KAAOG,EAAIf,KAAKa,IAAI,IAAKF,EAAI,KAAOI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAaI,EAAI,KAAOA,EAAIf,KAAKa,IAAI,IAAKF,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,KAAOE,EAAIf,KAAKa,IAAI,IACzFF,EAAI,GAAaI,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IACrCF,EAAI,GAAaI,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IACrCF,EAAI,GAAaI,EAAI,KAAOA,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IACpEF,EAAIC,EAAI,KAAOG,EAAIf,KAAKa,IAAI,IAAKF,EAAI,KAAeI,EAAIf,KAAKa,IAAI,KAElE/B,MAAOjtB,OAAO0E,GAAGuoB,MAAMmB,IAAI,QAAS,SAErCkB,MACCT,QACCC,EAAIC,EAAI,KAAOG,EAAIf,KAAKa,IAAI,IAAKF,EAAI,KAAeI,EAAIf,KAAKa,IAAI,IACjEF,EAAI,GAAaI,EAAI,KAAOA,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IACpEF,EAAI,GAAaI,EAAGJ,EAAIC,EAAIZ,KAAKa,IAAI,IACrCF,EAAIC,EAAGD,EAAIC,EAAIZ,KAAKa,IAAI,KAEzB/B,MAAOjtB,OAAO0E,GAAGuoB,MAAMmB,IAAI,UAE5BmB,iBACCV,QACCC,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IACrDF,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAC9DF,EAAIC,EAAI,KAAOG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,KAAOI,EAAIf,KAAKa,IAAI,IAClEF,EAAIC,EAAI,KAAOG,EAAIf,KAAKa,IAAI,IAAKF,EAAI,KAAOI,EAAIf,KAAKa,IAAI,KAE1D/B,MAAOjtB,OAAO0E,GAAGuoB,MAAMmB,IAAI,OAAQ,SAEpCoB,YACCX,QACCC,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IACrDF,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAC9DF,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,KAEtD/B,MAAOjtB,OAAO0E,GAAGuoB,MAAMmB,IAAI,SAE5BqB,WACCZ,QACCC,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAC9DF,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAC9DF,EAAIC,EAAI,KAAOG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,KAAOI,EAAIf,KAAKa,IAAI,IAClEF,EAAIC,EAAI,KAAOG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,KAAOI,EAAIf,KAAKa,IAAI,KAEnE/B,MAAOjtB,OAAO0E,GAAGuoB,MAAMmB,IAAI,QAAS,UAErCsB,iBACCb,QACCC,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IAClEF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAM,KAAOE,EAAGJ,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACpEF,EAAIC,EAAI,KAAOG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,KAAOI,EAAIf,KAAKa,IAAI,KAEnE/B,MAAOjtB,OAAO0E,GAAGuoB,MAAMmB,IAAI,OAAQ,SAEpCuB,YACCd,QACCC,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,GAAaI,EAAIf,KAAKa,IAAI,KAEnE/B,MAAOjtB,OAAO0E,GAAGuoB,MAAMmB,IAAI,QAE5BwB,MACCf,QACCC,EAAIC,EAAIZ,KAAKa,IAAI,IAAKF,EACtBA,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAaI,EAAIf,KAAKa,IAAI,IACzDF,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAC9DF,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAM,GAAKE,EAAGJ,EAAI,GAAKI,EAAIf,KAAKa,IAAI,IAC9DF,EAAIC,EAAI,GAAKG,EAAIf,KAAKa,IAAI,IAAKF,EAAI,GAAKI,EAAIf,KAAKa,IAAI,KAEtD/B,MAAOjtB,OAAO0E,GAAGuoB,MAAMmB,IAAI,yBAK9ByB,oBAAWC,GACV,OAAO/mB,KAAK4lB,OAAOmB,GAAWjB,oBAG/BkB,mBAAUD,GACT,OAAO/mB,KAAK4lB,OAAOmB,GAAW7C,mBAG/BW,qBACC,IAAKrjB,IAAIulB,UAAkBnB,YACrBT,MAAM8B,aAAaH,WAAWC,IAAYnvB,MAC9CsvB,UAAWF,UAAUD,GACrBrB,YAAaJ,OAAOI,OACpBD,iBAAkBH,OAAOG,2BAK5BX,6BACC,MAA0D9kB,KAAKslB,sDAEpDtlB,KAAKmlB,MAAM/V,KAAK4W,EAAIZ,KAAKa,IAAI,IAAM,EAAGF,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,EAAGnuB,GAAG,SAASF,MACtFsvB,KAAMjwB,OAAO0E,GAAGuoB,MAAMmB,IAAI,WAEtB8B,UAAU,QAEJnnB,KAAKmlB,MAAM/V,KAAK4W,EAAGD,EAAIC,EAAIZ,KAAKa,IAAI,IAAM,EAAGnuB,GAAG,SAASF,MACnEsvB,KAAMjwB,OAAO0E,GAAGuoB,MAAMmB,IAAI,WAEtB8B,UAAU,OAEJnnB,KAAKmlB,MAAM/V,KAAK,GAAK4W,EAAIZ,KAAKa,IAAI,IAAK,GAAKD,EAAIZ,KAAKa,IAAI,IAAKnuB,GAAG,SAASF,MACpFsvB,KAAMjwB,OAAO0E,GAAGuoB,MAAMmB,IAAI,WAEtB8B,UAAU,mBAGhBpC,2BAEK3X,EAAQ,EACRga,EAAS,EACTC,GAAY,EAChB,IAAK7lB,IAAIulB,UAAkBnB,OAAQ,CAC9BxY,EAAQ,GAAKia,IAChBD,EAAS,IACTha,EAAQ,EACRia,GAAY,QAEGlC,MAAMmC,KAAK,EAAEF,EAAQ,EAAQ,GAANha,EAAU,IAAK,GAAI,EAAG,GAAGxV,MAC/DsvB,UAAWF,UAAUD,GACrBrB,OAAQzuB,OAAO0E,GAAGuoB,MAAMmB,IAAI,gBAEbF,MAAM/V,KAAK,EAAEgY,EAAQ,GAAS,GAANha,EAAU2Z,GAAWnvB,MAC5DsvB,KAAMjwB,OAAO0E,GAAGuoB,MAAMmB,IAAI,SAC1BkC,YAAa,KAEdna,kBAIF4X,mBAAUwC,kBAAqBxnB,qCAC9B,GAAI6mB,EAAOhB,EAAOU,GAAQ,EAAE,CAC3B,MAA0DvmB,KAAKslB,wDAE3DmC,EAAS1B,EAAIc,EAAOV,EAAIf,KAAKa,IAAI,IAAMM,EAAOJ,EAC9CuB,EAAS3B,EAAIQ,EAAOJ,EAAIf,KAAKa,IAAI,IAAMJ,EAAOM,EAAIf,KAAKuC,IAAI,IAC/D3nB,KAAK4nB,KAAO5nB,KAAKmlB,MAAM0C,OAAOJ,EAAQC,EAAQ,GAAG9vB,MAChDsvB,KAAMjwB,OAAO0E,GAAGuoB,MAAMmB,IAAI,UAC1BK,OAAQzuB,OAAO0E,GAAGuoB,MAAMmB,IAAI,UAC5BI,YAAa,kBAKhBqC,4BAC0B,IAAd9nB,KAAK4nB,MACf5nB,KAAK4nB,KAAKtL,yLCrObrlB,OAAOC,QAAQ,kBAEfD,OAAO0E,GAAGqI,KAAK+jB,mBAAqB9wB,OAAO0E,GAAGqI,KAAKgkB,eAAehwB,QACjE6qB,KAAM,SAASlpB,EAASsuB,GACvBjoB,KAAK2Y,OAAOhf,EAASsuB,IAGtBC,cAAe,WACdloB,KAAKmoB,UAAYnoB,KAAKooB,qBAAqBxrB,OAAOoD,KAAKmoB,WACvDnoB,KAAKmoB,UAAYnoB,KAAKmoB,UAAUvrB,OAAOoD,KAAKqoB,yBAC5CroB,KAAK2Y,SACL3Y,KAAKsoB,qCACLtoB,KAAKuoB,6BACLvoB,KAAKO,OAAO9E,SAASuR,KAAK,cAAcoC,KAAKtX,GAAG,8EAGjDwwB,mCAAoC,WACnCtoB,KAAKO,OAAOzG,YAAY0uB,eAAe/sB,SAASypB,OAAOjuB,OAAOuW,gBAAgB,qBAC9ExN,KAAKyoB,kCACLzoB,KAAK0oB,iCAEL1oB,KAAK2oB,6BACL3oB,KAAKO,OAAO6Y,UAAU,iBAAiBhX,GAAGzB,OAAS,EACnDX,KAAKO,OAAO6Y,UAAU,iBAAiB7W,WAGxCqmB,wBAAyB,WACxB,IAAIxhB,EAAKpH,KACTA,KAAKO,OAAO4M,mBAAmBrV,GAAG,QAAS,WAC1C,IAAIsP,EAAG7G,OAAOsoB,QAAd,CAEA,IAAIvoB,EAAO8G,EAAG7G,OAAOc,aACjBynB,KAWJ,GATI1hB,EAAG7G,OAAOzG,YAAYivB,eAAeC,OAAOC,KAAK,aACpDH,EAAiB1hB,EAAG8hB,kBACf9uB,OAAOC,KAAKyuB,GAAgBvuB,SAChC+F,EAAO,MAERwoB,EAAevK,UAAYnX,EAAG+hB,aAAa5K,UAC3CuK,EAAe7I,WAAa7Y,EAAG+hB,aAAalJ,YAGzC3f,EAAM,CACT8G,EAAG7G,OAAOsoB,SAAU,EACpB,IAAIrkB,EAAS4C,EAAGgiB,aAE0B,gBAAtCN,EAAiC,mBACpCtkB,EAAyB,iBAAI,gBAE9BrN,EAAEa,OAAO8wB,EAAgBtkB,GACzB4C,EAAGiiB,OAAOP,QAKbO,OAAQ,SAASP,GAChBtnB,IAAI4F,EAAKpH,KACT,OAAO,IAAIspB,iBAAQC,GAClBtyB,OAAO4H,MACNC,OAAQ,uBACRC,MACC9F,IAAK6vB,GAENlqB,SAAU,SAASK,GAClBmI,EAAG7G,OAAOvD,OAEV/F,OAAOoI,MAAMmqB,UAAUpiB,EAAG7G,OAAOtH,IAAIU,QAASyN,EAAG7G,OAAOtH,IAAI1B,MAC5D6P,EAAG7G,OAAOtH,IAAMgG,EAAEM,QACdtI,OAAOwyB,WACVxyB,OAAO0E,GAAGqI,KAAK0lB,oBAAoBtiB,EAAG7G,OAAOtH,KAEzCmO,EAAG6gB,aACN7gB,EAAG6gB,aAAa7gB,EAAG7G,OAAOtH,KAE1BmO,EAAGuiB,yBAINC,MAAO,WACNxiB,EAAGyiB,YAEJC,OAAQ,WACP1iB,EAAG7G,OAAOsoB,SAAU,EACpBU,EAAQniB,EAAG7G,OAAOtH,MAEnB8wB,QAAQ,OAKXF,SAAU,WAGT,GAFA7pB,KAAKO,OAAOvD,OACZgD,KAAKopB,aACDppB,KAAKO,OAAOzG,YAAYivB,eAAeC,OAAOC,KAAK,WAAY,CAClE,IAAIe,EAAWhqB,KAAKO,OAAOzG,YAAYmwB,cAAc9gB,MAAMzE,MACvDslB,GACH/yB,OAAOuI,UAAU,OAAQQ,KAAKrG,QAASqwB,QAExC/yB,OAAOuI,UAAU,OAAQQ,KAAKrG,QAASqG,KAAK/G,IAAI1B,OAIlD6wB,mBAAoB,WAqBnB,QAnBCpsB,UAAW,iBACXD,UAAW,QACXG,MAAOpE,GAAG,oBAGVkE,UAAW,gBACXE,MAAOpE,GAAG,iBACVmR,KAAM,EACNlN,UAAW,OACXE,QAAS,OACTE,UAAW,WACV,OACCC,SACC8tB,aAAgB,QASrBC,yBAA0B,WAezB,OAdAnqB,KAAKoqB,sBACJruB,UAAW,OACXE,QAAS,eACTC,MAAO,eACPF,UAAW,eACX2E,OAAQ,EACRsI,KAAM,IAENlN,UAAW,OACXG,MAAO,2BACPF,UAAW,uBACX2E,OAAQ,EACRsI,KAAM,IAEAjJ,KAAKoqB,qBAGb/B,sBAAuB,WACtB,IAAIgC,IACHruB,UAAW,iBACXD,UAAW,SAIZ,OADAsuB,EAAmBA,EAAiBztB,OAAOoD,KAAKmqB,6BAIjD1B,gCAAiC,WAChC,IAAIrhB,EAAKpH,KAETA,KAAKO,OAAOzG,YAAYivB,eAAeC,OAAOttB,GAAG,QAAS,WACzD0L,EAAGmhB,6BACHnhB,EAAGkjB,uCAAsC,MAAW,MAItD/B,2BAA4B,sBACvBgC,EAAcvqB,KAAKO,OAAO9D,UAAU,kBAGpC+tB,EAAiBxqB,KAAKO,OAAO6Y,UAAU,iBAC3CoR,EAAepoB,GAAG6G,KAAOshB,EACzBC,EAAehwB,UAAU,IACzBgwB,EAAepoB,GAAGzB,QAAU4pB,EAC5BC,EAAejoB,WAGd,YAAa,YAAa,aAAc,aAAahB,iBAAS7H,GAC9D8H,IAAI+Q,EAAIvS,EAAKO,OAAO6Y,UAAU1f,GAC9B6Y,EAAEnQ,GAAGzB,OAAS4pB,EACdhY,EAAEhQ,YAGHvC,KAAKO,OAAO6Y,UAAU,kBAAkBqR,QAAO,IAG9C,YAAa,YAAa,cAAclpB,iBAAS7H,GACjD8H,IAAI+Q,EAAIvS,EAAKO,OAAO6Y,UAAU1f,GAC9B6Y,EAAEnQ,GAAG6G,MAAQshB,EACbhY,EAAEhQ,aAKJmmB,+BAAgC,WAC/B,IAAIthB,EAAKpH,KAEToH,EAAG7G,OAAOzG,YAA2B,cAAEsI,GAAGrB,oBACzC,IAAIipB,EAAW5iB,EAAG7G,OAAOzG,YAAYmwB,cAAc9gB,MAAMzE,MACzD0C,EAAG+hB,aAAe,KACda,EACH/yB,OAAO4H,MACNC,OAAQ,oBACRC,MACCpF,QAAS,OACTpC,KAAMyyB,GAEPprB,SAAU,SAASK,GAClBmI,EAAG+hB,aAAelqB,EAAEM,QACpB6H,EAAGsjB,iBAAkB,EAEoB,iBAArCtjB,EAAG+hB,aAAawB,iBACnBvjB,EAAGkjB,uCAAsC,MAAU,IAGnDljB,EAAGkjB,uCAAsC,EAAOljB,EAAG+hB,aAAayB,YAAY,GAC5ExjB,EAAGyjB,kBAAkBzjB,EAAG+hB,aAAayB,iBAKxCxjB,EAAG7G,OAAO6Y,UAAU,kBAAkBqR,QAAO,GAC7CrjB,EAAGkjB,uCAAsC,MAAW,MAKvDA,sCAAuC,SAASI,EAAiBE,EAAYE,GAC5E9qB,KAAK4qB,WAAaA,EAClB5qB,KAAK+qB,oBACL/qB,KAAKgrB,iBAAmBJ,EAAWrwB,OAEnCyF,KAAKO,OAAOzG,YAAY0uB,eAAe/sB,SAASuR,KAAK,eAAeO,QACpEvN,KAAK0qB,gBAAkBA,EACvB1qB,KAAK2oB,6BACL3oB,KAAKO,OAAOzG,YAAY0uB,eAAe/sB,SAASuR,KAAK,eAAeie,YAAY,eAAgBH,GAChG9qB,KAAKO,OAAOzG,YAAY0uB,eAAe/sB,SAASuR,KAAK,sBAAsBie,YAAY,eAAgBH,IAGxGnC,2BAA4B,WAC3B,IAAIvhB,EAAKpH,KACT7I,EAAEiM,KAAKpD,KAAKoqB,oBAAqB,SAAS5rB,EAAG0sB,GAC5C9jB,EAAG7G,OAAO6Y,UAAU8R,EAAalvB,WAAWoG,GAAGzB,QAAUyG,EAAGsjB,gBAC5DtjB,EAAG7G,OAAO6Y,UAAU8R,EAAalvB,WAAWoG,GAAG6G,KAAiC,gBAA1BiiB,EAAalvB,WAA8BoL,EAAGsjB,gBACpGtjB,EAAG7G,OAAO6Y,UAAU8R,EAAalvB,WAAWuG,aAI9C4oB,2BAA4B,WAC3BnrB,KAAKO,OAAOzG,YAAY0uB,eAAe/sB,SAASuR,KAAK,eAAeO,QACpEvN,KAAK6qB,kBAAkB7qB,KAAK4qB,aAG7BC,kBAAmB,SAASD,GAC3B,IAAIxjB,EAAKpH,KAETA,KAAKO,OAAO6Y,UAAU,kBAAkBqR,QAAO,GAE/CtzB,EAAEiM,KAAKwnB,EAAY,SAASxd,EAAO3L,GAClC,IAAI2pB,EAAO,GACPrvB,EAAY,OACZ0F,EAAI4pB,iBACPtvB,EAAY,QACZqvB,EAAO,cAAgB3pB,EAAI6pB,WAAa,iBAAmB7pB,EAAI8pB,SAAW,uBAAyB9pB,EAAI+pB,WAGxGpkB,EAAGqkB,kBAAkB1vB,EAAW0F,GAChC2F,EAAG3F,EAAIiqB,WAAWlxB,UAAU4M,EAAG2jB,iBAAiBtpB,EAAIiqB,YAAc,IAClEtkB,EAAG3F,EAAIiqB,WAAWjwB,SAASwvB,YAAY,aAAa7jB,EAAG2jB,iBAAiBtpB,EAAIiqB,YAG5Ev0B,EAAEiQ,EAAG3F,EAAIiqB,WAAWC,YAAYvc,KAAKtX,GAAG2J,EAAIiqB,YAExCN,GACHj0B,EAAEkX,KAAK,+DACN+c,KAAQA,KACLQ,YAAYxkB,EAAG3F,EAAIiqB,WAAWG,YAG9BpqB,EAAI4pB,eAGRjkB,EAAG3F,EAAIiqB,WAAW1C,OAAOttB,GAAG,SAAU,WACrC0L,EAAG2jB,iBAAiBtpB,EAAIiqB,WAAav0B,EAAE6I,MAAMtD,MAC7CvF,EAAE6I,MAAM8rB,QAAQ,mBAAmBb,YAAY,aAAa9zB,EAAE6I,MAAMtD,SAJrE0K,EAAG2kB,+BAA+BtqB,MAUrCgqB,kBAAmB,SAAS1vB,EAAW0F,GACtCzB,KAAKyB,EAAIiqB,WAAaz0B,OAAO0E,GAAGqI,KAAKgoB,cACpC5pB,IACCrG,UAAaA,EACbG,MAASuF,EAAIiqB,UACb1vB,UAAayF,EAAIiqB,UACjBzvB,QAAWwF,EAAIxF,SAAW,IAE3BmkB,OAAQjpB,EAAE6I,KAAKO,OAAOzG,YAAY0uB,eAAetJ,SAASlS,KAAK,eAC/Dif,YAAY,IAEbjsB,KAAKyB,EAAIiqB,WAAWQ,cAGrBH,+BAAgC,SAAStqB,GACxC,IAAI2F,EAAKpH,KAETA,KAAKyB,EAAIiqB,WAAWviB,MAAMgjB,YAAc,IAAIC,YAAYpsB,KAAKyB,EAAIiqB,WAAWviB,OAC3EkjB,SAAU,EACVC,SAAU,GACVC,WAAW,EACXC,UAGDxsB,KAAKyB,EAAIiqB,WAAW1C,OAAOttB,GAAG,QAAS,SAASwF,GAC/CjK,OAAO4H,MACNC,OAAQ,yBACRC,MACCpF,QAAS,uBACTyC,UACE,SAAU,IAAKjF,EAAE+J,EAAEgD,QAAQtM,KAAK,oBAChC,kBAAmB,OAAQsJ,EAAEgD,OAAOQ,MAAQ,MAE9C5I,QAAS,mBACTskB,OAAQ,QAETxhB,SAAU,SAASK,GACdA,EAAEM,UACL2B,EAAEgD,OAAOioB,YAAYK,KAAOvtB,EAAEM,QAAQ3F,IAAI,SAASF,GAClD,OAAOA,EAAE+yB,wBAKX/wB,GAAG,QAAS,SAASwF,GACvB/J,EAAE+J,EAAEgD,QAAQxH,IAAI,IAAImF,QAAQ,WAC1BnG,GAAG,oBAAqB,SAAUwF,GACpCkG,EAAG2jB,iBAAiB5zB,EAAE+J,EAAEgD,QAAQtM,KAAK,mBAAqBsJ,EAAEgD,OAAOQ,MACnEvN,EAAE+J,EAAEgD,QAAQ4nB,QAAQ,mBAAmBb,YAAY,aAAa/pB,EAAEgD,OAAOQ,UAI3EwkB,gBAAiB,WAChB,IAAI9hB,EAAKpH,KACL0sB,KACAhB,EAAY1rB,KAAK2sB,gCAgCrB,OA9BIvyB,OAAOC,KAAKqxB,GAAWnxB,QAC1BtD,OAAO4H,MACNC,OAAQ,sEACRC,MACCirB,SAAY5iB,EAAG7G,OAAOzG,YAAYmwB,cAAcjB,OAAOtsB,MACvDqC,KAAM2sB,GAEPkB,OAAO,EACPhuB,SAAU,SAASK,GAClB,GAAiD,mBAA7C7E,OAAOyyB,UAAUC,SAASjuB,KAAKI,EAAEM,SACpCmtB,EAAcztB,EAAEM,YACV,CACN,IAAIwtB,EAAkB91B,OAAOyM,SAAS5L,GAAG,wDAAyDuW,KAAK,2FAErG9I,KAAMtG,EAAEM,aAGVwtB,EAAgBtxB,SAASuR,KAAK,kBAAkBtR,GAAG,QAAS,WAC3DqxB,EAAgB/vB,OAChBoK,EAAG7G,OAAOvD,OACN/F,OAAOwyB,WACVxyB,OAAOwyB,WAAWjvB,UAAUrD,EAAE6I,MAAMpI,KAAK,mBAEzCX,OAAOuI,UAAU,OAAQ,OAAQrI,EAAE6I,MAAMpI,KAAK,yBAO7C80B,GAGRC,8BAA+B,WAC9B,IAAIvlB,EAAKpH,KACL0rB,KACAvD,KAWJ,OATAhxB,EAAEiM,KAAKpD,KAAK4qB,WAAY,SAASxd,EAAOxV,GACvC,IAAI8M,EAAQ0C,EAAG2jB,iBAAiBnzB,EAAK8zB,YAAc,GAC/ChnB,EACHgnB,EAAU9zB,EAAK8zB,WAAa9zB,EAAKyzB,eAAiB9nB,IAAImB,GAASA,EAE/DyjB,EAAU9lB,KAAKzK,EAAK8zB,aAIlBvD,EAAU5tB,QACbtD,OAAOyM,UACN7H,MAAO/D,GAAG,2BACVyH,QAASzH,GAAG,yCAA2C,mBAAqBqwB,EAAUtrB,KAAK,QAAU,QACrG2mB,UAAW,gBAKTxjB,KAAK0qB,iBACRvzB,EAAEiM,KAAKpD,KAAKoqB,oBAAqB,SAAShd,EAAO4f,GAChDtB,EAAUsB,EAAMhxB,WAAaoL,EAAG7G,OAAOzG,YAAYkzB,EAAMhxB,WAAWmN,MAAMzE,QAGrEgnB,MCtZTz0B,OAAOC,QAAQ,kBAEfD,OAAO0E,GAAGqI,KAAKipB,uBAAyBh2B,OAAO0E,GAAGqI,KAAKgkB,eAAehwB,QACrE6qB,KAAM,SAASlpB,EAASsuB,GACvBjoB,KAAK2Y,OAAOhf,EAASsuB,IAGtBC,cAAe,WACdloB,KAAKmoB,UAAYnoB,KAAKmoB,UAAUvrB,OAAOoD,KAAKooB,sBAC5CpoB,KAAK2Y,UAGNyP,mBAAoB,WAiEnB,QA/DCrsB,UAAW,gBACXG,MAAOpE,GAAG,2BACVo1B,YAAa,IAGbhxB,MAAOpE,GAAG,YACVkE,UAAW,WACXD,UAAW,SAGXA,UAAW,iBAGXG,MAAOpE,GAAG,iBACVkE,UAAW,YACXD,UAAW,SAGXA,UAAW,gBACXG,MAAOpE,GAAG,2BACVo1B,YAAa,IAGbhxB,MAAOpE,GAAG,kBACVkE,UAAW,gBACXD,UAAW,SAGXG,MAAOpE,GAAG,kBACVkE,UAAW,gBACXD,UAAW,SAGXG,MAAOpE,GAAG,YACVkE,UAAW,UACXD,UAAW,SAGXA,UAAW,iBAGXG,MAAOpE,GAAG,QACVkE,UAAW,OACXD,UAAW,SAGXG,MAAOpE,GAAG,SACVkE,UAAW,QACXD,UAAW,SAGXG,MAAOpE,GAAG,WACVkE,UAAW,UACXD,UAAW,OACXE,QAAS,YAGTC,MAAOpE,GAAG,mBACVkE,UAAW,kBACXD,UAAW,OACX4E,OAAQ,+vGC1EX1J,OAAOC,QAAQ,qBAEfD,OAAOk2B,MAAMC,WAAan2B,OAAOk2B,MAAME,QAAQr1B,QAC9Cs1B,cAAKC,cACEC,EAAYv2B,OAAOw2B,gBACnB1S,EAAOwS,EAAM,GAEbG,GAEJ,yCAFIA,GAKJ,sCAGFz2B,OAAOoI,MAAMmE,SAAS,eAAgB,0BAGrC,GAFAxD,EAAK2tB,aAAe12B,OAAOiC,QAAQ,gBAE9BL,QAAQ+0B,IAAIC,MAAML,GA+BtBv2B,OAAO62B,UAAUC,UAAUP,GAC3BQ,OAAOC,SAAWp1B,QAAQ+0B,IAAIC,MAAML,OAhCF,CAClC,IAAIv2B,OAAOi3B,YAEV,YADAluB,EAAKmuB,sBAGDZ,EAAM,GAeVt2B,OAAOurB,QAAQkL,aACd70B,QAAQ+0B,IAAIC,MAAML,GAAa,IAAI30B,QAAQ+0B,IAAI7S,EAAK,SACnDqT,UAAWb,EAAM,GACjB5zB,QAAS4zB,EAAM,GACfnN,OAAQpgB,EAAKquB,WAAU,EAAMb,GAC7BG,aAAc3tB,EAAK2tB,iBAnBrB12B,OAAOurB,QAAQkL,aAEb70B,QAAQ+0B,IAAIC,MAAML,GADP,eAATzS,EAC6B,IAAIliB,QAAQ+0B,IAAgB,YAC1DxN,OAAQpgB,EAAKquB,WAAU,EAAMb,GAC7BG,aAAc3tB,EAAK2tB,eAGW,IAAI90B,QAAQ+0B,IAAI7S,EAAK,YACnDqF,OAAQpgB,EAAKquB,WAAU,EAAMb,GAC7BG,aAAc3tB,EAAK2tB,iBAcvBK,OAAOC,SAAWp1B,QAAQ+0B,IAAIC,MAAML,OAQvCW,+BACC3sB,IAAI/J,EAAO,iLAIJK,GAAG,0HAELA,GAAG,mCAGGX,EAAE,aACR+tB,OAAOztB"}