{"version":3,"file":"form.min.js","sources":["../../../apps/frappe/frappe/public/js/frappe/views/formview.js","../../../apps/frappe/frappe/public/js/legacy/form.js","../../../apps/frappe/frappe/public/js/legacy/client_script_helpers.js","../../../apps/frappe/frappe/public/js/frappe/form/toolbar.js","../../../apps/frappe/frappe/public/js/frappe/form/dashboard.js","../../../apps/frappe/frappe/public/js/frappe/form/document_flow.js","../../../apps/frappe/frappe/public/js/frappe/form/save.js","../../../apps/frappe/frappe/public/js/frappe/form/script_manager.js","../../../apps/frappe/frappe/public/js/frappe/form/grid.js","../../../apps/frappe/frappe/public/js/frappe/form/grid_row.js","../../../apps/frappe/frappe/public/js/frappe/form/grid_row_form.js","../../../apps/frappe/frappe/public/js/frappe/form/linked_with.js","../../../apps/frappe/frappe/public/js/frappe/form/workflow.js","../../../apps/frappe/frappe/public/js/frappe/form/print.js","../../../apps/frappe/frappe/public/js/frappe/form/form_sidebar.js","../../../apps/frappe/frappe/public/js/frappe/form/user_image.js","../../../apps/frappe/frappe/public/js/frappe/form/share.js","../../../apps/frappe/frappe/public/js/frappe/form/form_viewers.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/footer.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/attachments.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/timeline.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/assign_to.js","../../../apps/frappe/frappe/public/js/frappe/form/quick_entry.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.views.formview');\n\nfrappe.views.FormFactory = frappe.views.Factory.extend({\n\tmake: function(route) {\n\t\tvar me = this,\n\t\t\tdt = route[1];\n\n\t\tif(!frappe.views.formview[dt]) {\n\t\t\tfrappe.model.with_doctype(dt, function() {\n\t\t\t\tme.page = frappe.container.add_page(\"Form/\" + dt);\n\t\t\t\tfrappe.views.formview[dt] = me.page;\n\t\t\t\tme.page.frm = new _f.Frm(dt, me.page, true);\n\t\t\t\tme.show_doc(route);\n\t\t\t});\n\t\t} else {\n\t\t\tme.show_doc(route);\n\t\t}\n\n\n\t\tif(!this.initialized) {\n\t\t\t$(document).on(\"page-change\", function() {\n\t\t\t\tfrappe.ui.form.close_grid_form();\n\t\t\t});\n\n\t\t\tfrappe.realtime.on(\"new_communication\", function(data) {\n\t\t\t\tfrappe.timeline.new_communication(data);\n\t\t\t});\n\n\t\t\tfrappe.realtime.on(\"delete_communication\", function(data) {\n\t\t\t\tfrappe.timeline.delete_communication(data);\n\t\t\t});\n\n\t\t\tfrappe.realtime.on('update_communication', function(data) {\n\t\t\t\tfrappe.timeline.update_communication(data);\n\t\t\t});\n\n\t\t\tfrappe.realtime.on(\"doc_viewers\", function(data) {\n\t\t\t\tfrappe.ui.form.set_viewers(data);\n\t\t\t});\n\t\t}\n\n\n\t\tthis.initialized = true;\n\t},\n\tshow_doc: function(route) {\n\t\tvar dt = route[1],\n\t\t\tdn = route.slice(2).join(\"/\"),\n\t\t\tme = this;\n\n\t\tif(frappe.model.new_names[dn]) {\n\t\t\tdn = frappe.model.new_names[dn];\n\t\t\tfrappe.set_route(\"Form\", dt, dn);\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.model.with_doc(dt, dn, function(dn, r) {\n\t\t\tif(r && r['403']) return; // not permitted\n\n\t\t\tif(!(locals[dt] && locals[dt][dn])) {\n\t\t\t\t// doc not found, but starts with New,\n\t\t\t\t// make a new doc and set it\n\t\t\t\tvar new_str = __(\"New\") + \" \";\n\t\t\t\tif(dn && dn.substr(0, new_str.length)==new_str) {\n\t\t\t\t\tvar new_name = frappe.model.make_new_doc_and_get_name(dt, true);\n\t\t\t\t\tif(new_name===dn) {\n\t\t\t\t\t\tme.load(dt, dn);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.set_route(\"Form\", dt, new_name)\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.show_not_found(route);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tme.load(dt, dn);\n\t\t});\n\n\t},\n\tload: function(dt, dn) {\n\t\tfrappe.container.change_to(\"Form/\" + dt);\n\t\tfrappe.views.formview[dt].frm.refresh(dn);\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\n/* Form page structure\n\n\t+ this.parent (either FormContainer or Dialog)\n\t\t+ this.wrapper\n\t\t\t+ this.toolbar\n\t\t\t+ this.form_wrapper\n\t\t\t\t\t+ this.head\n\t\t\t\t\t+ this.body\n\t\t\t\t\t\t+ this.layout\n\t\t\t\t+ this.sidebar\n\t\t\t+ this.footer\n*/\n\nfrappe.provide('_f');\nfrappe.provide('frappe.ui.form');\n\nfrappe.ui.form.Controller = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t}\n});\n\n_f.frms = {};\n\n_f.Frm = function(doctype, parent, in_form) {\n\tthis.docname = '';\n\tthis.doctype = doctype;\n\tthis.hidden = false;\n\tthis.refresh_if_stale_for = 120;\n\n\tvar me = this;\n\tthis.opendocs = {};\n\tthis.custom_buttons = {};\n\tthis.sections = [];\n\tthis.grids = [];\n\tthis.cscript = new frappe.ui.form.Controller({frm:this});\n\tthis.events = {};\n\tthis.pformat = {};\n\tthis.fetch_dict = {};\n\tthis.parent = parent;\n\tthis.tinymce_id_list = [];\n\n\tthis.setup_meta(doctype);\n\n\t// show in form instead of in dialog, when called using url (router.js)\n\tthis.in_form = in_form ? true : false;\n\n\t// notify on rename\n\tvar me = this;\n\t$(document).on('rename', function(event, dt, old_name, new_name) {\n\t\tif(dt==me.doctype)\n\t\t\tme.rename_notify(dt, old_name, new_name);\n\t});\n};\n\n_f.Frm.prototype.check_doctype_conflict = function(docname) {\n\tvar me = this;\n\tif(this.doctype=='DocType' && docname=='DocType') {\n\t\tfrappe.msgprint(__('Allowing DocType, DocType. Be careful!'));\n\t} else if(this.doctype=='DocType') {\n\t\tif (frappe.views.formview[docname] || frappe.pages['List/'+docname]) {\n\t\t\twindow.location.reload();\n\t\t\t//\tfrappe.msgprint(__(\"Cannot open {0} when its instance is open\", ['DocType']))\n\t\t\t// throw 'doctype open conflict'\n\t\t}\n\t} else {\n\t\tif (frappe.views.formview.DocType && frappe.views.formview.DocType.frm.opendocs[this.doctype]) {\n\t\t\twindow.location.reload();\n\t\t\t//\tfrappe.msgprint(__(\"Cannot open instance when its {0} is open\", ['DocType']))\n\t\t\t// throw 'doctype open conflict'\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.setup = function() {\n\tvar me = this;\n\tthis.fields = [];\n\tthis.fields_dict = {};\n\tthis.state_fieldname = frappe.workflow.get_state_fieldname(this.doctype);\n\n\t// wrapper\n\tthis.wrapper = this.parent;\n\tthis.$wrapper = $(this.wrapper);\n\tfrappe.ui.make_app_page({\n\t\tparent: this.wrapper,\n\t\tsingle_column: this.meta.hide_toolbar\n\t});\n\tthis.page = this.wrapper.page;\n\tthis.layout_main = this.page.main.get(0);\n\n\tthis.toolbar = new frappe.ui.form.Toolbar({\n\t\tfrm: this,\n\t\tpage: this.page\n\t});\n\n\t// print layout\n\tthis.setup_print_layout();\n\n\t// 2 column layout\n\tthis.setup_std_layout();\n\n\t// client script must be called after \"setup\" - there are no fields_dict attached to the frm otherwise\n\tthis.script_manager = new frappe.ui.form.ScriptManager({\n\t\tfrm: this\n\t});\n\tthis.script_manager.setup();\n\tthis.watch_model_updates();\n\n\tif(!this.meta.hide_toolbar) {\n\t\tthis.footer = new frappe.ui.form.Footer({\n\t\t\tfrm: this,\n\t\t\tparent: $('<div>').appendTo(this.page.main.parent())\n\t\t});\n\t\t$(\"body\").attr(\"data-sidebar\", 1);\n\t}\n\tthis.setup_drag_drop();\n\n\tthis.setup_done = true;\n};\n\n_f.Frm.prototype.setup_drag_drop = function() {\n\tvar me = this;\n\tthis.$wrapper.on('dragenter dragover', false)\n\t\t.on('drop', function (e) {\n\t\t\tvar dataTransfer = e.originalEvent.dataTransfer;\n\t\t\tif (!(dataTransfer && dataTransfer.files && dataTransfer.files.length > 0)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif(me.doc.__islocal) {\n\t\t\t\tfrappe.msgprint(__(\"Please save before attaching.\"));\n\t\t\t\tthrow \"attach error\";\n\t\t\t}\n\n\t\t\tif(me.attachments.max_reached()) {\n\t\t\t\tfrappe.msgprint(__(\"Maximum Attachment Limit for this record reached.\"));\n\t\t\t\tthrow \"attach error\";\n\t\t\t}\n\n\t\t\tfrappe.upload.make({\n\t\t\t\targs: me.attachments.get_args(),\n\t\t\t\tfiles: dataTransfer.files,\n\t\t\t\tcallback: function(attachment, r) {\n\t\t\t\t\tme.attachments.attachment_uploaded(attachment, r);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n};\n\n_f.Frm.prototype.setup_print_layout = function() {\n\tvar me = this;\n\tthis.print_preview = new frappe.ui.form.PrintPreview({\n\t\tfrm: this\n\t});\n\n\t// show edit button for print view\n\tthis.page.wrapper.on('view-change', function() {\n\t\tme.toolbar.set_primary_action();\n\t});\n};\n\n_f.Frm.prototype.print_doc = function() {\n\tif(this.print_preview.wrapper.is(\":visible\")) {\n\t\tthis.hide_print();\n\t\treturn;\n\t}\n\tif(!frappe.model.can_print(this.doc.doctype, this)) {\n\t\tfrappe.msgprint(__(\"You are not allowed to print this document\"));\n\t\treturn;\n\t}\n\n\tthis.print_preview.refresh_print_options().trigger(\"change\");\n\tthis.page.set_view(\"print\");\n\tthis.print_preview.set_user_lang();\n\tthis.print_preview.set_default_print_language();\n\tthis.print_preview.preview();\n};\n\n_f.Frm.prototype.hide_print = function() {\n\tif(this.setup_done && this.page.current_view_name===\"print\") {\n\t\tthis.page.set_view(this.page.previous_view_name===\"print\" ?\n\t\t\t\"main\" : (this.page.previous_view_name || \"main\"));\n\t}\n};\n\n_f.Frm.prototype.watch_model_updates = function() {\n\t// watch model updates\n\tvar me = this;\n\n\t// on main doc\n\tfrappe.model.on(me.doctype, \"*\", function(fieldname, value, doc) {\n\t\t// set input\n\t\tif(doc.name===me.docname) {\n\t\t\tif ((value==='' || value===null) && !doc[fieldname]) {\n\t\t\t\t// both the incoming and outgoing values are falsy\n\t\t\t\t// the texteditor, summernote, changes nulls to empty strings on render,\n\t\t\t\t// so ignore those changes\n\t\t\t} else {\n\t\t\t\tme.dirty();\n\t\t\t}\n\t\t\tme.fields_dict[fieldname]\n\t\t\t\t&& me.fields_dict[fieldname].refresh(fieldname);\n\n\t\t\tme.layout.refresh_dependency();\n\t\t\tlet object = me.script_manager.trigger(fieldname, doc.doctype, doc.name);\n\t\t\treturn object;\n\t\t}\n\t});\n\n\t// on table fields\n\tvar table_fields = frappe.get_children(\"DocType\", me.doctype, \"fields\", {fieldtype:\"Table\"});\n\n\t// using $.each to preserve df via closure\n\t$.each(table_fields, function(i, df) {\n\t\tfrappe.model.on(df.options, \"*\", function(fieldname, value, doc) {\n\t\t\tif(doc.parent===me.docname && doc.parentfield===df.fieldname) {\n\t\t\t\tme.dirty();\n\t\t\t\tme.fields_dict[df.fieldname].grid.set_value(fieldname, value, doc);\n\t\t\t\tme.script_manager.trigger(fieldname, doc.doctype, doc.name);\n\t\t\t}\n\t\t});\n\t});\n};\n\n_f.Frm.prototype.setup_std_layout = function() {\n\tthis.form_wrapper \t= $('<div></div>').appendTo(this.layout_main);\n\tthis.body \t\t\t= $('<div></div>').appendTo(this.form_wrapper);\n\n\t// only tray\n\tthis.meta.section_style='Simple'; // always simple!\n\n\t// layout\n\tthis.layout = new frappe.ui.form.Layout({\n\t\tparent: this.body,\n\t\tdoctype: this.doctype,\n\t\tfrm: this,\n\t\twith_dashboard: true\n\t});\n\tthis.layout.make();\n\n\tthis.fields_dict = this.layout.fields_dict;\n\tthis.fields = this.layout.fields_list;\n\n\tthis.document_flow = new frappe.ui.form.DocumentFlow({\n\t\tfrm: this\n\t});\n\n\tthis.dashboard = new frappe.ui.form.Dashboard({\n\t\tfrm: this,\n\t});\n\n\t// state\n\tthis.states = new frappe.ui.form.States({\n\t\tfrm: this\n\t});\n};\n\n// email the form\n_f.Frm.prototype.email_doc = function(message) {\n\tnew frappe.views.CommunicationComposer({\n\t\tdoc: this.doc,\n\t\tfrm: this,\n\t\tsubject: __(this.meta.name) + ': ' + this.docname,\n\t\trecipients: this.doc.email || this.doc.email_id || this.doc.contact_email,\n\t\tattach_document_print: true,\n\t\tmessage: message,\n\t\treal_name: this.doc.real_name || this.doc.contact_display || this.doc.contact_name\n\t});\n};\n\n// rename the form\n_f.Frm.prototype.rename_doc = function() {\n\tfrappe.model.rename_doc(this.doctype, this.docname);\n};\n\n_f.Frm.prototype.share_doc = function() {\n\tthis.shared.show();\n};\n\n// notify this form of renamed records\n_f.Frm.prototype.rename_notify = function(dt, old, name) {\n\t// from form\n\tif(this.meta.istable)\n\t\treturn;\n\n\tif(this.docname == old)\n\t\tthis.docname = name;\n\telse\n\t\treturn;\n\n\t// cleanup\n\tif(this && this.opendocs[old] && frappe.meta.docfield_copy[dt]) {\n\t\t// delete docfield copy\n\t\tfrappe.meta.docfield_copy[dt][name] = frappe.meta.docfield_copy[dt][old];\n\t\tdelete frappe.meta.docfield_copy[dt][old];\n\t}\n\n\tdelete this.opendocs[old];\n\tthis.opendocs[name] = true;\n\n\tif(this.meta.in_dialog || !this.in_form) {\n\t\treturn;\n\t}\n\n\tfrappe.re_route[window.location.hash] = '#Form/' + encodeURIComponent(this.doctype) + '/' + encodeURIComponent(name);\n\tfrappe.set_route('Form', this.doctype, name);\n};\n\n// SETUP\n\n_f.Frm.prototype.setup_meta = function(doctype) {\n\tthis.meta = frappe.get_doc('DocType',this.doctype);\n\tthis.perm = frappe.perm.get_perm(this.doctype); // for create\n\tif(this.meta.istable) { this.meta.in_dialog = 1; }\n};\n\n_f.Frm.prototype.refresh_header = function(is_a_different_doc) {\n\t// set title\n\t// main title\n\tif(!this.meta.in_dialog || this.in_form) {\n\t\tfrappe.utils.set_title(this.meta.issingle ? this.doctype : this.docname);\n\t}\n\n\t// show / hide buttons\n\tif(this.toolbar) {\n\t\tif (is_a_different_doc) {\n\t\t\tthis.toolbar.current_status = undefined;\n\t\t}\n\n\t\tthis.toolbar.refresh();\n\t}\n\n\tthis.document_flow.refresh();\n\tthis.dashboard.refresh();\n\n\tif(this.meta.is_submittable &&\n\t\tthis.perm[0] && this.perm[0].submit &&\n\t\t! this.is_dirty() &&\n\t\t! this.is_new() &&\n\t\tthis.doc.docstatus===0) {\n\t\tthis.dashboard.add_comment(__('Submit this document to confirm'), 'orange', true);\n\t}\n\n\tthis.clear_custom_buttons();\n\n\tthis.show_web_link();\n};\n\n_f.Frm.prototype.show_web_link = function() {\n\tvar doc = this.doc, me = this;\n\tif(!doc.__islocal && doc.__onload && doc.__onload.is_website_generator) {\n\t\tme.web_link && me.web_link.remove();\n\t\tif(doc.__onload.published) {\n\t\t\tme.add_web_link(\"/\" + doc.route);\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.add_web_link = function(path, label) {\n\tlabel = label || \"See on Website\";\n\tthis.web_link = this.sidebar.add_user_action(__(label),\n\t\tfunction() {}).attr(\"href\", path || this.doc.route).attr(\"target\", \"_blank\");\n};\n\n_f.Frm.prototype.check_doc_perm = function() {\n\t// get perm\n\tvar dt = this.parent_doctype?this.parent_doctype : this.doctype;\n\tthis.perm = frappe.perm.get_perm(dt, this.doc);\n\n\tif(!this.perm[0].read) {\n\t\treturn 0;\n\t}\n\treturn 1;\n};\n\n_f.Frm.prototype.refresh = function(docname) {\n\tvar is_a_different_doc = docname ? true : false;\n\n\tif(docname) {\n\t\t// record switch\n\t\tif(this.docname != docname && (!this.meta.in_dialog || this.in_form) && !this.meta.istable) {\n\t\t\tfrappe.utils.scroll_to(0);\n\t\t\tthis.hide_print();\n\t\t}\n\t\t// reset visible columns, since column headings can change in different docs\n\t\tthis.grids.forEach(grid_obj => grid_obj.grid.visible_columns = null);\n\t\tfrappe.ui.form.close_grid_form();\n\t\tthis.docname = docname;\n\t}\n\n\tcur_frm = this;\n\n\tif(this.docname) { // document to show\n\n\t\t// set the doc\n\t\tthis.doc = frappe.get_doc(this.doctype, this.docname);\n\n\t\t// check permissions\n\t\tif(!this.check_doc_perm()) {\n\t\t\tfrappe.show_not_permitted(__(this.doctype) + \" \" + __(this.docname));\n\t\t\treturn;\n\t\t}\n\n\t\t// read only (workflow)\n\t\tthis.read_only = frappe.workflow.is_read_only(this.doctype, this.docname);\n\t\tif (this.read_only) this.set_read_only(true);\n\n\t\t// check if doctype is already open\n\t\tif (!this.opendocs[this.docname]) {\n\t\t\tthis.check_doctype_conflict(this.docname);\n\t\t} else {\n\t\t\tif(this.doc && (!this.doc.__unsaved) && this.doc.__last_sync_on &&\n\t\t\t\t(new Date() - this.doc.__last_sync_on) > (this.refresh_if_stale_for * 1000)) {\n\t\t\t\tthis.reload_doc();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// do setup\n\t\tif(!this.setup_done) {\n\t\t\tthis.setup();\n\t\t}\n\n\t\t// load the record for the first time, if not loaded (call 'onload')\n\t\tthis.cscript.is_onload = false;\n\t\tif(!this.opendocs[this.docname]) {\n\t\t\tvar me = this;\n\t\t\tthis.cscript.is_onload = true;\n\t\t\tthis.setnewdoc();\n\t\t\t$(document).trigger(\"form-load\", [this]);\n\t\t\t$(this.page.wrapper).on('hide',  function(e) {\n\t\t\t\t$(document).trigger(\"form-unload\", [me]);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.render_form(is_a_different_doc);\n\t\t\tif (this.doc.localname) {\n\t\t\t\t// trigger form-rename and remove .localname\n\t\t\t\tdelete this.doc.localname;\n\t\t\t\t$(document).trigger(\"form-rename\", [this]);\n\t\t\t}\n\t\t}\n\n\t\t// if print format is shown, refresh the format\n\t\tif(this.print_preview.wrapper.is(\":visible\")) {\n\t\t\tthis.print_preview.preview();\n\t\t}\n\n\t\tif(is_a_different_doc) {\n\t\t\tif(this.show_print_first && this.doc.docstatus===1) {\n\t\t\t\t// show print view\n\t\t\t\tthis.print_doc();\n\t\t\t}\n\t\t}\n\n\t\t// set status classes\n\t\tthis.$wrapper.removeClass('validated-form')\n\t\t\t.toggleClass('editable-form', this.doc.docstatus===0)\n\t\t\t.toggleClass('submitted-form', this.doc.docstatus===1)\n\t\t\t.toggleClass('cancelled-form', this.doc.docstatus===2);\n\n\t\tthis.show_if_needs_refresh();\n\t}\n};\n\n_f.Frm.prototype.show_if_needs_refresh = function() {\n\tif(this.doc.__needs_refresh) {\n\t\tif(this.doc.__unsaved) {\n\t\t\tthis.dashboard.clear_headline();\n\t\t\tthis.dashboard.set_headline_alert(__(\"This form has been modified after you have loaded it\")\n\t\t\t\t+ '<a class=\"btn btn-xs btn-primary pull-right\" onclick=\"cur_frm.reload_doc()\">'\n\t\t\t\t+ __(\"Refresh\") + '</a>', \"alert-warning\");\n\t\t} else {\n\t\t\tthis.reload_doc();\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.render_form = function(is_a_different_doc) {\n\tif(!this.meta.istable) {\n\t\tthis.layout.doc = this.doc;\n\t\tthis.layout.attach_doc_and_docfields();\n\n\t\tthis.sidebar = new frappe.ui.form.Sidebar({\n\t\t\tfrm: this,\n\t\t\tpage: this.page\n\t\t});\n\t\tthis.sidebar.make();\n\n\t\t// clear layout message\n\t\tthis.layout.show_message();\n\n\t\t// header must be refreshed before client methods\n\t\t// because add_custom_button\n\t\tthis.refresh_header(is_a_different_doc);\n\n\t\t// call trigger\n\t\tthis.script_manager.trigger(\"refresh\");\n\n\t\t// trigger global trigger\n\t\t// to use this\n\t\t$(document).trigger('form-refresh', [this]);\n\n\t\t// fields\n\t\tthis.refresh_fields();\n\n\n\t\t// call onload post render for callbacks to be fired\n\t\tif(this.cscript.is_onload) {\n\t\t\tthis.script_manager.trigger(\"onload_post_render\");\n\t\t}\n\n\t\t// update dashboard after refresh\n\t\tfrappe.timeout(0.1).then(() => this.dashboard.after_refresh());\n\n\t\t// focus on first input\n\n\t\tif(this.is_new()) {\n\t\t\tvar first = this.form_wrapper.find('.form-layout input:first');\n\t\t\tif(!in_list([\"Date\", \"Datetime\"], first.attr(\"data-fieldtype\"))) {\n\t\t\t\tfirst.focus();\n\t\t\t}\n\t\t}\n\t} else {\n\t\tthis.refresh_header(is_a_different_doc);\n\t}\n\n\tthis.$wrapper.trigger('render_complete');\n\n\tif(!this.hidden) {\n\t\tthis.layout.show_empty_form_message();\n\t}\n\n\tthis.scroll_to_element();\n};\n\n_f.Frm.prototype.refresh_field = function(fname) {\n\tif(this.fields_dict[fname] && this.fields_dict[fname].refresh) {\n\t\tthis.fields_dict[fname].refresh();\n\t\tthis.layout.refresh_dependency();\n\t}\n};\n\n_f.Frm.prototype.refresh_fields = function() {\n\tthis.layout.refresh(this.doc);\n\tthis.layout.primary_button = this.$wrapper.find(\".btn-primary\");\n\n\t// cleanup activities after refresh\n\tthis.cleanup_refresh(this);\n};\n\n\n_f.Frm.prototype.cleanup_refresh = function() {\n\tvar me = this;\n\tif(me.fields_dict['amended_from']) {\n\t\tif (me.doc.amended_from) {\n\t\t\tunhide_field('amended_from');\n\t\t\tif (me.fields_dict['amendment_date']) unhide_field('amendment_date');\n\t\t} else {\n\t\t\thide_field('amended_from');\n\t\t\tif (me.fields_dict['amendment_date']) hide_field('amendment_date');\n\t\t}\n\t}\n\n\tif(me.fields_dict['trash_reason']) {\n\t\tif(me.doc.trash_reason && me.doc.docstatus == 2) {\n\t\t\tunhide_field('trash_reason');\n\t\t} else {\n\t\t\thide_field('trash_reason');\n\t\t}\n\t}\n\n\tif(me.meta.autoname && me.meta.autoname.substr(0,6)=='field:' && !me.doc.__islocal) {\n\t\tvar fn = me.meta.autoname.substr(6);\n\n\t\tif (me.doc[fn]) {\n\t\t\tme.toggle_display(fn, false);\n\t\t}\n\t}\n\n\tif(me.meta.autoname==\"naming_series:\" && !me.doc.__islocal) {\n\t\tme.toggle_display(\"naming_series\", false);\n\t}\n};\n\n_f.Frm.prototype.setnewdoc = function() {\n\t// moved this call to refresh function\n\t// this.check_doctype_conflict(docname);\n\tvar me = this;\n\n\t// hide any open grid\n\tthis.script_manager.trigger(\"before_load\", this.doctype, this.docname)\n\t\t.then(() => {\n\t\t\tme.script_manager.trigger(\"onload\");\n\t\t\tme.opendocs[me.docname] = true;\n\t\t\tme.render_form();\n\n\t\t\tfrappe.after_ajax(function() {\n\t\t\t\tme.trigger_link_fields();\n\t\t\t});\n\n\t\t\tfrappe.breadcrumbs.add(me.meta.module, me.doctype);\n\t\t});\n\n\t// update seen\n\tif(this.meta.track_seen) {\n\t\t$('.list-id[data-name=\"'+ me.docname +'\"]').addClass('seen');\n\t}\n};\n\n_f.Frm.prototype.trigger_link_fields = function() {\n\t// trigger link fields which have default values set\n\tif (this.is_new() && this.doc.__run_link_triggers) {\n\t\t$.each(this.fields_dict, function(fieldname, field) {\n\t\t\tif (field.df.fieldtype==\"Link\" && this.doc[fieldname]) {\n\t\t\t\t// triggers add fetch, sets value in model and runs triggers\n\t\t\t\tfield.set_value(this.doc[fieldname]);\n\t\t\t}\n\t\t});\n\n\t\tdelete this.doc.__run_link_triggers;\n\t}\n};\n\n_f.Frm.prototype.runscript = function(scriptname, callingfield, onrefresh) {\n\tvar me = this;\n\tif(this.docname) {\n\t\t// send to run\n\t\tif(callingfield)\n\t\t\t$(callingfield.input).set_working();\n\n\t\tfrappe.call({\n\t\t\tmethod: \"runserverobj\",\n\t\t\targs: {'docs':this.doc, 'method':scriptname },\n\t\t\tbtn: callingfield.$input,\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tif(onrefresh) {\n\t\t\t\t\t\tonrefresh(r);\n\t\t\t\t\t}\n\n\t\t\t\t\tme.refresh_fields();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\n_f.Frm.prototype.copy_doc = function(onload, from_amend) {\n\tthis.validate_form_action(\"Create\");\n\tvar newdoc = frappe.model.copy_doc(this.doc, from_amend);\n\n\tnewdoc.idx = null;\n\tnewdoc.__run_link_triggers = false;\n\tif(onload) {\n\t\tonload(newdoc);\n\t}\n\tfrappe.set_route('Form', newdoc.doctype, newdoc.name);\n};\n\n_f.Frm.prototype.reload_doc = function() {\n\tthis.check_doctype_conflict(this.docname);\n\n\tvar me = this;\n\tvar onsave = function(r, rtxt) {\n\t\tme.refresh();\n\t};\n\n\tif(!me.doc.__islocal) {\n\t\tfrappe.model.remove_from_locals(me.doctype, me.docname);\n\t\tfrappe.model.with_doc(me.doctype, me.docname, function() {\n\t\t\tme.refresh();\n\t\t});\n\t}\n};\n\nfrappe.validated = 0;\n// Proxy for frappe.validated\nObject.defineProperty(window, 'validated', {\n\tget: function() {\n\t\tconsole.warn('Please use `frappe.validated` instead of `validated`. It will be deprecated soon.');\n\t\treturn frappe.validated;\n\t},\n\tset: function(value) {\n\t\tconsole.warn('Please use `frappe.validated` instead of `validated`. It will be deprecated soon.');\n\t\tfrappe.validated = value;\n\t\treturn frappe.validated;\n\t}\n});\n\n_f.Frm.prototype.save = function(save_action, callback, btn, on_error) {\n\tlet me = this;\n\treturn new Promise(resolve => {\n\t\tbtn && $(btn).prop(\"disabled\", true);\n\t\t$(document.activeElement).blur();\n\n\t\tfrappe.ui.form.close_grid_form();\n\t\t// let any pending js process finish\n\t\tsetTimeout(function() {\n\t\t\tme._save(save_action, callback, btn, on_error, resolve);\n\t\t}, 100);\n\t});\n};\n\n_f.Frm.prototype._save = function(save_action, callback, btn, on_error, resolve) {\n\tvar me = this;\n\tif(!save_action) save_action = \"Save\";\n\tthis.validate_form_action(save_action, resolve);\n\n\tif((!this.meta.in_dialog || this.in_form) && !this.meta.istable) {\n\t\tfrappe.utils.scroll_to(0);\n\t}\n\tvar after_save = function(r) {\n\t\tif(!r.exc) {\n\t\t\tif ([\"Save\", \"Update\", \"Amend\"].indexOf(save_action)!==-1) {\n\t\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t\t}\n\n\t\t\tme.script_manager.trigger(\"after_save\");\n\t\t\tme.refresh();\n\t\t} else {\n\t\t\tif(on_error) {\n\t\t\t\ton_error();\n\t\t\t}\n\t\t}\n\t\tcallback && callback(r);\n\t\tresolve();\n\t};\n\n\tvar fail = () => {\n\t\tbtn && $(btn).prop(\"disabled\", false);\n\t\tif(on_error) {\n\t\t\ton_error();\n\t\t}\n\t\tresolve();\n\t};\n\n\tif(save_action != \"Update\") {\n\t\t// validate\n\t\tfrappe.validated = true;\n\t\tfrappe.run_serially([\n\t\t\t() => this.script_manager.trigger(\"validate\"),\n\t\t\t() => this.script_manager.trigger(\"before_save\"),\n\t\t\t() => {\n\t\t\t\tif(!frappe.validated) {\n\t\t\t\t\tfail();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfrappe.ui.form.save(me, save_action, after_save, btn);\n\t\t\t}\n\t\t]).catch(fail);\n\t} else {\n\t\tfrappe.ui.form.save(me, save_action, after_save, btn);\n\t}\n};\n\n\n_f.Frm.prototype.savesubmit = function(btn, callback, on_error) {\n\tvar me = this;\n\n\tlet handle_fail = () => {\n\t\t$(btn).prop('disabled', false);\n\t\tif (on_error) {\n\t\t\ton_error();\n\t\t}\n\t}\n\n\treturn new Promise(resolve => {\n\t\tthis.validate_form_action(\"Submit\");\n\t\tfrappe.confirm(__(\"Permanently Submit {0}?\", [this.docname]), function() {\n\t\t\tfrappe.validated = true;\n\t\t\tme.script_manager.trigger(\"before_submit\").then(function() {\n\t\t\t\tif(!frappe.validated) {\n\t\t\t\t\thandle_fail();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tme.save('Submit', function(r) {\n\t\t\t\t\tif(r.exc) {\n\t\t\t\t\t\thandle_fail();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\tcallback && callback();\n\t\t\t\t\t\tme.script_manager.trigger(\"on_submit\")\n\t\t\t\t\t\t\t.then(() => resolve(me));\n\t\t\t\t\t}\n\t\t\t\t}, btn, () => handle_fail(), resolve);\n\t\t\t});\n\t\t}, () => handle_fail() );\n\t});\n};\n\n_f.Frm.prototype.savecancel = function(btn, callback, on_error) {\n\tvar me = this;\n\n\tlet handle_fail = () => {\n\t\t$(btn).prop('disabled', false);\n\t\tif (on_error) {\n\t\t\ton_error();\n\t\t}\n\t}\n\n\tthis.validate_form_action('Cancel');\n\tfrappe.confirm(__(\"Permanently Cancel {0}?\", [this.docname]), function() {\n\t\tfrappe.validated = true;\n\t\tme.script_manager.trigger(\"before_cancel\").then(function() {\n\t\t\tif(!frappe.validated) {\n\t\t\t\thandle_fail();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar after_cancel = function(r) {\n\t\t\t\tif(r.exc) {\n\t\t\t\t\thandle_fail();\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.utils.play_sound(\"cancel\");\n\t\t\t\t\tme.refresh();\n\t\t\t\t\tcallback && callback();\n\t\t\t\t\tme.script_manager.trigger(\"after_cancel\");\n\t\t\t\t}\n\t\t\t};\n\t\t\tfrappe.ui.form.save(me, \"cancel\", after_cancel, btn);\n\t\t});\n\t}, () => handle_fail());\n};\n\n// delete the record\n_f.Frm.prototype.savetrash = function() {\n\tthis.validate_form_action(\"Delete\");\n\tfrappe.model.delete_doc(this.doctype, this.docname, function(r) {\n\t\twindow.history.back();\n\t});\n};\n\n_f.Frm.prototype.amend_doc = function() {\n\tif(!this.fields_dict['amended_from']) {\n\t\talert('\"amended_from\" field must be present to do an amendment.');\n\t\treturn;\n\t}\n\tthis.validate_form_action(\"Amend\");\n\tvar me = this;\n\tvar fn = function(newdoc) {\n\t\tnewdoc.amended_from = me.docname;\n\t\tif(me.fields_dict && me.fields_dict['amendment_date'])\n\t\t\tnewdoc.amendment_date = frappe.datetime.obj_to_str(new Date());\n\t};\n\tthis.copy_doc(fn, 1);\n\tfrappe.utils.play_sound(\"click\");\n};\n\n_f.Frm.prototype.disable_save = function() {\n\t// IMPORTANT: this function should be called in refresh event\n\tthis.save_disabled = true;\n\tthis.toolbar.current_status = null;\n\tthis.page.clear_primary_action();\n};\n\n_f.Frm.prototype.enable_save = function() {\n\tthis.save_disabled = false;\n\tthis.toolbar.set_primary_action();\n};\n\n_f.Frm.prototype.save_or_update = function() {\n\tif(this.save_disabled) return;\n\n\tif(this.doc.docstatus===0) {\n\t\tthis.save();\n\t} else if(this.doc.docstatus===1 && this.doc.__unsaved) {\n\t\tthis.save(\"Update\");\n\t}\n};\n\n_f.Frm.prototype.dirty = function() {\n\tthis.doc.__unsaved = 1;\n\tthis.$wrapper.trigger('dirty');\n};\n\n_f.Frm.prototype.get_docinfo = function() {\n\treturn frappe.model.docinfo[this.doctype][this.docname];\n};\n\n_f.Frm.prototype.is_dirty = function() {\n\treturn this.doc.__unsaved;\n};\n\n_f.Frm.prototype.is_new = function() {\n\treturn this.doc.__islocal;\n};\n\n\n_f.Frm.prototype.reload_docinfo = function(callback) {\n\tvar me = this;\n\tfrappe.call({\n\t\tmethod: \"frappe.desk.form.load.get_docinfo\",\n\t\targs: {\n\t\t\tdoctype: me.doctype,\n\t\t\tname: me.doc.name\n\t\t},\n\t\tcallback: function(r) {\n\t\t\t// docinfo will be synced\n\t\t\tif(callback) callback(r.docinfo);\n\t\t\tme.timeline.refresh();\n\t\t\tme.assign_to.refresh();\n\t\t\tme.attachments.refresh();\n\t\t}\n\t});\n};\n\n\n_f.Frm.prototype.get_perm = function(permlevel, access_type) {\n\treturn this.perm[permlevel] ? this.perm[permlevel][access_type] : null;\n};\n\n\n_f.Frm.prototype.set_intro = function(txt, append) {\n\tthis.dashboard.set_headline_alert(txt);\n\t//frappe.utils.set_intro(this, this.body, txt, append);\n};\n\n_f.Frm.prototype.set_footnote = function(txt) {\n\tthis.footnote_area = frappe.utils.set_footnote(this.footnote_area, this.body, txt);\n};\n\n\n_f.Frm.prototype.add_custom_button = function(label, fn, group) {\n\t// temp! old parameter used to be icon\n\tif(group && group.indexOf(\"fa fa-\")!==-1) group = null;\n\tvar btn = this.page.add_inner_button(label, fn, group);\n\tthis.custom_buttons[label] = btn;\n\treturn btn;\n};\n\n//Remove all custom buttons\n_f.Frm.prototype.clear_custom_buttons = function() {\n\tthis.page.clear_inner_toolbar();\n\tthis.page.clear_user_actions();\n\tthis.custom_buttons = {};\n};\n\n//Remove specific custom button by button Label\n_f.Frm.prototype.remove_custom_button = function(label, group) {\n\tthis.page.remove_inner_button(label, group);\n};\n\n_f.Frm.prototype.add_fetch = function(link_field, src_field, tar_field) {\n\tif(!this.fetch_dict[link_field]) {\n\t\tthis.fetch_dict[link_field] = {'columns':[], 'fields':[]};\n\t}\n\tthis.fetch_dict[link_field].columns.push(src_field);\n\tthis.fetch_dict[link_field].fields.push(tar_field);\n};\n\n_f.Frm.prototype.set_print_heading = function(txt) {\n\tthis.pformat[this.docname] = txt;\n};\n\n_f.Frm.prototype.action_perm_type_map = {\n\t\"Create\": \"create\",\n\t\"Save\": \"write\",\n\t\"Submit\": \"submit\",\n\t\"Update\": \"submit\",\n\t\"Cancel\": \"cancel\",\n\t\"Amend\": \"amend\",\n\t\"Delete\": \"delete\"\n};\n\n_f.Frm.prototype.validate_form_action = function(action, resolve) {\n\tvar perm_to_check = this.action_perm_type_map[action];\n\tvar allowed_for_workflow = false;\n\tvar perms = frappe.perm.get_perm(this.doc.doctype)[0];\n\n\t// Allow submit, write, cancel and create permissions for read only documents that are assigned by\n\t// workflows if the user already have those permissions. This is to allow for users to\n\t// continue through the workflow states and to allow execution of functions like Duplicate.\n\tif ((frappe.workflow.is_read_only(this.doctype, this.docname) && (perms[\"write\"] ||\n\t\tperms[\"create\"] || perms[\"submit\"] || perms[\"cancel\"])) || !frappe.workflow.is_read_only(this.doctype, this.docname)) {\n\t\tvar allowed_for_workflow = true;\n\t}\n\n\tif (!this.perm[0][perm_to_check] && !allowed_for_workflow) {\n\t\tif(resolve) {\n\t\t\t// re-enable buttons\n\t\t\tresolve();\n\t\t}\n\t\tfrappe.throw (__(\"No permission to '{0}' {1}\", [__(action), __(this.doc.doctype)]));\n\t}\n};\n\n_f.Frm.prototype.has_perm = function(ptype) {\n\treturn frappe.perm.has_perm(this.doctype, 0, ptype, this.doc);\n};\n\n_f.Frm.prototype.scroll_to_element = function() {\n\tif (frappe.route_options && frappe.route_options.scroll_to) {\n\t\tvar scroll_to = frappe.route_options.scroll_to;\n\t\tdelete frappe.route_options.scroll_to;\n\n\t\tvar selector = [];\n\t\tfor (var key in scroll_to) {\n\t\t\tvar value = scroll_to[key];\n\t\t\tselector.push(repl('[data-%(key)s=\"%(value)s\"]', {key: key, value: value}));\n\t\t}\n\n\t\tselector = $(selector.join(\" \"));\n\t\tif (selector.length) {\n\t\t\tfrappe.utils.scroll_to(selector);\n\t\t}\n\t}\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n/* eslint-disable no-console */\n\nwindow.get_server_fields = function(method, arg, table_field, doc, dt, dn, allow_edit, call_back) {\n\tconsole.warn(\"This function 'get_server_fields' has been deprecated and will be removed soon.\");\n\tfrappe.dom.freeze();\n\tif($.isPlainObject(arg)) arg = JSON.stringify(arg);\n\treturn $c('runserverobj', {'method': method, 'docs': JSON.stringify(doc), 'arg': arg },\n\t\tfunction(r) {\n\t\t\tfrappe.dom.unfreeze();\n\t\t\tif (r.message)  {\n\t\t\t\tvar d = locals[dt][dn];\n\t\t\t\tvar field_dict = r.message;\n\t\t\t\tfor(var key in field_dict) {\n\t\t\t\t\td[key] = field_dict[key];\n\t\t\t\t\tif (table_field)\n\t\t\t\t\t\trefresh_field(key, d.name, table_field);\n\t\t\t\t\telse\n\t\t\t\t\t\trefresh_field(key);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(call_back){\n\t\t\t\tdoc = locals[doc.doctype][doc.name];\n\t\t\t\tcall_back(doc, dt, dn);\n\t\t\t}\n\t\t});\n};\n\n\nwindow.set_multiple = function(dt, dn, dict, table_field) {\n\tvar d = locals[dt][dn];\n\tfor(var key in dict) {\n\t\td[key] = dict[key];\n\t\tif (table_field)\n\t\t\trefresh_field(key, d.name, table_field);\n\t\telse\n\t\t\trefresh_field(key);\n\t}\n};\n\nwindow.refresh_many = function(flist, dn, table_field) {\n\tfor(var i in flist) {\n\t\tif (table_field)\n\t\t\trefresh_field(flist[i], dn, table_field);\n\t\telse\n\t\t\trefresh_field(flist[i]);\n\t}\n};\n\nwindow.set_field_tip = function(n,txt) {\n\tvar df = frappe.meta.get_docfield(cur_frm.doctype, n, cur_frm.docname);\n\tif(df)df.description = txt;\n\n\tif(cur_frm && cur_frm.fields_dict) {\n\t\tif(cur_frm.fields_dict[n])\n\t\t\tcur_frm.fields_dict[n].comment_area.innerHTML = window.replace_newlines(txt);\n\t\telse\n\t\t\tconsole.log('[set_field_tip] Unable to set field tip: ' + n);\n\t}\n};\n\nwindow.refresh_field = function(n, docname, table_field) {\n\t// multiple\n\tif(typeof n==typeof [])\n\t\trefresh_many(n, docname, table_field);\n\n\tif (n && typeof n==='string' && table_field){\n\t\tvar grid = cur_frm.fields_dict[table_field].grid,\n\t\t\tfield = frappe.utils.filter_dict(grid.docfields, {fieldname: n});\n\t\tif (field && field.length){\n\t\t\tfield = field[0];\n\t\t\tvar meta = frappe.meta.get_docfield(field.parent, field.fieldname, docname);\n\t\t\t$.extend(field, meta);\n\t\t\tif (docname){\n\t\t\t\tcur_frm.fields_dict[table_field].grid.grid_rows_by_docname[docname].refresh_field(n);\n\t\t\t} else {\n\t\t\t\tcur_frm.fields_dict[table_field].grid.refresh();\n\t\t\t}\n\t\t}\n\t} else if(cur_frm) {\n\t\tcur_frm.refresh_field(n);\n\t}\n};\n\nwindow.set_field_options = function(n, txt) {\n\tcur_frm.set_df_property(n, 'options', txt);\n};\n\nwindow.set_field_permlevel = function(n, level) {\n\tcur_frm.set_df_property(n, 'permlevel', level);\n};\n\nwindow.toggle_field = function(n, hidden) {\n\tvar df = frappe.meta.get_docfield(cur_frm.doctype, n, cur_frm.docname);\n\tif(df) {\n\t\tdf.hidden = hidden;\n\t\trefresh_field(n);\n\t} else {\n\t\tconsole.log((hidden ? \"hide_field\" : \"unhide_field\") + \" cannot find field \" + n);\n\t}\n};\n\nwindow.hide_field = function(n) {\n\tif(cur_frm) {\n\t\tif(n.substr) toggle_field(n, 1);\n\t\telse {\n\t\t\tfor(var i in n) toggle_field(n[i], 1);\n\t\t}\n\t}\n};\n\nwindow.unhide_field = function(n) {\n\tif(cur_frm) {\n\t\tif(n.substr) toggle_field(n, 0);\n\t\telse {\n\t\t\tfor(var i in n) toggle_field(n[i], 0);\n\t\t}\n\t}\n};\n\nwindow.get_field_obj = function(fn) {\n\treturn cur_frm.fields_dict[fn];\n};\n\n_f.Frm.prototype.get_doc = function() {\n\treturn locals[this.doctype][this.docname];\n};\n\n_f.Frm.prototype.set_currency_labels = function(fields_list, currency, parentfield) {\n\t// To set the currency in the label\n\t// For example Total Cost(INR), Total Cost(USD)\n\n\tvar me = this;\n\tvar doctype = parentfield ? this.fields_dict[parentfield].grid.doctype : this.doc.doctype;\n\tvar field_label_map = {};\n\tvar grid_field_label_map = {};\n\n\t$.each(fields_list, function(i, fname) {\n\t\tvar docfield = frappe.meta.docfield_map[doctype][fname];\n\t\tif(docfield) {\n\t\t\tvar label = __(docfield.label || \"\").replace(/\\([^\\)]*\\)/g, \"\"); // eslint-disable-line\n\t\t\tif(parentfield) {\n\t\t\t\tgrid_field_label_map[doctype + \"-\" + fname] =\n\t\t\t\t\tlabel.trim() + \" (\" + __(currency) + \")\";\n\t\t\t} else {\n\t\t\t\tfield_label_map[fname] = label.trim() + \" (\" + currency + \")\";\n\t\t\t}\n\t\t}\n\t});\n\n\t$.each(field_label_map, function(fname, label) {\n\t\tme.fields_dict[fname].set_label(label);\n\t});\n\n\t$.each(grid_field_label_map, function(fname, label) {\n\t\tfname = fname.split(\"-\");\n\t\tvar df = frappe.meta.get_docfield(fname[0], fname[1], me.doc.name);\n\t\tif(df) df.label = label;\n\t});\n};\n\n_f.Frm.prototype.field_map = function(fnames, fn) {\n\tif(typeof fnames==='string') {\n\t\tif(fnames == '*') {\n\t\t\tfnames = Object.keys(this.fields_dict);\n\t\t} else {\n\t\t\tfnames = [fnames];\n\t\t}\n\t}\n\tfor (var i=0, l=fnames.length; i<l; i++) {\n\t\tvar fieldname = fnames[i];\n\t\tvar field = frappe.meta.get_docfield(cur_frm.doctype, fieldname, this.docname);\n\t\tif(field) {\n\t\t\tfn(field);\n\t\t\tthis.refresh_field(fieldname);\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.get_docfield = function(fieldname1, fieldname2) {\n\tif(fieldname2) {\n\t\t// for child\n\t\tvar doctype = this.get_docfield(fieldname1).options;\n\t\treturn frappe.meta.get_docfield(doctype, fieldname2, this.docname);\n\t} else {\n\t\t// for parent\n\t\treturn frappe.meta.get_docfield(this.doctype, fieldname1, this.docname);\n\t}\n};\n\n_f.Frm.prototype.set_df_property = function(fieldname, property, value, docname, table_field) {\n\tvar df;\n\tif (!docname && !table_field){\n\t\tdf = this.get_docfield(fieldname);\n\t} else {\n\t\tvar grid = this.fields_dict[table_field].grid,\n\t\t\tfname = frappe.utils.filter_dict(grid.docfields, {'fieldname': fieldname});\n\t\tif (fname && fname.length)\n\t\t\tdf = frappe.meta.get_docfield(fname[0].parent, fieldname, docname);\n\t}\n\tif(df && df[property] != value) {\n\t\tdf[property] = value;\n\t\trefresh_field(fieldname, table_field);\n\t}\n};\n\n_f.Frm.prototype.toggle_enable = function(fnames, enable) {\n\tthis.field_map(fnames, function(field) {\n\t\tfield.read_only = enable ? 0 : 1;\n\t});\n};\n\n_f.Frm.prototype.toggle_reqd = function(fnames, mandatory) {\n\tthis.field_map(fnames, function(field) {\n\t\tfield.reqd = mandatory ? true : false;\n\t});\n};\n\n_f.Frm.prototype.toggle_display = function(fnames, show) {\n\tthis.field_map(fnames, function(field) {\n\t\tfield.hidden = show ? 0 : 1;\n\t});\n};\n\n_f.Frm.prototype.call_server = function(method, args, callback) {\n\treturn $c_obj(this.doc, method, args, callback);\n};\n\n_f.Frm.prototype.get_files = function() {\n\treturn this.attachments\n\t\t? frappe.utils.sort(this.attachments.get_attachments(), \"file_name\", \"string\")\n\t\t: [] ;\n};\n\n_f.Frm.prototype.set_query = function(fieldname, opt1, opt2) {\n\tif(opt2) {\n\t\t// on child table\n\t\t// set_query(fieldname, parent fieldname, query)\n\t\tthis.fields_dict[opt1].grid.get_field(fieldname).get_query = opt2;\n\t} else {\n\t\t// on parent table\n\t\t// set_query(fieldname, query)\n\t\tif(this.fields_dict[fieldname]) {\n\t\t\tthis.fields_dict[fieldname].get_query = opt1;\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.set_value_if_missing = function(field, value) {\n\treturn this.set_value(field, value, true);\n};\n\n_f.Frm.prototype.clear_table = function(fieldname) {\n\tfrappe.model.clear_table(this.doc, fieldname);\n};\n\n_f.Frm.prototype.add_child = function(fieldname, values) {\n\tvar doc = frappe.model.add_child(this.doc, frappe.meta.get_docfield(this.doctype, fieldname).options, fieldname);\n\tif(values) {\n\t\t// Values of unique keys should not be overridden\n\t\tvar d = {};\n\t\tvar unique_keys = [\"idx\", \"name\"];\n\n\t\tObject.keys(values).map((key) => {\n\t\t\tif(!unique_keys.includes(key)) {\n\t\t\t\td[key] = values[key];\n\t\t\t}\n\t\t});\n\n\t\t$.extend(doc, d);\n\t}\n\treturn doc;\n};\n\n_f.Frm.prototype.set_value = function(field, value, if_missing) {\n\tvar me = this;\n\tvar _set = function(f, v) {\n\t\tvar fieldobj = me.fields_dict[f];\n\t\tif(fieldobj) {\n\t\t\tif(!if_missing || !frappe.model.has_value(me.doctype, me.doc.name, f)) {\n\t\t\t\tif(fieldobj.df.fieldtype===\"Table\" && $.isArray(v)) {\n\n\t\t\t\t\tfrappe.model.clear_table(me.doc, fieldobj.df.fieldname);\n\n\t\t\t\t\tfor (var i=0, j=v.length; i < j; i++) {\n\t\t\t\t\t\tvar d = v[i];\n\t\t\t\t\t\tvar child = frappe.model.add_child(me.doc, fieldobj.df.options,\n\t\t\t\t\t\t\tfieldobj.df.fieldname, i+1);\n\t\t\t\t\t\t$.extend(child, d);\n\t\t\t\t\t}\n\n\t\t\t\t\tme.refresh_field(f);\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t} else {\n\t\t\t\t\treturn frappe.model.set_value(me.doctype, me.doc.name, f, v);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfrappe.msgprint(__(\"Field {0} not found.\",[f]));\n\t\t\tthrow \"frm.set_value\";\n\t\t}\n\t};\n\n\tif(typeof field==\"string\") {\n\t\treturn _set(field, value);\n\t} else if($.isPlainObject(field)) {\n\t\tlet tasks = [];\n\t\tfor (let f in field) {\n\t\t\tlet v = field[f];\n\t\t\tif(me.get_field(f)) {\n\t\t\t\ttasks.push(() => _set(f, v));\n\t\t\t}\n\t\t}\n\t\treturn frappe.run_serially(tasks);\n\t}\n};\n\n_f.Frm.prototype.call = function(opts, args, callback) {\n\tvar me = this;\n\tif(typeof opts==='string') {\n\t\t// called as frm.call('do_this', {with_arg: 'arg'});\n\t\topts = {\n\t\t\tmethod: opts,\n\t\t\tdoc: this.doc,\n\t\t\targs: args,\n\t\t\tcallback: callback\n\t\t};\n\t}\n\tif(!opts.doc) {\n\t\tif(opts.method.indexOf(\".\")===-1)\n\t\t\topts.method = frappe.model.get_server_module_name(me.doctype) + \".\" + opts.method;\n\t\topts.original_callback = opts.callback;\n\t\topts.callback = function(r) {\n\t\t\tif($.isPlainObject(r.message)) {\n\t\t\t\tif(opts.child) {\n\t\t\t\t\t// update child doc\n\t\t\t\t\topts.child = locals[opts.child.doctype][opts.child.name];\n\n\t\t\t\t\tvar std_field_list = [\"doctype\"].concat(frappe.model.std_fields_list);\n\t\t\t\t\tfor (var key in r.message) {\n\t\t\t\t\t\tif (std_field_list.indexOf(key)===-1) {\n\t\t\t\t\t\t\topts.child[key] = r.message[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tme.fields_dict[opts.child.parentfield].refresh();\n\t\t\t\t} else {\n\t\t\t\t\t// update parent doc\n\t\t\t\t\tme.set_value(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t\topts.original_callback && opts.original_callback(r);\n\t\t};\n\t} else {\n\t\topts.original_callback = opts.callback;\n\t\topts.callback = function(r) {\n\t\t\tif(!r.exc) me.refresh_fields();\n\n\t\t\topts.original_callback && opts.original_callback(r);\n\t\t};\n\n\t}\n\treturn frappe.call(opts);\n};\n\n_f.Frm.prototype.get_field = function(field) {\n\treturn this.fields_dict[field];\n};\n\n\n_f.Frm.prototype.set_read_only = function() {\n\tvar perm = [];\n\tvar docperms = frappe.perm.get_perm(this.doc.doctype);\n\tfor (var i=0, l=docperms.length; i<l; i++) {\n\t\tvar p = docperms[i];\n\t\tperm[p.permlevel || 0] = {read:1, print:1, cancel:1};\n\t}\n\tthis.perm = perm;\n};\n\n_f.Frm.prototype.trigger = function(event) {\n\treturn this.script_manager.trigger(event);\n};\n\n_f.Frm.prototype.get_formatted = function(fieldname) {\n\treturn frappe.format(this.doc[fieldname],\n\t\tfrappe.meta.get_docfield(this.doctype, fieldname, this.docname),\n\t\t{no_icon:true}, this.doc);\n};\n\n_f.Frm.prototype.open_grid_row = function() {\n\treturn frappe.ui.form.get_open_grid_form();\n};\n\n_f.Frm.prototype.is_new = function() {\n\treturn this.doc.__islocal;\n};\n\n_f.Frm.prototype.get_title = function() {\n\tif(this.meta.title_field) {\n\t\treturn this.doc[this.meta.title_field];\n\t} else {\n\t\treturn this.doc.name;\n\t}\n};\n\n_f.Frm.prototype.get_selected = function() {\n\t// returns list of children that are selected. returns [parentfield, name] for each\n\tvar selected = {}, me = this;\n\tfrappe.meta.get_table_fields(this.doctype).forEach(function(df) {\n\t\tvar _selected = me.fields_dict[df.fieldname].grid.get_selected();\n\t\tif(_selected.length) {\n\t\t\tselected[df.fieldname] = _selected;\n\t\t}\n\t});\n\treturn selected;\n};\n\n_f.Frm.prototype.has_mapper = function() {\n\t// hackalert!\n\t// if open_mapped_doc is mentioned in the custom script, then mapper exists\n\tif(this._has_mapper === undefined) {\n\t\tthis._has_mapper = (this.meta.__js && this.meta.__js.search('open_mapped_doc')!==-1) ?\n\t\t\ttrue: false;\n\t}\n\treturn this._has_mapper;\n};\n\n_f.Frm.prototype.set_indicator_formatter = function(fieldname, get_color, get_text) {\n\t// get doctype from parent\n\tvar doctype;\n\tif(frappe.meta.docfield_map[this.doctype][fieldname]) {\n\t\tdoctype = this.doctype;\n\t} else {\n\t\tfrappe.meta.get_table_fields(this.doctype).every(function(df) {\n\t\t\tif(frappe.meta.docfield_map[df.options][fieldname]) {\n\t\t\t\tdoctype = df.options;\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n\n\tfrappe.meta.docfield_map[doctype][fieldname].formatter =\n\t\tfunction(value, df, options, doc) {\n\t\t\tif(value) {\n\t\t\t\treturn repl('<a class=\"indicator %(color)s\" href=\"#Form/%(doctype)s/%(name)s\">%(label)s</a>', {\n\t\t\t\t\tcolor: get_color(doc || {}),\n\t\t\t\t\tdoctype: df.options,\n\t\t\t\t\tname: value,\n\t\t\t\t\tlabel: get_text ? get_text(doc) : value\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t};\n};\n\n_f.Frm.prototype.can_create = function(doctype) {\n\t// return true or false if the user can make a particlar doctype\n\t// will check permission, `can_make_methods` if exists, or will decided on\n\t// basis of whether the document is submittable\n\tif(!frappe.model.can_create(doctype)) {\n\t\treturn false;\n\t}\n\n\tif(this.custom_make_buttons && this.custom_make_buttons[doctype]) {\n\t\t// custom buttons are translated and so are the keys\n\t\tconst key = __(this.custom_make_buttons[doctype]);\n\t\t// if the button is present, then show make\n\t\treturn !!this.custom_buttons[key];\n\t}\n\n\tif(this.can_make_methods && this.can_make_methods[doctype]) {\n\t\treturn this.can_make_methods[doctype](this);\n\t} else {\n\t\tif(this.meta.is_submittable && !this.doc.docstatus==1) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.make_new = function(doctype) {\n\t// make new doctype from the current form\n\t// will handover to `make_methods` if defined\n\t// or will create and match link fields\n\tvar me = this;\n\tif(this.make_methods && this.make_methods[doctype]) {\n\t\treturn this.make_methods[doctype](this);\n\t} else if(this.custom_make_buttons && this.custom_make_buttons[doctype]) {\n\t\tthis.custom_buttons[__(this.custom_make_buttons[doctype])].trigger('click');\n\t} else {\n\t\tfrappe.model.with_doctype(doctype, function() {\n\t\t\tvar new_doc = frappe.model.get_new_doc(doctype);\n\n\t\t\t// set link fields (if found)\n\t\t\tfrappe.get_meta(doctype).fields.forEach(function(df) {\n\t\t\t\tif(df.fieldtype==='Link' && df.options===me.doctype) {\n\t\t\t\t\tnew_doc[df.fieldname] = me.doc.name;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, new_doc);\n\t\t\t// frappe.set_route('Form', doctype, new_doc.name);\n\t\t});\n\t}\n};\n\n_f.Frm.prototype.update_in_all_rows = function(table_fieldname, fieldname, value) {\n\t// update the child value in all tables where it is missing\n\tif(!value) return;\n\tvar cl = this.doc[table_fieldname] || [];\n\tfor(var i = 0; i < cl.length; i++){\n\t\tif(!cl[i][fieldname]) cl[i][fieldname] = value;\n\t}\n\trefresh_field(\"items\");\n};\n\n_f.Frm.prototype.get_sum = function(table_fieldname, fieldname) {\n\tlet sum = 0;\n\tfor (let d of (this.doc[table_fieldname] || [])) {\n\t\tsum += d[fieldname];\n\t}\n\treturn sum;\n};","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\nfrappe.ui.form.Toolbar = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.refresh();\n\t\tthis.add_update_button_on_dirty();\n\t\tthis.setup_editable_title();\n\t},\n\trefresh: function() {\n\t\tthis.make_menu();\n\t\tthis.set_title();\n\t\tthis.page.clear_user_actions();\n\t\tthis.show_title_as_dirty();\n\t\tthis.set_primary_action();\n\n\t\tif(this.frm.meta.hide_toolbar) {\n\t\t\tthis.page.hide_menu();\n\t\t} else {\n\t\t\tif(this.frm.doc.__islocal) {\n\t\t\t\tthis.page.hide_menu();\n\t\t\t\tthis.print_icon && this.print_icon.addClass(\"hide\");\n\t\t\t} else {\n\t\t\t\tthis.page.show_menu();\n\t\t\t\tthis.print_icon && this.print_icon.removeClass(\"hide\");\n\t\t\t}\n\t\t}\n\t},\n\tset_title: function() {\n\t\tif(this.frm.meta.title_field) {\n\t\t\tvar title = strip_html((this.frm.doc[this.frm.meta.title_field] || \"\").trim() || this.frm.docname);\n\t\t\tif(this.frm.doc.__islocal || title === this.frm.docname || this.frm.meta.autoname===\"hash\") {\n\t\t\t\tthis.page.set_title_sub(\"\");\n\t\t\t} else {\n\t\t\t\tthis.page.set_title_sub(this.frm.docname);\n\t\t\t}\n\t\t} else {\n\t\t\tvar title = this.frm.docname;\n\t\t}\n\n\t\tvar me = this;\n\t\ttitle = __(title);\n\t\tthis.page.set_title(title);\n\t\tif(this.frm.meta.title_field) {\n\t\t\tfrappe.utils.set_title(title + \" - \" + this.frm.docname);\n\t\t}\n\t\tthis.page.$title_area.toggleClass(\"editable-title\",\n\t\t\t!!(this.is_title_editable() || this.can_rename()));\n\n\t\tthis.set_indicator();\n\t},\n\tis_title_editable: function() {\n\t\tif (this.frm.meta.title_field===\"title\"\n\t\t\t&& this.frm.perm[0].write\n\t\t\t&& !this.frm.get_docfield(\"title\").options\n\t\t\t&& !this.frm.doc.__islocal) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t},\n\tcan_rename: function() {\n\t\treturn this.frm.perm[0].write && this.frm.meta.allow_rename && !this.frm.doc.__islocal;\n\t},\n\tsetup_editable_title: function() {\n\t\tvar me = this;\n\t\tthis.page.$title_area.find(\".title-text\").on(\"click\", function() {\n\t\t\tif(me.is_title_editable()) {\n\t\t\t\tfrappe.prompt({fieldname: \"title\", fieldtype:\"Data\",\n\t\t\t\t\tlabel: __(\"Title\"), reqd: 1, \"default\": me.frm.doc.title },\n\t\t\t\t\tfunction(data) {\n\t\t\t\t\t\tif(data.title) {\n\t\t\t\t\t\t\tme.frm.set_value(\"title\", data.title);\n\t\t\t\t\t\t\tif(!me.frm.doc.__islocal) {\n\t\t\t\t\t\t\t\tme.frm.save_or_update();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.set_title();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, __(\"Edit Title\"), __(\"Update\"));\n\t\t\t}\n\t\t\tif(me.can_rename()) {\n\t\t\t\tme.frm.rename_doc();\n\t\t\t}\n\t\t});\n\t},\n\tget_dropdown_menu: function(label) {\n\t\treturn this.page.add_dropdown(label);\n\t},\n\tset_indicator: function() {\n\t\tif(this.frm.save_disabled)\n\t\t\treturn;\n\n\t\tvar indicator = frappe.get_indicator(this.frm.doc);\n\t\tif(indicator) {\n\t\t\tthis.page.set_indicator(indicator[0], indicator[1]);\n\t\t} else {\n\t\t\tthis.page.clear_indicator();\n\t\t}\n\t},\n\tmake_menu: function() {\n\t\tthis.page.clear_icons();\n\t\tthis.page.clear_menu();\n\t\tvar me = this;\n\t\tvar p = this.frm.perm[0];\n\t\tvar docstatus = cint(this.frm.doc.docstatus);\n\t\tvar is_submittable = frappe.model.is_submittable(this.frm.doc.doctype)\n\n\t\tvar print_settings = frappe.model.get_doc(\":Print Settings\", \"Print Settings\")\n\t\tvar allow_print_for_draft = cint(print_settings.allow_print_for_draft);\n\t\tvar allow_print_for_cancelled = cint(print_settings.allow_print_for_cancelled);\n\n\t\t// Print\n\t\tif(!is_submittable || docstatus == 1  ||\n\t\t\t(allow_print_for_cancelled && docstatus == 2)||\n\t\t\t(allow_print_for_draft && docstatus == 0)) {\n\t\t\tif(frappe.model.can_print(null, me.frm)) {\n\t\t\t\tthis.page.add_menu_item(__(\"Print\"), function() {\n\t\t\t\t\tme.frm.print_doc();}, true);\n\t\t\t\tthis.print_icon = this.page.add_action_icon(\"fa fa-print\", function() {\n\t\t\t\t\tme.frm.print_doc();});\n\t\t\t}\n\t\t}\n\n\t\t// email\n\t\tif(frappe.model.can_email(null, me.frm) && me.frm.doc.docstatus < 2) {\n\t\t\tthis.page.add_menu_item(__(\"Email\"), function() {\n\t\t\t\tme.frm.email_doc();}, true);\n\t\t}\n\n\t\t// Linked With\n\t\tif(!me.frm.meta.issingle) {\n\t\t\tthis.page.add_menu_item(__('Links'), function() {\n\t\t\t\tme.show_linked_with();\n\t\t\t}, true)\n\t\t}\n\n\t\t// copy\n\t\tif(in_list(frappe.boot.user.can_create, me.frm.doctype) && !me.frm.meta.allow_copy) {\n\t\t\tthis.page.add_menu_item(__(\"Duplicate\"), function() {\n\t\t\t\tme.frm.copy_doc();}, true);\n\t\t}\n\n\t\t// rename\n\t\tif(this.can_rename()) {\n\t\t\tthis.page.add_menu_item(__(\"Rename\"), function() {\n\t\t\t\tme.frm.rename_doc();}, true);\n\t\t}\n\n\t\t// reload\n\t\tthis.page.add_menu_item(__(\"Reload\"), function() {\n\t\t\tme.frm.reload_doc();}, true);\n\n\t\t// add to desktop\n\t\tif(me.frm.meta.issingle) {\n\t\t\tthis.page.add_menu_item(__('Add to Desktop'), function () {\n\t\t\t\tfrappe.add_to_desktop(me.frm.doctype, me.frm.doctype);\n\t\t\t}, true);\n\t\t}\n\n\t\t// delete\n\t\tif((cint(me.frm.doc.docstatus) != 1) && !me.frm.doc.__islocal\n\t\t\t&& frappe.model.can_delete(me.frm.doctype)) {\n\t\t\tthis.page.add_menu_item(__(\"Delete\"), function() {\n\t\t\t\tme.frm.savetrash();}, true);\n\t\t}\n\n\t\tif(frappe.user_roles.includes(\"System Manager\")) {\n\t\t\tthis.page.add_menu_item(__(\"Customize\"), function() {\n\t\t\t\tfrappe.set_route(\"Form\", \"Customize Form\", {\n\t\t\t\t\tdoc_type: me.frm.doctype\n\t\t\t\t})\n\t\t\t}, true);\n\n\t\t\tif (frappe.boot.developer_mode===1 && me.frm.meta.issingle) {\n\t\t\t\t// edit doctype\n\t\t\t\tthis.page.add_menu_item(__(\"Edit DocType\"), function() {\n\t\t\t\t\tfrappe.set_route('Form', 'DocType', me.frm.doctype);\n\t\t\t\t}, true);\n\t\t\t}\n\t\t}\n\n\t\t// feedback\n\t\tif(!this.frm.doc.__unsaved) {\n\t\t\tif(is_submittable && docstatus == 1) {\n\t\t\t\tthis.page.add_menu_item(__(\"Request Feedback\"), function() {\n\t\t\t\t\tvar feedback = new frappe.utils.Feedback();\n\t\t\t\t\tfeedback.manual_feedback_request(me.frm.doc);\n\t\t\t\t}, true)\n\t\t\t}\n\t\t}\n\n\t\t// New\n\t\tif(p[CREATE] && !this.frm.meta.issingle) {\n\t\t\tthis.page.add_menu_item(__(\"New {0} (Ctrl+B)\", [__(me.frm.doctype)]), function() {\n\t\t\t\tfrappe.new_doc(me.frm.doctype, true);}, true);\n\t\t}\n\t},\n\tcan_save: function() {\n\t\treturn this.get_docstatus()===0;\n\t},\n\tcan_submit: function() {\n\t\treturn this.get_docstatus()===0\n\t\t\t&& !this.frm.doc.__islocal\n\t\t\t&& !this.frm.doc.__unsaved\n\t\t\t&& this.frm.perm[0].submit\n\t\t\t&& !this.has_workflow();\n\t},\n\tcan_update: function() {\n\t\treturn this.get_docstatus()===1\n\t\t\t&& !this.frm.doc.__islocal\n\t\t\t&& this.frm.perm[0].submit\n\t\t\t&& this.frm.doc.__unsaved\n\t},\n\tcan_cancel: function() {\n\t\treturn this.get_docstatus()===1\n\t\t\t&& this.frm.perm[0].cancel\n\t\t\t&& !this.read_only\n\t\t\t&& !this.has_workflow();\n\t},\n\tcan_amend: function() {\n\t\treturn this.get_docstatus()===2\n\t\t\t&& this.frm.perm[0].amend\n\t\t\t&& !this.read_only;\n\t},\n\thas_workflow: function() {\n\t\tif(this._has_workflow === undefined)\n\t\t\tthis._has_workflow = frappe.get_list(\"Workflow\", {document_type: this.frm.doctype}).length;\n\t\treturn this._has_workflow;\n\t},\n\tget_docstatus: function() {\n\t\treturn cint(this.frm.doc.docstatus);\n\t},\n\tshow_linked_with: function() {\n\t\tif(!this.frm.linked_with) {\n\t\t\tthis.frm.linked_with = new frappe.ui.form.LinkedWith({\n\t\t\t\tfrm: this.frm\n\t\t\t});\n\t\t}\n\t\tthis.frm.linked_with.show();\n\t},\n\tset_primary_action: function(dirty) {\n\t\tif (!dirty) {\n\t\t\t// don't clear actions menu if dirty\n\t\t\tthis.page.clear_user_actions();\n\t\t}\n\n\t\tvar status = this.get_action_status();\n\t\tif (status) {\n\t\t\tif (status !== this.current_status) {\n\t\t\t\tthis.set_page_actions(status);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.page.clear_actions();\n\t\t\tthis.current_status = null\n\t\t}\n\t},\n\tget_action_status: function() {\n\t\tvar status = null;\n\t\tif (this.frm.page.current_view_name==='print' || this.frm.hidden) {\n\t\t\tstatus = \"Edit\";\n\t\t} else if (this.can_submit()) {\n\t\t\tstatus = \"Submit\";\n\t\t} else if (this.can_save()) {\n\t\t\tif (!this.frm.save_disabled) {\n\t\t\t\t//Show the save button if there is no workflow or if there is a workflow and there are changes\n\t\t\t\tif (this.has_workflow() ? this.frm.doc.__unsaved : true) {\n\t\t\t\t\tstatus = \"Save\";\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (this.can_update()) {\n\t\t\tstatus = \"Update\";\n\t\t} else if (this.can_cancel()) {\n\t\t\tstatus = \"Cancel\";\n\t\t} else if (this.can_amend()) {\n\t\t\tstatus = \"Amend\";\n\t\t}\n\t\treturn status;\n\t},\n\tset_page_actions: function(status) {\n\t\tvar me = this;\n\t\tthis.page.clear_actions();\n\n\t\tif(status!== 'Edit') {\n\t\t\tvar perm_to_check = this.frm.action_perm_type_map[status];\n\t\t\tif(!this.frm.perm[0][perm_to_check]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif(status === \"Edit\") {\n\t\t\tthis.page.set_primary_action(__(\"Edit\"), function() {\n\t\t\t\tme.frm.page.set_view('main');\n\t\t\t}, 'octicon octicon-pencil');\n\t\t} else if(status === \"Cancel\") {\n\t\t\tthis.page.set_secondary_action(__(status), function() {\n\t\t\t\tme.frm.savecancel(this);\n\t\t\t}, \"octicon octicon-circle-slash\");\n\t\t} else {\n\t\t\tvar click = {\n\t\t\t\t\"Save\": function() {\n\t\t\t\t\treturn me.frm.save('Save', null, this);\n\t\t\t\t},\n\t\t\t\t\"Submit\": function() {\n\t\t\t\t\treturn me.frm.savesubmit(this);\n\t\t\t\t},\n\t\t\t\t\"Update\": function() {\n\t\t\t\t\treturn me.frm.save('Update', null, this);\n\t\t\t\t},\n\t\t\t\t\"Amend\": function() {\n\t\t\t\t\treturn me.frm.amend_doc();\n\t\t\t\t}\n\t\t\t}[status];\n\n\t\t\tvar icon = {\n\t\t\t\t\"Save\": \"octicon octicon-check\",\n\t\t\t\t\"Submit\": \"octicon octicon-lock\",\n\t\t\t\t\"Update\": \"octicon octicon-check\",\n\t\t\t\t\"Amend\": \"octicon octicon-split\"\n\t\t\t}[status];\n\n\t\t\tthis.page.set_primary_action(__(status), click, icon);\n\t\t}\n\n\t\tthis.current_status = status;\n\t},\n\tmake_cancel_amend_button: function() {\n\t\tvar me = this;\n\t\tvar docstatus = cint(this.frm.doc.docstatus);\n\t\tvar p = this.frm.perm[0];\n\t\tvar has_workflow = this.has_workflow();\n\n\t\tif(has_workflow) {\n\t\t\treturn;\n\t\t} else if(docstatus==1 && p[CANCEL]) {\n\t\t\tthis.page.set_secondary_action(__('Cancel'), function() {\n\t\t\t\tme.frm.savecancel(this) }, 'fa fa-ban-circle');\n\t\t} else if(docstatus==2 && p[AMEND]) {\n\t\t\tthis.page.set_secondary_action(__('Amend'), function() {\n\t\t\t\tme.frm.amend_doc() }, 'fa fa-pencil', true);\n\t\t}\n\t},\n\tadd_update_button_on_dirty: function() {\n\t\tvar me = this;\n\t\t$(this.frm.wrapper).on(\"dirty\", function() {\n\t\t\tme.show_title_as_dirty();\n\n\t\t\t// clear workflow actions\n\t\t\tme.frm.page.clear_actions_menu();\n\n\t\t\t// enable save action\n\t\t\tif(!me.frm.save_disabled) {\n\t\t\t\tme.set_primary_action(true);\n\t\t\t}\n\t\t});\n\t},\n\tshow_title_as_dirty: function() {\n\t\tif(this.frm.save_disabled)\n\t\t\treturn;\n\n\t\tif(this.frm.doc.__unsaved) {\n\t\t\tthis.page.set_indicator(__(\"Not Saved\"), \"orange\");\n\t\t}\n\n\t\t$(this.frm.wrapper).attr(\"data-state\", this.frm.doc.__unsaved ? \"dirty\" : \"clean\");\n\t}\n})\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.Dashboard = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.section = this.frm.fields_dict._form_dashboard.wrapper;\n\t\tthis.parent = this.section.find('.section-body');\n\t\tthis.wrapper = $(frappe.render_template('form_dashboard',\n\t\t\t{frm: this.frm})).appendTo(this.parent);\n\n\t\tthis.progress_area = this.wrapper.find(\".progress-area\");\n\t\tthis.heatmap_area = this.wrapper.find('.form-heatmap');\n\t\tthis.chart_area = this.wrapper.find('.form-graph');\n\t\tthis.stats_area = this.wrapper.find('.form-stats');\n\t\tthis.stats_area_row = this.stats_area.find('.row');\n\t\tthis.links_area = this.wrapper.find('.form-links');\n\t\tthis.transactions_area = this.links_area.find('.transactions');\n\n\t},\n\treset: function() {\n\t\tthis.section.addClass('hidden');\n\t\tthis.clear_headline();\n\n\t\t// clear progress\n\t\tthis.progress_area.empty().addClass('hidden');\n\n\t\t// clear links\n\t\tthis.links_area.addClass('hidden');\n\t\tthis.links_area.find('.count, .open-notification').addClass('hidden');\n\n\t\t// clear stats\n\t\tthis.stats_area.addClass('hidden')\n\t\tthis.stats_area_row.empty();\n\n\t\t// clear custom\n\t\tthis.wrapper.find('.custom').remove();\n\t},\n\tset_headline: function(html) {\n\t\tthis.frm.layout.show_message(html);\n\t},\n\tclear_headline: function() {\n\t\tthis.frm.layout.show_message();\n\t},\n\n\tadd_comment: function(text, alert_class, permanent) {\n\t\tvar me = this;\n\t\tthis.set_headline_alert(text, alert_class);\n\t\tif(!permanent) {\n\t\t\tsetTimeout(function() {\n\t\t\t\tme.clear_headline();\n\t\t\t}, 10000);\n\t\t}\n\t},\n\n\tclear_comment: function() {\n\t\tthis.clear_headline();\n\t},\n\n\tset_headline_alert: function(text, indicator_color) {\n\t\tif (!indicator_color) {\n\t\t\tindicator_color = 'orange';\n\t\t}\n\t\tif(text) {\n\t\t\tthis.set_headline(`<div><span class=\"indicator ${indicator_color}\">${text}</span></div>`);\n\t\t} else {\n\t\t\tthis.clear_headline();\n\t\t}\n\t},\n\n\tadd_section: function(html) {\n\t\treturn $('<div class=\"form-dashboard-section custom\">'+html+'</div>').appendTo(this.wrapper);\n\t},\n\n\tadd_progress: function(title, percent, message) {\n\t\tvar progress_chart = this.make_progress_chart(title);\n\n\t\tif(!$.isArray(percent)) {\n\t\t\tpercent = this.format_percent(title, percent);\n\t\t}\n\n\t\tvar progress = $('<div class=\"progress\"></div>').appendTo(progress_chart);\n\t\t$.each(percent, function(i, opts) {\n\t\t\t$(repl('<div class=\"progress-bar %(progress_class)s\" style=\"width: %(width)s\" \\\n\t\t\t\ttitle=\"%(title)s\"></div>', opts)).appendTo(progress);\n\t\t});\n\n\t\tif(message) {\n\t\t\t$('<p class=\"text-muted small\">' + message + '</p>').appendTo(this.progress_area);\n\t\t}\n\n\t\tthis.show();\n\t},\n\n\tformat_percent: function(title, percent) {\n\t\tvar width = cint(percent) < 1 ? 1 : cint(percent);\n\t\tvar progress_class = \"\";\n\t\tif(width < 10)\n\t\t\tprogress_class = \"progress-bar-danger\";\n\t\tif(width > 99.9)\n\t\t\tprogress_class = \"progress-bar-success\";\n\n\t\treturn [{\n\t\t\ttitle: title,\n\t\t\twidth: width + '%',\n\t\t\tprogress_class: progress_class\n\t\t}];\n\t},\n\tmake_progress_chart: function(title) {\n\t\tvar progress_chart = $('<div class=\"progress-chart\" title=\"'+(title || '')+'\"></div>')\n\t\t\t.appendTo(this.progress_area.removeClass('hidden'));\n\t\treturn progress_chart;\n\t},\n\n\trefresh: function() {\n\t\tthis.reset();\n\t\tif(this.frm.doc.__islocal) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(!this.data) {\n\t\t\tthis.init_data();\n\t\t}\n\n\t\tvar show = false;\n\n\t\tif(this.data && (this.data.transactions || []).length) {\n\t\t\tif(this.data.docstatus && this.frm.doc.docstatus !== this.data.docstatus) {\n\t\t\t\t// limited docstatus\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.render_links();\n\t\t\tthis.set_open_count();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif(this.data.heatmap) {\n\t\t\tthis.render_heatmap();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif(this.data.graph) {\n\t\t\tthis.setup_graph();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif(show) {\n\t\t\tthis.show();\n\t\t}\n\t},\n\n\tafter_refresh: function() {\n\t\tvar me = this;\n\t\t// show / hide new buttons (if allowed)\n\t\tthis.links_area.find('.btn-new').each(function() {\n\t\t\tif(me.frm.can_create($(this).attr('data-doctype'))) {\n\t\t\t\t$(this).removeClass('hidden');\n\t\t\t}\n\t\t});\n\t},\n\n\tinit_data: function() {\n\t\tthis.data = this.frm.meta.__dashboard || {};\n\t\tif(!this.data.transactions) this.data.transactions = [];\n\t\tif(!this.data.internal_links) this.data.internal_links = {};\n\t\tthis.filter_permissions();\n\t},\n\n\tfilter_permissions: function() {\n\t\t// filter out transactions for which the user\n\t\t// does not have permission\n\t\tvar transactions = [];\n\t\t(this.data.transactions || []).forEach(function(group) {\n\t\t\tvar items = [];\n\t\t\tgroup.items.forEach(function(doctype) {\n\t\t\t\tif(frappe.model.can_read(doctype)) {\n\t\t\t\t\titems.push(doctype);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// only add thie group, if there is atleast\n\t\t\t// one item with permission\n\t\t\tif(items.length) {\n\t\t\t\tgroup.items = items;\n\t\t\t\ttransactions.push(group);\n\t\t\t}\n\t\t});\n\t\tthis.data.transactions = transactions;\n\t},\n\trender_links: function() {\n\t\tvar me = this;\n\t\tthis.links_area.removeClass('hidden');\n\t\tthis.links_area.find('.btn-new').addClass('hidden');\n\t\tif(this.data_rendered) {\n\t\t\treturn;\n\t\t}\n\n\t\t//this.transactions_area.empty();\n\n\t\tthis.data.frm = this.frm;\n\n\t\t$(frappe.render_template('form_links', this.data))\n\t\t\t.appendTo(this.transactions_area)\n\n\t\t// bind links\n\t\tthis.transactions_area.find(\".badge-link\").on('click', function() {\n\t\t\tme.open_document_list($(this).parent());\n\t\t});\n\n\t\t// bind open notifications\n\t\tthis.transactions_area.find('.open-notification').on('click', function() {\n\t\t\tme.open_document_list($(this).parent(), true);\n\t\t});\n\n\t\t// bind new\n\t\tthis.transactions_area.find('.btn-new').on('click', function() {\n\t\t\tme.frm.make_new($(this).attr('data-doctype'));\n\t\t});\n\n\t\tthis.data_rendered = true;\n\t},\n\topen_document_list: function($link, show_open) {\n\t\t// show document list with filters\n\t\tvar doctype = $link.attr('data-doctype'),\n\t\t\tnames = $link.attr('data-names') || [];\n\n\t\tif(this.data.internal_links[doctype]) {\n\t\t\tif(names.length) {\n\t\t\t\tfrappe.route_options = {'name': ['in', names]};\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else if(this.data.fieldname) {\n\t\t\tfrappe.route_options = this.get_document_filter(doctype);\n\t\t\tif(show_open) {\n\t\t\t\tfrappe.ui.notifications.show_open_count_list(doctype);\n\t\t\t}\n\t\t}\n\n\t\tfrappe.set_route(\"List\", doctype);\n\t},\n\tget_document_filter: function(doctype) {\n\t\t// return the default filter for the given document\n\t\t// like {\"customer\": frm.doc.name}\n\t\tvar filter = {};\n\t\tvar fieldname = this.data.non_standard_fieldnames\n\t\t\t? (this.data.non_standard_fieldnames[doctype] || this.data.fieldname)\n\t\t\t: this.data.fieldname;\n\t\tfilter[fieldname] = this.frm.doc.name;\n\t\treturn filter;\n\t},\n\tset_open_count: function() {\n\t\tif(!this.data.transactions || !this.data.fieldname) {\n\t\t\treturn;\n\t\t}\n\n\t\t// list all items from the transaction list\n\t\tvar items = [],\n\t\t\tme = this;\n\n\t\tthis.data.transactions.forEach(function(group) {\n\t\t\tgroup.items.forEach(function(item) { items.push(item); });\n\t\t});\n\n\t\tvar method = this.data.method || 'frappe.desk.notifications.get_open_count';\n\n\t\tfrappe.call({\n\t\t\ttype: \"GET\",\n\t\t\tmethod: method,\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.doc.name,\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message.timeline_data) {\n\t\t\t\t\tme.update_heatmap(r.message.timeline_data);\n\t\t\t\t}\n\n\t\t\t\t// update badges\n\t\t\t\t$.each(r.message.count, function(i, d) {\n\t\t\t\t\tme.frm.dashboard.set_badge_count(d.name, cint(d.open_count), cint(d.count));\n\t\t\t\t});\n\n\t\t\t\t// update from internal links\n\t\t\t\t$.each(me.data.internal_links, function(doctype, link) {\n\t\t\t\t\tvar table_fieldname = link[0], link_fieldname = link[1];\n\t\t\t\t\tvar names = [];\n\t\t\t\t\t(me.frm.doc[table_fieldname] || []).forEach(function(d) {\n\t\t\t\t\t\tvar value = d[link_fieldname];\n\t\t\t\t\t\tif(value && names.indexOf(value)===-1) {\n\t\t\t\t\t\t\tnames.push(value);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tme.frm.dashboard.set_badge_count(doctype, 0, names.length, names);\n\t\t\t\t});\n\n\t\t\t\tme.frm.dashboard_data = r.message;\n\t\t\t\tme.frm.trigger('dashboard_update');\n\t\t\t}\n\t\t});\n\n\t},\n\tset_badge_count: function(doctype, open_count, count, names) {\n\t\tvar $link = $(this.transactions_area)\n\t\t\t.find('.document-link[data-doctype=\"'+doctype+'\"]');\n\n\t\tif(open_count) {\n\t\t\t$link.find('.open-notification')\n\t\t\t\t.removeClass('hidden')\n\t\t\t\t.html((open_count > 99) ? '99+' : open_count);\n\t\t}\n\n\t\tif(count) {\n\t\t\t$link.find('.count')\n\t\t\t\t.removeClass('hidden')\n\t\t\t\t.html((count > 99) ? '99+' : count);\n\t\t}\n\n\t\tif(this.data.internal_links[doctype]) {\n\t\t\tif(names && names.length) {\n\t\t\t\t$link.attr('data-names', names ? names.join(',') : '');\n\t\t\t} else {\n\t\t\t\t$link.find('a').attr('disabled', true);\n\t\t\t}\n\t\t}\n\t},\n\n\tupdate_heatmap: function(data) {\n\t\tif(this.heatmap) {\n\t\t\tthis.heatmap.update(data);\n\t\t}\n\t},\n\n\t// heatmap\n\trender_heatmap: function() {\n\t\tif(!this.heatmap) {\n\t\t\tthis.heatmap = new Chart(\"#heatmap-\" + frappe.model.scrub(this.frm.doctype), {\n\t\t\t\ttype: 'heatmap',\n\t\t\t\theight: 120,\n\t\t\t\tstart: new Date(moment().subtract(1, 'year').toDate()),\n\t\t\t\tcount_label: \"interactions\",\n\t\t\t\tdiscreteDomains: 0,\n\t\t\t\tdata: {}\n\t\t\t});\n\n\t\t\t// center the heatmap\n\t\t\tthis.heatmap_area.removeClass('hidden').find('svg').css({'margin': 'auto'});\n\n\t\t\t// message\n\t\t\tvar heatmap_message = this.heatmap_area.find('.heatmap-message');\n\t\t\tif(this.data.heatmap_message) {\n\t\t\t\theatmap_message.removeClass('hidden').html(this.data.heatmap_message);\n\t\t\t} else {\n\t\t\t\theatmap_message.addClass('hidden');\n\t\t\t}\n\t\t}\n\t},\n\n\tadd_indicator: function(label, color) {\n\t\tthis.show();\n\t\tthis.stats_area.removeClass('hidden');\n\n\n\t\t// set colspan\n\t\tvar indicators = this.stats_area_row.find('.indicator-column');\n\t\tvar n_indicators = indicators.length + 1;\n\t\tvar colspan;\n\t\tif(n_indicators > 4) { colspan = 3 }\n\t\telse { colspan = 12 / n_indicators; }\n\n\t\t// reset classes in existing indicators\n\t\tif(indicators.length) {\n\t\t\tindicators.removeClass().addClass('col-sm-'+colspan).addClass('indicator-column');\n\t\t}\n\n\t\tvar indicator = $('<div class=\"col-sm-'+colspan+' indicator-column\"><span class=\"indicator '+color+'\">'\n\t\t\t+label+'</span></div>').appendTo(this.stats_area_row);\n\n\t\treturn indicator;\n\t},\n\n\t// graphs\n\tsetup_graph: function() {\n\t\tvar me = this;\n\t\tvar method = this.data.graph_method;\n\t\tvar args = {\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.doc.name,\n\t\t};\n\t\t$.extend(args, this.data.graph_method_args);\n\n\t\tfrappe.call({\n\t\t\ttype: \"GET\",\n\t\t\tmethod: method,\n\t\t\targs: args,\n\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\tme.render_graph(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\trender_graph: function(args) {\n\t\tvar me = this;\n\t\tthis.chart_area.empty().removeClass('hidden');\n\t\t$.extend(args, {\n\t\t\ttype: 'line',\n\t\t\theight: 140,\n\t\t\tcolors: ['green']\n\t\t});\n\t\tthis.show();\n\n\t\tthis.chart = new Chart('.form-graph', args);\n\t\tif(!this.chart) {\n\t\t\tthis.hide();\n\t\t}\n\t},\n\n\tshow: function() {\n\t\tthis.section.removeClass('hidden');\n\t},\n\n\thide: function() {\n\t\tthis.section.addClass('hidden');\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.document_flow');\n\nfrappe.ui.form.DocumentFlow = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\n\t\tthis.module = frappe.get_meta(this.frm.doctype).module\n\t\tif (!frappe.document_flow || !frappe.document_flow[this.module]) {\n\t\t\treturn;\n\t\t}\n\t\tthis.doctypes = frappe.document_flow[this.module][this.frm.doctype];\n\t\tif (!this.doctypes) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.wrapper = $('<div class=\"document-flow-wrapper hidden\"></div>').prependTo(this.frm.layout.wrapper);\n\t},\n\n\trefresh: function() {\n\t\tif(this.doctypes) {\n\t\t\tthis.reset();\n\t\t\tthis.render();\n\t\t}\n\t},\n\n\treset: function() {\n\t\tthis.wrapper.empty().addClass('hidden');\n\t\tthis.linked_with = {};\n\t},\n\n\trender: function() {\n\t\tvar me = this;\n\n\t\t$(frappe.render_template('form_document_flow', {\n\t\t\tfrm: this.frm,\n\t\t\tdoctypes: this.doctypes,\n\t\t})).appendTo(this.wrapper.removeClass('hidden'));\n\n\t\tthis.wrapper.on('click', '.document-flow-link', function() {\n\t\t\tvar doctype = $(this).attr(\"data-doctype\");\n\t\t\tif (me.frm.doctype != doctype) {\n\t\t\t\tme.get_linked_docs(doctype);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\tif (!this.frm.doc.__islocal) {\n\t\t\tthis.mark_completed_flow()\n\t\t}\n\n\t},\n\n\tget_linked_docs: function(for_doctype) {\n\t\tif(!this.linked_with[for_doctype]) {\n\t\t\tthis.linked_with[for_doctype] = new frappe.ui.form.LinkedWith({\n\t\t\t\tfrm: this.frm,\n\t\t\t\tfor_doctype: for_doctype\n\t\t\t});\n\t\t}\n\n\t\tthis.linked_with[for_doctype].show();\n\t},\n\n\tmark_completed_flow: function() {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.desk.form.document_flow.get_document_completion_status\",\n\t\t\targs: {\n\t\t\t\tdoctypes: me.doctypes,\n\t\t\t\tfrm_doctype: me.frm.doctype,\n\t\t\t\tfrm_docname: me.frm.docname\n\t\t\t},\n\t\t\tcallback: function(r){\n\t\t\t\tif(!r.message) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$.each(me.doctypes, function(i, doctype) {\n\t\t\t\t\tif (r.message[doctype] && me.frm.doctype!=doctype) {\n\t\t\t\t\t\tme.wrapper.find(\"[data-doctype='\"+doctype+\"']a .indicator\")\n\t\t\t\t\t\t\t.removeClass(\"darkgrey\")\n\t\t\t\t\t\t\t.addClass(\"black\")\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.save = function (frm, action, callback, btn) {\n\t$(btn).prop(\"disabled\", true);\n\n\t// specified here because there are keyboard shortcuts to save\n\tvar working_label = {\n\t\t\"Save\": __(\"Saving\"),\n\t\t\"Submit\": __(\"Submitting\"),\n\t\t\"Update\": __(\"Updating\"),\n\t\t\"Amend\": __(\"Amending\"),\n\t\t\"Cancel\": __(\"Cancelling\")\n\t}[toTitle(action)];\n\n\tvar freeze_message = working_label ? __(working_label) : \"\";\n\n\tvar save = function () {\n\t\tremove_empty_rows();\n\n\t\t$(frm.wrapper).addClass('validated-form');\n\t\tif (check_mandatory()) {\n\t\t\t_call({\n\t\t\t\tmethod: \"frappe.desk.form.save.savedocs\",\n\t\t\t\targs: { doc: frm.doc, action: action },\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\t$(document).trigger(\"save\", [frm.doc]);\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t\terror: function (r) {\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t\tbtn: btn,\n\t\t\t\tfreeze_message: freeze_message\n\t\t\t});\n\t\t} else {\n\t\t\t$(btn).prop(\"disabled\", false);\n\t\t}\n\t};\n\n\tvar remove_empty_rows = function() {\n\t\t/**\n\t\tThis function removes empty rows. Note that in this function, a row is considered\n\t\tempty if the fields with `in_list_view: 1` are undefined or falsy because that's\n\t\twhat users also consider to be an empty row\n\t\t */\n\t\tconst docs = frappe.model.get_all_docs(frm.doc);\n\n\t\t// we should only worry about table data\n\t\tconst tables = docs.filter(function(d){\n\t\t\treturn frappe.model.is_table(d.doctype);\n\t\t});\n\n\t\ttables.map(\n\t\t\tfunction(doc){\n\t\t\t\tconst cells = frappe.meta.docfield_list[doc.doctype] || [];\n\n\t\t\t\tconst in_list_view_cells = cells.filter(function(df) {\n\t\t\t\t\treturn cint(df.in_list_view) === 1;\n\t\t\t\t});\n\n\t\t\t\tvar is_empty_row = function(cells) {\n\t\t\t\t\tfor (var i=0; i < cells.length; i++){\n\t\t\t\t\t\tif(locals[doc.doctype][doc.name][cells[i].fieldname]){\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (is_empty_row(in_list_view_cells)) {\n\t\t\t\t\tfrappe.model.clear_doc(doc.doctype, doc.name);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t};\n\n\tvar cancel = function () {\n\t\tvar args = {\n\t\t\tdoctype: frm.doc.doctype,\n\t\t\tname: frm.doc.name\n\t\t};\n\n\t\t// update workflow state value if workflow exists\n\t\tvar workflow_state_fieldname = frappe.workflow.get_state_fieldname(frm.doctype);\n\t\tif (workflow_state_fieldname) {\n\t\t\t$.extend(args, {\n\t\t\t\tworkflow_state_fieldname: workflow_state_fieldname,\n\t\t\t\tworkflow_state: frm.doc[workflow_state_fieldname]\n\n\t\t\t});\n\t\t}\n\n\t\t_call({\n\t\t\tmethod: \"frappe.desk.form.save.cancel\",\n\t\t\targs: args,\n\t\t\tcallback: function (r) {\n\t\t\t\t$(document).trigger(\"save\", [frm.doc]);\n\t\t\t\tcallback(r);\n\t\t\t},\n\t\t\tbtn: btn,\n\t\t\tfreeze_message: freeze_message\n\t\t});\n\t};\n\n\tvar check_mandatory = function () {\n\t\tvar me = this;\n\t\tvar has_errors = false;\n\t\tfrm.scroll_set = false;\n\n\t\tif (frm.doc.docstatus == 2) return true; // don't check for cancel\n\n\t\t$.each(frappe.model.get_all_docs(frm.doc), function (i, doc) {\n\t\t\tvar error_fields = [];\n\t\t\tvar folded = false;\n\n\t\t\t$.each(frappe.meta.docfield_list[doc.doctype] || [], function (i, docfield) {\n\t\t\t\tif (docfield.fieldname) {\n\t\t\t\t\tvar df = frappe.meta.get_docfield(doc.doctype,\n\t\t\t\t\t\tdocfield.fieldname, frm.doc.name);\n\n\t\t\t\t\tif (df.fieldtype === \"Fold\") {\n\t\t\t\t\t\tfolded = frm.layout.folded;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (df.reqd && !frappe.model.has_value(doc.doctype, doc.name, df.fieldname)) {\n\t\t\t\t\t\thas_errors = true;\n\t\t\t\t\t\terror_fields[error_fields.length] = __(df.label);\n\t\t\t\t\t\t// scroll to field\n\t\t\t\t\t\tif (!frm.scroll_set) {\n\t\t\t\t\t\t\tscroll_to(doc.parentfield || df.fieldname);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (folded) {\n\t\t\t\t\t\t\tfrm.layout.unfold();\n\t\t\t\t\t\t\tfolded = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (error_fields.length) {\n\t\t\t\tif (doc.parenttype) {\n\t\t\t\t\tvar message = __('Mandatory fields required in table {0}, Row {1}',\n\t\t\t\t\t\t[__(frappe.meta.docfield_map[doc.parenttype][doc.parentfield].label).bold(), doc.idx]);\n\t\t\t\t} else {\n\t\t\t\t\tvar message = __('Mandatory fields required in {0}', [__(doc.doctype)]);\n\n\t\t\t\t}\n\t\t\t\tmessage = message + '<br><br><ul><li>' + error_fields.join('</li><li>') + \"</ul>\";\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\ttitle: __('Missing Fields')\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn !has_errors;\n\t};\n\n\tvar scroll_to = function (fieldname) {\n\t\tvar f = cur_frm.fields_dict[fieldname];\n\t\tif (f) {\n\t\t\t$(document).scrollTop($(f.wrapper).offset().top - 60);\n\t\t}\n\t\tfrm.scroll_set = true;\n\t};\n\n\tvar _call = function (opts) {\n\t\t// opts = {\n\t\t// \tmethod: \"some server method\",\n\t\t// \targs: {args to be passed},\n\t\t// \tcallback: callback,\n\t\t// \tbtn: btn\n\t\t// }\n\n\t\tif (frappe.ui.form.is_saving) {\n\t\t\t// this is likely to happen if the user presses the shortcut cmd+s for a longer duration or uses double click\n\t\t\t// no need to show this to user, as they can see \"Saving\" in freeze message\n\t\t\tconsole.log(\"Already saving. Please wait a few moments.\")\n\t\t\tthrow \"saving\";\n\t\t}\n\n\t\tfrappe.ui.form.remove_old_form_route();\n\t\tfrappe.ui.form.is_saving = true;\n\n\t\treturn frappe.call({\n\t\t\tfreeze: true,\n\t\t\t// freeze_message: opts.freeze_message,\n\t\t\tmethod: opts.method,\n\t\t\targs: opts.args,\n\t\t\tbtn: opts.btn,\n\t\t\tcallback: function (r) {\n\t\t\t\topts.callback && opts.callback(r);\n\t\t\t},\n\t\t\terror: opts.error,\n\t\t\talways: function (r) {\n\t\t\t\t$(btn).prop(\"disabled\", false);\n\t\t\t\tfrappe.ui.form.is_saving = false;\n\t\t\t\tif (r) {\n\t\t\t\t\tvar doc = r.docs && r.docs[0];\n\t\t\t\t\tif (doc) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(doc);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t};\n\n\tif (action === \"cancel\") {\n\t\tcancel();\n\t} else {\n\t\tsave();\n\t}\n}\n\nfrappe.ui.form.remove_old_form_route = () => {\n\tlet index = -1;\n\tlet current_route = frappe.get_route();\n\tfrappe.route_history.map((arr, i) => {\n\t\tif (arr.join(\"/\") === current_route.join(\"/\")) {\n\t\t\tindex = i;\n\t\t}\n\t});\n\tfrappe.route_history.splice(index, 1);\n}\n\nfrappe.ui.form.update_calling_link = (newdoc) => {\n\tif (frappe._from_link && newdoc.doctype === frappe._from_link.df.options) {\n\t\tvar doc = frappe.get_doc(frappe._from_link.doctype, frappe._from_link.docname);\n\t\t// set value\n\t\tif (doc && doc.parentfield) {\n\t\t\t//update values for child table\n\t\t\t$.each(frappe._from_link.frm.fields_dict[doc.parentfield].grid.grid_rows, function (index, field) {\n\t\t\t\tif (field.doc && field.doc.name === frappe._from_link.docname) {\n\t\t\t\t\tfrappe._from_link.set_value(newdoc.name);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tfrappe._from_link.set_value(newdoc.name);\n\t\t}\n\n\t\t// refresh field\n\t\tfrappe._from_link.refresh();\n\n\t\t// if from form, switch\n\t\tif (frappe._from_link.frm) {\n\t\t\tfrappe.set_route(\"Form\",\n\t\t\t\tfrappe._from_link.frm.doctype, frappe._from_link.frm.docname)\n\t\t\t\t.then(() => {\n\t\t\t\t\tfrappe.utils.scroll_to(frappe._from_link_scrollY);\n\t\t\t\t});\n\t\t}\n\n\t\tfrappe._from_link = null;\n\t}\n}\n\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form.handlers\");\n\nfrappe.ui.form.get_event_handler_list = function(doctype, fieldname) {\n\tif(!frappe.ui.form.handlers[doctype]) {\n\t\tfrappe.ui.form.handlers[doctype] = {};\n\t}\n\tif(!frappe.ui.form.handlers[doctype][fieldname]) {\n\t\tfrappe.ui.form.handlers[doctype][fieldname] = [];\n\t}\n\treturn frappe.ui.form.handlers[doctype][fieldname];\n}\n\nfrappe.ui.form.on = frappe.ui.form.on_change = function(doctype, fieldname, handler) {\n\tvar add_handler = function(fieldname, handler) {\n\t\tvar handler_list = frappe.ui.form.get_event_handler_list(doctype, fieldname);\n\t\thandler_list.push(handler);\n\n\t\t// add last handler to events so it can be called as\n\t\t// frm.events.handler(frm)\n\t\tif(cur_frm && cur_frm.doctype===doctype) {\n\t\t\tcur_frm.events[fieldname] = handler;\n\t\t}\n\t}\n\n\tif (!handler && $.isPlainObject(fieldname)) {\n\t\t// a dict of handlers {fieldname: handler, ...}\n\t\tfor (var key in fieldname) {\n\t\t\tvar fn = fieldname[key];\n\t\t\tif (typeof fn === \"function\") {\n\t\t\t\tadd_handler(key, fn);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tadd_handler(fieldname, handler);\n\t}\n}\n\n// remove standard event handlers\nfrappe.ui.form.off = function(doctype, fieldname, handler) {\n\tvar handler_list = frappe.ui.form.get_event_handler_list(doctype, fieldname);\n\tif(handler_list.length) {\n\t\tfrappe.ui.form.handlers[doctype][fieldname] = [];\n\t}\n\n\tif(cur_frm && cur_frm.doctype===doctype && cur_frm.events[fieldname]) {\n\t\tdelete cur_frm.events[fieldname];\n\t}\n\n\tif(cur_frm && cur_frm.cscript && cur_frm.cscript[fieldname]) {\n\t\tdelete cur_frm.cscript[fieldname];\n\t}\n}\n\n\nfrappe.ui.form.trigger = function(doctype, fieldname) {\n\tcur_frm.script_manager.trigger(fieldname, doctype);\n}\n\nfrappe.ui.form.ScriptManager = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\tmake: function(ControllerClass) {\n\t\tthis.frm.cscript = $.extend(this.frm.cscript,\n\t\t\tnew ControllerClass({frm: this.frm}));\n\t},\n\ttrigger: function(event_name, doctype, name) {\n\t\t// trigger all the form level events that\n\t\t// are bound to this event_name\n\t\tlet me = this;\n\t\tdoctype = doctype || this.frm.doctype;\n\t\tname = name || this.frm.docname;\n\n\t\tlet tasks = [];\n\t\tlet handlers = this.get_handlers(event_name, doctype);\n\n\t\t// helper for child table\n\t\tthis.frm.selected_doc = frappe.get_doc(doctype, name);\n\n\t\tlet runner = (_function, is_old_style) => {\n\t\t\tlet _promise = null;\n\t\t\tif(is_old_style) {\n\t\t\t\t// old style arguments (doc, cdt, cdn)\n\t\t\t\t_promise = me.frm.cscript[_function](me.frm.doc, doctype, name);\n\t\t\t} else {\n\t\t\t\t// new style (frm, doctype, name)\n\t\t\t\t_promise = _function(me.frm, doctype, name);\n\t\t\t}\n\n\t\t\t// if the trigger returns a promise, return it,\n\t\t\t// or use the default promise frappe.after_ajax\n\t\t\tif (_promise && _promise.then) {\n\t\t\t\treturn _promise;\n\t\t\t} else {\n\t\t\t\treturn frappe.after_server_call();\n\t\t\t}\n\t\t};\n\n\t\t// make list of functions to be run serially\n\t\thandlers.new_style.forEach((_function) => {\n\t\t\tif(event_name==='setup') {\n\t\t\t\t// setup must be called immediately\n\t\t\t\trunner(_function, false);\n\t\t\t} else {\n\t\t\t\ttasks.push(() => runner(_function, false));\n\t\t\t}\n\t\t});\n\n\t\thandlers.old_style.forEach((_function) => {\n\t\t\tif(event_name==='setup') {\n\t\t\t\t// setup must be called immediately\n\t\t\t\trunner(_function, true);\n\t\t\t} else {\n\t\t\t\ttasks.push(() => runner(_function, true));\n\t\t\t}\n\t\t});\n\n\t\t// run them serially\n\t\treturn frappe.run_serially(tasks);\n\t},\n\thas_handlers: function(event_name, doctype) {\n\t\tlet handlers = this.get_handlers(event_name, doctype);\n\t\treturn handlers && (handlers.old_style.length || handlers.new_style.length);\n\t},\n\tget_handlers: function(event_name, doctype) {\n\t\t// returns list of all functions to be called (old style and new style)\n\t\tlet me = this;\n\t\tlet handlers = {\n\t\t\told_style: [],\n\t\t\tnew_style: []\n\t\t};\n\t\tif(frappe.ui.form.handlers[doctype] && frappe.ui.form.handlers[doctype][event_name]) {\n\t\t\t$.each(frappe.ui.form.handlers[doctype][event_name], function(i, fn) {\n\t\t\t\thandlers.new_style.push(fn);\n\t\t\t});\n\t\t}\n\t\tif(this.frm.cscript[event_name]) {\n\t\t\thandlers.old_style.push(event_name);\n\t\t}\n\t\tif(this.frm.cscript[\"custom_\" + event_name]) {\n\t\t\thandlers.old_style.push(\"custom_\" + event_name);\n\t\t}\n\t\treturn handlers;\n\t},\n\tsetup: function() {\n\t\tvar doctype = this.frm.meta;\n\t\tvar me = this;\n\n\t\t// js\n\t\tvar cs = doctype.__js;\n\t\tif(cs) {\n\t\t\tvar tmp = eval(cs);\n\t\t}\n\n\t\tif(doctype.__custom_js) {\n\t\t\ttry {\n\t\t\t\teval(doctype.__custom_js);\n\t\t\t} catch(e) {\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('Error in Custom Script'),\n\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\tmessage: '<pre class=\"small\"><code>' + e.stack  + '</code></pre>'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction setup_add_fetch(df) {\n\t\t\tif((['Data', 'Read Only', 'Text', 'Small Text',\n\t\t\t\t'Text Editor', 'Code'].includes(df.fieldtype) || df.read_only==1)\n\t\t\t\t&& df.options && df.options.indexOf(\".\")!=-1) {\n\t\t\t\tvar parts = df.options.split(\".\");\n\t\t\t\tme.frm.add_fetch(parts[0], parts[1], df.fieldname);\n\t\t\t}\n\t\t}\n\n\t\t// setup add fetch\n\t\t$.each(this.frm.fields, function(i, field) {\n\t\t\tsetup_add_fetch(field.df);\n\t\t\tif(field.df.fieldtype===\"Table\") {\n\t\t\t\t$.each(frappe.meta.get_docfields(field.df.options, me.frm.docname), function(i, df) {\n\t\t\t\t\tsetup_add_fetch(df);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// css\n\t\tdoctype.__css && frappe.dom.set_style(doctype.__css);\n\n\t\tthis.trigger('setup');\n\t},\n\tlog_error: function(caller, e) {\n\t\tfrappe.show_alert(\"Error in Client Script.\");\n\t\tconsole.group && console.group();\n\t\tconsole.log(\"----- error in client script -----\");\n\t\tconsole.log(\"method: \" + caller);\n\t\tconsole.log(e);\n\t\tconsole.log(\"error message: \" + e.message);\n\t\tconsole.trace && console.trace();\n\t\tconsole.log(\"----- end of error message -----\");\n\t\tconsole.group && console.groupEnd();\n\t},\n\tcopy_from_first_row: function(parentfield, current_row, fieldnames) {\n\t\tvar data = this.frm.doc[parentfield];\n\t\tif(data.length===1 || data[0]===current_row) return;\n\n\t\tif(typeof fieldnames==='string') {\n\t\t\tfieldnames = [fieldnames];\n\t\t}\n\n\t\t$.each(fieldnames, function(i, fieldname) {\n\t\t\tfrappe.model.set_value(current_row.doctype, current_row.name, fieldname,\n\t\t\t\tdata[0][fieldname]);\n\t\t});\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.get_open_grid_form = function() {\n\treturn $(\".grid-row-open\").data(\"grid_row\");\n}\n\nfrappe.ui.form.close_grid_form = function() {\n\tvar open_form = frappe.ui.form.get_open_grid_form();\n\topen_form && open_form.hide_form();\n\n\t// hide editable row too\n\tif(frappe.ui.form.editable_row) {\n\t\tfrappe.ui.form.editable_row.toggle_editable_row(false);\n\t}\n}\n\n\nfrappe.ui.form.Grid = Class.extend({\n\tinit: function(opts) {\n\t\tvar me = this;\n\t\t$.extend(this, opts);\n\t\tthis.fieldinfo = {};\n\t\tthis.doctype = this.df.options;\n\n\t\tif(this.doctype) {\n\t\t\tthis.meta = frappe.get_meta(this.doctype);\n\t\t}\n\t\tthis.fields_map = {};\n\t\tthis.template = null;\n\t\tthis.multiple_set = false;\n\t\tif(this.frm && this.frm.meta.__form_grid_templates\n\t\t\t&& this.frm.meta.__form_grid_templates[this.df.fieldname]) {\n\t\t\tthis.template = this.frm.meta.__form_grid_templates[this.df.fieldname];\n\t\t}\n\n\t\tthis.is_grid = true;\n\t},\n\n\tallow_on_grid_editing: function() {\n\t\tif(frappe.utils.is_xs()) {\n\t\t\treturn false;\n\t\t} else if(this.meta && this.meta.editable_grid || !this.meta) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t},\n\tmake: function() {\n\t\tvar me = this;\n\n\t\tthis.wrapper = $(frappe.render_template(\"grid_body\", {}))\n\t\t\t.appendTo(this.parent)\n\t\t\t.attr(\"data-fieldname\", this.df.fieldname);\n\n\t\tthis.form_grid = this.wrapper.find('.form-grid');\n\n\t\tthis.wrapper.find(\".grid-add-row\").click(function() {\n\t\t\tme.add_new_row(null, null, true);\n\t\t\tme.set_focus_on_row();\n\n\t\t\treturn false;\n\t\t});\n\n\t\tthis.custom_buttons = {};\n\t\tthis.grid_buttons = this.wrapper.find('.grid-buttons');\n\t\tthis.remove_rows_button = this.grid_buttons.find('.grid-remove-rows')\n\n\t\tthis.setup_allow_bulk_edit();\n\t\tthis.setup_check();\n\t\tif(this.df.on_setup) {\n\t\t\tthis.df.on_setup(this);\n\t\t}\n\t},\n\n\tsetup_check: function() {\n\t\tvar me = this;\n\n\t\tthis.wrapper.on('click', '.grid-row-check', function(e) {\n\t\t\tvar $check = $(this);\n\t\t\tif($check.parents('.grid-heading-row:first').length!==0) {\n\t\t\t\t// select all?\n\t\t\t\tvar checked = $check.prop('checked');\n\t\t\t\t$check.parents('.form-grid:first')\n\t\t\t\t\t.find('.grid-row-check').prop('checked', checked);\n\n\t\t\t\t// set all\n\t\t\t\t(me.grid_rows || []).forEach(function(row) { row.doc.__checked = checked ? 1 : 0; });\n\t\t\t} else {\n\t\t\t\tvar docname = $check.parents('.grid-row:first').attr('data-name');\n\t\t\t\tme.grid_rows_by_docname[docname].select($check.prop('checked'));\n\t\t\t}\n\t\t\tme.refresh_remove_rows_button();\n\t\t});\n\n\t\tthis.remove_rows_button.on('click', function() {\n\t\t\tvar dirty = false;\n\n\t\t\tlet tasks = [];\n\t\t\tme.deleted_docs = [];\n\n\t\t\tme.get_selected().forEach((docname) => {\n\t\t\t\ttasks.push(() => {\n\t\t\t\t\tif (!me.frm) {\n\t\t\t\t\t\tme.deleted_docs.push(docname);\n\t\t\t\t\t}\n\t\t\t\t\tme.grid_rows_by_docname[docname].remove();\n\t\t\t\t\tdirty = true;\n\t\t\t\t});\n\t\t\t\ttasks.push(() => frappe.timeout(0.1));\n\t\t\t});\n\n\t\t\ttasks.push(() => {\n\t\t\t\tif (dirty) me.refresh();\n\t\t\t});\n\n\t\t\tfrappe.run_serially(tasks);\n\t\t});\n\t},\n\tselect_row: function(name) {\n\t\tthis.grid_rows_by_docname[name].select();\n\t},\n\tremove_all: function() {\n\t\tthis.grid_rows.forEach(row => {\n\t\t\trow.remove();\n\t\t});\n\t},\n\trefresh_remove_rows_button: function() {\n\t\tthis.remove_rows_button.toggleClass('hide',\n\t\t\tthis.wrapper.find('.grid-body .grid-row-check:checked:first').length ? false : true);\n\t},\n\tget_selected: function() {\n\t\treturn (this.grid_rows || []).map(function(row) { return row.doc.__checked ? row.doc.name : null; })\n\t\t\t.filter(function(d) { return d; });\n\t},\n\tget_selected_children: function() {\n\t\treturn (this.grid_rows || []).map(function(row) { return row.doc.__checked ? row.doc : null; })\n\t\t\t.filter(function(d) { return d; });\n\t},\n\tmake_head: function() {\n\t\t// labels\n\t\tif(!this.header_row) {\n\t\t\tthis.header_row = new frappe.ui.form.GridRow({\n\t\t\t\tparent: $(this.parent).find(\".grid-heading-row\"),\n\t\t\t\tparent_df: this.df,\n\t\t\t\tdocfields: this.docfields,\n\t\t\t\tfrm: this.frm,\n\t\t\t\tgrid: this\n\t\t\t});\n\t\t}\n\t},\n\trefresh: function(force) {\n\t\t!this.wrapper && this.make();\n\t\tvar me = this,\n\t\t\t$rows = $(me.parent).find(\".rows\"),\n\t\t\tdata = this.get_data();\n\n\t\tthis.setup_fields();\n\n\t\tif(this.frm) {\n\t\t\tthis.display_status = frappe.perm.get_field_display_status(this.df, this.frm.doc,\n\t\t\t\tthis.perm);\n\t\t} else {\n\t\t\t// not in form\n\t\t\tthis.display_status = 'Write';\n\t\t}\n\n\t\tif(this.display_status===\"None\") return;\n\n\t\t// redraw\n\t\tvar _scroll_y = $(document).scrollTop();\n\t\tthis.make_head();\n\n\t\tif(!this.grid_rows) {\n\t\t\tthis.grid_rows = [];\n\t\t}\n\n\t\tthis.truncate_rows(data);\n\t\tthis.grid_rows_by_docname = {};\n\n\t\tfor(var ri=0; ri < data.length; ri++) {\n\t\t\tvar d = data[ri];\n\n\t\t\tif(d.idx===undefined) {\n\t\t\t\td.idx = ri + 1;\n\t\t\t}\n\n\t\t\tif(this.grid_rows[ri]) {\n\t\t\t\tvar grid_row = this.grid_rows[ri];\n\t\t\t\tgrid_row.doc = d;\n\t\t\t\tgrid_row.refresh();\n\t\t\t} else {\n\t\t\t\tvar grid_row = new frappe.ui.form.GridRow({\n\t\t\t\t\tparent: $rows,\n\t\t\t\t\tparent_df: this.df,\n\t\t\t\t\tdocfields: this.docfields,\n\t\t\t\t\tdoc: d,\n\t\t\t\t\tfrm: this.frm,\n\t\t\t\t\tgrid: this\n\t\t\t\t});\n\t\t\t\tthis.grid_rows.push(grid_row);\n\t\t\t}\n\n\t\t\tthis.grid_rows_by_docname[d.name] = grid_row;\n\t\t}\n\n\t\tthis.wrapper.find(\".grid-empty\").toggleClass(\"hide\", !!data.length);\n\n\t\t// toolbar\n\t\tthis.setup_toolbar();\n\n\t\t// sortable\n\t\tif(this.frm && this.is_sortable() && !this.sortable_setup_done) {\n\t\t\tthis.make_sortable($rows);\n\t\t\tthis.sortable_setup_done = true;\n\t\t}\n\n\t\tthis.last_display_status = this.display_status;\n\t\tthis.last_docname = this.frm && this.frm.docname;\n\t\tfrappe.utils.scroll_to(_scroll_y);\n\n\t\t// red if mandatory\n\t\tthis.form_grid.toggleClass('error', !!(this.df.reqd && !(data && data.length)));\n\n\t\tthis.refresh_remove_rows_button();\n\n\t\tthis.wrapper.trigger('change');\n\t},\n\tsetup_toolbar: function() {\n\t\tif(this.is_editable()) {\n\t\t\tthis.wrapper.find(\".grid-footer\").toggle(true);\n\n\t\t\t// show, hide buttons to add rows\n\t\t\tif(this.cannot_add_rows || (this.df && this.df.cannot_add_rows)) {\n\t\t\t\t// add 'hide' to buttons\n\t\t\t\tthis.wrapper.find(\".grid-add-row, .grid-add-multiple-rows\")\n\t\t\t\t\t.addClass('hide');\n\t\t\t} else {\n\t\t\t\t// show buttons\n\t\t\t\tthis.wrapper.find(\".grid-add-row\").removeClass('hide');\n\n\t\t\t\tif(this.multiple_set) {\n\t\t\t\t\tthis.wrapper.find(\".grid-add-multiple-rows\").removeClass('hide')\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else {\n\t\t\tthis.wrapper.find(\".grid-footer\").toggle(false);\n\t\t}\n\n\t},\n\ttruncate_rows: function(data) {\n\t\tif(this.grid_rows.length > data.length) {\n\t\t\t// remove extra rows\n\t\t\tfor(var i=data.length; i < this.grid_rows.length; i++) {\n\t\t\t\tvar grid_row = this.grid_rows[i];\n\t\t\t\tgrid_row.wrapper.remove();\n\t\t\t}\n\t\t\tthis.grid_rows.splice(data.length);\n\t\t}\n\t},\n\tsetup_fields: function() {\n\t\tvar me = this;\n\t\t// reset docfield\n\t\tif (this.frm && this.frm.docname) {\n\t\t\t// use doc specific docfield object\n\t\t\tthis.df = frappe.meta.get_docfield(this.frm.doctype, this.df.fieldname,\n\t\t\t\tthis.frm.docname);\n\t\t} else {\n\t\t\t// use non-doc specific docfield\n\t\t\tif(this.df.options) {\n\t\t\t\tthis.df = frappe.meta.get_docfield(this.df.options, this.df.fieldname);\n\t\t\t}\n\t\t}\n\n\t\tif(this.doctype) {\n\t\t\tthis.docfields = frappe.meta.get_docfields(this.doctype, this.frm.docname);\n\t\t} else {\n\t\t\t// fields given in docfield\n\t\t\tthis.docfields = this.df.fields;\n\t\t}\n\n\t\tthis.docfields.forEach(function(df) {\n\t\t\tme.fields_map[df.fieldname] = df;\n\t\t});\n\t},\n\trefresh_row: function(docname) {\n\t\tthis.grid_rows_by_docname[docname] &&\n\t\t\tthis.grid_rows_by_docname[docname].refresh();\n\t},\n\tmake_sortable: function($rows) {\n\t\tvar me =this;\n\t\tif ('ontouchstart' in window) {\n\t\t\treturn;\n\t\t}\n\n\t\tnew Sortable($rows.get(0), {\n\t\t\tgroup: {name: me.df.fieldname},\n\t\t\thandle: '.sortable-handle',\n\t\t\tdraggable: '.grid-row',\n\t\t\tfilter: 'li, a',\n\t\t\tonUpdate: function(event, ui) {\n\t\t\t\tme.frm.doc[me.df.fieldname] = [];\n\t\t\t\t$rows.find(\".grid-row\").each(function(i, item) {\n\t\t\t\t\tvar doc = locals[me.doctype][$(item).attr('data-name')];\n\t\t\t\t\tdoc.idx = i + 1;\n\t\t\t\t\tme.frm.doc[me.df.fieldname].push(doc);\n\t\t\t\t});\n\n\t\t\t\t// re-order grid-rows by name\n\t\t\t\tme.grid_rows = [];\n\t\t\t\tme.frm.doc[me.df.fieldname].forEach(function(d) {\n\t\t\t\t\tme.grid_rows.push(me.grid_rows_by_docname[d.name]);\n\t\t\t\t});\n\t\t\t\tme.frm.script_manager.trigger(me.df.fieldname + \"_move\", me.df.options, me.frm.doc[me.df.fieldname][event.newIndex].name);\n\t\t\t\tme.refresh();\n\n\t\t\t\tme.frm.dirty();\n\t\t\t}\n\t\t});\n\n\t\t$(this.frm.wrapper).trigger(\"grid-make-sortable\", [this.frm]);\n\t},\n\tget_data: function() {\n\t\tvar data = this.frm ?\n\t\t\tthis.frm.doc[this.df.fieldname] || []\n\t\t\t: this.get_modal_data();\n\t\tdata.sort(function(a, b) { return a.idx - b.idx});\n\t\treturn data;\n\t},\n\tget_modal_data: function() {\n\t\treturn this.df.get_data().filter(data => {\n\t\t\tif (!this.deleted_docs || !in_list(this.deleted_docs, data.name)) {\n\t\t\t\treturn data;\n\t\t\t}\n\t\t});\n\t},\n\tset_column_disp: function(fieldname, show) {\n\t\tif($.isArray(fieldname)) {\n\t\t\tvar me = this;\n\t\t\tfor(var i=0, l=fieldname.length; i<l; i++) {\n\t\t\t\tvar fname = fieldname[i];\n\t\t\t\tme.get_docfield(fname).hidden = show ? 0 : 1;\n\t\t\t\tthis.set_editable_grid_column_disp(fname, show);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.get_docfield(fieldname).hidden = show ? 0 : 1;\n\t\t\tthis.set_editable_grid_column_disp(fieldname, show);\n\t\t}\n\n\t\tthis.refresh(true);\n\t},\n\tset_editable_grid_column_disp: function(fieldname, show) {\n\t\t//Hide columns for editable grids\n\t\tif (this.meta.editable_grid && this.grid_rows) {\n\t\t\tthis.grid_rows.forEach(function(row) {\n\t\t\t\trow.columns_list.forEach(function(column) {\n\t\t\t\t\t//Hide the column specified\n\t\t\t\t\tif (column.df.fieldname == fieldname) {\n\t\t\t\t\t\tif (show) {\n\t\t\t\t\t\t\tcolumn.df.hidden = false;\n\n\t\t\t\t\t\t\t//Show the static area and hide field area if it is not the editable row\n\t\t\t\t\t\t\tif  (row != frappe.ui.form.editable_row) {\n\t\t\t\t\t\t\t\tcolumn.static_area.show();\n\t\t\t\t\t\t\t\tcolumn.field_area && column.field_area.toggle(false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t//Hide the static area and show field area if it is the editable row\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tcolumn.static_area.hide();\n\t\t\t\t\t\t\t\tcolumn.field_area && column.field_area.toggle(true);\n\n\t\t\t\t\t\t\t\t//Format the editable column appropriately if it is now visible\n\t\t\t\t\t\t\t\tif (column.field) {\n\t\t\t\t\t\t\t\t\tcolumn.field.refresh();\n\t\t\t\t\t\t\t\t\tif (column.field.$input) column.field.$input.toggleClass('input-sm', true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcolumn.df.hidden = true;\n\t\t\t\t\t\t\tcolumn.static_area.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tthis.refresh();\n\t},\n\ttoggle_reqd: function(fieldname, reqd) {\n\t\tthis.get_docfield(fieldname).reqd = reqd;\n\t\tthis.refresh();\n\t},\n\ttoggle_enable: function(fieldname, enable) {\n\t\tthis.get_docfield(fieldname).read_only = enable ? 0 : 1;\n\t\tthis.refresh();\n\t},\n\ttoggle_display: function(fieldname, show) {\n\t\tthis.get_docfield(fieldname).hidden = show ? 0 : 1;\n\t\tthis.refresh();\n\t},\n\tget_docfield: function(fieldname) {\n\t\treturn frappe.meta.get_docfield(this.doctype, fieldname, this.frm ? this.frm.docname : null);\n\t},\n\tget_row: function(key) {\n\t\tif(typeof key == 'number') {\n\t\t\tif(key < 0) {\n\t\t\t\treturn this.grid_rows[this.grid_rows.length + key];\n\t\t\t} else {\n\t\t\t\treturn this.grid_rows[key];\n\t\t\t}\n\t\t} else {\n\t\t\treturn this.grid_rows_by_docname[key];\n\t\t}\n\t},\n\tget_grid_row: function(key) {\n\t\treturn this.get_row(key);\n\t},\n\tget_field: function(fieldname) {\n\t\t// Note: workaround for get_query\n\t\tif(!this.fieldinfo[fieldname])\n\t\t\tthis.fieldinfo[fieldname] = {\n\t\t\t}\n\t\treturn this.fieldinfo[fieldname];\n\t},\n\tset_value: function(fieldname, value, doc) {\n\t\tif(this.display_status!==\"None\" && this.grid_rows_by_docname[doc.name]) {\n\t\t\tthis.grid_rows_by_docname[doc.name].refresh_field(fieldname, value);\n\t\t}\n\t},\n\tadd_new_row: function(idx, callback, show) {\n\t\tif(this.is_editable()) {\n\t\t\tif(this.frm) {\n\t\t\t\tvar d = frappe.model.add_child(this.frm.doc, this.df.options, this.df.fieldname, idx);\n\t\t\t\td.__unedited = true;\n\t\t\t\tthis.frm.script_manager.trigger(this.df.fieldname + \"_add\", d.doctype, d.name);\n\t\t\t\tthis.refresh();\n\t\t\t} else {\n\t\t\t\tthis.df.data.push({name: \"batch \" + (this.df.data.length+1), idx: this.df.data.length+1});\n\t\t\t\tthis.refresh();\n\t\t\t}\n\n\t\t\tif(show) {\n\t\t\t\tif(idx) {\n\t\t\t\t\t// always open inserted rows\n\t\t\t\t\tthis.wrapper.find(\"[data-idx='\"+idx+\"']\").data(\"grid_row\")\n\t\t\t\t\t\t.toggle_view(true, callback);\n\t\t\t\t} else {\n\t\t\t\t\tif(!this.allow_on_grid_editing()) {\n\t\t\t\t\t\t// open last row only if on-grid-editing is disabled\n\t\t\t\t\t\tthis.wrapper.find(\".grid-row:last\").data(\"grid_row\")\n\t\t\t\t\t\t\t.toggle_view(true, callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn d;\n\t\t}\n\t},\n\n\tset_focus_on_row: function(idx) {\n\t\tvar me = this;\n\t\tif(!idx) {\n\t\t\tidx = me.grid_rows.length - 1;\n\t\t}\n\t\tsetTimeout(function() {\n\t\t\tme.grid_rows[idx].row\n\t\t\t\t.find('input[type=\"Text\"],textarea,select').filter(':visible:first').focus();\n\t\t}, 100);\n\t},\n\n\tsetup_visible_columns: function() {\n\t\tif (this.visible_columns) return;\n\n\t\tvar total_colsize = 1,\n\t\t\tfields = this.editable_fields || this.docfields;\n\n\t\tthis.visible_columns = [];\n\n\t\tfor(var ci in fields) {\n\t\t\tvar _df = fields[ci];\n\n\t\t\t// get docfield if from fieldname\n\t\t\tdf = this.fields_map[_df.fieldname];\n\n\t\t\tif(!df.hidden\n\t\t\t\t&& (this.editable_fields || df.in_list_view)\n\t\t\t\t&& (this.frm && this.frm.get_perm(df.permlevel, \"read\") || !this.frm)\n\t\t\t\t&& !in_list(frappe.model.layout_fields, df.fieldtype)) {\n\n\t\t\t\tif(df.columns) {\n\t\t\t\t\tdf.colsize=df.columns;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar colsize = 2;\n\t\t\t\t\tswitch(df.fieldtype) {\n\t\t\t\t\t\tcase \"Text\":\n\t\t\t\t\t\tcase \"Small Text\": colsize = 3; break;\n\t\t\t\t\t\tcase\"Check\": colsize = 1;\n\t\t\t\t\t}\n\t\t\t\t\tdf.colsize = colsize;\n\t\t\t\t}\n\n\t\t\t\t// attach formatter on refresh\n\t\t\t\tif (df.fieldtype == 'Link' && !df.formatter && frappe.meta.docfield_map[df.parent]) {\n\t\t\t\t\tconst docfield = frappe.meta.docfield_map[df.parent][df.fieldname];\n\t\t\t\t\tif (docfield && docfield.formatter) {\n\t\t\t\t\t\tdf.formatter = docfield.formatter;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttotal_colsize += df.colsize;\n\t\t\t\tif(total_colsize > 11)\n\t\t\t\t\treturn false;\n\t\t\t\tthis.visible_columns.push([df, df.colsize]);\n\t\t\t}\n\t\t}\n\n\t\t// redistribute if total-col size is less than 12\n\t\tvar passes = 0;\n\t\twhile(total_colsize < 11 && passes < 12) {\n\t\t\tfor(var i in this.visible_columns) {\n\t\t\t\tvar df = this.visible_columns[i][0];\n\t\t\t\tvar colsize = this.visible_columns[i][1];\n\t\t\t\tif(colsize > 1 && colsize < 11\n\t\t\t\t\t&& !in_list(frappe.model.std_fields_list, df.fieldname)) {\n\n\t\t\t\t\tif (passes < 3 && [\"Int\", \"Currency\", \"Float\", \"Check\", \"Percent\"].indexOf(df.fieldtype)!==-1) {\n\t\t\t\t\t\t// don't increase col size of these fields in first 3 passes\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.visible_columns[i][1] += 1;\n\t\t\t\t\ttotal_colsize++;\n\t\t\t\t}\n\n\t\t\t\tif(total_colsize > 10)\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tpasses++;\n\t\t}\n\t},\n\n\n\tis_editable: function() {\n\t\treturn this.display_status==\"Write\" && !this.static_rows;\n\t},\n\tis_sortable: function() {\n\t\treturn this.sortable_status || this.is_editable();\n\t},\n\tonly_sortable: function(status) {\n\t\tif(status===undefined ? true : status) {\n\t\t\tthis.sortable_status = true;\n\t\t\tthis.static_rows = true;\n\t\t}\n\t},\n\tset_multiple_add: function(link, qty) {\n\t\tif(this.multiple_set) return;\n\t\tvar me = this;\n\t\tvar link_field = frappe.meta.get_docfield(this.df.options, link);\n\t\tvar btn = $(this.wrapper).find(\".grid-add-multiple-rows\");\n\n\t\t// show button\n\t\tbtn.removeClass('hide');\n\n\t\t// open link selector on click\n\t\tbtn.on(\"click\", function() {\n\t\t\tnew frappe.ui.form.LinkSelector({\n\t\t\t\tdoctype: link_field.options,\n\t\t\t\tfieldname: link,\n\t\t\t\tqty_fieldname: qty,\n\t\t\t\ttarget: me,\n\t\t\t\ttxt: \"\"\n\t\t\t});\n\t\t\treturn false;\n\t\t});\n\t\tthis.multiple_set = true;\n\t},\n\tsetup_allow_bulk_edit: function() {\n\t\tvar me = this;\n\t\tif(this.frm && this.frm.get_docfield(this.df.fieldname).allow_bulk_edit) {\n\t\t\t// download\n\t\t\tme.setup_download();\n\n\t\t\t// upload\n\t\t\tfrappe.flags.no_socketio = true;\n\t\t\t$(this.wrapper).find(\".grid-upload\").removeClass(\"hide\").on(\"click\", function() {\n\t\t\t\tfrappe.prompt({fieldtype:\"Attach\", label:\"Upload File\"},\n\t\t\t\t\tfunction(data) {\n\t\t\t\t\t\tvar data = frappe.utils.csv_to_array(frappe.upload.get_string(data.upload_file));\n\t\t\t\t\t\t// row #2 contains fieldnames;\n\t\t\t\t\t\tvar fieldnames = data[2];\n\n\t\t\t\t\t\tme.frm.clear_table(me.df.fieldname);\n\t\t\t\t\t\t$.each(data, function(i, row) {\n\t\t\t\t\t\t\tif(i > 6) {\n\t\t\t\t\t\t\t\tvar blank_row = true;\n\t\t\t\t\t\t\t\t$.each(row, function(ci, value) {\n\t\t\t\t\t\t\t\t\tif(value) {\n\t\t\t\t\t\t\t\t\t\tblank_row = false;\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tif(!blank_row) {\n\t\t\t\t\t\t\t\t\tvar d = me.frm.add_child(me.df.fieldname);\n\t\t\t\t\t\t\t\t\t$.each(row, function(ci, value) {\n\t\t\t\t\t\t\t\t\t\tvar fieldname = fieldnames[ci];\n\t\t\t\t\t\t\t\t\t\tvar df = frappe.meta.get_docfield(me.df.options, fieldname);\n\n\t\t\t\t\t\t\t\t\t\t// convert date formatting\n\t\t\t\t\t\t\t\t\t\tif(df.fieldtype===\"Date\" && value) {\n\t\t\t\t\t\t\t\t\t\t\tvalue = frappe.datetime.user_to_str(value);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif(df.fieldtype===\"Int\" || df.fieldtype===\"Check\") {\n\t\t\t\t\t\t\t\t\t\t\tvalue = cint(value);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\td[fieldnames[ci]] = value;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tme.frm.refresh_field(me.df.fieldname);\n\t\t\t\t\t\tfrappe.msgprint({message:__('Table updated'), title:__('Success'), indicator:'green'})\n\n\t\t\t\t\t}, __(\"Edit via Upload\"), __(\"Update\"));\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\t},\n\tsetup_download: function() {\n\t\tvar me = this;\n\t\tlet title = me.df.label || frappe.model.unscrub(me.df.fieldname);\n\t\t$(this.wrapper).find(\".grid-download\").removeClass(\"hide\").on(\"click\", function() {\n\t\t\tvar data = [];\n\t\t\tvar docfields = [];\n\t\t\tdata.push([__(\"Bulk Edit {0}\", [title])]);\n\t\t\tdata.push([]);\n\t\t\tdata.push([]);\n\t\t\tdata.push([]);\n\t\t\tdata.push([__(\"The CSV format is case sensitive\")]);\n\t\t\tdata.push([__(\"Do not edit headers which are preset in the template\")]);\n\t\t\tdata.push([\"------\"]);\n\t\t\t$.each(frappe.get_meta(me.df.options).fields, function(i, df) {\n\t\t\t\t// don't include the hidden field in the template\n\t\t\t\tif(frappe.model.is_value_type(df.fieldtype) && !df.hidden) {\n\t\t\t\t\tdata[1].push(df.label);\n\t\t\t\t\tdata[2].push(df.fieldname);\n\t\t\t\t\tlet description = (df.description || \"\") + ' ';\n\t\t\t\t\tif (df.fieldtype === \"Date\") {\n\t\t\t\t\t\tdescription += frappe.boot.sysdefaults.date_format;\n\t\t\t\t\t}\n\t\t\t\t\tdata[3].push(description);\n\t\t\t\t\tdocfields.push(df);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// add data\n\t\t\t$.each(me.frm.doc[me.df.fieldname] || [], function(i, d) {\n\t\t\t\tvar row = [];\n\t\t\t\t$.each(data[2], function(i, fieldname) {\n\t\t\t\t\tvar value = d[fieldname];\n\n\t\t\t\t\t// format date\n\t\t\t\t\tif(docfields[i].fieldtype===\"Date\" && value) {\n\t\t\t\t\t\tvalue = frappe.datetime.str_to_user(value);\n\t\t\t\t\t}\n\n\t\t\t\t\trow.push(value || \"\");\n\t\t\t\t});\n\t\t\t\tdata.push(row);\n\t\t\t});\n\n\t\t\tfrappe.tools.downloadify(data, null, title);\n\t\t\treturn false;\n\t\t});\n\t},\n\tadd_custom_button: function(label, click) {\n\t\t// add / unhide a custom button\n\t\tvar btn = this.custom_buttons[label];\n\t\tif(!btn) {\n\t\t\tbtn = $('<button class=\"btn btn-default btn-xs btn-custom\">' + label + '</button>')\n\t\t\t\t.css('margin-right', '4px')\n\t\t\t\t.prependTo(this.grid_buttons)\n\t\t\t\t.on('click', click);\n\t\t\tthis.custom_buttons[label] = btn;\n\t\t} else {\n\t\t\tbtn.removeClass('hidden');\n\t\t}\n\t},\n\tclear_custom_buttons: function() {\n\t\t// hide all custom buttons\n\t\tthis.grid_buttons.find('.btn-custom').addClass('hidden');\n\t}\n});\n","frappe.ui.form.GridRow = Class.extend({\n\tinit: function(opts) {\n\t\tthis.on_grid_fields_dict = {};\n\t\tthis.on_grid_fields = [];\n\t\tthis.columns = {};\n\t\tthis.columns_list = [];\n\t\t$.extend(this, opts);\n\t\tthis.row_check_html = '<input type=\"checkbox\" class=\"grid-row-check pull-left\">';\n\t\tthis.make();\n\t},\n\tmake: function() {\n\t\tvar me = this;\n\n\t\tthis.wrapper = $('<div class=\"grid-row\"></div>').appendTo(this.parent).data(\"grid_row\", this);\n\t\tthis.row = $('<div class=\"data-row row\"></div>').appendTo(this.wrapper)\n\t\t\t.on(\"click\", function(e) {\n\t\t\t\tif($(e.target).hasClass('grid-row-check') || $(e.target).hasClass('row-index') || $(e.target).parent().hasClass('row-index')) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif(me.grid.allow_on_grid_editing() && me.grid.is_editable()) {\n\t\t\t\t\t// pass\n\t\t\t\t} else {\n\t\t\t\t\tme.toggle_view();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t// no checkboxes if too small\n\t\t// if(this.is_too_small()) {\n\t\t// \tthis.row_check_html = '';\n\t\t// }\n\n\t\tif(this.grid.template && !this.grid.meta.editable_grid) {\n\t\t\tthis.render_template();\n\t\t} else {\n\t\t\tthis.render_row();\n\t\t}\n\t\tif(this.doc) {\n\t\t\tthis.set_data();\n\t\t}\n\t},\n\tset_data: function() {\n\t\tthis.wrapper.data({\n\t\t\t\"doc\": this.doc\n\t\t})\n\t},\n\tset_row_index: function() {\n\t\tif(this.doc) {\n\t\t\tthis.wrapper\n\t\t\t\t.attr('data-name', this.doc.name)\n\t\t\t\t.attr(\"data-idx\", this.doc.idx)\n\t\t\t\t.find(\".row-index span, .grid-form-row-index\").html(this.doc.idx)\n\n\t\t}\n\t},\n\tselect: function(checked) {\n\t\tthis.doc.__checked = checked ? 1 : 0;\n\t},\n\trefresh_check: function() {\n\t\tthis.wrapper.find('.grid-row-check').prop('checked', this.doc ? !!this.doc.__checked : false);\n\t\tthis.grid.refresh_remove_rows_button();\n\t},\n\tremove: function() {\n\t\tvar me = this;\n\t\tif(this.grid.is_editable()) {\n\t\t\tif(this.frm) {\n\t\t\t\tif(this.get_open_form()) {\n\t\t\t\t\tthis.hide_form();\n\t\t\t\t}\n\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => {\n\t\t\t\t\t\treturn this.frm.script_manager.trigger(\"before_\" + this.grid.df.fieldname + \"_remove\",\n\t\t\t\t\t\t\tthis.doc.doctype, this.doc.name);\n\t\t\t\t\t},\n\t\t\t\t\t() => {\n\t\t\t\t\t\tfrappe.model.clear_doc(this.doc.doctype, this.doc.name);\n\n\t\t\t\t\t\tthis.frm.script_manager.trigger(this.grid.df.fieldname + \"_remove\",\n\t\t\t\t\t\t\tthis.doc.doctype, this.doc.name);\n\t\t\t\t\t\tthis.frm.dirty();\n\t\t\t\t\t\tthis.grid.refresh();\n\t\t\t\t\t},\n\t\t\t\t]).catch((e) => {\n\t\t\t\t\t// aborted\n\t\t\t\t\tconsole.trace(e); // eslint-disable-line\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tlet data = null;\n\t\t\t\tif (this.grid.df.get_data) {\n\t\t\t\t\tdata = this.grid.df.get_data();\n\t\t\t\t} else {\n\t\t\t\t\tdata = this.grid.df.data;\n\t\t\t\t}\n\n\t\t\t\tconst index = data.findIndex(d => d.name === me.doc.name);\n\n\t\t\t\tif (index > -1) {\n\t\t\t\t\t// mutate array directly,\n\t\t\t\t\t// else the object reference will be lost\n\t\t\t\t\tdata.splice(index, 1);\n\t\t\t\t}\n\t\t\t\t// remap idxs\n\t\t\t\tdata.forEach(function(d, i) {\n\t\t\t\t\td.idx = i+1;\n\t\t\t\t});\n\n\t\t\t\tthis.grid.refresh();\n\t\t\t}\n\t\t}\n\t},\n\tinsert: function(show, below) {\n\t\tvar idx = this.doc.idx;\n\t\tif(below) idx ++;\n\t\tthis.toggle_view(false);\n\t\tthis.grid.add_new_row(idx, null, show);\n\t},\n\trefresh: function() {\n\t\tif(this.frm && this.doc) {\n\t\t\tthis.doc = locals[this.doc.doctype][this.doc.name];\n\t\t}\n\t\t// re write columns\n\t\tthis.visible_columns = null;\n\n\t\tif(this.grid.template && !this.grid.meta.editable_grid) {\n\t\t\tthis.render_template();\n\t\t} else {\n\t\t\tthis.render_row(true);\n\t\t}\n\n\t\t// refersh form fields\n\t\tif(this.grid_form) {\n\t\t\tthis.grid_form.layout && this.grid_form.layout.refresh(this.doc);\n\t\t}\n\t},\n\trender_template: function() {\n\t\tthis.set_row_index();\n\n\t\tif(this.row_display) {\n\t\t\tthis.row_display.remove();\n\t\t}\n\t\tvar index_html = '';\n\n\t\t// row index\n\t\tif(this.doc) {\n\t\t\tif(!this.row_index) {\n\t\t\t\tthis.row_index = $('<div style=\"float: left; margin-left: 15px; margin-top: 8px; \\\n\t\t\t\t\tmargin-right: -20px;\">'+this.row_check_html+' <span></span></div>').appendTo(this.row);\n\t\t\t}\n\t\t\tthis.row_index.find('span').html(this.doc.idx);\n\t\t}\n\n\t\tthis.row_display = $('<div class=\"row-data sortable-handle template-row\">'+\n\t\t\t+'</div>').appendTo(this.row)\n\t\t\t.html(frappe.render(this.grid.template, {\n\t\t\t\tdoc: this.doc ? frappe.get_format_helper(this.doc) : null,\n\t\t\t\tfrm: this.frm,\n\t\t\t\trow: this\n\t\t\t}));\n\t},\n\trender_row: function(refresh) {\n\t\tvar me = this;\n\t\tthis.set_row_index();\n\n\t\t// index (1, 2, 3 etc)\n\t\tif(!this.row_index) {\n\t\t\tvar txt = (this.doc ? this.doc.idx : \"&nbsp;\");\n\t\t\tthis.row_index = $(\n\t\t\t\t`<div class=\"row-index sortable-handle col col-xs-1\">\n\t\t\t\t\t${this.row_check_html}\n\t\t\t\t<span>${txt}</span></div>`)\n\t\t\t\t.appendTo(this.row)\n\t\t\t\t.on('click', function(e) {\n\t\t\t\t\tif(!$(e.target).hasClass('grid-row-check')) {\n\t\t\t\t\t\tme.toggle_view();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.row_index.find('span').html(txt);\n\t\t}\n\n\t\tthis.setup_columns();\n\t\tthis.add_open_form_button();\n\t\tthis.refresh_check();\n\n\t\tif(this.frm && this.doc) {\n\t\t\t$(this.frm.wrapper).trigger(\"grid-row-render\", [this]);\n\t\t}\n\t},\n\n\tmake_editable: function() {\n\t\tthis.row.toggleClass('editable-row', this.grid.is_editable());\n\t},\n\n\tis_too_small: function() {\n\t\treturn this.row.width() ? this.row.width() < 300 : false;\n\t},\n\n\tadd_open_form_button: function() {\n\t\tvar me = this;\n\t\tif(this.doc && !this.grid.df.in_place_edit) {\n\t\t\t// remove row\n\t\t\tif(!this.open_form_button) {\n\t\t\t\tthis.open_form_button = $('<a class=\"close btn-open-row\">\\\n\t\t\t\t\t<span class=\"octicon octicon-triangle-down\"></span></a>')\n\t\t\t\t\t.appendTo($('<div class=\"col col-xs-1 sortable-handle\"></div>').appendTo(this.row))\n\t\t\t\t\t.on('click', function() { me.toggle_view(); return false; });\n\n\t\t\t\tif(this.is_too_small()) {\n\t\t\t\t\t// narrow\n\t\t\t\t\tthis.open_form_button.css({'margin-right': '-2px'});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tsetup_columns: function() {\n\t\tvar me = this;\n\t\tthis.focus_set = false;\n\t\tthis.grid.setup_visible_columns();\n\n\t\tfor(var ci in this.grid.visible_columns) {\n\t\t\tvar df = this.grid.visible_columns[ci][0],\n\t\t\t\tcolsize = this.grid.visible_columns[ci][1],\n\t\t\t\ttxt = this.doc ?\n\t\t\t\t\tfrappe.format(this.doc[df.fieldname], df, null, this.doc) :\n\t\t\t\t\t__(df.label);\n\n\t\t\tif(this.doc && df.fieldtype === \"Select\") {\n\t\t\t\ttxt = __(txt);\n\t\t\t}\n\n\t\t\tif(!this.columns[df.fieldname]) {\n\t\t\t\tvar column = this.make_column(df, colsize, txt, ci);\n\t\t\t} else {\n\t\t\t\tvar column = this.columns[df.fieldname];\n\t\t\t\tthis.refresh_field(df.fieldname, txt);\n\t\t\t}\n\n\t\t\t// background color for cellz\n\t\t\tif(this.doc) {\n\t\t\t\tif(df.reqd && !txt) {\n\t\t\t\t\tcolumn.addClass('error');\n\t\t\t\t}\n\t\t\t\tif (df.reqd || df.bold) {\n\t\t\t\t\tcolumn.addClass('bold');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tmake_column: function(df, colsize, txt, ci) {\n\t\tvar\tme = this;\n\t\tvar add_class = (([\"Text\", \"Small Text\"].indexOf(df.fieldtype)!==-1) ?\n\t\t\t\" grid-overflow-no-ellipsis\" : \"\");\n\t\tadd_class += ([\"Int\", \"Currency\", \"Float\", \"Percent\"].indexOf(df.fieldtype)!==-1) ?\n\t\t\t\" text-right\": \"\";\n\t\tadd_class += ([\"Check\"].indexOf(df.fieldtype)!==-1) ?\n\t\t\t\" text-center\": \"\";\n\n\t\tvar $col = $('<div class=\"col grid-static-col col-xs-'+colsize+' '+add_class+'\"></div>')\n\t\t\t.attr(\"data-fieldname\", df.fieldname)\n\t\t\t.attr(\"data-fieldtype\", df.fieldtype)\n\t\t\t.data(\"df\", df)\n\t\t\t.appendTo(this.row)\n\t\t\t.on('click', function() {\n\t\t\t\tif(frappe.ui.form.editable_row===me) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar out = me.toggle_editable_row();\n\t\t\t\tvar col = this;\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t$(col).find('input[type=\"Text\"]:first').focus();\n\t\t\t\t}, 500);\n\t\t\t\treturn out;\n\t\t\t});\n\n\t\t$col.field_area = $('<div class=\"field-area\"></div>').appendTo($col).toggle(false);\n\t\t$col.static_area = $('<div class=\"static-area ellipsis\"></div>').appendTo($col).html(txt);\n\t\t$col.df = df;\n\t\t$col.column_index = ci;\n\n\t\tthis.columns[df.fieldname] = $col;\n\t\tthis.columns_list.push($col);\n\n\t\treturn $col;\n\t},\n\n\tactivate: function() {\n\t\tthis.toggle_editable_row(true);\n\t\treturn this;\n\t},\n\n\ttoggle_editable_row: function(show) {\n\t\tvar me = this;\n\t\t// show static for field based on\n\t\t// whether grid is editable\n\t\tif(this.grid.allow_on_grid_editing() && this.grid.is_editable() && this.doc && show !== false) {\n\n\t\t\t// disable other editable row\n\t\t\tif(frappe.ui.form.editable_row\n\t\t\t\t&& frappe.ui.form.editable_row !== this) {\n\t\t\t\tfrappe.ui.form.editable_row.toggle_editable_row(false);\n\t\t\t}\n\n\t\t\tthis.row.toggleClass('editable-row', true);\n\n\t\t\t// setup controls\n\t\t\tthis.columns_list.forEach(function(column) {\n\t\t\t\tme.make_control(column);\n\t\t\t\tcolumn.static_area.toggle(false);\n\t\t\t\tcolumn.field_area.toggle(true);\n\t\t\t});\n\n\t\t\tfrappe.ui.form.editable_row = this;\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthis.row.toggleClass('editable-row', false);\n\t\t\tthis.columns_list.forEach(function(column) {\n\t\t\t\tif (!column.df.hidden) {\n\t\t\t\t\tcolumn.static_area.toggle(true);\n\t\t\t\t}\n\n\t\t\t\tcolumn.field_area && column.field_area.toggle(false);\n\t\t\t});\n\t\t\tfrappe.ui.form.editable_row = null;\n\t\t}\n\t},\n\n\tmake_control: function(column) {\n\t\tif(column.field) return;\n\n\t\tvar me = this,\n\t\t\tparent = column.field_area,\n\t\t\tdf = column.df;\n\n\t\t// no text editor in grid\n\t\tif (df.fieldtype=='Text Editor') {\n\t\t\tdf.fieldtype = 'Text';\n\t\t}\n\n\t\tvar field = frappe.ui.form.make_control({\n\t\t\tdf: df,\n\t\t\tparent: parent,\n\t\t\tonly_input: true,\n\t\t\twith_link_btn: true,\n\t\t\tdoc: this.doc,\n\t\t\tdoctype: this.doc.doctype,\n\t\t\tdocname: this.doc.name,\n\t\t\tfrm: this.grid.frm,\n\t\t\tgrid: this.grid,\n\t\t\tgrid_row: this,\n\t\t\tvalue: this.doc[df.fieldname]\n\t\t});\n\n\t\t// sync get_query\n\t\tfield.get_query = this.grid.get_field(df.fieldname).get_query;\n\t\tfield.refresh();\n\t\tif(field.$input) {\n\t\t\tfield.$input\n\t\t\t\t.addClass('input-sm')\n\t\t\t\t.attr('data-col-idx', column.column_index)\n\t\t\t\t.attr('placeholder', __(df.label));\n\t\t\t// flag list input\n\t\t\tif (this.columns_list && this.columns_list.slice(-1)[0]===column) {\n\t\t\t\tfield.$input.attr('data-last-input', 1);\n\t\t\t}\n\t\t}\n\n\t\tthis.set_arrow_keys(field);\n\t\tcolumn.field = field;\n\t\tthis.on_grid_fields_dict[df.fieldname] = field;\n\t\tthis.on_grid_fields.push(field);\n\n\t},\n\n\tset_arrow_keys: function(field) {\n\t\tvar me = this;\n\t\tif(field.$input) {\n\t\t\tfield.$input.on('keydown', function(e) {\n\t\t\t\tvar { TAB, UP_ARROW, DOWN_ARROW } = frappe.ui.keyCode;\n\t\t\t\tif(!in_list([TAB, UP_ARROW, DOWN_ARROW], e.which)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar values = me.grid.get_data();\n\t\t\t\tvar fieldname = $(this).attr('data-fieldname');\n\t\t\t\tvar fieldtype = $(this).attr('data-fieldtype');\n\n\t\t\t\tvar move_up_down = function(base) {\n\t\t\t\t\tif(in_list(['Text', 'Small Text'], fieldtype)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tbase.toggle_editable_row();\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\tvar input = base.columns[fieldname].field.$input;\n\t\t\t\t\t\tif(input) {\n\t\t\t\t\t\t\tinput.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 400)\n\n\t\t\t\t}\n\n\t\t\t\t// TAB\n\t\t\t\tif(e.which==TAB && !e.shiftKey) {\n\t\t\t\t\t// last column\n\t\t\t\t\tif($(this).attr('data-last-input') ||\n\t\t\t\t\t\tme.grid.wrapper.find('.grid-row :input:enabled:last').get(0)===this) {\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tif(me.doc.idx === values.length) {\n\t\t\t\t\t\t\t\t// last row\n\t\t\t\t\t\t\t\tme.grid.add_new_row(null, null, true);\n\t\t\t\t\t\t\t\tme.grid.grid_rows[me.grid.grid_rows.length - 1].toggle_editable_row();\n\t\t\t\t\t\t\t\tme.grid.set_focus_on_row();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.grid.grid_rows[me.doc.idx].toggle_editable_row();\n\t\t\t\t\t\t\t\tme.grid.set_focus_on_row(me.doc.idx+1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 500);\n\t\t\t\t\t}\n\t\t\t\t} else if(e.which==UP_ARROW) {\n\t\t\t\t\tif(me.doc.idx > 1) {\n\t\t\t\t\t\tvar prev = me.grid.grid_rows[me.doc.idx-2];\n\t\t\t\t\t\tmove_up_down(prev);\n\t\t\t\t\t}\n\t\t\t\t} else if(e.which==DOWN_ARROW) {\n\t\t\t\t\tif(me.doc.idx < values.length) {\n\t\t\t\t\t\tvar next = me.grid.grid_rows[me.doc.idx];\n\t\t\t\t\t\tmove_up_down(next);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t});\n\t\t}\n\t},\n\n\tget_open_form: function() {\n\t\treturn frappe.ui.form.get_open_grid_form();\n\t},\n\n\ttoggle_view: function(show, callback) {\n\t\tif(!this.doc) {\n\t\t\treturn this;\n\t\t}\n\n\t\tif(this.frm) {\n\t\t\t// reload doc\n\t\t\tthis.doc = locals[this.doc.doctype][this.doc.name];\n\t\t}\n\n\t\t// hide other\n\t\tvar open_row = this.get_open_form();\n\n\t\tif (show===undefined) show = !!!open_row;\n\n\t\t// call blur\n\t\tdocument.activeElement && document.activeElement.blur();\n\n\t\tif(show && open_row) {\n\t\t\tif(open_row==this) {\n\t\t\t\t// already open, do nothing\n\t\t\t\tcallback && callback();\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\t// close other views\n\t\t\t\topen_row.toggle_view(false);\n\t\t\t}\n\t\t}\n\n\t\tif(show) {\n\t\t\tthis.show_form();\n\t\t} else {\n\t\t\tthis.hide_form();\n\t\t}\n\t\tcallback && callback();\n\n\t\treturn this;\n\t},\n\tshow_form: function() {\n\t\tif(!this.grid_form) {\n\t\t\tthis.grid_form = new frappe.ui.form.GridRowForm({\n\t\t\t\trow: this\n\t\t\t});\n\t\t}\n\t\tthis.grid_form.render();\n\t\tthis.row.toggle(false);\n\t\t// this.form_panel.toggle(true);\n\t\tfrappe.dom.freeze(\"\", \"dark\");\n\t\tcur_frm.cur_grid = this;\n\t\tthis.wrapper.addClass(\"grid-row-open\");\n\t\tif(!frappe.dom.is_element_in_viewport(this.wrapper)) {\n\t\t\tfrappe.utils.scroll_to(this.wrapper, true, 15);\n\t\t}\n\n\t\tif(this.frm) {\n\t\t\tthis.frm.script_manager.trigger(this.doc.parentfield + \"_on_form_rendered\");\n\t\t\tthis.frm.script_manager.trigger(\"form_render\", this.doc.doctype, this.doc.name);\n\t\t}\n\t},\n\thide_form: function() {\n\t\tfrappe.dom.unfreeze();\n\t\tthis.row.toggle(true);\n\t\tthis.refresh();\n\t\tcur_frm.cur_grid = null;\n\t\tthis.wrapper.removeClass(\"grid-row-open\");\n\t},\n\topen_prev: function() {\n\t\tif(this.grid.grid_rows[this.doc.idx-2]) {\n\t\t\tthis.grid.grid_rows[this.doc.idx-2].toggle_view(true);\n\t\t}\n\t},\n\topen_next: function() {\n\t\tif(this.grid.grid_rows[this.doc.idx]) {\n\t\t\tthis.grid.grid_rows[this.doc.idx].toggle_view(true);\n\t\t} else {\n\t\t\tthis.grid.add_new_row(null, null, true);\n\t\t}\n\t},\n\trefresh_field: function(fieldname, txt) {\n\t\tvar df = this.grid.get_docfield(fieldname) || undefined;\n\n\t\t// format values if no frm\n\t\tif(!df) {\n\t\t\tdf = this.grid.visible_columns.find((col) => {\n\t\t\t\treturn col[0].fieldname === fieldname;\n\t\t\t});\n\t\t\tif(df && this.doc) {\n\t\t\t\tvar txt = frappe.format(this.doc[fieldname], df[0],\n\t\t\t\t\tnull, this.doc);\n\t\t\t}\n\t\t}\n\n\t\tif(txt===undefined && this.frm) {\n\t\t\tvar txt = frappe.format(this.doc[fieldname], df,\n\t\t\t\tnull, this.frm.doc);\n\t\t}\n\n\t\t// reset static value\n\t\tvar column = this.columns[fieldname];\n\t\tif(column) {\n\t\t\tcolumn.static_area.html(txt || \"\");\n\t\t\tif(df && df.reqd) {\n\t\t\t\tcolumn.toggleClass('error', !!(txt===null || txt===''));\n\t\t\t}\n\t\t}\n\n\t\t// reset field value\n\t\tvar field = this.on_grid_fields_dict[fieldname];\n\t\tif(field) {\n\t\t\tfield.docname = this.doc.name;\n\t\t\tfield.refresh();\n\t\t}\n\n\t\t// in form\n\t\tif(this.grid_form) {\n\t\t\tthis.grid_form.refresh_field(fieldname);\n\t\t}\n\t},\n\tget_field: function(fieldname) {\n\t\tlet field = this.on_grid_fields_dict[fieldname];\n\t\tif (field) {\n\t\t\treturn field;\n\t\t} else if(this.grid_form) {\n\t\t\treturn this.grid_form.fields_dict[fieldname];\n\t\t} else {\n\t\t\tthrow `fieldname ${fieldname} not found`;\n\t\t}\n\t},\n\n\tget_visible_columns: function(blacklist) {\n\t\tvar me = this;\n\t\tvar visible_columns = $.map(this.docfields, function(df) {\n\t\t\tvar visible = !df.hidden && df.in_list_view && me.grid.frm.get_perm(df.permlevel, \"read\")\n\t\t\t\t&& !in_list(frappe.model.layout_fields, df.fieldtype) && !in_list(blacklist, df.fieldname);\n\n\t\t\treturn visible ? df : null;\n\t\t});\n\t\treturn visible_columns;\n\t},\n\tset_field_property: function(fieldname, property, value) {\n\t\t// set a field property for open form / grid form\n\t\tvar me = this;\n\n\t\tvar set_property = function(field) {\n\t\t\tif(!field) return;\n\t\t\tfield.df[property] = value;\n\t\t\tfield.refresh();\n\t\t}\n\n\t\t// set property in grid form\n\t\tif(this.grid_form) {\n\t\t\tset_property(this.grid_form.fields_dict[fieldname]);\n\t\t\tthis.grid_form.layout && this.grid_form.layout.refresh_sections();\n\t\t}\n\n\t\t// set property in on grid fields\n\t\tset_property(this.on_grid_fields_dict[fieldname]);\n\t},\n\ttoggle_reqd: function(fieldname, reqd) {\n\t\tthis.set_field_property(fieldname, 'reqd', reqd ? 1 : 0);\n\t},\n\ttoggle_display: function(fieldname, show) {\n\t\tthis.set_field_property(fieldname, 'hidden', show ? 0 : 1);\n\t},\n\ttoggle_editable: function(fieldname, editable) {\n\t\tthis.set_field_property(fieldname, 'read_only', editable ? 0 : 1);\n\t}\n});","frappe.ui.form.GridRowForm = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.wrapper = $('<div class=\"form-in-grid\"></div>')\n\t\t\t.appendTo(this.row.wrapper);\n\n\t},\n\trender: function() {\n\t\tvar me = this;\n\t\tthis.make_form();\n\t\tthis.form_area.empty();\n\n\t\tthis.layout = new frappe.ui.form.Layout({\n\t\t\tfields: this.row.docfields,\n\t\t\tbody: this.form_area,\n\t\t\tno_submit_on_enter: true,\n\t\t\tfrm: this.row.frm,\n\t\t});\n\t\tthis.layout.make();\n\n\t\tthis.fields = this.layout.fields;\n\t\tthis.fields_dict = this.layout.fields_dict;\n\n\t\tthis.layout.refresh(this.row.doc);\n\n\t\t// copy get_query to fields\n\t\tfor(var fieldname in (this.row.grid.fieldinfo || {})) {\n\t\t\tvar fi = this.row.grid.fieldinfo[fieldname];\n\t\t\t$.extend(me.fields_dict[fieldname], fi);\n\t\t}\n\n\t\tthis.toggle_add_delete_button_display(this.wrapper);\n\n\t\tthis.row.grid.open_grid_row = this;\n\n\t\tthis.set_focus();\n\t},\n\tmake_form: function() {\n\t\tif(!this.form_area) {\n\t\t\t$(frappe.render_template(\"grid_form\", {grid:this})).appendTo(this.wrapper);\n\t\t\tthis.form_area = this.wrapper.find(\".form-area\");\n\t\t\tthis.row.set_row_index();\n\t\t\tthis.set_form_events();\n\t\t}\n\t},\n\tset_form_events: function() {\n\t\tvar me = this;\n\t\tthis.wrapper.find(\".grid-delete-row\")\n\t\t\t.on('click', function() {\n\t\t\t\tme.row.remove(); return false;\n\t\t\t});\n\t\tthis.wrapper.find(\".grid-insert-row\")\n\t\t\t.on('click', function() {\n\t\t\t\tme.row.insert(true); return false;\n\t\t\t});\n\t\tthis.wrapper.find(\".grid-insert-row-below\")\n\t\t\t.on('click', function() {\n\t\t\t\tme.row.insert(true, true); return false;\n\t\t\t});\n\t\tthis.wrapper.find(\".grid-append-row\")\n\t\t\t.on('click', function() {\n\t\t\t\tme.row.toggle_view(false);\n\t\t\t\tme.row.grid.add_new_row(me.row.doc.idx+1, null, true);\n\t\t\t\treturn false;\n\t\t\t});\n\t\tthis.wrapper.find(\".grid-form-heading, .grid-footer-toolbar\").on(\"click\", function() {\n\t\t\tme.row.toggle_view();\n\t\t\treturn false;\n\t\t});\n\t},\n\ttoggle_add_delete_button_display: function($parent) {\n\t\t$parent.find(\".grid-header-toolbar .btn, .grid-footer-toolbar .btn\")\n\t\t\t.toggle(this.row.grid.is_editable());\n\t},\n\trefresh_field: function(fieldname) {\n\t\tif(this.fields_dict[fieldname]) {\n\t\t\tthis.fields_dict[fieldname].refresh();\n\t\t\tthis.layout && this.layout.refresh_dependency();\n\t\t}\n\t},\n\tset_focus: function() {\n\t\t// wait for animation and then focus on the first row\n\t\tvar me = this;\n\t\tsetTimeout(function() {\n\t\t\tif(me.row.frm && me.row.frm.doc.docstatus===0 || !me.row.frm) {\n\t\t\t\tvar first = me.form_area.find(\"input:first\");\n\t\t\t\tif(first.length && !in_list([\"Date\", \"Datetime\", \"Time\"], first.attr(\"data-fieldtype\"))) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tfirst.get(0).focus();\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t//\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}, 500);\n\t},\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.LinkedWith = class LinkedWith {\n\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\tshow() {\n\t\tif(!this.dialog)\n\t\t\tthis.make_dialog();\n\n\t\t$(this.dialog.body).html(\n\t\t\t`<div class=\"text-muted text-center\" style=\"padding: 30px 0px\">\n\t\t\t\t${__(\"Loading\")}...\n\t\t\t</div>`);\n\n\t\tthis.dialog.show();\n\t}\n\n\tmake_dialog() {\n\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\thide_on_page_refresh: true,\n\t\t\ttitle: __(\"Linked With\")\n\t\t});\n\n\t\tthis.dialog.on_page_show = () => {\n\t\t\t// execute ajax calls sequentially\n\t\t\t// 1. get linked doctypes\n\t\t\t// 2. load all doctypes\n\t\t\t// 3. load linked docs\n\t\t\tthis.get_linked_doctypes()\n\t\t\t\t.then(() => this.load_doctypes())\n\t\t\t\t.then(() => this.links_not_permitted_or_missing())\n\t\t\t\t.then(() => this.get_linked_docs())\n\t\t\t\t.then(() => this.make_html());\n\t\t};\n\t}\n\n\tmake_html() {\n\t\tconst linked_docs = this.frm.__linked_docs;\n\n\t\tlet html = '';\n\n\t\tconst linked_doctypes = Object.keys(linked_docs);\n\n\t\tif (linked_doctypes.length === 0) {\n\t\t\thtml = __(\"Not Linked to any record\");\n\t\t} else {\n\t\t\thtml = linked_doctypes.map(doctype => {\n\t\t\t\tconst docs = linked_docs[doctype];\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"list-item-table margin-bottom\">\n\t\t\t\t\t\t${this.make_doc_head(doctype)}\n\t\t\t\t\t\t${docs.map(doc => this.make_doc_row(doc, doctype)).join('')}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}).join('');\n\t\t}\n\n\t\t$(this.dialog.body).html(html);\n\t}\n\n\tload_doctypes() {\n\t\tconst already_loaded = Object.keys(locals.DocType);\n\t\tlet doctypes_to_load = [];\n\n\t\tif (this.frm.__linked_doctypes) {\n\t\t\tdoctypes_to_load =\n\t\t\t\tObject.keys(this.frm.__linked_doctypes)\n\t\t\t\t\t.filter(doctype => !already_loaded.includes(doctype));\n\t\t}\n\n\t\t// load all doctypes asynchronously using with_doctype\n\t\tconst promises = doctypes_to_load.map(dt => {\n\t\t\treturn frappe.model.with_doctype(dt, () => {\n\t\t\t\tif(frappe.listview_settings[dt]) {\n\t\t\t\t\t// add additional fields to __linked_doctypes\n\t\t\t\t\tthis.frm.__linked_doctypes[dt].add_fields =\n\t\t\t\t\t\tfrappe.listview_settings[dt].add_fields;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn Promise.all(promises);\n\t}\n\n\tlinks_not_permitted_or_missing() {\n\t\tlet links = null;\n\n\t\tif (this.frm.__linked_doctypes) {\n\t\t\tlinks =\n\t\t\t\tObject.keys(this.frm.__linked_doctypes)\n\t\t\t\t\t.filter(frappe.model.can_get_report);\n\t\t}\n\n\t\tlet flag;\n\t\tif(!links) {\n\t\t\t$(this.dialog.body).html(`${this.frm.__linked_doctypes\n\t\t\t\t? __(\"Not enough permission to see links\")\n\t\t\t\t: __(\"Not Linked to any record\")}`);\n\t\t\tflag = true;\n\t\t}\n\t\tflag = false;\n\n\t\t// reject Promise if not_permitted or missing\n\t\treturn new Promise(\n\t\t\t(resolve, reject) => flag ? reject() : resolve()\n\t\t);\n\t}\n\n\tget_linked_doctypes() {\n\t\treturn new Promise((resolve) => {\n\t\t\tif (this.frm.__linked_doctypes) {\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.desk.form.linked_with.get_linked_doctypes\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: this.frm.doctype\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tthis.frm.__linked_doctypes = r.message;\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tget_linked_docs() {\n\t\treturn frappe.call({\n\t\t\tmethod: \"frappe.desk.form.linked_with.get_linked_docs\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.docname,\n\t\t\t\tlinkinfo: this.frm.__linked_doctypes,\n\t\t\t\tfor_doctype: this.for_doctype\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tthis.frm.__linked_docs = r.message || {};\n\t\t\t}\n\t\t});\n\t}\n\n\tmake_doc_head(heading) {\n\t\treturn `\n\t\t\t<header class=\"level list-row list-row-head text-muted small\">\n\t\t\t\t<div>${__(heading)}</div>\n\t\t\t</header>\n\t\t`;\n\t}\n\n\tmake_doc_row(doc, doctype) {\n\t\treturn `<div class=\"list-row-container\">\n\t\t\t<div class=\"level list-row small\">\n\t\t\t\t<div class=\"level-left bold\">\n\t\t\t\t\t<a href=\"#Form/${doctype}/${doc.name}\">${doc.name}</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`;\n\t}\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.States = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.state_fieldname = frappe.workflow.get_state_fieldname(this.frm.doctype);\n\n\t\t// no workflow?\n\t\tif(!this.state_fieldname)\n\t\t\treturn;\n\n\t\tthis.update_fields = frappe.workflow.get_update_fields(this.frm.doctype);\n\n\t\tvar me = this;\n\t\t$(this.frm.wrapper).bind(\"render_complete\", function() {\n\t\t\tme.refresh();\n\t\t});\n\t},\n\n\tsetup_help: function() {\n\t\tvar me = this;\n\t\tthis.frm.page.add_action_item(__(\"Help\"), function() {\n\t\t\tfrappe.workflow.setup(me.frm.doctype);\n\t\t\tvar state = me.get_state();\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: \"Workflow: \"\n\t\t\t\t\t+ frappe.workflow.workflows[me.frm.doctype].name\n\t\t\t})\n\t\t\tvar next_html = $.map(frappe.workflow.get_transitions(me.frm.doctype, state),\n\t\t\t\tfunction(d) {\n\t\t\t\t\treturn d.action.bold() + __(\" by Role \") + d.allowed;\n\t\t\t\t}).join(\", \") || __(\"None: End of Workflow\").bold();\n\n\t\t\t$(d.body).html(\"<p>\"+__(\"Current status\")+\": \" + state.bold() + \"</p>\"\n\t\t\t\t+ \"<p>\"+__(\"Document is only editable by users of role\")+\": \"\n\t\t\t\t\t+ frappe.workflow.get_document_state(me.frm.doctype,\n\t\t\t\t\t\tstate).allow_edit.bold() + \"</p>\"\n\t\t\t\t+ \"<p>\"+__(\"Next actions\")+\": \"+ next_html +\"</p>\"\n\t\t\t\t+ (me.frm.doc.__islocal ? (\"<div class='alert alert-info'>\"\n\t\t\t\t\t+__(\"Workflow will start after saving.\")+\"</div>\") : \"\")\n\t\t\t\t+ \"<p class='help'>\"+__(\"Note: Other permission rules may also apply\")+\"</p>\"\n\t\t\t\t).css({padding: '15px'});\n\t\t\td.show();\n\t\t}, true);\n\t},\n\n\trefresh: function() {\n\t\t// hide if its not yet saved\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.set_default_state();\n\t\t\treturn;\n\t\t}\n\n\t\t// state text\n\t\tvar state = this.get_state();\n\n\t\tif(state) {\n\t\t\t// show actions from that state\n\t\t\tthis.show_actions(state);\n\t\t}\n\t},\n\n\tshow_actions: function(state) {\n\t\tvar added = false,\n\t\t\tme = this;\n\n\t\tthis.frm.page.clear_actions_menu();\n\n\t\t// if the loaded doc is dirty, don't show workflow buttons\n\t\tif (this.frm.doc.__unsaved===1) {\n\t\t\treturn;\n\t\t}\n\n\t\t$.each(frappe.workflow.get_transitions(this.frm.doctype, state), function(i, d) {\n\t\t\tif(frappe.user_roles.includes(d.allowed)) {\n\t\t\t\tadded = true;\n\t\t\t\tme.frm.page.add_action_item(__(d.action), function() {\n\t\t\t\t\tvar action = d.action;\n\t\t\t\t\t// capture current state\n\t\t\t\t\tvar doc_before_action = copy_dict(me.frm.doc);\n\n\t\t\t\t\t// set new state\n\t\t\t\t\tvar next_state = frappe.workflow.get_next_state(me.frm.doctype,\n\t\t\t\t\t\t\tme.frm.doc[me.state_fieldname], action);\n\t\t\t\t\tme.frm.doc[me.state_fieldname] = next_state;\n\t\t\t\t\tvar new_state = frappe.workflow.get_document_state(me.frm.doctype, next_state);\n\t\t\t\t\tvar new_docstatus = cint(new_state.doc_status);\n\n\n\t\t\t\t\tif(new_state.update_field) {\n\t\t\t\t\t\tme.frm.set_value(new_state.update_field, new_state.update_value);\n\t\t\t\t\t}\n\n\t\t\t\t\t// revert state on error\n\t\t\t\t\tvar on_error = function() {\n\t\t\t\t\t\t// reset in locals\n\t\t\t\t\t\tfrappe.model.add_to_locals(doc_before_action);\n\t\t\t\t\t\tme.frm.refresh();\n\t\t\t\t\t}\n\n\t\t\t\t\t// success - add a comment\n\t\t\t\t\tvar success = function() {\n\t\t\t\t\t\tme.frm.timeline.insert_comment(\"Workflow\", next_state);\n\t\t\t\t\t}\n\t\t\t\t\tif(new_docstatus==1 && me.frm.doc.docstatus==0) {\n\t\t\t\t\t\tme.frm.savesubmit(null, success, on_error);\n\t\t\t\t\t} else if(new_docstatus==0 && me.frm.doc.docstatus==0) {\n\t\t\t\t\t\tme.frm.save(\"Save\", success, null, on_error);\n\t\t\t\t\t} else if(new_docstatus==1 && me.frm.doc.docstatus==1) {\n\t\t\t\t\t\tme.frm.save(\"Update\", success, null, on_error);\n\t\t\t\t\t} else if(new_docstatus==2 && me.frm.doc.docstatus==1) {\n\t\t\t\t\t\tme.frm.savecancel(null, success, on_error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.msgprint(__(\"Document Status transition from \") + me.frm.doc.docstatus + \" \"\n\t\t\t\t\t\t\t+ __(\"to\") +\n\t\t\t\t\t\t\tnew_docstatus + \" \" + __(\"is not allowed.\"));\n\t\t\t\t\t\tfrappe.msgprint(__(\"Document Status transition from {0} to {1} is not allowed\", [me.frm.doc.docstatus, new_docstatus]));\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif(added) {\n\t\t\tthis.frm.page.btn_primary.addClass(\"hide\");\n\t\t\tthis.frm.toolbar.current_status = \"\";\n\t\t\tthis.setup_help();\n\t\t}\n\t},\n\n\tset_default_state: function() {\n\t\tvar default_state = frappe.workflow.get_default_state(this.frm.doctype, this.frm.doc.docstatus);\n\t\tif(default_state) {\n\t\t\tthis.frm.set_value(this.state_fieldname, default_state);\n\t\t}\n\t},\n\n\tget_state: function() {\n\t\tif(!this.frm.doc[this.state_fieldname]) {\n\t\t\tthis.set_default_state();\n\t\t}\n\t\treturn this.frm.doc[this.state_fieldname];\n\t},\n\n\tbind_action: function() {\n\t\tvar me = this;\n\t\tthis.dropdown.on(\"click\", \"[data-action]\", function() {\n\t\t})\n\t}\n});\n","frappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.PrintPreview = Class.extend({\n\tinit: function (opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t\tthis.bind_events();\n\t},\n\tmake: function () {\n\t\tthis.wrapper = this.frm.page.add_view(\"print\", frappe.render_template(\"print_layout\", {}));\n\n\t\t// only system manager can edit\n\t\tthis.wrapper.find(\".btn-print-edit\").toggle(frappe.user.has_role(\"System Manager\"));\n\t},\n\tbind_events: function () {\n\t\tvar me = this;\n\t\tthis.wrapper.find(\".btn-print-close\").click(function () {\n\t\t\tme.frm.hide_print();\n\t\t});\n\n\t\t// hide print view on pressing escape, only if there is no focus on any input\n\t\t$(document).on(\"keydown\", function (e) {\n\t\t\tif (e.which === 27 && me.frm && e.target === document.body) {\n\t\t\t\tme.frm.hide_print();\n\t\t\t}\n\t\t});\n\n\t\tthis.print_formats = frappe.meta.get_print_formats(this.frm.meta.name);\n\t\tthis.print_letterhead = this.wrapper\n\t\t\t.find(\".print-letterhead\")\n\t\t\t.on(\"change\", function () { me.print_sel.trigger(\"change\"); })\n\t\t\t.prop(\"checked\", cint(\n\t\t\t\t(frappe.model.get_doc(\":Print Settings\", \"Print Settings\")\n\t\t\t\t\t|| { with_letterhead: 1 }).with_letterhead) ? true : false);\n\t\tthis.print_sel = this.wrapper\n\t\t\t.find(\".print-preview-select\")\n\t\t\t.on(\"change\", function () {\n\t\t\t\tme.set_default_print_language();\n\t\t\t\tme.multilingual_preview();\n\t\t\t});\n\n\t\t//On selection of language get code and pass it to preview method\n\t\tthis.language_sel = this.wrapper\n\t\t\t.find(\".languages\")\n\t\t\t.on(\"change\", function () {\n\t\t\t\tme.lang_code = me.language_sel.val()\n\t\t\t\tme.multilingual_preview()\n\t\t\t});\n\n\t\tthis.wrapper.find(\".btn-print-print\").click(function () {\n\t\t\tif (me.is_old_style()) {\n\t\t\t\tme.print_old_style();\n\t\t\t} else {\n\t\t\t\tme.printit();\n\t\t\t}\n\t\t});\n\n\t\tthis.wrapper.find(\".btn-print-preview\").click(function () {\n\t\t\tif (me.is_old_style()) {\n\t\t\t\tme.new_page_preview_old_style();\n\t\t\t} else {\n\t\t\t\tme.new_page_preview();\n\t\t\t}\n\t\t});\n\n\t\tthis.wrapper.find(\".btn-download-pdf\").click(function () {\n\t\t\tif (!me.is_old_style()) {\n\t\t\t\tvar w = window.open(\n\t\t\t\t\tfrappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n\t\t\t\t\t\t+ \"doctype=\" + encodeURIComponent(me.frm.doc.doctype)\n\t\t\t\t\t\t+ \"&name=\" + encodeURIComponent(me.frm.doc.name)\n\t\t\t\t\t\t+ \"&format=\" + me.selected_format()\n\t\t\t\t\t\t+ \"&no_letterhead=\" + (me.with_letterhead() ? \"0\" : \"1\")\n\t\t\t\t\t\t+ (me.lang_code ? (\"&_lang=\" + me.lang_code) : \"\"))\n\t\t\t\t);\n\t\t\t\tif (!w) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please enable pop-ups\")); return;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.wrapper.find(\".btn-print-edit\").on(\"click\", function () {\n\t\t\tlet print_format = me.get_print_format();\n\t\t\tif (print_format && print_format.name) {\n\t\t\t\tif (print_format.print_format_builder) {\n\t\t\t\t\tfrappe.set_route(\"print-format-builder\", print_format.name);\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.set_route(\"Form\", \"Print Format\", print_format.name);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// start a new print format\n\t\t\t\tfrappe.prompt({\n\t\t\t\t\tfieldname: \"print_format_name\", fieldtype: \"Data\", reqd: 1,\n\t\t\t\t\tlabel: \"New Print Format Name\"\n\t\t\t\t}, function (data) {\n\t\t\t\t\tfrappe.route_options = {\n\t\t\t\t\t\tmake_new: true,\n\t\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\t\tname: data.print_format_name\n\t\t\t\t\t};\n\t\t\t\t\tfrappe.set_route(\"print-format-builder\");\n\t\t\t\t}, __(\"New Custom Print Format\"), __(\"Start\"));\n\t\t\t}\n\t\t});\n\t},\n\tset_user_lang: function () {\n\t\tthis.lang_code = this.frm.doc.language;\n\t\t// Load all languages in the field\n\t\tthis.language_sel.empty()\n\t\t\t.add_options([{value:'', label:__(\"Select Language...\")}]\n\t\t\t\t.concat(frappe.get_languages()))\n\t\t\t.val(this.lang_code);\n\t\tthis.preview();\n\t},\n\tset_default_print_language: function () {\n \t\tvar print_format = this.get_print_format();\n \t\n \t\tif (print_format.default_print_language) {\n \t\t\tthis.lang_code = print_format.default_print_language;\n \t\t\tthis.language_sel.val(this.lang_code);\n \t\t} else {\n\t\t\tthis.language_sel.val(frappe.boot.lang);\t\n\t\t}\n \t},\n\tmultilingual_preview: function () {\n\t\tvar me = this;\n\t\tif (this.is_old_style()) {\n\t\t\tme.wrapper.find(\".btn-download-pdf\").toggle(false);\n\t\t\tme.set_style();\n\t\t\tme.preview_old_style();\n\t\t} else {\n\t\t\tme.wrapper.find(\".btn-download-pdf\").toggle(true);\n\t\t\tme.preview();\n\t\t}\n\t},\n\tpreview: function () {\n\t\tvar me = this;\n\t\tthis.get_print_html(function (out) {\n\t\t\tme.wrapper.find(\".print-format\").html(out.html);\n\t\t\tme.show_footer();\n\t\t\tme.set_style(out.style);\n\t\t});\n\t},\n\tshow_footer: function() {\n\t\t// footer is hidden by default as reqd by pdf generation\n\t\t// simple hack to show it in print preview\n\t\tthis.wrapper.find('.page-break').css({\n\t\t\t'display': 'flex',\n\t\t\t'flex-direction': 'column'\n\t\t});\n\t\tthis.wrapper.find('#footer-html').attr('style', `\n\t\t\tdisplay: block !important;\n\t\t\torder: 1;\n\t\t\tmargin-top: 20px;\n\t\t`);\n\t},\n\tprintit: function () {\n\t\tthis.new_page_preview(true);\n\t},\n\tnew_page_preview: function (printit) {\n\t\tvar me = this;\n\t\tvar w = window.open(frappe.urllib.get_full_url(\"/printview?\"\n\t\t\t+ \"doctype=\" + encodeURIComponent(me.frm.doc.doctype)\n\t\t\t+ \"&name=\" + encodeURIComponent(me.frm.doc.name)\n\t\t\t+ (printit ? \"&trigger_print=1\" : \"\")\n\t\t\t+ \"&format=\" + me.selected_format()\n\t\t\t+ \"&no_letterhead=\" + (me.with_letterhead() ? \"0\" : \"1\")\n\t\t\t+ (me.lang_code ? (\"&_lang=\" + me.lang_code) : \"\")));\n\t\tif (!w) {\n\t\t\tfrappe.msgprint(__(\"Please enable pop-ups\")); return;\n\t\t}\n\t},\n\tget_print_html: function (callback) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.www.printview.get_html_and_style\",\n\t\t\targs: {\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tprint_format: this.selected_format(),\n\t\t\t\tno_letterhead: !this.with_letterhead() ? 1 : 0,\n\t\t\t\t_lang: this.lang_code\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tcallback(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tpreview_old_style: function () {\n\t\tvar me = this;\n\t\tthis.with_old_style({\n\t\t\tformat: me.print_sel.val(),\n\t\t\tcallback: function (html) {\n\t\t\t\tme.wrapper.find(\".print-format\").html('<div class=\"alert alert-warning\">'\n\t\t\t\t\t+ __(\"Warning: This Print Format is in old style and cannot be generated via the API.\")\n\t\t\t\t\t+ '</div>'\n\t\t\t\t\t+ html);\n\t\t\t},\n\t\t\tno_letterhead: !this.with_letterhead(),\n\t\t\tonly_body: true,\n\t\t\tno_heading: true\n\t\t});\n\t},\n\trefresh_print_options: function () {\n\t\tthis.print_formats = frappe.meta.get_print_formats(this.frm.doctype);\n\t\treturn this.print_sel\n\t\t\t.empty().add_options(this.print_formats);\n\n\t},\n\twith_old_style: function (opts) {\n\t\tfrappe.require(\"/assets/js/print_format_v3.min.js\", function () {\n\t\t\t_p.build(opts.format, opts.callback, opts.no_letterhead, opts.only_body, opts.no_heading);\n\t\t});\n\t},\n\tprint_old_style: function () {\n\t\tvar me = this;\n\t\tfrappe.require(\"/assets/js/print_format_v3.min.js\", function () {\n\t\t\t_p.build(me.print_sel.val(), _p.go,\n\t\t\t\t!me.with_letterhead());\n\t\t});\n\t},\n\tnew_page_preview_old_style: function () {\n\t\tvar me = this;\n\t\tfrappe.require(\"/assets/js/print_format_v3.min.js\", function () {\n\t\t\t_p.build(me.print_sel.val(), _p.preview, !me.with_letterhead());\n\t\t});\n\t},\n\tselected_format: function () {\n\t\treturn this.print_sel.val() || this.frm.meta.default_print_format || \"Standard\";\n\t},\n\tis_old_style: function (format) {\n\t\treturn this.get_print_format(format).print_format_type === \"Client\";\n\t},\n\tget_print_format: function (format) {\n\t\tif (!format) {\n\t\t\tformat = this.selected_format();\n\t\t}\n\n\t\tif (locals[\"Print Format\"] && locals[\"Print Format\"][format]) {\n\t\t\treturn locals[\"Print Format\"][format]\n\t\t} else {\n\t\t\treturn {}\n\t\t}\n\t},\n\twith_letterhead: function () {\n\t\treturn this.print_letterhead.is(\":checked\") ? 1 : 0;\n\t},\n\tset_style: function (style) {\n\t\tfrappe.dom.set_style(style || frappe.boot.print_css, \"print-style\");\n\t}\n});\n\nfrappe.ui.get_print_settings = function (pdf, callback, letter_head) {\n\tvar print_settings = locals[\":Print Settings\"][\"Print Settings\"];\n\n\tvar default_letter_head = locals[\":Company\"] && frappe.defaults.get_default('company')\n\t\t? locals[\":Company\"][frappe.defaults.get_default('company')][\"default_letter_head\"]\n\t\t: '';\n\n\tvar columns = [{\n\t\tfieldtype: \"Check\",\n\t\tfieldname: \"with_letter_head\",\n\t\tlabel: __(\"With Letter head\")\n\t}, {\n\t\tfieldtype: \"Select\",\n\t\tfieldname: \"letter_head\",\n\t\tlabel: __(\"Letter Head\"),\n\t\tdepends_on: \"with_letter_head\",\n\t\toptions: $.map(frappe.boot.letter_heads, function (i, d) { return d }),\n\t\tdefault: letter_head || default_letter_head\n\t}];\n\n\tif (pdf) {\n\t\tcolumns.push({\n\t\t\tfieldtype: \"Select\",\n\t\t\tfieldname: \"orientation\",\n\t\t\tlabel: __(\"Orientation\"),\n\t\t\toptions: \"Landscape\\nPortrait\",\n\t\t\tdefault: \"Landscape\"\n\t\t})\n\t}\n\n\tfrappe.prompt(columns, function (data) {\n\t\tvar data = $.extend(print_settings, data);\n\t\tif (!data.with_letter_head) {\n\t\t\tdata.letter_head = null;\n\t\t}\n\t\tif (data.letter_head) {\n\t\t\tdata.letter_head = frappe.boot.letter_heads[print_settings.letter_head];\n\t\t}\n\t\tcallback(data);\n\t}, __(\"Print Settings\"));\n}\n","frappe.provide(\"frappe.ui.form\");\nfrappe.ui.form.Sidebar = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\n\tmake: function() {\n\t\tvar sidebar_content = frappe.render_template(\"form_sidebar\", {doctype: this.frm.doctype, frm:this.frm});\n\n\t\tthis.sidebar = $('<div class=\"form-sidebar overlay-sidebar hidden-xs hidden-sm\"></div>')\n\t\t\t.html(sidebar_content)\n\t\t\t.appendTo(this.page.sidebar.empty());\n\n\t\tthis.ratings = this.sidebar.find(\".sidebar-rating\");\n\t\tthis.comments = this.sidebar.find(\".sidebar-comments\");\n\t\tthis.user_actions = this.sidebar.find(\".user-actions\");\n\t\tthis.image_section = this.sidebar.find(\".sidebar-image-section\");\n\t\tthis.image_wrapper = this.image_section.find('.sidebar-image-wrapper');\n\n\t\tthis.make_assignments();\n\t\tthis.make_attachments();\n\t\tthis.make_shared();\n\t\tthis.make_viewers();\n\t\tthis.make_tags();\n\t\tthis.make_like();\n\n\t\tthis.bind_events();\n\t\tfrappe.ui.form.setup_user_image_event(this.frm);\n\n\t\tthis.refresh();\n\n\t},\n\n\tbind_events: function() {\n\t\tvar me = this;\n\n\t\t// scroll to comments\n\t\tthis.comments.on(\"click\", function() {\n\t\t\tfrappe.utils.scroll_to(me.frm.footer.wrapper.find(\".form-comments\"), true);\n\t\t});\n\n\t\tthis.like_icon.on(\"click\", function() {\n\t\t\tfrappe.ui.toggle_like(me.like_icon, me.frm.doctype, me.frm.doc.name, function() {\n\t\t\t\tme.refresh_like();\n\t\t\t});\n\t\t})\n\t},\n\n\trefresh: function() {\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.sidebar.toggle(false);\n\t\t} else {\n\t\t\tthis.sidebar.toggle(true);\n\t\t\tthis.frm.assign_to.refresh();\n\t\t\tthis.frm.attachments.refresh();\n\t\t\tthis.frm.shared.refresh();\n\t\t\tthis.frm.viewers.refresh();\n\t\t\tthis.frm.tags && this.frm.tags.refresh(this.frm.doc._user_tags);\n\t\t\tthis.sidebar.find(\".modified-by\").html(__(\"{0} edited this {1}\",\n\t\t\t\t[\"<strong>\" + frappe.user.full_name(this.frm.doc.modified_by) + \"</strong>\",\n\t\t\t\t\t\"<br>\" + comment_when(this.frm.doc.modified)]));\n\t\t\tthis.sidebar.find(\".created-by\").html(__(\"{0} created this {1}\",\n\t\t\t\t[\"<strong>\" + frappe.user.full_name(this.frm.doc.owner) + \"</strong>\",\n\t\t\t\t\t\"<br>\" + comment_when(this.frm.doc.creation)]));\n\n\t\t\tthis.refresh_like();\n\t\t\tthis.setup_ratings();\n\t\t\tfrappe.ui.form.set_user_image(this.frm);\n\t\t}\n\t},\n\n\trefresh_comments: function() {\n\t\t$.map(this.frm.timeline.get_communications(), function(c) {\n\t\t\treturn (c.communication_type===\"Communication\" || (c.communication_type==\"Comment\" && c.comment_type===\"Comment\")) ? c : null;\n\t\t});\n\t\tthis.comments.find(\".n-comments\").html(this.frm.get_docinfo().total_comments);\n\t},\n\n\tmake_tags: function() {\n\t\tvar me = this;\n\t\tif (this.frm.meta.issingle) {\n\t\t\tthis.sidebar.find(\".form-tags\").toggle(false);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.frm.tags = new frappe.ui.TagEditor({\n\t\t\tparent: this.sidebar.find(\".tag-area\"),\n\t\t\tfrm: this.frm,\n\t\t\ton_change: function(user_tags) {\n\t\t\t\tme.frm.doc._user_tags += (\",\" + user_tags);\n\t\t\t}\n\t\t});\n\t},\n\tmake_attachments: function() {\n\t\tvar me = this;\n\t\tthis.frm.attachments = new frappe.ui.form.Attachments({\n\t\t\tparent: me.sidebar.find(\".form-attachments\"),\n\t\t\tfrm: me.frm\n\t\t});\n\t},\n\tmake_assignments: function() {\n\t\tthis.frm.assign_to = new frappe.ui.form.AssignTo({\n\t\t\tparent: this.sidebar.find(\".form-assignments\"),\n\t\t\tfrm: this.frm\n\t\t});\n\t},\n\tmake_shared: function() {\n\t\tthis.frm.shared = new frappe.ui.form.Share({\n\t\t\tfrm: this.frm,\n\t\t\tparent: this.sidebar.find(\".form-shared\")\n\t\t});\n\t},\n\tmake_viewers: function() {\n\t\tthis.frm.viewers = new frappe.ui.form.Viewers({\n\t\t\tfrm: this.frm,\n\t\t\tparent: this.sidebar.find(\".form-viewers\")\n\t\t});\n\t},\n\tadd_user_action: function(label, click) {\n\t\treturn $('<a>').html(label).appendTo($('<li class=\"user-action-row\">')\n\t\t\t.appendTo(this.user_actions.removeClass(\"hidden\"))).on(\"click\", click);\n\t},\n\tclear_user_actions: function() {\n\t\tthis.user_actions.addClass(\"hidden\")\n\t\tthis.user_actions.find(\".user-action-row\").remove();\n\t},\n\n\tmake_like: function() {\n\t\tthis.like_wrapper = this.sidebar.find(\".liked-by\");\n\t\tthis.like_icon = this.sidebar.find(\".liked-by .octicon-heart\");\n\t\tthis.like_count = this.sidebar.find(\".liked-by .likes-count\");\n\t\tfrappe.ui.setup_like_popover(this.sidebar.find(\".liked-by-parent\"), \".liked-by\");\n\t},\n\n\trefresh_like: function() {\n\t\tif (!this.like_icon) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.like_wrapper.attr(\"data-liked-by\", this.frm.doc._liked_by);\n\n\t\tthis.like_icon.toggleClass(\"text-extra-muted not-liked\",\n\t\t\t!frappe.ui.is_liked(this.frm.doc))\n\t\t\t.attr(\"data-doctype\", this.frm.doctype)\n\t\t\t.attr(\"data-name\", this.frm.doc.name);\n\n\t\tthis.like_count.text(JSON.parse(this.frm.doc._liked_by || \"[]\").length);\n\t},\n\n\trefresh_image: function() {\n\t},\n\n\tsetup_ratings: function() {\n\t\tvar _ratings = this.frm.get_docinfo().rating || 0;\n\n\t\tif(_ratings) {\n\t\t\tthis.ratings.removeClass(\"hide\");\n\t\t\tvar rating_icons = frappe.render_template(\"rating_icons\", {rating: _ratings, show_label: false});\n\t\t\tthis.ratings.find(\".rating-icons\").html(rating_icons);\n\t\t}\n\t}\n});\n","frappe.ui.form.set_user_image = function(frm) {\n\n\tvar image_section = frm.sidebar.image_section;\n\tvar image_field = frm.meta.image_field;\n\tvar image = frm.doc[image_field];\n\tvar title_image = frm.page.$title_area.find('.title-image');\n\n\n\timage_section.toggleClass('hide', image_field ? false : true);\n\ttitle_image.toggleClass('hide', image_field ? false : true);\n\n\tif(!image_field) {\n\t\treturn;\n\t}\n\n\t// if image field has value\n\tif (image) {\n\t\timage = (window.cordova && image.indexOf('http')===-1) ?\n\t\t\tfrappe.base_url + image : image;\n\n\t\timage_section\n\t\t\t.find(\".sidebar-image\")\n\t\t\t.css(\"background-image\", 'url(\"' + image + '\")')\n\t\t\t.removeClass(\"hide\");\n\n\t\timage_section\n\t\t\t.find('.sidebar-standard-image')\n\t\t\t.addClass('hide');\n\n\t\ttitle_image\n\t\t\t.css('background-color', '')\n\t\t\t.css(\"background-image\", 'url(\"' + image + '\")')\n\t\t\t.html('');\n\n\t} else {\n\t\timage_section\n\t\t\t.find(\".sidebar-image\")\n\t\t\t.css(\"background-image\", null)\n\t\t\t.addClass(\"hide\");\n\n\t\tvar title = frm.get_title();\n\n\t\timage_section\n\t\t\t.find('.sidebar-standard-image')\n\t\t\t.removeClass('hide')\n\t\t\t.find('.standard-image')\n\t\t\t.css({'background-color': frappe.get_palette(title)})\n\t\t\t.html(frappe.get_abbr(title));\n\n\t\ttitle_image.css(\"background-image\", '')\n\t\t\t.css({'background-color': frappe.get_palette(title)})\n\t\t\t.html(frappe.get_abbr(title));\n\n\t}\n\n}\n\nfrappe.ui.form.setup_user_image_event = function(frm) {\n\t// re-draw image on change of user image\n\tif(frm.meta.image_field) {\n\t\tfrappe.ui.form.on(frm.doctype, frm.meta.image_field, function(frm) {\n\t\t\tfrappe.ui.form.set_user_image(frm);\n\t\t});\n\t}\n\n\t// bind click on image_wrapper\n\tfrm.sidebar.image_wrapper.on('click', function() {\n\t\tvar field = frm.get_field(frm.meta.image_field);\n\t\tif(!field.$input) {\n\t\t\tfield.make_input();\n\t\t}\n\t\tfield.$input.trigger('click');\n\t});\n}","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.Share = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\trefresh: function() {\n\t\tthis.render_sidebar();\n\t},\n\trender_sidebar: function() {\n\t\tvar me = this;\n\t\tthis.parent.empty();\n\n\t\tvar shared = this.shared || this.frm.get_docinfo().shared;\n\t\tshared = shared.filter(function(d) { return d });\n\t\tvar users = [];\n\t\tfor (var i=0, l=shared.length; i < l; i++) {\n\t\t\tvar s = shared[i];\n\n\t\t\tif (s.everyone) {\n\t\t\t\tusers.push({\n\t\t\t\t\ticon: \"octicon octicon-megaphone text-muted\",\n\t\t\t\t\tavatar_class: \"avatar-empty share-doc-btn shared-with-everyone\",\n\t\t\t\t\ttitle: __(\"Shared with everyone\")\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tvar user_info = frappe.user_info(s.user);\n\t\t\t\tusers.push({\n\t\t\t\t\timage: user_info.image,\n\t\t\t\t\tfullname: user_info.fullname,\n\t\t\t\t\tabbr: user_info.abbr,\n\t\t\t\t\tcolor: user_info.color,\n\t\t\t\t\ttitle: __(\"Shared with {0}\", [user_info.fullname])\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (!me.frm.doc.__islocal) {\n\t\t\tusers.push({\n\t\t\t\ticon: \"octicon octicon-plus text-muted\",\n\t\t\t\tavatar_class: \"avatar-empty share-doc-btn\",\n\t\t\t\ttitle: __(\"Share\")\n\t\t\t});\n\t\t}\n\n\t\tthis.parent.append(frappe.render_template(\"users_in_sidebar\", {\"users\": users}));\n\t\tthis.parent.find(\".avatar\").on(\"click\", function() {\n\t\t\tme.frm.share_doc();\n\t\t});\n\t},\n\tshow: function() {\n\t\tvar me = this;\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Share {0} with\", [this.frm.doc.name]),\n\t\t});\n\n\t\tthis.dialog = d;\n\t\tthis.dirty = false;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.share.get_users\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.doc.name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tme.render_shared(r.message || []);\n\t\t\t}\n\t\t});\n\n\t\t$(d.body).html('<p class=\"text-muted\">' + __(\"Loading...\") + '</p>');\n\n\t\td.onhide = function() {\n\t\t\t// reload comments\n\t\t\tif(me.dirty) me.frm.reload_docinfo();\n\t\t}\n\n\t\td.show();\n\t},\n\trender_shared: function(shared) {\n\t\tif(shared)\n\t\t\tthis.shared = shared;\n\t\tvar d = this.dialog;\n\t\t$(d.body).empty();\n\n\t\tvar everyone = {};\n\t\t$.each(this.shared, function(i, s) {\n\t\t\t// pullout everyone record from shared list\n\t\t\tif (s && s.everyone) {\n\t\t\t\teveryone = s;\n\t\t\t}\n\t\t});\n\n\t\t$(frappe.render_template(\"set_sharing\", {frm: this.frm, shared: this.shared, everyone: everyone}))\n\t\t\t.appendTo(d.body);\n\n\t\tif(frappe.model.can_share(null, this.frm)) {\n\t\t\tthis.make_user_input();\n\t\t\tthis.add_share_button();\n\t\t\tthis.set_edit_share_events();\n\t\t} else {\n\t\t\t// if cannot share, disable sharing settings.\n\t\t\t$(d.body).find(\".edit-share\").prop(\"disabled\", true);\n\t\t}\n\t},\n\tmake_user_input: function() {\n\t\t// make add-user input\n\t\tthis.dialog.share_with = frappe.ui.form.make_control({\n\t\t\tparent: $(this.dialog.body).find(\".input-wrapper-add-share\"),\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: __(\"Share With\"),\n\t\t\t\tfieldname: \"share_with\",\n\t\t\t\toptions: \"User\",\n\t\t\t\tfilters: {\n\t\t\t\t\t\"user_type\": \"System User\",\n\t\t\t\t\t\"name\": [\"!=\", frappe.session.user]\n\t\t\t\t}\n\t\t\t},\n\t\t\tonly_input: true,\n\t\t\trender_input: true\n\t\t});\n\n\t},\n\tadd_share_button: function() {\n\t\tvar me = this, d = this.dialog;\n\t\t$(d.body).find(\".btn-add-share\").on(\"click\", function() {\n\t\t\tvar user = d.share_with.get_value();\n\t\t\tif(!user) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.share.add\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\tuser: user,\n\t\t\t\t\tread: $(d.body).find(\".add-share-read\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\twrite: $(d.body).find(\".add-share-write\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\tshare: $(d.body).find(\".add-share-share\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\tnotify: $(d.body).find(\".add-share-notify\").prop(\"checked\") ? 1 : 0\n\t\t\t\t},\n\t\t\t\tbtn: this,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\t$.each(me.shared, function(i, s) {\n\t\t\t\t\t\tif(s && s.user===r.message.user) {\n\t\t\t\t\t\t\t// re-adding / remove the old share rule.\n\t\t\t\t\t\t\tdelete me.shared[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\tme.dirty = true;\n\t\t\t\t\tme.shared.push(r.message);\n\t\t\t\t\tme.render_shared();\n\t\t\t\t\tme.frm.shared.refresh();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\tset_edit_share_events: function() {\n\t\tvar me = this, d = this.dialog;\n\t\t$(d.body).find(\".edit-share\").on(\"click\", function() {\n\t\t\tvar user = $(this).parents(\".shared-user:first\").attr(\"data-user\") || \"\",\n\t\t\t\tvalue = $(this).prop(\"checked\") ? 1 : 0,\n\t\t\t\tproperty = $(this).attr(\"name\"),\n\t\t\t\teveryone = cint($(this).parents(\".shared-user:first\").attr(\"data-everyone\"));\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.share.set_permission\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\tuser: user,\n\t\t\t\t\tpermission_to: property,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\teveryone: everyone\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tvar found = null;\n\t\t\t\t\t$.each(me.shared, function(i, s) {\n\t\t\t\t\t\t// update shared object\n\t\t\t\t\t\tif(s && (s.user===user || (everyone && s.everyone===1))) {\n\t\t\t\t\t\t\tif(!r.message) {\n\t\t\t\t\t\t\t\tdelete me.shared[i];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.shared[i] = $.extend(s, r.message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!found) {\n\t\t\t\t\t\tme.shared.push(r.message);\n\t\t\t\t\t}\n\n\t\t\t\t\tme.dirty = true;\n\t\t\t\t\tme.render_shared();\n\t\t\t\t\tme.frm.shared.refresh();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n});\n","frappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.Viewers = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\tget_viewers: function() {\n\t\tlet docinfo = this.frm.get_docinfo();\n\t\tif (docinfo) {\n\t\t\treturn docinfo.viewers || {};\n\t\t} else {\n\t\t\treturn {};\n\t\t}\n\t},\n\trefresh: function(data_updated) {\n\t\tthis.parent.empty();\n\n\t\tvar viewers = this.get_viewers();\n\n\t\tvar users = [];\n\t\tvar new_users = [];\n\t\tfor (var i=0, l=(viewers.current || []).length; i < l; i++) {\n\t\t\tvar username = viewers.current[i];\n\t\t\tif (username===frappe.session.user) {\n\t\t\t\t// current user\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar user_info = frappe.user_info(username);\n\t\t\tusers.push({\n\t\t\t\timage: user_info.image,\n\t\t\t\tfullname: user_info.fullname,\n\t\t\t\tabbr: user_info.abbr,\n\t\t\t\tcolor: user_info.color,\n\t\t\t\ttitle: __(\"{0} is currently viewing this document\", [user_info.fullname])\n\t\t\t});\n\n\t\t\tif (viewers.new.indexOf(username)!==-1) {\n\t\t\t\tnew_users.push(user_info.fullname);\n\t\t\t}\n\t\t}\n\n\t\tif (users.length) {\n\t\t\tthis.parent.parent().removeClass(\"hidden\");\n\t\t\tthis.parent.append(frappe.render_template(\"users_in_sidebar\", {\"users\": users}));\n\t\t} else {\n\t\t\tthis.parent.parent().addClass(\"hidden\");\n\t\t}\n\n\t\tif (data_updated && new_users.length) {\n\t\t\t// new user viewing this document, who wasn't viewing in the past\n\t\t\tif (new_users.length===1) {\n\t\t\t\tfrappe.show_alert(__(\"{0} is currently viewing this document\", [new_users[0]]));\n\t\t\t} else {\n\t\t\t\tfrappe.show_alert(__(\"{0} are currently viewing this document\", [frappe.utils.comma_and(new_users)]));\n\t\t\t}\n\n\t\t}\n\t}\n});\n\nfrappe.ui.form.set_viewers = function(data) {\n\tvar doctype = data.doctype;\n\tvar docname = data.docname;\n\tvar docinfo = frappe.model.get_docinfo(doctype, docname);\n\tvar past_viewers = ((docinfo && docinfo.viewers) || {}).past || [];\n\tvar viewers = data.viewers || [];\n\n\tvar new_viewers = viewers.filter(viewer => !past_viewers.includes(viewer));\n\n\tfrappe.model.set_docinfo(doctype, docname, \"viewers\", {\n\t\tpast: past_viewers.concat(new_viewers),\n\t\tnew: new_viewers,\n\t\tcurrent: viewers\n\t});\n\n\tif (cur_frm && cur_frm.doc && cur_frm.doc.doctype===doctype && cur_frm.doc.name==docname) {\n\t\tcur_frm.viewers.refresh(true);\n\t}\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.Footer = Class.extend({\n\tinit: function(opts) {\n\t\tvar me = this;\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t\tthis.make_comments();\n\t\t// render-complete\n\t\t$(this.frm.wrapper).on(\"render_complete\", function() {\n\t\t\tme.refresh();\n\t\t});\n\t},\n\tmake: function() {\n\t\tvar me = this;\n\t\tthis.wrapper = $(frappe.render_template(\"form_footer\", {}))\n\t\t\t.appendTo(this.parent);\n\t\tthis.wrapper.find(\".btn-save\").click(function() {\n\t\t\tme.frm.save('Save', null, this);\n\t\t})\n\n\t},\n\tmake_comments: function() {\n\t\tthis.frm.timeline = new frappe.ui.form.Timeline({\n\t\t\tparent: this.wrapper.find(\".form-comments\"),\n\t\t\tfrm: this.frm\n\t\t});\n\t},\n\trefresh: function() {\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.parent.addClass(\"hide\");\n\t\t} else {\n\t\t\tthis.parent.removeClass(\"hide\");\n\t\t\tthis.frm.timeline.refresh();\n\t\t}\n\t},\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.Attachments = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t},\n\tmake: function() {\n\t\tvar me = this;\n\t\tthis.parent.find(\".add-attachment\").click(function() {\n\t\t\tme.new_attachment();\n\t\t});\n\t\tthis.add_attachment_wrapper = this.parent.find(\".add_attachment\").parent();\n\t\tthis.attachments_label = this.parent.find(\".attachments-label\");\n\t},\n\tmax_reached: function() {\n\t\t// no of attachments\n\t\tvar n = Object.keys(this.get_attachments()).length;\n\n\t\t// button if the number of attachments is less than max\n\t\tif(n < this.frm.meta.max_attachments || !this.frm.meta.max_attachments) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t},\n\trefresh: function() {\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.parent.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.parent.toggle(true);\n\t\tthis.parent.find(\".attachment-row\").remove();\n\n\t\tvar max_reached = this.max_reached();\n\t\tthis.add_attachment_wrapper.toggleClass(\"hide\", !max_reached);\n\n\t\t// add attachment objects\n\t\tvar attachments = this.get_attachments();\n\t\tif(attachments.length) {\n\t\t\tattachments.forEach(function(attachment) {\n\t\t\t\tme.add_attachment(attachment)\n\t\t\t});\n\t\t} else {\n\t\t\tthis.attachments_label.removeClass(\"has-attachments\");\n\t\t}\n\n\t},\n\tget_attachments: function() {\n\t\treturn this.frm.get_docinfo().attachments;\n\t},\n\tadd_attachment: function(attachment) {\n\t\tvar file_name = attachment.file_name;\n\t\tvar file_url = this.get_file_url(attachment);\n\t\tvar fileid = attachment.name;\n\t\tif (!file_name) {\n\t\t\tfile_name = file_url;\n\t\t}\n\n\t\tvar me = this;\n\t\tvar $attach = $(repl('<li class=\"attachment-row\">\\\n\t\t\t\t<a class=\"close\">&times;</a>\\\n\t\t\t\t%(lock_icon)s\\\n\t\t\t\t<a href=\"%(file_url)s\" target=\"_blank\" title=\"%(file_name)s\" \\\n\t\t\t\t\tclass=\"ellipsis\" style=\"max-width: calc(100% - 43px);\">\\\n\t\t\t\t\t<span>%(file_name)s</span></a>\\\n\t\t\t</li>', {\n\t\t\t\tlock_icon: attachment.is_private ? '<i class=\"fa fa-lock fa-fw text-warning\"></i> ': \"\",\n\t\t\t\tfile_name: file_name,\n\t\t\t\tfile_url: frappe.urllib.get_full_url(file_url)\n\t\t\t}))\n\t\t\t.insertAfter(this.attachments_label.addClass(\"has-attachments\"));\n\n\t\tvar $close =\n\t\t\t$attach.find(\".close\")\n\t\t\t.data(\"fileid\", fileid)\n\t\t\t.click(function() {\n\t\t\t\tvar remove_btn = this;\n\t\t\t\tfrappe.confirm(__(\"Are you sure you want to delete the attachment?\"),\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tme.remove_attachment($(remove_btn).data(\"fileid\"))\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\treturn false\n\t\t\t});\n\n\t\tif(!frappe.model.can_write(this.frm.doctype, this.frm.name)) {\n\t\t\t$close.remove();\n\t\t}\n\t},\n\tget_file_url: function(attachment) {\n\t\tvar file_url = attachment.file_url;\n\t\tif (!file_url) {\n\t\t\tif (attachment.file_name.indexOf('files/') === 0) {\n\t\t\t\tfile_url = '/' + attachment.file_name;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfile_url = '/files/' + attachment.file_name;\n\t\t\t}\n\t\t}\n\t\t// hash is not escaped, https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI\n\t\treturn encodeURI(file_url).replace(/#/g, '%23');\n\t},\n\tget_file_id_from_file_url: function(file_url) {\n\t\tvar fid;\n\t\t$.each(this.get_attachments(), function(i, attachment) {\n\t\t\tif (attachment.file_url === file_url) {\n\t\t\t\tfid = attachment.name;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn fid;\n\t},\n\tremove_attachment_by_filename: function(filename, callback) {\n\t\tthis.remove_attachment(this.get_file_id_from_file_url(filename), callback);\n\t},\n\tremove_attachment: function(fileid, callback) {\n\t\tif (!fileid) {\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.desk.form.utils.remove_attach',\n\t\t\targs: {\n\t\t\t\tfid: fileid,\n\t\t\t\tdt: me.frm.doctype,\n\t\t\t\tdn: me.frm.docname\n\t\t\t},\n\t\t\tcallback: function(r,rt) {\n\t\t\t\tif(r.exc) {\n\t\t\t\t\tif(!r._server_messages)\n\t\t\t\t\t\tfrappe.msgprint(__(\"There were errors\"));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tme.remove_fileid(fileid);\n\t\t\t\tme.frm.get_docinfo().communications.push(r.message);\n\t\t\t\tme.frm.timeline && me.frm.timeline.refresh();\n\t\t\t\tif (callback) callback();\n\t\t\t}\n\t\t});\n\t},\n\tnew_attachment: function(fieldname) {\n\t\tvar me = this;\n\t\tif (this.dialog) {\n\t\t\t// remove upload dialog\n\t\t\tthis.dialog.$wrapper.remove();\n\t\t}\n\n\t\t// make upload dialog\n\t\tthis.dialog = frappe.ui.get_upload_dialog({\n\t\t\t\"args\": me.get_args(),\n\t\t\t\"callback\": function(attachment, r) { me.attachment_uploaded(attachment, r) },\n\t\t\t\"max_width\": me.frm.cscript ? me.frm.cscript.attachment_max_width : null,\n\t\t\t\"max_height\": me.frm.cscript ? me.frm.cscript.attachment_max_height : null\n\t\t});\n\t},\n\tget_args: function() {\n\t\treturn {\n\t\t\tfrom_form: 1,\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.docname,\n\t\t}\n\t},\n\tattachment_uploaded:  function(attachment, r) {\n\t\tthis.dialog && this.dialog.hide();\n\t\tthis.update_attachment(attachment, r.message.comment);\n\n\t\tif(this.fieldname) {\n\t\t\tthis.frm.set_value(this.fieldname, attachment.file_url);\n\t\t}\n\t},\n\tupdate_attachment: function(attachment, comment) {\n\t\tif(attachment.name) {\n\t\t\tthis.add_to_attachments(attachment);\n\t\t\tthis.refresh();\n\t\t\tif(comment) {\n\t\t\t\tthis.frm.get_docinfo().communications.push(comment);\n\t\t\t\tthis.frm.timeline.refresh();\n\t\t\t}\n\t\t}\n\t},\n\tadd_to_attachments: function (attachment) {\n\t\tvar form_attachments = this.get_attachments();\n\t\tfor(var i in form_attachments) {\n\t\t\t// prevent duplicate\n\t\t\tif(form_attachments[i][\"name\"] === attachment.name) return;\n\t\t}\n\t\tform_attachments.push(attachment);\n\t},\n\tremove_fileid: function(fileid) {\n\t\tvar attachments = this.get_attachments();\n\t\tvar new_attachments = [];\n\t\t$.each(attachments, function(i, attachment) {\n\t\t\tif(attachment.name!=fileid) {\n\t\t\t\tnew_attachments.push(attachment);\n\t\t\t}\n\t\t});\n\t\tthis.frm.get_docinfo().attachments = new_attachments;\n\t\tthis.refresh();\n\t}\n});\n\nfrappe.ui.get_upload_dialog = function(opts){\n\tvar dialog = new frappe.ui.Dialog({\n\t\ttitle: __('Upload Attachment'),\n\t\tno_focus: true,\n\t\tfields: [\n\t\t\t{\n\t\t\t\t\"fieldtype\": \"Section Break\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"fieldtype\": \"Link\" ,\n\t\t\t\t\"fieldname\": \"file\" ,\n\t\t\t\t\"label\": __(\"Select uploaded file\"),\n\t\t\t\t\"options\": \"File\",\n\t\t\t\tonchange: function() {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t'method': 'frappe.client.get_value',\n\t\t\t\t\t\t'args': {\n\t\t\t\t\t\t\t'doctype': 'File',\n\t\t\t\t\t\t\t'fieldname': ['file_url','file_name','is_private'],\n\t\t\t\t\t\t\t'filters': {\n\t\t\t\t\t\t\t\t'name': dialog.get_value(\"file\")\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r){\n\t\t\t\t\t\t\tif(!r.message) {\n\t\t\t\t\t\t\t\tdialog.$wrapper.find('[name=\"file_url\"]').val(\"\");\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdialog.$wrapper.find('[name=\"file_url\"]').val(r.message.file_url);\n\t\t\t\t\t\t\tdialog.$wrapper.find('.private-file input').prop('checked', r.message.is_private);\n\t\t\t\t\t\t\topts.args.filename = r.message.file_name;\n\t\t\t\t\t\t\topts.args.is_private = r.message.is_private;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"hidden\": !opts.args.doctype || !frappe.boot.gsuite_enabled,\n\t\t\t\t\"fieldtype\": \"Section Break\",\n\t\t\t\t\"label\": __(\"GSuite Document\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"fieldtype\": \"Link\" ,\n\t\t\t\t\"fieldname\": \"gs_template\" ,\n\t\t\t\t\"label\": __(\"Select template\"),\n\t\t\t\t\"options\": \"GSuite Templates\",\n\t\t\t\t\"reqd\" : false,\n\t\t\t\t\"filters\": {\n\t\t\t\t\t'related_doctype': opts.args.doctype\n\t\t\t\t},\n\t\t\t\tonchange: function(){\n\t\t\t\t\topts.args.gs_template = this.get_value();\n\t\t\t\t}\n\t\t\t},\n\t\t],\n\t});\n\n\n\n\n\tvar btn = dialog.set_primary_action(__(\"Attach\"));\n\tbtn.removeClass(\"btn-primary\").addClass(\"btn-default\");\n\n\tdialog.show();\n\tvar upload_area = $('<div></div>').prependTo(dialog.body);\n\n\t\n\n\tfrappe.upload.make({\n\t\tparent: upload_area,\n\t\targs: opts.args,\n\t\tcallback: function(attachment, r) {\n\t\t\tdialog.hide();\n\t\t\tif(opts.callback){\n\t\t\t\topts.callback(attachment, r);\n\t\t\t}\n\t\t},\n\t\ton_select: function() {\n\t\t\tbtn.removeClass(\"btn-default\").addClass(\"btn-primary\");\n\t\t},\n\t\tonerror: function() {\n\t\t\tdialog.hide();\n\t\t},\n\t\tbtn: btn,\n\t\tmax_width: opts.max_width,\n\t\tmax_height: opts.max_height,\n\t});\n\n\treturn dialog;\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.timeline');\n\nfrappe.ui.form.Timeline = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t},\n\tmake: function() {\n\t\tvar me = this;\n\t\tthis.wrapper = $(frappe.render_template(\"timeline\",\n\t\t\t{doctype: this.frm.doctype})).appendTo(this.parent);\n\n\t\tthis.list = this.wrapper.find(\".timeline-items\");\n\n\t\tthis.comment_area = new frappe.ui.CommentArea({\n\t\t\tparent: this.wrapper.find('.timeline-head'),\n\t\t\tmentions: this.get_usernames_for_mentions(),\n\t\t\ton_submit: (val) => {\n\t\t\t\tval && this.insert_comment(\n\t\t\t\t\t\"Comment\", val, this.comment_area.button);\n\t\t\t}\n\t\t});\n\n\t\tthis.setup_editing_area();\n\n\t\tthis.setup_email_button();\n\n\t\tthis.list.on(\"click\", \".toggle-blockquote\", function() {\n\t\t\t$(this).parent().siblings(\"blockquote\").toggleClass(\"hidden\");\n\t\t});\n\n\t\tthis.setup_comment_like();\n\n\t\tthis.list.on(\"click\", \".btn-more\", function() {\n\t\t\tvar communications = me.get_communications();\n\t\t\tfrappe.call({\n\t\t\t\tbtn: this,\n\t\t\t\tmethod: \"frappe.desk.form.load.get_communications\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\tstart: communications.length\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\tvar new_communications = r.message;\n\t\t\t\t\t\t\tvar communications = me.get_communications().concat(new_communications);\n\t\t\t\t\t\t\tfrappe.model.set_docinfo(me.frm.doc.doctype, me.frm.doc.name, \"communications\", communications);\n\n\t\t\t\t\t\t\tif (new_communications.length < 20) {\n\t\t\t\t\t\t\t\tme.more = false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.more = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t},\n\n\tsetup_email_button: function() {\n\t\tvar me = this;\n\t\tvar selector = this.frm.doctype === \"Communication\"? \".btn-reply-email\": \".btn-new-email\"\n\t\tthis.email_button = this.wrapper.find(selector)\n\t\t\t.on(\"click\", function() {\n\t\t\t\tvar args = {\n\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\tfrm: me.frm,\n\t\t\t\t\trecipients: me.get_recipient()\n\t\t\t\t}\n\n\t\t\t\tif(me.frm.doctype === \"Communication\") {\n\t\t\t\t\t$.extend(args, {\n\t\t\t\t\t\ttxt: \"\",\n\t\t\t\t\t\tlast_email: me.frm.doc,\n\t\t\t\t\t\trecipients: me.frm.doc.sender,\n\t\t\t\t\t\tsubject: __(\"Re: {0}\", [me.frm.doc.subject]),\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t$.extend(args, {\n\t\t\t\t\t\ttxt: frappe.markdown(me.comment_area.val())\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tnew frappe.views.CommunicationComposer(args)\n\t\t\t});\n\t},\n\n\tsetup_editing_area: function() {\n\t\tthis.$editing_area = $('<div class=\"timeline-editing-area\">');\n\n\t\tthis.editing_area = new frappe.ui.CommentArea({\n\t\t\tparent: this.$editing_area,\n\t\t\tmentions: this.get_usernames_for_mentions(),\n\t\t\tno_wrapper: true\n\t\t});\n\n\t\tthis.editing_area.destroy();\n\t},\n\n\trefresh: function(scroll_to_end) {\n\t\tvar me = this;\n\n\t\tthis.last_type = \"Comment\";\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.wrapper.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.wrapper.toggle(true);\n\t\tthis.list.empty();\n\t\tthis.comment_area.val('');\n\n\t\tvar communications = this.get_communications(true);\n\n\t\tcommunications\n\t\t\t.sort((a, b) => a.creation > b.creation ? -1 : 1)\n\t\t\t.filter(c => c.content)\n\t\t\t.forEach(c => {\n\t\t\t\tc.frm = me.frm;\n\t\t\t\tme.render_timeline_item(c);\n\t\t\t});\n\n\t\t// more btn\n\t\tif (this.more===undefined && communications.length===20) {\n\t\t\tthis.more = true;\n\t\t}\n\n\t\tif (this.more) {\n\t\t\t$('<div class=\"timeline-item\">\\\n\t\t\t\t<button class=\"btn btn-default btn-xs btn-more\">More</button>\\\n\t\t\t</div>').appendTo(me.list);\n\t\t}\n\n\t\t// created\n\t\tme.render_timeline_item({\n\t\t\tcontent: __(\"created\"),\n\t\t\tcomment_type: \"Created\",\n\t\t\tcommunication_type: \"Comment\",\n\t\t\tsender: this.frm.doc.owner,\n\t\t\tcommunication_date: this.frm.doc.creation,\n\t\t\tcreation: this.frm.doc.creation,\n\t\t\tfrm: this.frm\n\t\t});\n\n\t\tthis.wrapper.find(\".is-email\").prop(\"checked\", this.last_type===\"Email\").change();\n\n\t\tthis.frm.sidebar.refresh_comments();\n\n\t\tthis.frm.trigger('timeline_refresh');\n\t},\n\n\trender_timeline_item: function(c) {\n\t\tvar me = this;\n\t\tthis.prepare_timeline_item(c);\n\t\tvar $timeline_item = $(frappe.render_template(\"timeline_item\", {data:c, frm:this.frm}))\n\t\t\t.appendTo(me.list)\n\t\t\t.on(\"click\", \".delete-comment\", function() {\n\t\t\t\tvar name = $timeline_item.data('name');\n\t\t\t\tme.delete_comment(name);\n\t\t\t\treturn false;\n\t\t\t})\n\t\t\t.on('click', '.edit-comment', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tvar name = $timeline_item.data('name');\n\n\t\t\t\tif($timeline_item.hasClass('is-editing')) {\n\t\t\t\t\tme.editing_area.submit();\n\t\t\t\t\tme.$editing_area.detach();\n\t\t\t\t} else {\n\t\t\t\t\tvar $edit_btn = $(this);\n\t\t\t\t\tvar content = $timeline_item.find('.timeline-item-content').html();\n\n\t\t\t\t\t$edit_btn\n\t\t\t\t\t\t.text(\"Save\")\n\t\t\t\t\t\t.find('i')\n\t\t\t\t\t\t.removeClass('octicon-pencil')\n\t\t\t\t\t\t.addClass('octicon-check');\n\n\t\t\t\t\tme.editing_area.setup_summernote();\n\t\t\t\t\tme.editing_area.val(content);\n\t\t\t\t\tme.editing_area.on_submit = (value) => {\n\t\t\t\t\t\tme.editing_area.destroy();\n\t\t\t\t\t\tvalue = value.trim();\n\t\t\t\t\t\t// set content to new val so that on save and refresh the new content is shown\n\t\t\t\t\t\tc.content = value;\n\t\t\t\t\t\tfrappe.timeline.update_communication(c);\n\t\t\t\t\t\tme.update_comment(name, value);\n\t\t\t\t\t\t// all changes to the timeline_item for editing are reset after calling refresh\n\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t};\n\n\t\t\t\t\t$timeline_item\n\t\t\t\t\t\t.find('.timeline-item-content')\n\t\t\t\t\t\t.hide();\n\t\t\t\t\t$timeline_item\n\t\t\t\t\t\t.find('.timeline-content-show')\n\t\t\t\t\t\t.append(me.$editing_area);\n\t\t\t\t\t$timeline_item\n\t\t\t\t\t\t.addClass('is-editing');\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\n\n\t\tif(c.communication_type==\"Communication\" && c.communication_medium===\"Email\") {\n\t\t\tthis.last_type = c.communication_medium;\n\t\t\tthis.add_reply_btn_event($timeline_item, c);\n\t\t}\n\n\t},\n\n\tadd_reply_btn_event: function($timeline_item, c) {\n\t\tvar me = this;\n\t\t$timeline_item.find(\".reply-link\").on(\"click\", function() {\n\t\t\tvar name = $(this).attr(\"data-name\");\n\t\t\tvar last_email = null;\n\n\t\t\t// find the email tor reply to\n\t\t\tme.get_communications().forEach(function(c) {\n\t\t\t\tif(c.name==name) {\n\t\t\t\t\tlast_email = c;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// make the composer\n\t\t\tnew frappe.views.CommunicationComposer({\n\t\t\t\tdoc: me.frm.doc,\n\t\t\t\ttxt: \"\",\n\t\t\t\ttitle: __('Reply'),\n\t\t\t\tfrm: me.frm,\n\t\t\t\tlast_email: last_email\n\t\t\t});\n\t\t});\n\t},\n\n\tprepare_timeline_item: function(c) {\n\t\tif(!c.sender) c.sender = c.owner;\n\n\t\tif(c.sender && c.sender.indexOf(\"<\")!==-1) {\n\t\t\tc.sender = c.sender.split(\"<\")[1].split(\">\")[0];\n\t\t}\n\n\t\tc.user_info = frappe.user_info(c.sender);\n\n\t\tc[\"delete\"] = \"\";\n\t\tc[\"edit\"] = \"\";\n\t\tif(c.communication_type==\"Comment\" && (c.comment_type || \"Comment\") === \"Comment\") {\n\t\t\tif(frappe.model.can_delete(\"Communication\")) {\n\t\t\t\tc[\"delete\"] = '<a class=\"close delete-comment\" title=\"Delete\"  href=\"#\"><i class=\"octicon octicon-x\"></i></a>';\n\t\t\t}\n\n\t\t\tif(frappe.user.name == c.sender || (frappe.user.name == 'Administrator')) {\n\t\t\t\tc[\"edit\"] = '<a class=\"edit-comment text-muted\" title=\"Edit\" href=\"#\">Edit</a>';\n\t\t\t}\n\t\t}\n\t\tc.comment_on_small = comment_when(c.creation, true);\n\t\tc.comment_on = comment_when(c.creation);\n\t\tif(!c.fullname) {\n\t\t\tc.fullname = c.sender_full_name || frappe.user.full_name(c.sender);\n\t\t}\n\n\t\tif(c.attachments && typeof c.attachments===\"string\")\n\t\t\tc.attachments = JSON.parse(c.attachments);\n\n\t\tif(c.communication_type==\"Comment\" && !c.comment_type) {\n\t\t\tc.comment_type = \"Comment\";\n\t\t}\n\n\t\tthis.set_icon_and_color(c);\n\n\t\t// label view\n\t\tif(c.comment_type===\"Workflow\" || c.comment_type===\"Label\") {\n\t\t\tc.comment_html = repl('<span class=\"label label-%(style)s\">%(text)s</span>', {\n\t\t\t\tstyle: frappe.utils.guess_style(c.content),\n\t\t\t\ttext: __(c.content)\n\t\t\t});\n\t\t} else {\n\t\t\tif(c.communication_type==\"Communication\" && c.communication_medium==\"Email\") {\n\t\t\t\tc.content = c.content.split(\"<!-- original-reply -->\")[0];\n\t\t\t\tc.content = frappe.utils.strip_original_content(c.content);\n\n\t\t\t\tc.original_content = c.content;\n\t\t\t\tc.content = frappe.utils.toggle_blockquote(c.content);\n\t\t\t} else if (c.communication_type===\"Feedback\") {\n\t\t\t\tc.content = frappe.utils.strip_original_content(c.content);\n\n\t\t\t\tc.original_content = c.content;\n\t\t\t\tc.content = frappe.utils.toggle_blockquote(c.content);\n\t\t\t}\n\n\t\t\tif(!frappe.utils.is_html(c.content)) {\n\t\t\t\tc.content_html = frappe.markdown(__(c.content));\n\t\t\t} else {\n\t\t\t\tc.content_html = c.content;\n\t\t\t\tc.content_html = frappe.utils.strip_whitespace(c.content_html);\n\t\t\t\tc.content_html = c.content_html.replace(/&lt;/g,\"<\").replace(/&gt;/g,\">\");\n\t\t\t}\n\n\t\t\t// bold @mentions\n\t\t\tif(c.comment_type===\"Comment\" &&\n\t\t\t\t// avoid adding <b> tag a 2nd time\n\t\t\t\t!c.content_html.match(/(^|\\W)<b>(@\\w+)<\\/b>/)\n\t\t\t) {\n\t\t\t\tc.content_html = c.content_html.replace(/(^|\\W)(@\\w+)/g, \"$1<b>$2</b>\");\n\t\t\t}\n\n\t\t\tif (this.is_communication_or_comment(c)) {\n\t\t\t\tc.user_content = true;\n\t\t\t\tif (!$.isArray(c._liked_by)) {\n\t\t\t\t\tc._liked_by = JSON.parse(c._liked_by || \"[]\");\n\t\t\t\t}\n\n\t\t\t\tc.liked_by_user = c._liked_by.indexOf(frappe.session.user)!==-1;\n\t\t\t}\n\t\t}\n\n\t\t// basic level of XSS protection\n\t\tc.content_html = frappe.dom.remove_script_and_style(c.content_html);\n\n\t\t// subject\n\t\tc.show_subject = false;\n\t\tif(c.subject && c.communication_type===\"Communication\") {\n\t\t\tif(this.frm.doc.subject && !this.frm.doc.subject.includes(c.subject)) {\n\t\t\t\tc.show_subject = true;\n\t\t\t} else if(this.frm.meta.title_field && this.frm.doc[this.frm.meta.title_field]\n\t\t\t\t&& !!this.frm.doc[this.frm.meta.title_field].includes(c.subject)) {\n\t\t\t\tc.show_subject = true;\n\t\t\t} else if(!this.frm.doc.name.includes(c.subject)) {\n\t\t\t\tc.show_subject = true;\n\t\t\t}\n\t\t}\n\t},\n\n\tis_communication_or_comment: function(c) {\n\t\treturn c.communication_type===\"Communication\"\n\t\t|| c.communication_type===\"Feedback\"\n\t\t|| (c.communication_type===\"Comment\" && (c.comment_type===\"Comment\"||c.comment_type===\"Relinked\"));\n\t},\n\n\tset_icon_and_color: function(c) {\n\t\tif(c.communication_type == \"Feedback\"){\n\t\t\tc.icon = \"octicon octicon-comment-discussion\"\n\t\t\tc.rating_icons = frappe.render_template(\"rating_icons\", {rating: c.rating, show_label: true})\n\t\t\tc.color = \"#f39c12\"\n\t\t} else {\n\t\t\tc.icon = {\n\t\t\t\t\"Email\": \"octicon octicon-mail\",\n\t\t\t\t\"Chat\": \"octicon octicon-comment-discussion\",\n\t\t\t\t\"Phone\": \"octicon octicon-device-mobile\",\n\t\t\t\t\"SMS\": \"octicon octicon-comment\",\n\t\t\t\t\"Created\": \"octicon octicon-plus\",\n\t\t\t\t\"Submitted\": \"octicon octicon-lock\",\n\t\t\t\t\"Cancelled\": \"octicon octicon-x\",\n\t\t\t\t\"Assigned\": \"octicon octicon-person\",\n\t\t\t\t\"Assignment Completed\": \"octicon octicon-check\",\n\t\t\t\t\"Comment\": \"octicon octicon-comment-discussion\",\n\t\t\t\t\"Workflow\": \"octicon octicon-git-branch\",\n\t\t\t\t\"Label\": \"octicon octicon-tag\",\n\t\t\t\t\"Attachment\": \"octicon octicon-cloud-upload\",\n\t\t\t\t\"Attachment Removed\": \"octicon octicon-trashcan\",\n\t\t\t\t\"Shared\": \"octicon octicon-eye\",\n\t\t\t\t\"Unshared\": \"octicon octicon-circle-slash\",\n\t\t\t\t\"Like\": \"octicon octicon-heart\",\n\t\t\t\t\"Edit\": \"octicon octicon-pencil\",\n\t\t\t\t\"Relinked\": \"octicon octicon-check\",\n\t\t\t\t\"Reply\": \"octicon octicon-mail-reply\"\n\t\t\t}[c.comment_type || c.communication_medium]\n\n\t\t\tc.color = {\n\t\t\t\t\"Email\": \"#3498db\",\n\t\t\t\t\"Chat\": \"#3498db\",\n\t\t\t\t\"Phone\": \"#3498db\",\n\t\t\t\t\"SMS\": \"#3498db\",\n\t\t\t\t\"Created\": \"#1abc9c\",\n\t\t\t\t\"Submitted\": \"#1abc9c\",\n\t\t\t\t\"Cancelled\": \"#c0392b\",\n\t\t\t\t\"Assigned\": \"#f39c12\",\n\t\t\t\t\"Assignment Completed\": \"#16a085\",\n\t\t\t\t\"Comment\": \"#f39c12\",\n\t\t\t\t\"Workflow\": \"#2c3e50\",\n\t\t\t\t\"Label\": \"#2c3e50\",\n\t\t\t\t\"Attachment\": \"#7f8c8d\",\n\t\t\t\t\"Attachment Removed\": \"#eee\",\n\t\t\t\t\"Relinked\": \"#16a085\",\n\t\t\t\t\"Reply\": \"#8d99a6\"\n\t\t\t}[c.comment_type || c.communication_medium];\n\n\t\t\tc.icon_fg = {\n\t\t\t\t\"Attachment Removed\": \"#333\",\n\t\t\t}[c.comment_type || c.communication_medium]\n\n\t\t}\n\t\tif(!c.icon_fg)\n\t\t\tc.icon_fg = \"#fff\";\n\t},\n\tget_communications: function(with_versions) {\n\t\tvar docinfo = this.frm.get_docinfo(),\n\t\t\tme = this,\n\t\t\tout = [].concat(docinfo.communications);\n\n\t\tif(with_versions) {\n\t\t\tthis.build_version_comments(docinfo, out);\n\t\t}\n\t\treturn out;\n\t},\n\tbuild_version_comments: function(docinfo, out) {\n\t\tvar me = this;\n\n\t\tdocinfo.versions.forEach(function(version) {\n\t\t\tif(!version.data) return;\n\t\t\tvar data = JSON.parse(version.data);\n\n\t\t\t// comment\n\t\t\tif(data.comment) {\n\t\t\t\tout.push(me.get_version_comment(version, data.comment, data.comment_type));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// value changed in parent\n\t\t\tif(data.changed && data.changed.length) {\n\t\t\t\tvar parts = [];\n\t\t\t\tdata.changed.every(function(p) {\n\t\t\t\t\tif(p[0]==='docstatus') {\n\t\t\t\t\t\tif(p[2]==1) {\n\t\t\t\t\t\t\tout.push(me.get_version_comment(version, __('submitted this document')));\n\t\t\t\t\t\t} else if (p[2]==2) {\n\t\t\t\t\t\t\tout.push(me.get_version_comment(version, __('cancelled this document')));\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tvar df = frappe.meta.get_docfield(me.frm.doctype, p[0], me.frm.docname);\n\n\t\t\t\t\t\tif(df && !df.hidden) {\n\t\t\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(df, null,\n\t\t\t\t\t\t\t\tme.frm.perm);\n\t\t\t\t\t\t\tif(field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\t\t\tparts.push(__('{0} from {1} to {2}', [\n\t\t\t\t\t\t\t\t\t__(df.label),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[1], 40) || '\"\"').bold(),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[2], 40) || '\"\"').bold()\n\t\t\t\t\t\t\t\t]));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn parts.length < 3;\n\t\t\t\t});\n\t\t\t\tif(parts.length) {\n\t\t\t\t\tout.push(me.get_version_comment(version, __(\"changed value of {0}\", [parts.join(', ')])));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// value changed in table field\n\t\t\tif(data.row_changed && data.row_changed.length) {\n\t\t\t\tvar parts = [], count = 0;\n\t\t\t\tdata.row_changed.every(function(row) {\n\t\t\t\t\trow[3].every(function(p) {\n\t\t\t\t\t\tvar df = me.frm.fields_dict[row[0]] &&\n\t\t\t\t\t\t\tfrappe.meta.get_docfield(me.frm.fields_dict[row[0]].grid.doctype,\n\t\t\t\t\t\t\t\tp[0], me.frm.docname);\n\n\t\t\t\t\t\tif(df && !df.hidden) {\n\t\t\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(df,\n\t\t\t\t\t\t\t\tnull, me.frm.perm);\n\n\t\t\t\t\t\t\tif(field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\t\t\tparts.push(__('{0} from {1} to {2} in row #{3}', [\n\t\t\t\t\t\t\t\t\tfrappe.meta.get_label(me.frm.fields_dict[row[0]].grid.doctype,\n\t\t\t\t\t\t\t\t\t\tp[0]),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[2], 40) || '\"\"').bold(),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[1], 40) || '\"\"').bold(),\n\t\t\t\t\t\t\t\t\trow[1]\n\t\t\t\t\t\t\t\t]));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn parts.length < 3;\n\t\t\t\t\t});\n\t\t\t\t\treturn parts.length < 3;\n\t\t\t\t});\n\t\t\t\tif(parts.length) {\n\t\t\t\t\tout.push(me.get_version_comment(version, __(\"changed values for {0}\",\n\t\t\t\t\t\t[parts.join(', ')])));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// rows added / removed\n\t\t\t// __('added'), __('removed') # for translation, don't remove\n\t\t\t['added', 'removed'].forEach(function(key) {\n\t\t\t\tif(data[key] && data[key].length) {\n\t\t\t\t\tparts = (data[key] || []).map(function(p) {\n\t\t\t\t\t\tvar df = frappe.meta.get_docfield(me.frm.doctype, p[0], me.frm.docname);\n\t\t\t\t\t\tif(df && !df.hidden) {\n\t\t\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(df, null,\n\t\t\t\t\t\t\t\tme.frm.perm);\n\n\t\t\t\t\t\t\tif(field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\t\t\treturn frappe.meta.get_label(me.frm.doctype, p[0])\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tparts = parts.filter(function(p) { return p; });\n\t\t\t\t\tif(parts.length) {\n\t\t\t\t\t\tout.push(me.get_version_comment(version, __(\"{0} rows for {1}\",\n\t\t\t\t\t\t\t[__(key), parts.join(', ')])));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\tget_version_comment: function(version, text, comment_type) {\n\t\tif(!comment_type) {\n\t\t\ttext = '<a href=\"#Form/Version/'+version.name+'\">' + text + '</a>';\n\t\t}\n\t\treturn {\n\t\t\tcomment_type: comment_type || 'Edit',\n\t\t\tcreation: version.creation,\n\t\t\towner: version.owner,\n\t\t\tversion_name: version.name,\n\t\t\tsender: version.owner,\n\t\t\tcomment_by: version.owner,\n\t\t\tcontent: text\n\t\t};\n\t},\n\n\tinsert_comment: function(comment_type, comment, btn) {\n\t\tvar me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: \"frappe.desk.form.utils.add_comment\",\n\t\t\targs: {\n\t\t\t\tdoc:{\n\t\t\t\t\tdoctype: \"Communication\",\n\t\t\t\t\tcommunication_type: \"Comment\",\n\t\t\t\t\tcomment_type: comment_type || \"Comment\",\n\t\t\t\t\treference_doctype: this.frm.doctype,\n\t\t\t\t\treference_name: this.frm.docname,\n\t\t\t\t\tcontent: comment,\n\t\t\t\t\tsender: frappe.session.user\n\t\t\t\t}\n\t\t\t},\n\t\t\tbtn: btn,\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tme.comment_area.val('');\n\t\t\t\t\tfrappe.utils.play_sound(\"click\");\n\n\t\t\t\t\tvar comment = r.message;\n\t\t\t\t\tvar comments = me.get_communications();\n\t\t\t\t\tvar comment_exists = false;\n\t\t\t\t\tfor (var i=0, l=comments.length; i<l; i++) {\n\t\t\t\t\t\tif (comments[i].name==comment.name) {\n\t\t\t\t\t\t\tcomment_exists = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (comment_exists) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tme.frm.get_docinfo().communications = comments.concat([r.message]);\n\t\t\t\t\tme.refresh(true);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t},\n\n\tdelete_comment: function(name) {\n\t\tvar me = this;\n\n\t\tfrappe.confirm(__('Delete comment?'), function() {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: \"frappe.client.delete\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Communication\",\n\t\t\t\t\tname: name\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tfrappe.utils.play_sound(\"delete\");\n\n\t\t\t\t\t\tme.frm.get_docinfo().communications =\n\t\t\t\t\t\t\t$.map(me.frm.get_docinfo().communications,\n\t\t\t\t\t\t\t\tfunction(v) {\n\t\t\t\t\t\t\t\t\tif(v.name==name) return null;\n\t\t\t\t\t\t\t\t\telse return v;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tme.refresh(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Update comment\n\t *\n\t * @param {string} name\n\t * @param {string} content\n\t *\n\t * @returns {boolean}\n\t */\n\tupdate_comment: function(name, content)\n\t{\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.desk.form.utils.update_comment',\n\t\t\targs: { name, content },\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tfrappe.utils.play_sound('click');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\tget_recipient: function() {\n\t\tif(this.frm.email_field) {\n\t\t\treturn this.frm.doc[this.frm.email_field];\n\t\t} else {\n\t\t\treturn this.frm.doc.email_id || this.frm.doc.email || \"\";\n\t\t}\n\t},\n\n\tget_last_email: function(from_recipient) {\n\t\tvar last_email = null,\n\t\t\tcommunications = this.frm.get_docinfo().communications,\n\t\t\temail = this.get_recipient();\n\n\t\t$.each(communications && communications.sort(function(a, b) { return a.creation > b.creation ? -1 : 1 }), function(i, c) {\n\t\t\tif(c.communication_type=='Communication' && c.communication_medium==\"Email\") {\n\t\t\t\tif(from_recipient) {\n\t\t\t\t\tif(c.sender.indexOf(email)!==-1) {\n\t\t\t\t\t\tlast_email = c;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlast_email = c;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn last_email;\n\t},\n\n\tget_usernames_for_mentions: function() {\n\t\tvar valid_users = Object.keys(frappe.boot.user_info)\n\t\t\t.filter(user => ![\"Administrator\", \"Guest\"].includes(user));\n\n\t\treturn valid_users.map(user => frappe.boot.user_info[user].username || frappe.boot.user_info[user].name);\n\t},\n\n\tsetup_comment_like: function() {\n\t\tthis.wrapper.on(\"click\", \".comment-likes .octicon-heart\", frappe.ui.click_toggle_like);\n\n\t\tfrappe.ui.setup_like_popover(this.wrapper, \".comment-likes\");\n\t}\n});\n\n$.extend(frappe.timeline, {\n\tnew_communication: function(communication) {\n\t\tvar docinfo = frappe.model.get_docinfo(communication.reference_doctype, communication.reference_name);\n\t\tif (docinfo && docinfo.communications) {\n\t\t\tvar communications = docinfo.communications;\n\t\t\tvar communication_exists = false;\n\t\t\tfor (var i=0, l=communications.length; i<l; i++) {\n\t\t\t\tif (communications[i].name==communication.name) {\n\t\t\t\t\tcommunication_exists = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!communication_exists) {\n\t\t\t\tdocinfo.communications = communications.concat([communication]);\n\t\t\t}\n\t\t}\n\n\t\tif (cur_frm.doctype === communication.reference_doctype && cur_frm.docname === communication.reference_name) {\n\t\t\tcur_frm.timeline && cur_frm.timeline.refresh();\n\t\t}\n\t},\n\n\tdelete_communication: function(communication) {\n\t\tvar docinfo = frappe.model.get_docinfo(communication.reference_doctype, communication.reference_name);\n\t\tvar index = frappe.timeline.index_of_communication(communication, docinfo);\n\t\tif (index !== -1) {\n\t\t\t// remove it from communications list\n\t\t\tdocinfo.communications.splice(index, 1);\n\t\t}\n\n\t\tif (cur_frm.doctype === communication.reference_doctype && cur_frm.docname === communication.reference_name) {\n\t\t\tcur_frm.timeline && cur_frm.timeline.refresh();\n\t\t}\n\t},\n\n\tupdate_communication: function(communication) {\n\t\tvar docinfo = frappe.model.get_docinfo(communication.reference_doctype, communication.reference_name);\n\t\tvar index = frappe.timeline.index_of_communication(communication, docinfo);\n\n\t\tif (index !== -1) {\n\t\t\t// update\n\t\t\t$.extend(docinfo.communications[index], communication);\n\t\t}\n\n\t\tif (cur_frm.doctype === communication.reference_doctype && cur_frm.docname === communication.reference_name) {\n\t\t\tcur_frm.timeline && cur_frm.timeline.refresh();\n\t\t}\n\t},\n\n\tindex_of_communication: function(communication, docinfo) {\n\t\tvar index = -1;\n\n\t\tif (docinfo && docinfo.communications) {\n\t\t\tvar communications = docinfo.communications;\n\n\t\t\tfor (var i=0, l=communications.length; i<l; i++) {\n\t\t\t\tif (communications[i].name==communication.name) {\n\t\t\t\t\tindex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn index;\n\t}\n})\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.AssignTo = Class.extend({\n\tinit: function(opts) {\n\t\tvar me = this;\n\n\t\t$.extend(this, opts);\n\t\tthis.btn = this.parent.find(\".add-assignment\").on(\"click\", function() { me.add(); });\n\t\tthis.btn_wrapper = this.btn.parent();\n\n\t\tthis.refresh();\n\t},\n\trefresh: function() {\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.parent.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.parent.toggle(true);\n\t\tthis.render(this.frm.get_docinfo().assignments);\n\t},\n\trender: function(d) {\n\t\tvar me = this;\n\t\tthis.frm.get_docinfo().assignments = d;\n\t\tthis.parent.find(\".assignment-row\").remove();\n\n\t\tif(me.primary_action) {\n\t\t\tme.primary_action.remove();\n\t\t\tme.primary_action = null;\n\t\t}\n\n\t\tif(this.dialog) {\n\t\t\tthis.dialog.hide();\n\t\t}\n\n\t\tif(d && d.length) {\n\t\t\tfor(var i=0; i<d.length; i++) {\n\t\t\t\tvar info = frappe.user_info(d[i].owner);\n\t\t\t\tinfo.assign_to_name = d[i].name\n\t\t\t\tinfo.owner = d[i].owner;\n\t\t\t\tinfo.avatar = frappe.avatar(d[i].owner);\n\t\t\t\tinfo.description = d[i].description || \"\";\n\n\t\t\t\tinfo._fullname = info.fullname;\n\t\t\t\tif(info.fullname.length > 10) {\n\t\t\t\t\tinfo._fullname = info.fullname.substr(0, 10) + '...';\n\t\t\t\t}\n\n\t\t\t\t$(repl('<li class=\"assignment-row\">\\\n\t\t\t\t\t<a class=\"close\" data-owner=\"%(owner)s\">&times;</a>\\\n\t\t\t\t\t%(avatar)s\\\n\t\t\t\t\t<span><a href=\"#Form/ToDo/%(assign_to_name)s\">%(_fullname)s</a></span>\\\n\t\t\t\t</li>', info))\n\t\t\t\t\t.insertBefore(this.parent.find('.add-assignment'));\n\n\t\t\t\tif(d[i].owner===frappe.session.user) {\n\t\t\t\t\tme.primary_action = this.frm.page.add_menu_item(__(\"Assignment Complete\"), function() {\n\t\t\t\t\t\tme.remove(frappe.session.user);\n\t\t\t\t\t}, \"fa fa-check\", \"btn-success\")\n\t\t\t\t}\n\n\t\t\t\tif(!(d[i].owner === frappe.session.user || me.frm.perm[0].write)) {\n\t\t\t\t\tme.parent.find('a.close').remove();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// set remove\n\t\t\tthis.parent.find('a.close').click(function() {\n\t\t\t\tme.remove($(this).attr('data-owner'));\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\t//this.btn_wrapper.addClass(\"hide\");\n\t\t} else {\n\t\t\t//this.btn_wrapper.removeClass(\"hide\");\n\t\t}\n\t},\n\tadd: function() {\n\t\tvar me = this;\n\n\t\tif(this.frm.is_new()) {\n\t\t\tfrappe.throw(__(\"Please save the document before assignment\"));\n\t\t\treturn;\n\t\t}\n\n\t\tif(!me.dialog) {\n\t\t\tme.dialog = new frappe.ui.form.AssignToDialog({\n\t\t\t\tobj: me,\n\t\t\t\tmethod: 'frappe.desk.form.assign_to.add',\n\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\tdocname: me.frm.docname,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.render(r.message);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tme.dialog.clear();\n\n\t\tif(me.frm.meta.title_field) {\n\t\t\tme.dialog.set_value(\"description\", me.frm.doc[me.frm.meta.title_field])\n\t\t}\n\n\t\tme.dialog.show();\n\t},\n\tremove: function(owner) {\n\t\tvar me = this;\n\n\t\tif(this.frm.is_new()) {\n\t\t\tfrappe.throw(__(\"Please save the document before removing assignment\"));\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.call({\n\t\t\tmethod:'frappe.desk.form.assign_to.remove',\n\t\t\targs: {\n\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\tname: me.frm.docname,\n\t\t\t\tassign_to: owner\n\t\t\t},\n\t\t\tcallback:function(r,rt) {\n\t\t\t\tme.render(r.message);\n\t\t\t}\n\t\t});\n\t}\n});\n\n\nfrappe.ui.form.AssignToDialog = Class.extend({\n\tinit: function(opts){\n\t\tvar me = this\n\t\t$.extend(me, new frappe.ui.Dialog({\n\t\t\ttitle: __('Add to To Do'),\n\t\t\tfields: [\n\t\t\t\t{fieldtype: 'Link', fieldname:'assign_to', options:'User',\n\t\t\t\t\tlabel:__(\"Assign To\"), reqd:true, filters: {'user_type': 'System User'}},\n\t\t\t\t{fieldtype:'Check', fieldname:'myself', label:__(\"Assign to me\"), \"default\":0},\n\t\t\t\t{fieldtype:'Small Text', fieldname:'description', label:__(\"Comment\")},\n\t\t\t\t{fieldtype: 'Section Break'},\n\t\t\t\t{fieldtype: 'Column Break'},\n\t\t\t\t{fieldtype:'Date', fieldname:'date', label: __(\"Complete By\")},\n\t\t\t\t{fieldtype:'Check', fieldname:'notify',\n\t\t\t\t\tlabel:__(\"Notify by Email\")},\n\t\t\t\t{fieldtype: 'Column Break'},\n\t\t\t\t{fieldtype:'Select', fieldname:'priority', label: __(\"Priority\"),\n\t\t\t\t\toptions:[\n\t\t\t\t\t\t{value:'Low', label:__('Low')},\n\t\t\t\t\t\t{value:'Medium', label:__('Medium')},\n\t\t\t\t\t\t{value:'High', label:__('High')}],\n\t\t\t\t\t'default':'Medium'},\n\t\t\t],\n\t\t\tprimary_action: function() { frappe.ui.add_assignment(opts, me) },\n\t\t\tprimary_action_label: __(\"Add\")\n\t\t}));\n\n\t\tme.fields_dict.assign_to.get_query = \"frappe.core.doctype.user.user.user_query\";\n\n\t\tvar myself = me.get_input(\"myself\").on(\"click\", function() {\n\t\t\tme.toggle_myself(this);\n\t\t});\n\t\tme.toggle_myself(myself);\n\t},\n\ttoggle_myself: function(myself) {\n\t\tvar me = this;\n\t\tif($(myself).prop(\"checked\")) {\n\t\t\tme.set_value(\"assign_to\", frappe.session.user);\n\t\t\tme.set_value(\"notify\", 0);\n\t\t\tme.get_field(\"notify\").$wrapper.toggle(false);\n\t\t\tme.get_field(\"assign_to\").$wrapper.toggle(false);\n\t\t} else {\n\t\t\tme.set_value(\"assign_to\", \"\");\n\t\t\tme.set_value(\"notify\", 1);\n\t\t\tme.get_field(\"notify\").$wrapper.toggle(true);\n\t\t\tme.get_field(\"assign_to\").$wrapper.toggle(true);\n\t\t}\n\t},\n\n});\n\nfrappe.ui.add_assignment = function(opts, dialog) {\n\tvar assign_to = dialog.fields_dict.assign_to.get_value();\n\tvar args = dialog.get_values();\n\tif(args && assign_to) {\n\t\treturn frappe.call({\n\t\t\tmethod: opts.method,\n\t\t\targs: $.extend(args, {\n\t\t\t\tdoctype: opts.doctype,\n\t\t\t\tname: opts.docname,\n\t\t\t\tassign_to: assign_to,\n\t\t\t\tbulk_assign:  opts.bulk_assign || false,\n\t\t\t\tre_assign: opts.re_assign || false\n\t\t\t}),\n\t\t\tcallback: function(r,rt) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tif(opts.callback){\n\t\t\t\t\t\topts.callback(r);\n\t\t\t\t\t}\n\t\t\t\t\tdialog && dialog.hide();\n\t\t\t\t}\n\t\t\t},\n\t\t\tbtn: this\n\t\t});\n\t}\n}\n","frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.make_quick_entry = (doctype, after_insert, init_callback, doc) => {\n\tvar trimmed_doctype = doctype.replace(/ /g, '');\n\tvar controller_name = \"QuickEntryForm\";\n\n\tif(frappe.ui.form[trimmed_doctype + \"QuickEntryForm\"]){\n\t\tcontroller_name = trimmed_doctype + \"QuickEntryForm\";\n\t}\n\n\tfrappe.quick_entry = new frappe.ui.form[controller_name](doctype, after_insert, init_callback, doc);\n\treturn frappe.quick_entry.setup();\n};\n\nfrappe.ui.form.QuickEntryForm = Class.extend({\n\tinit: function(doctype, after_insert, init_callback, doc) {\n\t\tthis.doctype = doctype;\n\t\tthis.after_insert = after_insert;\n\t\tthis.init_callback = init_callback;\n\t\tthis.doc = doc;\n\t},\n\n\tsetup: function() {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.model.with_doctype(this.doctype, function() {\n\t\t\t\tme.set_meta_and_mandatory_fields();\n\t\t\t\tif(me.is_quick_entry()) {\n\t\t\t\t\tme.render_dialog();\n\t\t\t\t\tresolve(me);\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.quick_entry = null;\n\t\t\t\t\tfrappe.set_route('Form', me.doctype, me.doc.name)\n\t\t\t\t\t\t.then(() => resolve(me));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tset_meta_and_mandatory_fields: function(){\n\t\t// prepare a list of mandatory and bold fields\n\t\tthis.mandatory = $.map(frappe.get_meta(this.doctype).fields,\n\t\t\tfunction(d) { return (d.reqd || d.bold && !d.read_only) ? $.extend({}, d) : null; });\n\t\tthis.meta = frappe.get_meta(this.doctype);\n\t\tif (!this.doc) {\n\t\t\tthis.doc = frappe.model.get_new_doc(this.doctype, null, null, true);\n\t\t}\n\t},\n\n\tis_quick_entry: function(){\n\t\tif(this.meta.quick_entry != 1) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.validate_for_prompt_autoname();\n\n\t\tif (this.too_many_mandatory_fields() || this.has_child_table()\n\t\t\t|| !this.mandatory.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\ttoo_many_mandatory_fields: function(){\n\t\tif(this.mandatory.length > 7) {\n\t\t\t// too many fields, show form\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\thas_child_table: function(){\n\t\tif($.map(this.mandatory, function(d) {\n\t\t\treturn d.fieldtype==='Table' ? d : null; }).length) {\n\t\t\t// has mandatory table, quit!\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\tvalidate_for_prompt_autoname: function(){\n\t\tif(this.meta.autoname && this.meta.autoname.toLowerCase()==='prompt') {\n\t\t\tthis.mandatory = [{fieldname:'__newname', label:__('{0} Name', [this.meta.name]),\n\t\t\t\treqd: 1, fieldtype:'Data'}].concat(this.mandatory);\n\t\t}\n\t},\n\n\trender_dialog: function(){\n\t\tvar me = this;\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"New {0}\", [__(this.doctype)]),\n\t\t\tfields: this.mandatory,\n\t\t});\n\t\tthis.dialog.doc = this.doc;\n\n\t\tthis.register_primary_action();\n\t\tthis.render_edit_in_full_page_link();\n\t\t// ctrl+enter to save\n\t\tthis.dialog.wrapper.keydown(function(e) {\n\t\t\tif((e.ctrlKey || e.metaKey) && e.which==13) {\n\t\t\t\tif(!frappe.request.ajax_count) {\n\t\t\t\t\t// not already working -- double entry\n\t\t\t\t\tme.dialog.get_primary_btn().trigger(\"click\");\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.dialog.onhide = () => frappe.quick_entry = null;\n\t\tthis.dialog.show();\n\t\tthis.dialog.refresh_dependency();\n\t\tthis.set_defaults();\n\n\t\tif (this.init_callback) {\n\t\t\tthis.init_callback(this.dialog);\n\t\t}\n\t},\n\n\tregister_primary_action: function(){\n\t\tvar me = this;\n\t\tthis.dialog.set_primary_action(__('Save'), function() {\n\t\t\tif(me.dialog.working) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar data = me.dialog.get_values();\n\n\t\t\tif(data) {\n\t\t\t\tme.dialog.working = true;\n\t\t\t\tme.insert();\n\t\t\t}\n\t\t});\n\t},\n\n\tinsert: function() {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tme.update_doc();\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.insert\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: me.dialog.doc\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t// delete the old doc\n\t\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\t\tif(frappe._from_link) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif(me.after_insert) {\n\t\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function() {\n\t\t\t\t\tme.open_doc();\n\t\t\t\t},\n\t\t\t\talways: function() {\n\t\t\t\t\tme.dialog.working = false;\n\t\t\t\t\tresolve(me.dialog.doc);\n\t\t\t\t},\n\t\t\t\tfreeze: true\n\t\t\t});\n\t\t});\n\t},\n\n\topen_form_if_not_list: function() {\n\t\tlet route = frappe.get_route();\n\t\tlet doc = this.dialog.doc;\n\t\tif (route && !(route[0]==='List' && route[1]===doc.doctype)) {\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => frappe.set_route('Form', doc.doctype, doc.name)\n\t\t\t]);\n\t\t}\n\t},\n\n\tupdate_doc: function(){\n\t\tvar me = this;\n\t\tvar data = this.dialog.get_values(true);\n\t\t$.each(data, function(key, value) {\n\t\t\tif(key==='__newname') {\n\t\t\t\tme.dialog.doc.name = value;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif(!is_null(value)) {\n\t\t\t\t\tme.dialog.doc[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn this.dialog.doc;\n\t},\n\n\topen_doc: function(){\n\t\tthis.dialog.hide();\n\t\tthis.update_doc();\n\t\tfrappe.set_route('Form', this.doctype, this.doc.name);\n\t},\n\n\trender_edit_in_full_page_link: function(){\n\t\tvar me = this;\n\t\tvar $link = $('<div style=\"padding-left: 7px; padding-top: 15px; padding-bottom: 10px;\">' +\n\t\t\t'<button class=\"edit-full btn-default btn-sm\">' + __(\"Edit in full page\") + '</button></div>').appendTo(this.dialog.body);\n\n\t\t$link.find('.edit-full').on('click', function() {\n\t\t\t// edit in form\n\t\t\tme.open_doc();\n\t\t});\n\t},\n\n\tset_defaults: function(){\n\t\tvar me = this;\n\t\t// set defaults\n\t\t$.each(this.dialog.fields_dict, function(fieldname, field) {\n\t\t\tfield.doctype = me.doc.doctype;\n\t\t\tfield.docname = me.doc.name;\n\n\t\t\tif(!is_null(me.doc[fieldname])) {\n\t\t\t\tfield.set_input(me.doc[fieldname]);\n\t\t\t}\n\t\t});\n\t}\n});\n"],"names":["frappe","provide","views","FormFactory","Factory","extend","make","route","me","this","dt","formview","show_doc","model","with_doctype","page","container","add_page","frm","_f","Frm","initialized","$","document","on","ui","form","close_grid_form","realtime","data","timeline","new_communication","delete_communication","update_communication","set_viewers","dn","slice","join","new_names","set_route","with_doc","r","locals","load","new_str","__","substr","length","new_name","make_new_doc_and_get_name","show_not_found","change_to","refresh","Controller","Class","init","opts","frms","doctype","parent","in_form","docname","hidden","refresh_if_stale_for","opendocs","custom_buttons","sections","grids","cscript","events","pformat","fetch_dict","tinymce_id_list","setup_meta","event","old_name","rename_notify","prototype","check_doctype_conflict","msgprint","pages","window","location","reload","DocType","setup","fields","fields_dict","state_fieldname","workflow","get_state_fieldname","wrapper","$wrapper","make_app_page","single_column","meta","hide_toolbar","layout_main","main","get","toolbar","Toolbar","setup_print_layout","setup_std_layout","script_manager","ScriptManager","watch_model_updates","footer","Footer","appendTo","attr","setup_drag_drop","setup_done","e","dataTransfer","originalEvent","files","stopPropagation","preventDefault","doc","__islocal","attachments","max_reached","upload","args","get_args","callback","attachment","attachment_uploaded","print_preview","PrintPreview","set_primary_action","print_doc","is","hide_print","can_print","refresh_print_options","trigger","set_view","set_user_lang","set_default_print_language","preview","current_view_name","previous_view_name","fieldname","value","name","dirty","layout","refresh_dependency","table_fields","get_children","fieldtype","each","i","df","options","parentfield","grid","set_value","form_wrapper","body","section_style","Layout","with_dashboard","fields_list","document_flow","DocumentFlow","dashboard","Dashboard","states","States","email_doc","message","CommunicationComposer","subject","recipients","email","email_id","contact_email","attach_document_print","real_name","contact_display","contact_name","rename_doc","share_doc","shared","show","old","istable","docfield_copy","in_dialog","re_route","hash","encodeURIComponent","get_doc","perm","get_perm","refresh_header","is_a_different_doc","utils","set_title","issingle","current_status","undefined","is_submittable","submit","is_dirty","is_new","docstatus","add_comment","clear_custom_buttons","show_web_link","__onload","is_website_generator","web_link","remove","published","add_web_link","path","label","sidebar","add_user_action","check_doc_perm","parent_doctype","read","scroll_to","forEach","grid_obj","visible_columns","cur_frm","show_not_permitted","read_only","is_read_only","set_read_only","__unsaved","__last_sync_on","Date","reload_doc","is_onload","render_form","localname","setnewdoc","show_print_first","removeClass","toggleClass","show_if_needs_refresh","__needs_refresh","clear_headline","set_headline_alert","attach_doc_and_docfields","Sidebar","show_message","refresh_fields","timeout","then","after_refresh","first","find","in_list","focus","show_empty_form_message","scroll_to_element","refresh_field","fname","primary_button","cleanup_refresh","amended_from","unhide_field","hide_field","trash_reason","autoname","fn","toggle_display","after_ajax","trigger_link_fields","breadcrumbs","add","module","track_seen","addClass","__run_link_triggers","field","runscript","scriptname","callingfield","onrefresh","input","set_working","call","method","docs","btn","$input","exc","copy_doc","onload","from_amend","validate_form_action","newdoc","idx","remove_from_locals","validated","Object","defineProperty","console","warn","set","save","save_action","on_error","let","Promise","resolve","prop","activeElement","blur","setTimeout","_save","after_save","indexOf","play_sound","fail","run_serially","catch","savesubmit","handle_fail","confirm","savecancel","savetrash","delete_doc","history","back","amend_doc","amendment_date","datetime","obj_to_str","alert","disable_save","save_disabled","clear_primary_action","enable_save","save_or_update","get_docinfo","docinfo","reload_docinfo","assign_to","permlevel","access_type","set_intro","txt","append","set_footnote","footnote_area","add_custom_button","group","add_inner_button","clear_inner_toolbar","clear_user_actions","remove_custom_button","remove_inner_button","add_fetch","link_field","src_field","tar_field","columns","push","set_print_heading","action_perm_type_map","Create","Save","Submit","Update","Cancel","Amend","Delete","action","perm_to_check","allowed_for_workflow","perms","throw","has_perm","ptype","route_options","selector","key","repl","get_server_fields","arg","table_field","allow_edit","call_back","dom","freeze","isPlainObject","JSON","stringify","$c","unfreeze","d","field_dict","set_multiple","dict","refresh_many","flist","set_field_tip","n","get_docfield","description","comment_area","innerHTML","replace_newlines","log","filter_dict","docfields","grid_rows_by_docname","set_field_options","set_df_property","set_field_permlevel","level","toggle_field","get_field_obj","set_currency_labels","currency","field_label_map","grid_field_label_map","docfield","docfield_map","replace","trim","set_label","split","field_map","fnames","keys","l","fieldname1","fieldname2","property","toggle_enable","enable","toggle_reqd","mandatory","reqd","call_server","$c_obj","get_files","sort","get_attachments","set_query","opt1","opt2","get_field","get_query","set_value_if_missing","clear_table","add_child","values","unique_keys","map","includes","if_missing","_set","f","v","fieldobj","has_value","isArray","j","child","tasks","original_callback","get_server_module_name","std_field_list","concat","std_fields_list","docperms","print","cancel","get_formatted","format","no_icon","open_grid_row","get_open_grid_form","get_title","title_field","get_selected","selected","get_table_fields","_selected","has_mapper","_has_mapper","__js","search","set_indicator_formatter","get_color","get_text","every","formatter","color","can_create","custom_make_buttons","const","can_make_methods","make_new","make_methods","new_doc","get_new_doc","get_meta","make_quick_entry","update_in_all_rows","table_fieldname","cl","get_sum","sum","add_update_button_on_dirty","setup_editable_title","make_menu","show_title_as_dirty","hide_menu","print_icon","show_menu","title","strip_html","set_title_sub","$title_area","is_title_editable","can_rename","set_indicator","write","allow_rename","prompt","default","get_dropdown_menu","add_dropdown","indicator","get_indicator","clear_indicator","clear_icons","clear_menu","p","cint","print_settings","allow_print_for_draft","allow_print_for_cancelled","add_menu_item","add_action_icon","can_email","show_linked_with","boot","user","allow_copy","add_to_desktop","can_delete","user_roles","doc_type","developer_mode","Feedback","manual_feedback_request","CREATE","can_save","get_docstatus","can_submit","has_workflow","can_update","can_cancel","can_amend","amend","_has_workflow","get_list","document_type","linked_with","LinkedWith","status","get_action_status","set_page_actions","clear_actions","set_secondary_action","click","icon","make_cancel_amend_button","CANCEL","AMEND","clear_actions_menu","section","_form_dashboard","render_template","progress_area","heatmap_area","chart_area","stats_area","stats_area_row","links_area","transactions_area","reset","empty","set_headline","html","text","alert_class","permanent","clear_comment","indicator_color","add_section","add_progress","percent","progress_chart","make_progress_chart","format_percent","progress","width","progress_class","init_data","transactions","render_links","set_open_count","heatmap","render_heatmap","graph","setup_graph","__dashboard","internal_links","filter_permissions","items","can_read","data_rendered","open_document_list","$link","show_open","names","get_document_filter","notifications","show_open_count_list","filter","non_standard_fieldnames","item","type","timeline_data","update_heatmap","count","set_badge_count","open_count","link","link_fieldname","dashboard_data","update","Chart","scrub","height","start","moment","subtract","toDate","count_label","discreteDomains","css","margin","heatmap_message","add_indicator","colspan","indicators","n_indicators","graph_method","graph_method_args","render_graph","colors","chart","hide","doctypes","prependTo","render","get_linked_docs","mark_completed_flow","for_doctype","frm_doctype","frm_docname","workflow_state_fieldname","working_label","toTitle","freeze_message","remove_empty_rows","get_all_docs","is_table","cells","is_empty_row","docfield_list","in_list_view","clear_doc","check_mandatory","has_errors","scroll_set","error_fields","folded","unfold","parenttype","bold","scrollTop","offset","top","_call","is_saving","remove_old_form_route","error","always","update_calling_link","workflow_state","index","current_route","get_route","route_history","arr","splice","_from_link","grid_rows","_from_link_scrollY","get_event_handler_list","handlers","on_change","handler","add_handler","off","ControllerClass","event_name","get_handlers","selected_doc","runner","_function","is_old_style","_promise","after_server_call","new_style","old_style","has_handlers","cs","tmp","eval","__custom_js","stack","setup_add_fetch","parts","get_docfields","__css","set_style","log_error","caller","show_alert","trace","groupEnd","copy_from_first_row","current_row","fieldnames","open_form","hide_form","editable_row","toggle_editable_row","Grid","fieldinfo","fields_map","template","multiple_set","__form_grid_templates","is_grid","allow_on_grid_editing","is_xs","editable_grid","form_grid","add_new_row","set_focus_on_row","grid_buttons","remove_rows_button","setup_allow_bulk_edit","setup_check","on_setup","$check","parents","checked","row","__checked","select","refresh_remove_rows_button","deleted_docs","select_row","remove_all","get_selected_children","make_head","header_row","GridRow","parent_df","force","$rows","get_data","setup_fields","display_status","get_field_display_status","_scroll_y","truncate_rows","ri","grid_row","setup_toolbar","is_sortable","sortable_setup_done","make_sortable","last_display_status","last_docname","is_editable","toggle","cannot_add_rows","refresh_row","Sortable","handle","draggable","onUpdate","newIndex","get_modal_data","a","b","set_column_disp","set_editable_grid_column_disp","columns_list","column","static_area","field_area","get_row","get_grid_row","__unedited","toggle_view","setup_visible_columns","total_colsize","editable_fields","ci","_df","layout_fields","colsize","passes","static_rows","sortable_status","only_sortable","set_multiple_add","qty","LinkSelector","qty_fieldname","target","allow_bulk_edit","setup_download","flags","no_socketio","csv_to_array","get_string","upload_file","blank_row","user_to_str","unscrub","is_value_type","sysdefaults","date_format","str_to_user","tools","downloadify","on_grid_fields_dict","on_grid_fields","row_check_html","hasClass","render_row","set_data","set_row_index","refresh_check","get_open_form","findIndex","insert","below","grid_form","row_display","row_index","get_format_helper","setup_columns","add_open_form_button","make_editable","is_too_small","in_place_edit","open_form_button","margin-right","focus_set","make_column","add_class","$col","out","col","column_index","activate","make_control","only_input","with_link_btn","set_arrow_keys","keyCode","TAB","UP_ARROW","DOWN_ARROW","which","move_up_down","base","shiftKey","open_row","show_form","GridRowForm","cur_grid","is_element_in_viewport","open_prev","open_next","get_visible_columns","blacklist","set_field_property","set_property","refresh_sections","toggle_editable","editable","make_form","form_area","no_submit_on_enter","fi","toggle_add_delete_button_display","set_focus","set_form_events","$parent","dialog","make_dialog","Dialog","hide_on_page_refresh","on_page_show","get_linked_doctypes","load_doctypes","links_not_permitted_or_missing","make_html","linked_docs","__linked_docs","linked_doctypes","make_doc_head","make_doc_row","already_loaded","doctypes_to_load","__linked_doctypes","promises","listview_settings","add_fields","all","flag","links","can_get_report","reject","linkinfo","heading","update_fields","get_update_fields","bind","setup_help","add_action_item","state","get_state","workflows","next_html","get_transitions","allowed","get_document_state","padding","set_default_state","show_actions","added","doc_before_action","copy_dict","next_state","get_next_state","new_state","new_docstatus","doc_status","update_field","update_value","add_to_locals","success","insert_comment","btn_primary","default_state","get_default_state","bind_action","dropdown","bind_events","add_view","has_role","print_formats","get_print_formats","print_letterhead","print_sel","with_letterhead","multilingual_preview","language_sel","lang_code","val","print_old_style","printit","new_page_preview_old_style","new_page_preview","open","urllib","get_full_url","selected_format","print_format","get_print_format","print_format_builder","print_format_name","language","add_options","get_languages","default_print_language","lang","preview_old_style","get_print_html","show_footer","style","display","flex-direction","no_letterhead","_lang","with_old_style","only_body","no_heading","require","_p","build","go","default_print_format","print_format_type","print_css","get_print_settings","pdf","letter_head","default_letter_head","defaults","get_default","depends_on","letter_heads","with_letter_head","sidebar_content","ratings","comments","user_actions","image_section","image_wrapper","make_assignments","make_attachments","make_shared","make_viewers","make_tags","make_like","setup_user_image_event","like_icon","toggle_like","refresh_like","viewers","tags","_user_tags","full_name","modified_by","comment_when","modified","owner","creation","setup_ratings","set_user_image","refresh_comments","get_communications","c","communication_type","comment_type","total_comments","TagEditor","user_tags","Attachments","AssignTo","Share","Viewers","like_wrapper","like_count","setup_like_popover","_liked_by","is_liked","parse","refresh_image","_ratings","rating","rating_icons","show_label","image_field","image","title_image","cordova","base_url","background-color","get_palette","get_abbr","make_input","render_sidebar","users","s","everyone","avatar_class","user_info","fullname","abbr","render_shared","onhide","can_share","make_user_input","add_share_button","set_edit_share_events","share_with","filters","user_type","session","render_input","get_value","share","notify","permission_to","found","get_viewers","data_updated","new_users","current","username","new","comma_and","past_viewers","past","new_viewers","viewer","set_docinfo","make_comments","Timeline","new_attachment","add_attachment_wrapper","attachments_label","max_attachments","add_attachment","file_name","file_url","get_file_url","fileid","$close","lock_icon","is_private","insertAfter","remove_btn","remove_attachment","can_write","encodeURI","get_file_id_from_file_url","fid","remove_attachment_by_filename","filename","rt","_server_messages","remove_fileid","communications","get_upload_dialog","max_width","attachment_max_width","max_height","attachment_max_height","from_form","update_attachment","comment","add_to_attachments","form_attachments","new_attachments","no_focus","onchange","gsuite_enabled","related_doctype","gs_template","upload_area","on_select","onerror","list","CommentArea","mentions","get_usernames_for_mentions","on_submit","button","setup_editing_area","setup_email_button","siblings","setup_comment_like","new_communications","more","email_button","get_recipient","last_email","sender","markdown","$editing_area","editing_area","no_wrapper","destroy","scroll_to_end","last_type","content","render_timeline_item","communication_date","change","prepare_timeline_item","$timeline_item","delete_comment","detach","$edit_btn","setup_summernote","update_comment","communication_medium","add_reply_btn_event","comment_on_small","comment_on","sender_full_name","set_icon_and_color","comment_html","guess_style","strip_original_content","original_content","toggle_blockquote","is_html","content_html","strip_whitespace","match","is_communication_or_comment","user_content","liked_by_user","remove_script_and_style","show_subject","Email","Chat","Phone","SMS","Created","Submitted","Cancelled","Assigned","Assignment Completed","Comment","Workflow","Label","Attachment","Attachment Removed","Shared","Unshared","Like","Edit","Relinked","Reply","icon_fg","with_versions","build_version_comments","versions","version","get_version_comment","changed","field_display_status","ellipsis","row_changed","get_label","version_name","comment_by","reference_doctype","reference_name","comment_exists","email_field","get_last_email","from_recipient","click_toggle_like","communication","communication_exists","index_of_communication","btn_wrapper","assignments","primary_action","info","assign_to_name","avatar","_fullname","insertBefore","AssignToDialog","obj","clear","add_assignment","primary_action_label","myself","get_input","toggle_myself","get_values","bulk_assign","re_assign","after_insert","init_callback","trimmed_doctype","controller_name","quick_entry","QuickEntryForm","set_meta_and_mandatory_fields","is_quick_entry","render_dialog","validate_for_prompt_autoname","too_many_mandatory_fields","has_child_table","toLowerCase","register_primary_action","render_edit_in_full_page_link","keydown","ctrlKey","metaKey","request","ajax_count","get_primary_btn","set_defaults","working","update_doc","open_form_if_not_list","open_doc","is_null","set_input"],"mappings":"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"}