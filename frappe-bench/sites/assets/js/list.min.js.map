{"version":3,"file":"list.min.js","sources":["../../../apps/frappe/frappe/public/js/frappe/model/indicator.js","../../../apps/frappe/frappe/public/js/frappe/ui/filters/filter.js","../../../apps/frappe/frappe/public/js/frappe/ui/filters/filter_list.js","../../../apps/frappe/frappe/public/js/frappe/ui/filters/field_select.js","../../../apps/frappe/frappe/public/js/frappe/ui/tags.js","../../../apps/frappe/frappe/public/js/frappe/ui/tag_editor.js","../../../apps/frappe/frappe/public/js/frappe/ui/like.js","../../../apps/frappe/frappe/public/js/frappe/list/base_list.js","../../../apps/frappe/frappe/public/js/frappe/list/bulk_operations.js","../../../apps/frappe/frappe/public/js/frappe/list/list_view.js","../../../apps/frappe/frappe/public/js/frappe/list/list_factory.js","../../../apps/frappe/frappe/public/js/frappe/list/list_filter.js","../../../apps/frappe/frappe/public/js/frappe/list/list_sidebar.js","../../../apps/frappe/frappe/public/js/frappe/views/gantt/gantt_view.js","../../../apps/frappe/frappe/public/js/frappe/views/calendar/calendar.js","../../../apps/frappe/frappe/public/js/frappe/views/image/image_view.js","../../../apps/frappe/frappe/public/js/frappe/views/kanban/kanban_view.js","../../../apps/frappe/frappe/public/js/frappe/views/inbox/inbox_view.js","../../../apps/frappe/frappe/public/js/frappe/views/file/file_view.js","../../../apps/frappe/frappe/public/js/frappe/views/treeview.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n\nfrappe.has_indicator = function(doctype) {\n\t// returns true if indicator is present\n\tif(frappe.model.is_submittable(doctype)) {\n\t\treturn true;\n\t} else if((frappe.listview_settings[doctype] || {}).get_indicator\n\t\t|| frappe.workflow.get_state_fieldname(doctype)) {\n\t\treturn true;\n\t} else if(frappe.meta.has_field(doctype, 'enabled')\n\t\t|| frappe.meta.has_field(doctype, 'disabled')) {\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nfrappe.get_indicator = function(doc, doctype) {\n\tif(doc.__unsaved) {\n\t\treturn [__(\"Not Saved\"), \"orange\"];\n\t}\n\n\tif(!doctype) doctype = doc.doctype;\n\n\tvar workflow = frappe.workflow.workflows[doctype];\n\tvar without_workflow = workflow ? workflow['override_status'] : true;\n\n\tvar settings = frappe.listview_settings[doctype] || {};\n\n\tvar is_submittable = frappe.model.is_submittable(doctype),\n\t\tworkflow_fieldname = frappe.workflow.get_state_fieldname(doctype);\n\n\t// workflow\n\tif(workflow_fieldname && !without_workflow) {\n\t\tvar value = doc[workflow_fieldname];\n\t\tif(value) {\n\t\t\tvar colour = \"\";\n\n\t\t\tif(locals[\"Workflow State\"][value] && locals[\"Workflow State\"][value].style) {\n\t\t\t\tvar colour = {\n\t\t\t\t\t\"Success\": \"green\",\n\t\t\t\t\t\"Warning\": \"orange\",\n\t\t\t\t\t\"Danger\": \"red\",\n\t\t\t\t\t\"Primary\": \"blue\",\n\t\t\t\t}[locals[\"Workflow State\"][value].style];\n\t\t\t}\n\t\t\tif(!colour) colour = \"darkgrey\";\n\n\t\t\treturn [__(value), colour, workflow_fieldname + ',=,' + value];\n\t\t}\n\t}\n\n\t// draft if document is submittable\n\tif(is_submittable && doc.docstatus==0 && !settings.has_indicator_for_draft) {\n\t\treturn [__(\"Draft\"), \"red\", \"docstatus,=,0\"];\n\t}\n\n\t// cancelled\n\tif(is_submittable && doc.docstatus==2) {\n\t\treturn [__(\"Cancelled\"), \"red\", \"docstatus,=,2\"];\n\t}\n\n\tif(settings.get_indicator) {\n\t\tvar indicator = settings.get_indicator(doc);\n\t\tif(indicator) return indicator;\n\t}\n\n\t// if submittable\n\tif(is_submittable && doc.docstatus==1) {\n\t\treturn [__(\"Submitted\"), \"blue\", \"docstatus,=,1\"];\n\t}\n\n\t// based on status\n\tif(doc.status) {\n\t\treturn [__(doc.status), frappe.utils.guess_colour(doc.status)];\n\t}\n\n\t// based on enabled\n\tif(frappe.meta.has_field(doctype, 'enabled')) {\n\t\tif(doc.enabled) {\n\t\t\treturn [__('Enabled'), 'blue', 'enabled,=,1'];\n\t\t} else {\n\t\t\treturn [__('Disabled'), 'grey', 'enabled,=,0'];\n\t\t}\n\t}\n\n\t// based on disabled\n\tif(frappe.meta.has_field(doctype, 'disabled')) {\n\t\tif(doc.disabled) {\n\t\t\treturn [__('Disabled'), 'grey', 'disabled,=,1'];\n\t\t} else {\n\t\t\treturn [__('Enabled'), 'blue', 'disabled,=,0'];\n\t\t}\n\t}\n}\n","frappe.ui.Filter = class {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tif (this.value === null || this.value === undefined) {\n\t\t\tthis.value = '';\n\t\t}\n\n\t\tthis.utils = frappe.ui.filter_utils;\n\t\tthis.conditions = [\n\t\t\t[\"=\", __(\"Equals\")],\n\t\t\t[\"!=\", __(\"Not Equals\")],\n\t\t\t[\"like\", __(\"Like\")],\n\t\t\t[\"not like\", __(\"Not Like\")],\n\t\t\t[\"in\", __(\"In\")],\n\t\t\t[\"not in\", __(\"Not In\")],\n\t\t\t[\">\", \">\"],\n\t\t\t[\"<\", \"<\"],\n\t\t\t[\">=\", \">=\"],\n\t\t\t[\"<=\", \"<=\"],\n\t\t\t[\"Between\", __(\"Between\")]\n\t\t];\n\t\tthis.invalid_condition_map = {\n\t\t\tDate: ['like', 'not like'],\n\t\t\tDatetime: ['like', 'not like'],\n\t\t\tData: ['Between'],\n\t\t\tSelect: [\"Between\", \"<=\", \">=\", \"<\", \">\"],\n\t\t\tLink: [\"Between\"],\n\t\t\tCurrency: [\"Between\"],\n\t\t\tColor: [\"Between\"]\n\t\t};\n\t\tthis.make();\n\t\tthis.make_select();\n\t\tthis.set_events();\n\t\tthis.setup();\n\t}\n\n\tmake() {\n\t\tthis.filter_edit_area = $(frappe.render_template(\"edit_filter\", {}))\n\t\t\t.appendTo(this.parent.find('.filter-edit-area'));\n\t}\n\n\tmake_select() {\n\t\tthis.fieldselect = new frappe.ui.FieldSelect({\n\t\t\tparent: this.filter_edit_area.find('.fieldname-select-area'),\n\t\t\tdoctype: this.parent_doctype,\n\t\t\tfilter_fields: this.filter_fields,\n\t\t\tselect: (doctype, fieldname) => {\n\t\t\t\tthis.set_field(doctype, fieldname);\n\t\t\t},\n\t\t\tfilter_options: (doctype, fieldname) => {\n\t\t\t\treturn this.filter_items(doctype, fieldname);\n\t\t\t}\n\t\t});\n\n\t\tif(this.fieldname) {\n\t\t\tthis.fieldselect.set_value(this.doctype, this.fieldname);\n\t\t}\n\t}\n\n\tset_events() {\n\t\tthis.filter_edit_area.find(\"a.remove-filter\").on(\"click\", () => {\n\t\t\tthis.remove();\n\t\t});\n\n\t\tthis.filter_edit_area.find(\".set-filter-and-run\").on(\"click\", () => {\n\t\t\tthis.filter_edit_area.removeClass(\"new-filter\");\n\t\t\tthis.on_change();\n\t\t\tthis.update_filter_tag();\n\t\t});\n\n\t\tthis.filter_edit_area.find('.condition').change(() => {\n\t\t\tif(!this.field) return;\n\n\t\t\tlet condition = this.get_condition();\n\t\t\tlet fieldtype = null;\n\n\t\t\tif([\"in\", \"like\", \"not in\", \"not like\"].includes(condition)) {\n\t\t\t\tfieldtype = 'Data';\n\t\t\t\tthis.add_condition_help(condition);\n\t\t\t}\n\n\t\t\tif (['Select', 'MultiSelect'].includes(this.field.df.fieldtype) && [\"in\", \"not in\"].includes(condition)) {\n\t\t\t\tfieldtype = 'MultiSelect';\n\t\t\t}\n\n\t\t\tthis.set_field(this.field.df.parent, this.field.df.fieldname, fieldtype, condition);\n\t\t});\n\t}\n\n\tsetup() {\n\t\tconst fieldname = this.fieldname || 'name';\n\t\t// set the field\n\t\treturn this.set_values(this.doctype, fieldname, this.condition, this.value);\n\t}\n\n\tsetup_state(is_new) {\n\t\tlet promise = Promise.resolve();\n\t\tif (is_new) {\n\t\t\tthis.filter_edit_area.addClass(\"new-filter\");\n\t\t} else {\n\t\t\tpromise = this.update_filter_tag();\n\t\t}\n\n\t\tif(this.hidden) {\n\t\t\tpromise.then(() => this.$filter_tag.hide());\n\t\t}\n\t}\n\n\tfreeze() {\n\t\tthis.update_filter_tag();\n\t}\n\n\tupdate_filter_tag() {\n\t\treturn this._filter_value_set.then(() => {\n\t\t\t!this.$filter_tag ? this.make_tag() : this.set_filter_button_text();\n\t\t\tthis.filter_edit_area.hide();\n\t\t});\n\t}\n\n\tremove() {\n\t\tthis.filter_edit_area.remove();\n\t\tthis.$filter_tag && this.$filter_tag.remove();\n\t\tthis.field = null;\n\t\tthis.on_change(true);\n\t}\n\n\tset_values(doctype, fieldname, condition, value) {\n\t\t// presents given (could be via tags!)\n\t\tthis.set_field(doctype, fieldname);\n\n\t\tif(this.field.df.original_type==='Check') {\n\t\t\tvalue = (value==1) ? 'Yes' : 'No';\n\t\t}\n\t\tif(condition) this.set_condition(condition, true);\n\n\t\t// set value can be asynchronous, so update_filter_tag should happen after field is set\n\t\tthis._filter_value_set = Promise.resolve();\n\n\t\tif (['in', 'not in'].includes(condition) && Array.isArray(value)) {\n\t\t\tvalue = value.join(',');\n\t\t}\n\n\t\tif(value) {\n\t\t\tthis._filter_value_set = this.field.set_value((value + '').trim());\n\t\t}\n\t\treturn this._filter_value_set;\n\t}\n\n\tset_field(doctype, fieldname, fieldtype, condition) {\n\t\t// set in fieldname (again)\n\t\tlet cur = {};\n\t\tif(this.field) for(let k in this.field.df) cur[k] = this.field.df[k];\n\n\t\tlet original_docfield = (this.fieldselect.fields_by_name[doctype] || {})[fieldname];\n\t\tif(!original_docfield) {\n\t\t\tfrappe.msgprint(__(\"Field {0} is not selectable.\", [fieldname]));\n\t\t\tthis.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tlet df = copy_dict(original_docfield);\n\n\t\t// filter field shouldn't be read only or hidden\n\t\tdf.read_only = 0; df.hidden = 0;\n\n\t\tlet c = condition ? condition : this.utils.get_default_condition(df);\n\t\tthis.set_condition(c);\n\n\t\tthis.utils.set_fieldtype(df, fieldtype, this.get_condition());\n\n\t\t// called when condition is changed,\n\t\t// don't change if all is well\n\t\tif(this.field && cur.fieldname == fieldname && df.fieldtype == cur.fieldtype &&\n\t\t\tdf.parent == cur.parent) {\n\t\t\treturn;\n\t\t}\n\n\t\t// clear field area and make field\n\t\tthis.fieldselect.selected_doctype = doctype;\n\t\tthis.fieldselect.selected_fieldname = fieldname;\n\n\t\tthis.make_field(df, cur.fieldtype);\n\t}\n\n\tmake_field(df, old_fieldtype) {\n\t\tlet old_text = this.field ? this.field.get_value() : null;\n\t\tthis.hide_invalid_conditions(df.fieldtype, df.original_type);\n\n\t\tlet field_area = this.filter_edit_area.find('.filter-field').empty().get(0);\n\t\tlet f = frappe.ui.form.make_control({\n\t\t\tdf: df,\n\t\t\tparent: field_area,\n\t\t\tonly_input: true,\n\t\t});\n\t\tf.refresh();\n\n\t\tthis.field = f;\n\t\tif(old_text && f.fieldtype===old_fieldtype) {\n\t\t\tthis.field.set_value(old_text);\n\t\t}\n\n\t\t// run on enter\n\t\t$(this.field.wrapper).find(':input').keydown(e => {\n\t\t\tif(e.which==13 && this.field.df.fieldtype !== 'MultiSelect') {\n\t\t\t\tthis.on_change();\n\t\t\t}\n\t\t});\n\t}\n\n\tget_value() {\n\t\treturn [\n\t\t\tthis.fieldselect.selected_doctype,\n\t\t\tthis.field.df.fieldname,\n\t\t\tthis.get_condition(),\n\t\t\tthis.get_selected_value(),\n\t\t\tthis.hidden\n\t\t];\n\t}\n\n\tget_selected_value() {\n\t\treturn this.utils.get_selected_value(this.field, this.get_condition());\n\t}\n\n\tget_condition() {\n\t\treturn this.filter_edit_area.find('.condition').val();\n\t}\n\n\tset_condition(condition, trigger_change=false) {\n\t\tlet $condition_field = this.filter_edit_area.find('.condition');\n\t\t$condition_field.val(condition);\n\t\tif(trigger_change) $condition_field.change();\n\t}\n\n\tmake_tag() {\n\t\tthis.$filter_tag = this.get_filter_tag_element()\n\t\t\t.insertAfter(this.parent.find(\".active-tag-filters .add-filter\"));\n\t\tthis.set_filter_button_text();\n\t\tthis.bind_tag();\n\t}\n\n\tbind_tag() {\n\t\tthis.$filter_tag.find(\".remove-filter\").on(\"click\", this.remove.bind(this));\n\n\t\tlet filter_button = this.$filter_tag.find(\".toggle-filter\");\n\t\tfilter_button.on(\"click\", () => {\n\t\t\tfilter_button.closest('.tag-filters-area').find('.filter-edit-area').show();\n\t\t\tthis.filter_edit_area.toggle();\n\t\t});\n\t}\n\n\tset_filter_button_text() {\n\t\tthis.$filter_tag.find(\".toggle-filter\").html(this.get_filter_button_text());\n\t}\n\n\tget_filter_button_text() {\n\t\tlet value = this.utils.get_formatted_value(this.field, this.get_selected_value());\n\t\treturn `${__(this.field.df.label)} ${__(this.get_condition())} ${__(value)}`;\n\t}\n\n\tget_filter_tag_element() {\n\t\treturn $(`<div class=\"filter-tag btn-group\">\n\t\t\t<button class=\"btn btn-default btn-xs toggle-filter\"\n\t\t\t\ttitle=\"${ __(\"Edit Filter\") }\">\n\t\t\t</button>\n\t\t\t<button class=\"btn btn-default btn-xs remove-filter\"\n\t\t\t\ttitle=\"${ __(\"Remove Filter\") }\">\n\t\t\t\t<i class=\"fa fa-remove text-muted\"></i>\n\t\t\t</button>\n\t\t</div>`);\n\t}\n\n\tadd_condition_help(condition) {\n\t\tlet $desc = this.field.desc_area;\n\t\tif(!$desc) {\n\t\t\t$desc = $('<div class=\"text-muted small\">').appendTo(this.field.wrapper);\n\t\t}\n\t\t// set description\n\t\t$desc.html((in_list([\"in\", \"not in\"], condition)===\"in\"\n\t\t\t? __(\"values separated by commas\")\n\t\t\t: __(\"use % as wildcard\"))+'</div>');\n\t}\n\n\thide_invalid_conditions(fieldtype, original_type) {\n\t\tlet invalid_conditions = this.invalid_condition_map[fieldtype] ||\n\t\t\tthis.invalid_condition_map[original_type] || [];\n\n\t\tfor (let condition of this.conditions) {\n\t\t\tthis.filter_edit_area.find(`.condition option[value=\"${condition[0]}\"]`).toggle(\n\t\t\t\t!invalid_conditions.includes(condition[0])\n\t\t\t);\n\t\t}\n\t}\n};\n\nfrappe.ui.filter_utils = {\n\tget_formatted_value(field, value) {\n\t\tif(field.df.fieldname===\"docstatus\") {\n\t\t\tvalue = {0:\"Draft\", 1:\"Submitted\", 2:\"Cancelled\"}[value] || value;\n\t\t} else if(field.df.original_type===\"Check\") {\n\t\t\tvalue = {0:\"No\", 1:\"Yes\"}[cint(value)];\n\t\t}\n\t\treturn frappe.format(value, field.df, {only_value: 1});\n\t},\n\n\tget_selected_value(field, condition) {\n\t\tlet val = field.get_value();\n\n\t\tif(typeof val==='string') {\n\t\t\tval = strip(val);\n\t\t}\n\n\t\tif(field.df.original_type == 'Check') {\n\t\t\tval = (val=='Yes' ? 1 :0);\n\t\t}\n\n\t\tif(condition.indexOf('like', 'not like')!==-1) {\n\t\t\t// automatically append wildcards\n\t\t\tif(val) {\n\t\t\t\tif(val.slice(0,1) !== \"%\") {\n\t\t\t\t\tval = \"%\" + val;\n\t\t\t\t}\n\t\t\t\tif(val.slice(-1) !== \"%\") {\n\t\t\t\t\tval = val + \"%\";\n\t\t\t\t}\n\t\t\t}\n\t\t} else if(in_list([\"in\", \"not in\"], condition)) {\n\t\t\tif(val) {\n\t\t\t\tval = val.split(',').map(v => strip(v));\n\t\t\t}\n\t\t} if(val === '%') {\n\t\t\tval = \"\";\n\t\t}\n\n\t\treturn val;\n\t},\n\n\tget_default_condition(df) {\n\t\tif (df.fieldtype == 'Data') {\n\t\t\treturn 'like';\n\t\t} else if (df.fieldtype == 'Date' || df.fieldtype == 'Datetime'){\n\t\t\treturn 'Between';\n\t\t} else {\n\t\t\treturn '=';\n\t\t}\n\t},\n\n\tset_fieldtype(df, fieldtype, condition) {\n\t\t// reset\n\t\tif(df.original_type)\n\t\t\tdf.fieldtype = df.original_type;\n\t\telse\n\t\t\tdf.original_type = df.fieldtype;\n\n\t\tdf.description = ''; df.reqd = 0;\n\t\tdf.ignore_link_validation = true;\n\n\t\t// given\n\t\tif(fieldtype) {\n\t\t\tdf.fieldtype = fieldtype;\n\t\t\treturn;\n\t\t}\n\n\t\t// scrub\n\t\tif(df.fieldname==\"docstatus\") {\n\t\t\tdf.fieldtype=\"Select\",\n\t\t\tdf.options=[\n\t\t\t\t{value:0, label:__(\"Draft\")},\n\t\t\t\t{value:1, label:__(\"Submitted\")},\n\t\t\t\t{value:2, label:__(\"Cancelled\")}\n\t\t\t];\n\t\t} else if(df.fieldtype=='Check') {\n\t\t\tdf.fieldtype='Select';\n\t\t\tdf.options='No\\nYes';\n\t\t} else if(['Text','Small Text','Text Editor','Code','Tag','Comments',\n\t\t\t'Dynamic Link','Read Only','Assign'].indexOf(df.fieldtype)!=-1) {\n\t\t\tdf.fieldtype = 'Data';\n\t\t} else if(df.fieldtype=='Link' && ['=', '!='].indexOf(condition)==-1) {\n\t\t\tdf.fieldtype = 'Data';\n\t\t}\n\t\tif(df.fieldtype===\"Data\" && (df.options || \"\").toLowerCase()===\"email\") {\n\t\t\tdf.options = null;\n\t\t}\n\t\tif(condition == \"Between\" && (df.fieldtype == 'Date' || df.fieldtype == 'Datetime')){\n\t\t\tdf.fieldtype = 'DateRange';\n\t\t}\n\t}\n};\n","frappe.ui.FilterGroup = class {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.wrapper = this.parent;\n\t\tthis.filters = [];\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tthis.wrapper.append(this.get_container_template());\n\t\tthis.set_events();\n\t}\n\n\tset_events() {\n\t\tthis.wrapper.find('.add-filter').on('click', () => {\n\t\t\tthis.add_filter(this.doctype, 'name');\n\t\t});\n\t}\n\n\tadd_filters(filters) {\n\t\tlet promises = [];\n\n\t\tfor (const filter of filters) {\n\t\t\tpromises.push(this.add_filter(...filter));\n\t\t}\n\n\t\treturn Promise.all(promises);\n\t}\n\n\tadd_filter(doctype, fieldname, condition, value, hidden) {\n\t\tif (!fieldname) return Promise.resolve();\n\t\t// adds a new filter, returns true if filter has been added\n\n\t\t// {}: Add in page filter by fieldname if exists ('=' => 'like')\n\n\t\tif(!this.validate_args(doctype, fieldname)) return false;\n\n\t\tconst is_new_filter = arguments.length < 2;\n\t\tif (is_new_filter && this.wrapper.find(\".new-filter:visible\").length) {\n\t\t\t// only allow 1 new filter at a time!\n\t\t\treturn Promise.resolve();\n\t\t} else {\n\t\t\tlet args = [doctype, fieldname, condition, value, hidden];\n\t\t\tconst promise = this.push_new_filter(args, is_new_filter);\n\t\t\treturn (promise && promise.then) ? promise : Promise.resolve();\n\t\t}\n\t}\n\n\tvalidate_args(doctype, fieldname) {\n\t\tif(doctype && fieldname\n\t\t\t&& !frappe.meta.has_field(doctype, fieldname)\n\t\t\t&& !frappe.model.std_fields_list.includes(fieldname)) {\n\n\t\t\tfrappe.throw(__(`Invalid filter: \"${[fieldname.bold()]}\"`));\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tpush_new_filter(args, is_new_filter=false) {\n\t\t// args: [doctype, fieldname, condition, value]\n\t\tif(this.filter_exists(args)) return;\n\n\t\t// {}: Clear page filter fieldname field\n\n\t\tlet filter = this._push_new_filter(...args);\n\n\t\tif (filter && filter.value) {\n\t\t\tfilter.setup_state(is_new_filter);\n\t\t\treturn filter._filter_value_set; // internal promise\n\t\t}\n\t}\n\n\t_push_new_filter(doctype, fieldname, condition, value, hidden = false) {\n\t\tlet args = {\n\t\t\tparent: this.wrapper,\n\t\t\tparent_doctype: this.doctype,\n\t\t\tdoctype: doctype,\n\t\t\tfieldname: fieldname,\n\t\t\tcondition: condition,\n\t\t\tvalue: value,\n\t\t\thidden: hidden,\n\t\t\ton_change: (update) => {\n\t\t\t\tif(update) this.update_filters();\n\t\t\t\tthis.on_change();\n\t\t\t},\n\t\t\tfilter_items: (doctype, fieldname) => {\n\t\t\t\treturn !this.filter_exists([doctype, fieldname]);\n\t\t\t}\n\t\t};\n\t\tlet filter = new frappe.ui.Filter(args);\n\t\tthis.filters.push(filter);\n\t\treturn filter;\n\t}\n\n\tfilter_exists(filter_value) {\n\t\t// filter_value of form: [doctype, fieldname, condition, value]\n\t\tlet exists = false;\n\t\tthis.filters.filter(f => f.field).map(f => {\n\t\t\tlet f_value = f.get_value();\n\t\t\tif (filter_value.length === 2) {\n\t\t\t\texists = filter_value[0] === f_value[0] && filter_value[1] === f_value[1];\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet value = filter_value[3];\n\t\t\tlet equal = frappe.utils.arrays_equal;\n\n\t\t\tif(equal(f_value.slice(0, 4), filter_value.slice(0, 4)) || (Array.isArray(value) && equal(value, f_value[3]))) {\n\t\t\t\texists = true;\n\t\t\t}\n\t\t});\n\t\treturn exists;\n\t}\n\n\tget_filters() {\n\t\treturn this.filters.filter(f => f.field).map(f => {\n\t\t\tf.freeze();\n\t\t\treturn f.get_value();\n\t\t});\n\t\t// {}: this.list.update_standard_filters(values);\n\t}\n\n\tupdate_filters() {\n\t\tthis.filters = this.filters.filter(f => f.field); // remove hidden filters\n\t}\n\n\tclear_filters() {\n\t\tthis.filters.map(f => f.remove(true));\n\t\t// {}: Clear page filters, .date-range-picker (called list run())\n\t\tthis.filters = [];\n\t}\n\n\tget_filter(fieldname) {\n\t\treturn this.filters.filter(f => {\n\t\t\treturn (f.field && f.field.df.fieldname==fieldname);\n\t\t})[0];\n\t}\n\n\tget_container_template() {\n\t\treturn $(`<div class=\"tag-filters-area\">\n\t\t\t<div class=\"active-tag-filters\">\n\t\t\t\t<button class=\"btn btn-default btn-xs add-filter text-muted\">\n\t\t\t\t\t\t${__(\"Add Filter\")}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"filter-edit-area\"></div>`);\n\t}\n};\n","// <select> widget with all fields of a doctype as options\nfrappe.ui.FieldSelect = Class.extend({\n\t// opts parent, doctype, filter_fields, with_blank, select\n\tinit(opts) {\n\t\tvar me = this;\n\t\t$.extend(this, opts);\n\t\tthis.fields_by_name = {};\n\t\tthis.options = [];\n\t\tthis.$input = $('<input class=\"form-control\">')\n\t\t\t.appendTo(this.parent)\n\t\t\t.on(\"click\", function () { $(this).select(); });\n\t\tthis.select_input = this.$input.get(0);\n\t\tthis.awesomplete = new Awesomplete(this.select_input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tautoFirst: true,\n\t\t\tlist: me.options,\n\t\t\titem(item) {\n\t\t\t\treturn $(repl('<li class=\"filter-field-select\"><p>%(label)s</p></li>', item))\n\t\t\t\t\t.data(\"item.autocomplete\", item)\n\t\t\t\t\t.get(0);\n\t\t\t}\n\t\t});\n\t\tthis.$input.on(\"awesomplete-select\", function(e) {\n\t\t\tvar o = e.originalEvent;\n\t\t\tvar value = o.text.value;\n\t\t\tvar item = me.awesomplete.get_item(value);\n\t\t\tme.selected_doctype = item.doctype;\n\t\t\tme.selected_fieldname = item.fieldname;\n\t\t\tif(me.select) me.select(item.doctype, item.fieldname);\n\t\t});\n\t\tthis.$input.on(\"awesomplete-selectcomplete\", function(e) {\n\t\t\tvar o = e.originalEvent;\n\t\t\tvar value = o.text.value;\n\t\t\tvar item = me.awesomplete.get_item(value);\n\t\t\tme.$input.val(item.label);\n\t\t});\n\n\t\tif(this.filter_fields) {\n\t\t\tfor(var i in this.filter_fields)\n\t\t\t\tthis.add_field_option(this.filter_fields[i]);\n\t\t} else {\n\t\t\tthis.build_options();\n\t\t}\n\t\tthis.set_value(this.doctype, \"name\");\n\t},\n\tget_value() {\n\t\treturn this.selected_doctype ? this.selected_doctype + \".\" + this.selected_fieldname : null;\n\t},\n\tval(value) {\n\t\tif(value===undefined) {\n\t\t\treturn this.get_value();\n\t\t} else {\n\t\t\tthis.set_value(value);\n\t\t}\n\t},\n\tclear() {\n\t\tthis.selected_doctype = null;\n\t\tthis.selected_fieldname = null;\n\t\tthis.$input.val(\"\");\n\t},\n\tset_value(doctype, fieldname) {\n\t\tvar me = this;\n\t\tthis.clear();\n\t\tif(!doctype) return;\n\n\t\t// old style\n\t\tif(doctype.indexOf(\".\")!==-1) {\n\t\t\tvar parts = doctype.split(\".\");\n\t\t\tdoctype = parts[0];\n\t\t\tfieldname = parts[1];\n\t\t}\n\n\t\t$.each(this.options, function(i, v) {\n\t\t\tif(v.doctype===doctype && v.fieldname===fieldname) {\n\t\t\t\tme.selected_doctype = doctype;\n\t\t\t\tme.selected_fieldname = fieldname;\n\t\t\t\tme.$input.val(v.label);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t},\n\tbuild_options() {\n\t\tvar me = this;\n\t\tme.table_fields = [];\n\t\tvar std_filters = $.map(frappe.model.std_fields, function(d) {\n\t\t\tvar opts = {parent: me.doctype};\n\t\t\tif(d.fieldname==\"name\") opts.options = me.doctype;\n\t\t\treturn $.extend(copy_dict(d), opts);\n\t\t});\n\n\t\t// add parenttype column\n\t\tvar doctype_obj = locals['DocType'][me.doctype];\n\t\tif(doctype_obj && cint(doctype_obj.istable)) {\n\t\t\tstd_filters = std_filters.concat([{\n\t\t\t\tfieldname: 'parent',\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tlabel: 'Parent',\n\t\t\t\tparent: me.doctype,\n\t\t\t}]);\n\t\t}\n\n\t\t// blank\n\t\tif(this.with_blank) {\n\t\t\tthis.options.push({\n\t\t\t\tlabel:\"\",\n\t\t\t\tvalue:\"\",\n\t\t\t});\n\t\t}\n\n\t\t// main table\n\t\tvar main_table_fields = std_filters.concat(frappe.meta.docfield_list[me.doctype]);\n\t\t$.each(frappe.utils.sort(main_table_fields, \"label\", \"string\"), function(i, df) {\n\t\t\t// show fields where user has read access and if report hide flag is not set\n\t\t\tif(frappe.perm.has_perm(me.doctype, df.permlevel, \"read\") && !df.report_hide)\n\t\t\t\tme.add_field_option(df);\n\t\t});\n\n\t\t// child tables\n\t\t$.each(me.table_fields, function(i, table_df) {\n\t\t\tif(table_df.options) {\n\t\t\t\tvar child_table_fields = [].concat(frappe.meta.docfield_list[table_df.options]);\n\t\t\t\t$.each(frappe.utils.sort(child_table_fields, \"label\", \"string\"), function(i, df) {\n\t\t\t\t\t// show fields where user has read access and if report hide flag is not set\n\t\t\t\t\tif(frappe.perm.has_perm(me.doctype, df.permlevel, \"read\") && !df.report_hide)\n\t\t\t\t\t\tme.add_field_option(df);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tadd_field_option(df) {\n\t\tvar me = this;\n\t\tvar label, table;\n\t\tif(me.doctype && df.parent==me.doctype) {\n\t\t\tlabel = __(df.label);\n\t\t\ttable = me.doctype;\n\t\t\tif(df.fieldtype=='Table') me.table_fields.push(df);\n\t\t} else {\n\t\t\tlabel = __(df.label) + ' (' + __(df.parent) + ')';\n\t\t\ttable = df.parent;\n\t\t}\n\n\t\t// check if this option should be added\n\t\tif (this.filter_options && this.filter_options(table, df.fieldname) === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(frappe.model.no_value_type.indexOf(df.fieldtype) == -1 &&\n\t\t\t!(me.fields_by_name[df.parent] && me.fields_by_name[df.parent][df.fieldname])) {\n\t\t\tthis.options.push({\n\t\t\t\tlabel: label,\n\t\t\t\tvalue: table + \".\" + df.fieldname,\n\t\t\t\tfieldname: df.fieldname,\n\t\t\t\tdoctype: df.parent\n\t\t\t});\n\t\t\tif(!me.fields_by_name[df.parent]) me.fields_by_name[df.parent] = {};\n\t\t\tme.fields_by_name[df.parent][df.fieldname] = df;\n\t\t}\n\t},\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.Tags = class {\n\tconstructor({\n\t\tparent, placeholder, tagsList,\n\t\tonTagAdd,\n\t\tonTagRemove,\n\t\tonTagClick,\n\t\tonChange\n\t}) {\n\t\tthis.tagsList = tagsList || [];\n\t\tthis.onTagAdd = onTagAdd;\n\t\tthis.onTagRemove = onTagRemove;\n\t\tthis.onTagClick = onTagClick;\n\t\tthis.onChange = onChange;\n\n\t\tthis.setup(parent, placeholder);\n\t}\n\n\tsetup(parent, placeholder) {\n\t\tthis.$wrapper = $(`<div class=\"tags-wrapper\"></div>`).appendTo(parent);\n\t\tthis.$ul = $(`<ul class=\"tags-list\"></ul>`).appendTo(this.$wrapper);\n\t\tthis.$input = $(`<input class=\"tags-input\"></input>`);\n\n\t\tthis.$inputWrapper = this.getListElement(this.$input);\n\t\tthis.$placeholder = this.getListElement($(`<span class=\"tags-placeholder text-muted\">${placeholder}</span>`));\n\t\tthis.$inputWrapper.appendTo(this.$ul);\n\t\tthis.$placeholder.appendTo(this.$ul);\n\n\t\tthis.deactivate();\n\t\tthis.bind();\n\t\tthis.boot();\n\t}\n\n\tbind() {\n\t\tthis.$input.keypress((e) => {\n\t\t\tif(e.which == 13 || e.keyCode == 13) {\n\t\t\t\tthis.addTag(this.$input.val());\n\t\t\t\tthis.$input.val('');\n\t\t\t}\n\t\t});\n\n\t\tthis.$input.on('blur', () => {\n\t\t\tthis.deactivate();\n\t\t});\n\n\t\tthis.$placeholder.on('click', () => {\n\t\t\tthis.activate();\n\t\t});\n\t}\n\n\tboot() {\n\t\tthis.addTags(this.tagsList);\n\t}\n\n\tactivate() {\n\t\tthis.$placeholder.hide();\n\t\tthis.$inputWrapper.show();\n\t\tthis.$input.focus();\n\t}\n\n\tdeactivate() {\n\t\tthis.$inputWrapper.hide();\n\t\tthis.$placeholder.show();\n\t}\n\n\trefresh() {\n\t\tthis.deactivate();\n\t\tthis.activate();\n\t}\n\n\taddTag(label) {\n\t\tif(label && !this.tagsList.includes(label)) {\n\t\t\tlet $tag = this.getTag(label);\n\t\t\tthis.getListElement($tag).insertBefore(this.$inputWrapper);\n\t\t\tthis.tagsList.push(label);\n\t\t\tthis.onTagAdd && this.onTagAdd(label);\n\n\t\t\tthis.refresh();\n\t\t}\n\t}\n\n\tremoveTag(label) {\n\t\tif(this.tagsList.includes(label)) {\n\t\t\tlet $tag = this.$ul.find(`.frappe-tag[data-tag-label=\"${label}\"]`);\n\t\t\t\n\t\t\t// Just don't remove tag, but also the li DOM.\n\t\t\t$tag.parent('.tags-list-item').remove();\n\n\t\t\tthis.tagsList = this.tagsList.filter(d => d !== label);\n\t\t\tthis.onTagRemove && this.onTagRemove(label);\n\t\t}\n\t}\n\n\taddTags(labels) {\n\t\tlabels.map(this.addTag.bind(this));\n\t}\n\n\tclearTags() {\n\t\tthis.$ul.find('.frappe-tag').remove();\n\t\tthis.tagsList = [];\n\t}\n\n\tgetListElement($element, className) {\n\t\tlet $li = $(`<li class=\"tags-list-item ${className}\"></li>`);\n\t\t$element.appendTo($li);\n\t\treturn $li;\n\t}\n\n\tgetTag(label) {\n\t\tlet $tag = $(`<div class=\"frappe-tag btn-group\" data-tag-label=\"${label}\">\n\t\t<button class=\"btn btn-default btn-xs toggle-tag\"\n\t\t\ttitle=\"${ __(\"toggle Tag\") }\"\n\t\t\tdata-tag-label=\"${label}\">${label}\n\t\t</button>\n\t\t<button class=\"btn btn-default btn-xs remove-tag\"\n\t\t\ttitle=\"${ __(\"Remove Tag\") }\"\n\t\t\tdata-tag-label=\"${label}\">\n\t\t\t<i class=\"fa fa-remove text-muted\"></i>\n\t\t</button></div>`);\n\n\t\tlet $removeTag = $tag.find(\".remove-tag\");\n\n\t\t$removeTag.on(\"click\", () => {\n\t\t\tthis.removeTag($removeTag.attr('data-tag-label'));\n\t\t});\n\n\t\tif(this.onTagClick) {\n\t\t\tlet $toggle_tag = $tag.find(\".toggle-tag\");\n\t\t\t$toggle_tag.on(\"click\", () => {\n\t\t\t\tthis.onTagClick($toggle_tag.attr('data-tag-label'));\n\t\t\t});\n\t\t}\n\n\t\treturn $tag;\n\t}\n}\n","frappe.ui.TagEditor = Class.extend({\n\tinit: function(opts) {\n\t\t/* docs:\n\t\tArguments\n\n\t\t- parent\n\t\t- user_tags\n\t\t- doctype\n\t\t- docname\n\t\t*/\n\t\t$.extend(this, opts);\n\n\t\tthis.setup_tags();\n\n\t\tif (!this.user_tags) {\n\t\t\tthis.user_tags = \"\";\n\t\t}\n\t\tthis.initialized = true;\n\t\tthis.refresh(this.user_tags);\n\t},\n\tsetup_tags: function() {\n\t\tvar me = this;\n\n\t\t// hidden form, does not have parent\n\t\tif (!this.parent) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.wrapper = $('<div class=\"tag-line\" style=\"position: relative\">').appendTo(this.parent);\n\t\tif(!this.wrapper.length) return;\n\n\t\tthis.tags = new frappe.ui.Tags({\n\t\t\tparent: this.wrapper,\n\t\t\tplaceholder: \"Add a tag ...\",\n\t\t\tonTagAdd: (tag) => {\n\t\t\t\tif(me.initialized && !me.refreshing) {\n\t\t\t\t\ttag = toTitle(tag);\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: 'frappe.desk.tags.add_tag',\n\t\t\t\t\t\targs: me.get_args(tag),\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tvar user_tags = me.user_tags ? me.user_tags.split(\",\") : [];\n\t\t\t\t\t\t\tuser_tags.push(tag)\n\t\t\t\t\t\t\tme.user_tags = user_tags.join(\",\");\n\t\t\t\t\t\t\tme.on_change && me.on_change(me.user_tags);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonTagRemove: (tag) => {\n\t\t\t\tif(!me.refreshing) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: 'frappe.desk.tags.remove_tag',\n\t\t\t\t\t\targs: me.get_args(tag),\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tvar user_tags = me.user_tags.split(\",\");\n\t\t\t\t\t\t\tuser_tags.splice(user_tags.indexOf(tag), 1);\n\t\t\t\t\t\t\tme.user_tags = user_tags.join(\",\");\n\t\t\t\t\t\t\tme.on_change && me.on_change(me.user_tags);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.setup_awesomplete();\n\t\tthis.setup_complete = true;\n\t},\n\tsetup_awesomplete: function() {\n\t\tvar me = this;\n\t\tvar $input = this.wrapper.find(\"input.tags-input\");\n\t\tvar input = $input.get(0);\n\t\tthis.awesomplete = new Awesomplete(input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tlist: []\n\t\t});\n\t\t$input.on(\"awesomplete-open\", function(e){\n\t\t\t$input.attr('state', 'open');\n\t\t});\n\t\t$input.on(\"awesomplete-close\", function(e){\n\t\t\t$input.attr('state', 'closed');\n\t\t});\n\t\t$input.on(\"input\", function(e) {\n\t\t\tvar value = e.target.value;\n\t\t\tfrappe.call({\n\t\t\t\tmethod:\"frappe.desk.tags.get_tags\",\n\t\t\t\targs:{\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\ttxt: value.toLowerCase(),\n\t\t\t\t\tcat_tags: me.list_sidebar ?\n\t\t\t\t\t\tJSON.stringify(me.list_sidebar.get_cat_tags()) : '[]'\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.awesomplete.list = r.message;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\t$input.on(\"focus\", function(e) {\n\t\t\tif($input.attr('state') != 'open') {\n\t\t\t\t$input.trigger(\"input\");\n\t\t\t}\n\t\t});\n\t},\n\tget_args: function(tag) {\n\t\treturn {\n\t\t\ttag: tag,\n\t\t\tdt: this.frm.doctype,\n\t\t\tdn: this.frm.docname,\n\t\t}\n\t},\n\trefresh: function(user_tags) {\n\t\tvar me = this;\n\t\tif (!this.initialized || !this.setup_complete || this.refreshing) return;\n\n\t\tme.refreshing = true;\n\t\ttry {\n\t\t\tme.tags.clearTags();\n\t\t\tif(user_tags) {\n\t\t\t\tme.tags.addTags(user_tags.split(','));\n\t\t\t}\n\t\t} catch(e) {\n\t\t\tme.refreshing = false;\n\t\t\t// wtf bug\n\t\t\tsetTimeout( function() { me.refresh(); }, 100);\n\t\t}\n\t\tme.refreshing = false;\n\n\t}\n})\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.is_liked = function(doc) {\n\tvar liked = frappe.ui.get_liked_by(doc);\n\treturn liked.indexOf(frappe.session.user)===-1 ? false : true;\n}\n\nfrappe.ui.get_liked_by = function(doc) {\n\tvar liked = doc._liked_by;\n\tif(liked) {\n\t\tliked = JSON.parse(liked);\n\t}\n\n\treturn liked || [];\n}\n\nfrappe.ui.toggle_like = function($btn, doctype, name, callback) {\n\tvar add = $btn.hasClass(\"not-liked\") ? \"Yes\" : \"No\";\n\t// disable click\n\t$btn.css('pointer-events', 'none');\n\n\tfrappe.call({\n\t\tmethod: \"frappe.desk.like.toggle_like\",\n\t\tquiet: true,\n\t\targs: {\n\t\t\tdoctype: doctype,\n\t\t\tname: name,\n\t\t\tadd: add,\n\t\t},\n\t\tcallback: function(r) {\n\t\t\t// renable click\n\t\t\t$btn.css('pointer-events', 'auto');\n\n\t\t\tif(!r.exc) {\n\t\t\t\t// update in all local-buttons\n\t\t\t\tvar action_buttons = $('.like-action[data-name=\"'+ name.replace(/\"/g, '\\\"')\n\t\t\t\t\t+'\"][data-doctype=\"'+ doctype.replace(/\"/g, '\\\"')+'\"]');\n\n\t\t\t\tif(add===\"Yes\") {\n\t\t\t\t\taction_buttons.removeClass(\"not-liked text-extra-muted\");\n\t\t\t\t} else {\n\t\t\t\t\taction_buttons.addClass(\"not-liked text-extra-muted\");\n\t\t\t\t}\n\n\t\t\t\t// update in locals (form)\n\t\t\t\tvar doc = locals[doctype] && locals[doctype][name];\n\t\t\t\tif(doc) {\n\t\t\t\t\tvar liked_by = JSON.parse(doc._liked_by || \"[]\"),\n\t\t\t\t\t\tidx = liked_by.indexOf(frappe.session.user);\n\t\t\t\t\tif(add===\"Yes\") {\n\t\t\t\t\t\tif(idx===-1)\n\t\t\t\t\t\t\tliked_by.push(frappe.session.user);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif(idx!==-1) {\n\t\t\t\t\t\t\tliked_by = liked_by.slice(0,idx).concat(liked_by.slice(idx+1))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tdoc._liked_by = JSON.stringify(liked_by);\n\t\t\t\t}\n\n\t\t\t\tif(callback) {\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};\n\nfrappe.ui.click_toggle_like = function() {\n\tvar $btn = $(this);\n\tvar $count = $btn.siblings(\".likes-count\");\n\tvar not_liked = $btn.hasClass(\"not-liked\");\n\tvar doctype = $btn.attr(\"data-doctype\");\n\tvar name = $btn.attr(\"data-name\");\n\n\tfrappe.ui.toggle_like($btn, doctype, name, function() {\n\t\tif (not_liked) {\n\t\t\t$count.text(cint($count.text()) + 1);\n\t\t} else {\n\t\t\t$count.text(cint($count.text()) - 1);\n\t\t}\n\t});\n\n\treturn false;\n}\n\nfrappe.ui.setup_like_popover = function($parent, selector) {\n\tif (frappe.dom.is_touchscreen()) {\n\t\treturn;\n\t}\n\n\t$parent.on(\"mouseover\", selector, function() {\n\t\tvar $wrapper = $(this);\n\n\t\t$wrapper.popover({\n\t\t\tanimation: true,\n\t\t\tplacement: \"right\",\n\t\t\tcontent: function() {\n\t\t\t\tvar liked_by = $wrapper.attr('data-liked-by');\n\t\t\t\tliked_by = liked_by ? decodeURI(liked_by) : '[]';\n\t\t\t\tliked_by = JSON.parse(liked_by);\n\n\t\t\t\tvar user = frappe.session.user;\n\t\t\t\t// hack\n\t\t\t\tif ($wrapper.find(\".not-liked\").length) {\n\t\t\t\t\tif (liked_by.indexOf(user)!==-1) {\n\t\t\t\t\t\tliked_by.splice(liked_by.indexOf(user), 1);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (liked_by.indexOf(user)===-1) {\n\t\t\t\t\t\tliked_by.push(user);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!liked_by.length) {\n\t\t\t\t\treturn \"\";\n\t\t\t\t}\n\t\t\t\treturn frappe.render_template(\"liked_by\", {\"liked_by\": liked_by});\n\t\t\t},\n\t\t\thtml: true,\n\t\t\tcontainer: 'body'\n\t\t});\n\n\t\t$wrapper.popover('show');\n\t});\n\n\t$parent.on(\"mouseout\", selector, function() {\n\t\t$(this).popover('destroy');\n\t});\n}\n","frappe.provide('frappe.views');\n\nfrappe.views.BaseList = class BaseList {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\t}\n\n\tshow() {\n\t\tthis.init().then(() => this.refresh());\n\t}\n\n\tinit() {\n\n\t\tif (this.init_promise) return this.init_promise;\n\n\t\tlet tasks = [\n\t\t\tthis.setup_defaults,\n\t\t\tthis.set_stats,\n\t\t\tthis.setup_fields,\n\t\t\t// make view\n\t\t\tthis.setup_page,\n\t\t\tthis.setup_side_bar,\n\t\t\tthis.setup_main_section,\n\t\t\tthis.setup_view,\n\t\t].map(fn => fn.bind(this));\n\n\t\tthis.init_promise = frappe.run_serially(tasks);\n\t\treturn this.init_promise;\n\t}\n\n\tsetup_defaults() {\n\t\tthis.page_name = frappe.get_route_str();\n\t\tthis.page_title = this.page_title || __(this.doctype);\n\t\tthis.meta = frappe.get_meta(this.doctype);\n\t\tthis.settings = frappe.listview_settings[this.doctype] || {};\n\t\tthis.user_settings = frappe.get_user_settings(this.doctype);\n\n\t\tthis.start = 0;\n\t\tthis.page_length = 20;\n\t\tthis.data = [];\n\t\tthis.method = 'frappe.desk.reportview.get';\n\n\t\tthis.can_create = frappe.model.can_create(this.doctype);\n\t\tthis.can_write = frappe.model.can_write(this.doctype);\n\n\t\tthis.fields = [];\n\t\tthis.filters = [];\n\t\tthis.order_by = 'modified desc';\n\n\t\t// Setup buttons\n\t\tthis.primary_action = null;\n\t\tthis.secondary_action = {\n\t\t\tlabel: __('Refresh'),\n\t\t\taction: () => this.refresh()\n\t\t};\n\n\t\tthis.menu_items = [{\n\t\t\tlabel: __('Refresh'),\n\t\t\taction: () => this.refresh(),\n\t\t\tclass: 'visible-xs'\n\t\t}];\n\t}\n\n\tsetup_fields() {\n\t\tthis.set_fields();\n\t\tthis.build_fields();\n\t}\n\n\tset_fields() {\n\t\tlet fields = [].concat(\n\t\t\tfrappe.model.std_fields_list,\n\t\t\tthis.meta.title_field\n\t\t);\n\n\t\tfields.forEach(f => this._add_field(f));\n\t}\n\n\tget_fields_in_list_view() {\n\t\treturn this.meta.fields.filter(df => {\n\t\t\treturn frappe.model.is_value_type(df.fieldtype) && (\n\t\t\t\tdf.in_list_view\n\t\t\t\t&& frappe.perm.has_perm(this.doctype, df.permlevel, 'read')\n\t\t\t) || (\n\t\t\t\tdf.fieldtype === 'Currency'\n\t\t\t\t&& df.options\n\t\t\t\t&& !df.options.includes(':')\n\t\t\t) || (\n\t\t\t\tdf.fieldname === 'status'\n\t\t\t);\n\t\t});\n\t}\n\n\tbuild_fields() {\n\t\t// fill in missing doctype\n\t\tthis.fields = this.fields.map(f => {\n\t\t\tif (typeof f === 'string') {\n\t\t\t\tf = [f, this.doctype];\n\t\t\t}\n\t\t\treturn f;\n\t\t});\n\t\t//de-dup\n\t\tthis.fields = this.fields.uniqBy(f => f[0] + f[1]);\n\t}\n\n\t_add_field(fieldname) {\n\t\tif (!fieldname) return;\n\t\tlet doctype = this.doctype;\n\n\t\tif (typeof fieldname === 'object') {\n\t\t\t// df is passed\n\t\t\tconst df = fieldname;\n\t\t\tfieldname = df.fieldname;\n\t\t\tdoctype = df.parent;\n\t\t}\n\n\t\tconst is_valid_field = frappe.model.std_fields_list.includes(fieldname)\n\t\t\t|| frappe.meta.has_field(doctype, fieldname)\n\t\t\t|| fieldname === '_seen';\n\n\t\tif (!is_valid_field) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fields.push([fieldname, doctype]);\n\t}\n\n\tset_stats() {\n\t\tthis.stats = ['_user_tags'];\n\t\t// add workflow field (as priority)\n\t\tthis.workflow_state_fieldname = frappe.workflow.get_state_fieldname(this.doctype);\n\t\tif (this.workflow_state_fieldname) {\n\t\t\tif (!frappe.workflow.workflows[this.doctype]['override_status']) {\n\t\t\t\tthis._add_field(this.workflow_state_fieldname);\n\t\t\t}\n\t\t\tthis.stats.push(this.workflow_state_fieldname);\n\t\t}\n\t}\n\n\tsetup_page() {\n\t\tthis.page = this.parent.page;\n\t\tthis.$page = $(this.parent);\n\t\tthis.page.page_form.removeClass('row').addClass('flex');\n\t\tthis.setup_page_head();\n\t}\n\n\tsetup_page_head() {\n\t\tthis.set_title();\n\t\tthis.set_menu_items();\n\t\tthis.set_breadcrumbs();\n\t}\n\n\tset_title() {\n\t\tthis.page.set_title(this.page_title);\n\t}\n\n\tset_menu_items() {\n\t\tconst $secondary_action = this.page.set_secondary_action(\n\t\t\tthis.secondary_action.label,\n\t\t\tthis.secondary_action.action,\n\t\t\tthis.secondary_action.icon\n\t\t);\n\t\tif (!this.secondary_action.icon) {\n\t\t\t$secondary_action.addClass('hidden-xs');\n\t\t} else {\n\t\t\t$secondary_action.addClass('visible-xs');\n\t\t}\n\n\t\tthis.menu_items.map(item => {\n\t\t\tif (item.condition && item.condition() === false) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst $item = this.page.add_menu_item(item.label, item.action, item.standard);\n\t\t\tif (item.class) {\n\t\t\t\t$item && $item.addClass(item.class);\n\t\t\t}\n\t\t});\n\t}\n\n\tset_breadcrumbs() {\n\t\tfrappe.breadcrumbs.add(this.meta.module, this.doctype);\n\t}\n\n\tsetup_side_bar() {\n\t\tthis.list_sidebar = new frappe.views.ListSidebar({\n\t\t\tdoctype: this.doctype,\n\t\t\tstats: this.stats,\n\t\t\tparent: this.$page.find('.layout-side-section'),\n\t\t\t// set_filter: this.set_filter.bind(this),\n\t\t\tpage: this.page,\n\t\t\tlist_view: this\n\t\t});\n\t}\n\n\ttoggle_side_bar() {\n\t\tthis.list_sidebar.parent.toggleClass('hide');\n\t\tthis.page.current_view.find('.layout-main-section-wrapper').toggleClass('col-md-10 col-md-12');\n\t}\n\n\tsetup_main_section() {\n\t\treturn frappe.run_serially([\n\t\t\tthis.setup_list_wrapper,\n\t\t\tthis.setup_filter_area,\n\t\t\tthis.setup_sort_selector,\n\t\t\tthis.setup_result_area,\n\t\t\tthis.setup_no_result_area,\n\t\t\tthis.setup_freeze_area,\n\t\t\tthis.setup_paging_area\n\t\t].map(fn => fn.bind(this)));\n\t}\n\n\tsetup_list_wrapper() {\n\t\tthis.$frappe_list = $('<div class=\"frappe-list\">').appendTo(this.page.main);\n\t}\n\n\tsetup_filter_area() {\n\t\tthis.filter_area = new FilterArea(this);\n\n\t\tif (this.filters.length > 0) {\n\t\t\treturn this.filter_area.set(this.filters);\n\t\t}\n\t}\n\n\tsetup_sort_selector() {\n\t\tthis.sort_selector = new frappe.ui.SortSelector({\n\t\t\tparent: this.filter_area.$filter_list_wrapper,\n\t\t\tdoctype: this.doctype,\n\t\t\targs: this.order_by,\n\t\t\tonchange: () => this.refresh(true)\n\t\t});\n\t}\n\n\tsetup_result_area() {\n\t\tthis.$result = $(`<div class=\"result\">`);\n\t\tthis.$frappe_list.append(this.$result);\n\t}\n\n\tsetup_no_result_area() {\n\t\tthis.$no_result = $(`\n\t\t\t<div class=\"no-result text-muted flex justify-center align-center\">\n\t\t\t\t${this.get_no_result_message()}\n\t\t\t</div>\n\t\t`).hide();\n\t\tthis.$frappe_list.append(this.$no_result);\n\t}\n\n\tsetup_freeze_area() {\n\t\tthis.$freeze = $('<div class=\"freeze\"></div>').hide();\n\t\tthis.$frappe_list.append(this.$freeze);\n\t}\n\n\tget_no_result_message() {\n\t\treturn __('Nothing to show');\n\t}\n\n\tsetup_paging_area() {\n\t\tconst paging_values = [20, 100, 500];\n\t\tthis.$paging_area = $(\n\t\t\t`<div class=\"list-paging-area level\">\n\t\t\t\t<div class=\"level-left\">\n\t\t\t\t\t<div class=\"btn-group\">\n\t\t\t\t\t\t${paging_values.map(value => `\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-default btn-sm btn-paging\"\n\t\t\t\t\t\t\t\tdata-value=\"${value}\">\n\t\t\t\t\t\t\t\t${value}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t`).join('')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"level-right\">\n\t\t\t\t\t<button class=\"btn btn-default btn-more btn-sm\">\n\t\t\t\t\t\t${__(\"More\")}...\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t).hide();\n\t\tthis.$frappe_list.append(this.$paging_area);\n\n\t\t// set default paging btn active\n\t\tthis.$paging_area\n\t\t\t.find(`.btn-paging[data-value=\"${this.page_length}\"]`)\n\t\t\t.addClass('btn-info');\n\n\t\tthis.$paging_area.on('click', '.btn-paging, .btn-more', e => {\n\t\t\tconst $this = $(e.currentTarget);\n\n\t\t\tif ($this.is('.btn-paging')) {\n\t\t\t\t// set active button\n\t\t\t\tthis.$paging_area.find('.btn-paging').removeClass('btn-info');\n\t\t\t\t$this.addClass('btn-info');\n\n\t\t\t\tthis.start = 0;\n\t\t\t\tthis.page_length = $this.data().value;\n\t\t\t\tthis.refresh();\n\t\t\t} else if ($this.is('.btn-more')) {\n\t\t\t\tthis.start = this.start + this.page_length;\n\t\t\t\tthis.refresh();\n\t\t\t}\n\t\t});\n\t}\n\n\tget_fields() {\n\t\t// convert [fieldname, Doctype] => tabDoctype.fieldname\n\t\treturn this.fields.map(f => frappe.model.get_full_column_name(f[0], f[1]));\n\t}\n\n\tsetup_view() {\n\t\t// for child classes\n\t}\n\n\tget_filters_for_args() {\n\t\t// filters might have a fifth param called hidden,\n\t\t// we don't want to pass that server side\n\t\treturn this.filter_area\n\t\t\t? this.filter_area.get().map(filter => filter.slice(0, 4))\n\t\t\t: [];\n\t}\n\n\tget_args() {\n\t\treturn {\n\t\t\tdoctype: this.doctype,\n\t\t\tfields: this.get_fields(),\n\t\t\tfilters: this.get_filters_for_args(),\n\t\t\torder_by: this.sort_selector.get_sql_string(),\n\t\t\tstart: this.start,\n\t\t\tpage_length: this.page_length\n\t\t};\n\t}\n\n\trefresh() {\n\t\tthis.freeze(true);\n\t\t// fetch data from server\n\t\tconst args = this.get_args();\n\t\treturn frappe.call({\n\t\t\tmethod: this.method,\n\t\t\ttype: 'GET',\n\t\t\targs: args,\n\t\t\tfreeze: this.freeze_on_refresh || false,\n\t\t\tfreeze_message: this.freeze_message || (__('Loading') + '...')\n\t\t}).then(r => {\n\t\t\t// render\n\t\t\tthis.prepare_data(r);\n\t\t\tthis.toggle_result_area();\n\t\t\tthis.before_render();\n\t\t\tthis.render();\n\t\t\tthis.freeze(false);\n\t\t});\n\t}\n\n\tprepare_data(r) {\n\t\tlet data = r.message || {};\n\t\tdata = !Array.isArray(data) ? frappe.utils.dict(data.keys, data.values) : data;\n\n\t\tif (this.start === 0) {\n\t\t\tthis.data = data;\n\t\t} else {\n\t\t\tthis.data = this.data.concat(data);\n\t\t}\n\n\t\tthis.data = this.data.uniqBy(d => d.name);\n\t}\n\n\tfreeze() {\n\t\t// show a freeze message while data is loading\n\t}\n\n\tbefore_render() {\n\n\t}\n\n\trender() {\n\t\t// for child classes\n\t}\n\n\ttoggle_result_area() {\n\t\tthis.$result.toggle(this.data.length > 0);\n\t\tthis.$paging_area.toggle(this.data.length > 0);\n\t\tthis.$no_result.toggle(this.data.length == 0);\n\n\t\tconst show_more = (this.start + this.page_length) <= this.data.length;\n\t\tthis.$paging_area.find('.btn-more')\n\t\t\t.toggle(show_more);\n\t}\n\n\tcall_for_selected_items(method, args = {}) {\n\t\targs.names = this.get_checked_items(true);\n\n\t\tfrappe.call({\n\t\t\tmethod: method,\n\t\t\targs: args,\n\t\t\tfreeze: true,\n\t\t\tcallback: r => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tthis.refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\nclass FilterArea {\n\tconstructor(list_view) {\n\t\tthis.list_view = list_view;\n\t\tthis.standard_filters_wrapper = this.list_view.page.page_form;\n\t\tthis.$filter_list_wrapper = $('<div class=\"filter-list\">').appendTo(this.list_view.$frappe_list);\n\t\tthis.trigger_refresh = true;\n\t\tthis.setup();\n\t}\n\n\tsetup() {\n\t\tthis.make_standard_filters();\n\t\tthis.make_filter_list();\n\t}\n\n\tget() {\n\t\tlet filters = this.filter_list.get_filters();\n\t\tlet standard_filters = this.get_standard_filters();\n\n\t\treturn filters\n\t\t\t.concat(standard_filters)\n\t\t\t.uniqBy(JSON.stringify);\n\t}\n\n\tset(filters) {\n\t\t// use to method to set filters without triggering refresh\n\t\tthis.trigger_refresh = false;\n\t\treturn this.add(filters, false)\n\t\t\t.then(() => {\n\t\t\t\tthis.trigger_refresh = true;\n\t\t\t});\n\t}\n\n\tadd(filters, refresh = true) {\n\t\tif (!filters || Array.isArray(filters) && filters.length === 0)\n\t\t\treturn Promise.resolve();\n\n\t\tif (typeof filters[0] === 'string') {\n\t\t\t// passed in the format of doctype, field, condition, value\n\t\t\tconst filter = Array.from(arguments);\n\t\t\tfilters = [filter];\n\t\t}\n\n\t\tfilters = filters.filter(f => {\n\t\t\treturn !this.exists(f);\n\t\t});\n\n\t\tconst { non_standard_filters, promise } = this.set_standard_filter(filters);\n\n\t\treturn promise\n\t\t\t.then(() => {\n\t\t\t\treturn non_standard_filters.length > 0 &&\n\t\t\t\t\tthis.filter_list.add_filters(non_standard_filters);\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\trefresh && this.list_view.refresh();\n\t\t\t});\n\t}\n\n\trefresh_list_view() {\n\t\tif (this.trigger_refresh) {\n\t\t\tthis.list_view.refresh();\n\t\t}\n\t}\n\n\texists(f) {\n\t\tlet exists = false;\n\t\t// check in standard filters\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\t\tif (f[2] === '=' && f[1] in fields_dict) {\n\t\t\tconst value = fields_dict[f[1]].get_value();\n\t\t\tif (value) {\n\t\t\t\texists = true;\n\t\t\t}\n\t\t}\n\n\t\t// check in filter area\n\t\tif (!exists) {\n\t\t\texists = this.filter_list.filter_exists(f);\n\t\t}\n\n\t\treturn exists;\n\t}\n\n\tset_standard_filter(filters) {\n\t\tif (filters.length === 0) {\n\t\t\treturn {\n\t\t\t\tnon_standard_filters: [],\n\t\t\t\tpromise: Promise.resolve()\n\t\t\t};\n\t\t}\n\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\n\t\tlet out = filters.reduce((out, filter) => {\n\t\t\t// eslint-disable-next-line\n\t\t\tconst [dt, fieldname, condition, value] = filter;\n\t\t\tout.promise = out.promise || Promise.resolve();\n\t\t\tout.non_standard_filters = out.non_standard_filters || [];\n\n\t\t\tif (fields_dict[fieldname] && condition === '=') {\n\t\t\t\t// standard filter\n\t\t\t\tout.promise = out.promise.then(\n\t\t\t\t\t() => fields_dict[fieldname].set_value(value)\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t// filter out non standard filters\n\t\t\t\tout.non_standard_filters.push(filter);\n\t\t\t}\n\t\t\treturn out;\n\t\t}, {});\n\n\t\treturn out;\n\t}\n\n\tremove(fieldname) {\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\n\t\tif (fieldname in fields_dict) {\n\t\t\tfields_dict[fieldname].set_value('');\n\t\t\treturn;\n\t\t}\n\t\tthis.filter_list.get_filter(fieldname).remove();\n\t}\n\n\tclear() {\n\t\tthis.filter_list.clear_filters();\n\n\t\tconst promises = [];\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\t\tfor (let key in fields_dict) {\n\t\t\tconst field = this.list_view.page.fields_dict[key];\n\t\t\tpromises.push(() => field.set_value(''));\n\t\t}\n\t\treturn frappe.run_serially(promises);\n\t}\n\n\tmake_standard_filters() {\n\t\tlet fields = [\n\t\t\t{\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tlabel: 'ID',\n\t\t\t\tcondition: 'like',\n\t\t\t\tfieldname: 'name',\n\t\t\t\tonchange: () => this.refresh_list_view()\n\t\t\t}\n\t\t];\n\n\t\tif(this.list_view.custom_filter_configs) {\n\t\t\tthis.list_view.custom_filter_configs.forEach(config => {\n\t\t\t\tconfig.onchange = () => this.refresh_list_view();\n\t\t\t});\n\n\t\t\tfields = fields.concat(this.list_view.custom_filter_configs);\n\t\t}\n\n\t\tconst doctype_fields = this.list_view.meta.fields;\n\n\t\tfields = fields.concat(doctype_fields.filter(\n\t\t\tdf => df.in_standard_filter &&\n\t\t\t\tfrappe.model.is_value_type(df.fieldtype)\n\t\t).map(df => {\n\t\t\tlet options = df.options;\n\t\t\tlet condition = '=';\n\t\t\tlet fieldtype = df.fieldtype;\n\t\t\tif (['Text', 'Small Text', 'Text Editor', 'Data'].includes(fieldtype)) {\n\t\t\t\tfieldtype = 'Data';\n\t\t\t\tcondition = 'like';\n\t\t\t}\n\t\t\tif (df.fieldtype == \"Select\" && df.options) {\n\t\t\t\toptions = df.options.split(\"\\n\");\n\t\t\t\tif (options.length > 0 && options[0] != \"\") {\n\t\t\t\t\toptions.unshift(\"\");\n\t\t\t\t\toptions = options.join(\"\\n\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tfieldtype: fieldtype,\n\t\t\t\tlabel: __(df.label),\n\t\t\t\toptions: options,\n\t\t\t\tfieldname: df.fieldname,\n\t\t\t\tcondition: condition,\n\t\t\t\tonchange: () => this.refresh_list_view()\n\t\t\t};\n\t\t}));\n\n\t\tif (fields.length > 3) {\n\t\t\tfields = fields.map((df, i) => {\n\t\t\t\tif (i >= 3) {\n\t\t\t\t\tdf.input_class = 'hidden-sm hidden-xs';\n\t\t\t\t}\n\t\t\t\treturn df;\n\t\t\t});\n\t\t}\n\n\t\tfields.map(df => this.list_view.page.add_field(df));\n\n\t\t// search icon in name filter\n\t\t$('<span class=\"octicon octicon-search text-muted small\"></span>')\n\t\t\t.appendTo(this.list_view.page.fields_dict.name.$wrapper)\n\t\t\t.css({\n\t\t\t\t'position': 'absolute',\n\t\t\t\t'z-index': '1',\n\t\t\t\t'right': '7px',\n\t\t\t\t'top': '9px',\n\t\t\t\t'font-size': '90%'\n\t\t\t});\n\n\t\tthis.list_view.page.fields_dict.name.$wrapper\n\t\t\t.find('.form-control')\n\t\t\t.css('padding-right', '2em');\n\t}\n\n\tget_standard_filters() {\n\t\tconst filters = [];\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\t\tfor (let key in fields_dict) {\n\t\t\tlet field = fields_dict[key];\n\t\t\tlet value = field.get_value();\n\t\t\tif (value) {\n\t\t\t\tif (field.df.condition === 'like' && !value.includes('%')) {\n\t\t\t\t\tvalue = '%' + value + '%';\n\t\t\t\t}\n\t\t\t\tfilters.push([\n\t\t\t\t\tthis.list_view.doctype,\n\t\t\t\t\tfield.df.fieldname,\n\t\t\t\t\tfield.df.condition || '=',\n\t\t\t\t\tvalue\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\n\t\treturn filters;\n\t}\n\n\tmake_filter_list() {\n\t\tthis.filter_list = new frappe.ui.FilterGroup({\n\t\t\tbase_list: this.list_view,\n\t\t\tparent: this.$filter_list_wrapper,\n\t\t\tdoctype: this.list_view.doctype,\n\t\t\tdefault_filters: [],\n\t\t\ton_change: () => this.refresh_list_view()\n\t\t});\n\t}\n}\n\n// utility function to validate view modes\nfrappe.views.view_modes = ['List', 'Gantt', 'Kanban', 'Calendar', 'Image', 'Inbox', 'Report'];\nfrappe.views.is_valid = view_mode => frappe.views.view_modes.includes(view_mode);\n","export default class BulkOperations {\n\tconstructor({ doctype }) {\n\t\tif (!doctype) frappe.throw(__('Doctype required'));\n\t\tthis.doctype = doctype;\n\t}\n\n\tprint(docs) {\n\t\tconst print_settings = frappe.model.get_doc(':Print Settings', 'Print Settings');\n\t\tconst allow_print_for_draft = cint(print_settings.allow_print_for_draft);\n\t\tconst is_submittable = frappe.model.is_submittable(this.doctype);\n\t\tconst allow_print_for_cancelled = cint(print_settings.allow_print_for_cancelled);\n\n\t\tconst valid_docs = docs.filter(doc => {\n\t\t\treturn !is_submittable || doc.docstatus === 1 ||\n\t\t\t\t(allow_print_for_cancelled && doc.docstatus == 2) ||\n\t\t\t\t(allow_print_for_draft && doc.docstatus == 0) ||\n\t\t\t\tfrappe.user.has_role('Administrator');\n\t\t}).map(doc => doc.name);\n\n\t\tconst invalid_docs = docs.filter(doc => !valid_docs.includes(doc.name));\n\n\t\tif (invalid_docs.length > 0) {\n\t\t\tfrappe.msgprint(__('You selected Draft or Cancelled documents'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (valid_docs.length > 0) {\n\t\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\t\ttitle: __('Print Documents'),\n\t\t\t\tfields: [{\n\t\t\t\t\t'fieldtype': 'Check',\n\t\t\t\t\t'label': __('With Letterhead'),\n\t\t\t\t\t'fieldname': 'with_letterhead'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'fieldtype': 'Select',\n\t\t\t\t\t'label': __('Print Format'),\n\t\t\t\t\t'fieldname': 'print_sel',\n\t\t\t\t\toptions: frappe.meta.get_print_formats(this.doctype)\n\t\t\t\t}]\n\t\t\t});\n\n\t\t\tdialog.set_primary_action(__('Print'), args => {\n\t\t\t\tif (!args) return;\n\t\t\t\tconst default_print_format = frappe.get_meta(this.doctype).default_print_format;\n\t\t\t\tconst with_letterhead = args.with_letterhead ? 1 : 0;\n\t\t\t\tconst print_format = args.print_sel ? args.print_sel : default_print_format;\n\t\t\t\tconst json_string = JSON.stringify(valid_docs);\n\n\t\t\t\tconst w = window.open('/api/method/frappe.utils.print_format.download_multi_pdf?' +\n\t\t\t\t\t'doctype=' + encodeURIComponent(this.doctype) +\n\t\t\t\t\t'&name=' + encodeURIComponent(json_string) +\n\t\t\t\t\t'&format=' + encodeURIComponent(print_format) +\n\t\t\t\t\t'&no_letterhead=' + (with_letterhead ? '0' : '1'));\n\t\t\t\tif (!w) {\n\t\t\t\t\tfrappe.msgprint(__('Please enable pop-ups'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdialog.show();\n\t\t} else {\n\t\t\tfrappe.msgprint(__('Select atleast 1 record for printing'));\n\t\t}\n\t}\n\n\tdelete(docnames, done = null) {\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: 'frappe.desk.reportview.delete_items',\n\t\t\t\tfreeze: true,\n\t\t\t\targs: {\n\t\t\t\t\titems: docnames,\n\t\t\t\t\tdoctype: this.doctype\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tlet failed = r.message;\n\t\t\t\tif (!failed) failed = [];\n\n\t\t\t\tif (failed.length && !r._server_messages) {\n\t\t\t\t\tfrappe.throw(__('Cannot delete {0}', [failed.map(f => f.bold()).join(', ')]));\n\t\t\t\t}\n\t\t\t\tif (failed.length < docnames.length) {\n\t\t\t\t\tfrappe.utils.play_sound('delete');\n\t\t\t\t\tif (done) done();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tassign(docnames, done) {\n\t\tif (docnames.length > 0) {\n\t\t\tconst dialog = new frappe.ui.form.AssignToDialog({\n\t\t\t\tobj: this,\n\t\t\t\tmethod: 'frappe.desk.form.assign_to.add_multiple',\n\t\t\t\tdoctype: this.doctype,\n\t\t\t\tdocname: docnames,\n\t\t\t\tbulk_assign: true,\n\t\t\t\tre_assign: true,\n\t\t\t\tcallback: done\n\t\t\t});\n\t\t\tdialog.clear();\n\t\t\tdialog.show();\n\t\t} else {\n\t\t\tfrappe.msgprint(__('Select records for assignment'));\n\t\t}\n\t}\n\n\tsubmit_or_cancel(docnames, action='submit', done=null) {\n\t\taction = action.toLowerCase();\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: 'frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs',\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\taction: action,\n\t\t\t\t\tdocnames: docnames\n\t\t\t\t},\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tlet failed = r.message;\n\t\t\t\tif (!failed) failed = [];\n\n\t\t\t\tif (failed.length && !r._server_messages) {\n\t\t\t\t\tfrappe.throw(__('Cannot {0} {1}', [action, failed.map(f => f.bold()).join(', ')]));\n\t\t\t\t}\n\t\t\t\tif (failed.length < docnames.length) {\n\t\t\t\t\tfrappe.utils.play_sound(action);\n\t\t\t\t\tif (done) done();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tedit(docnames, field_mappings, done) {\n\t\tlet field_options = Object.keys(field_mappings).sort();\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Edit'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\t'fieldtype': 'Select', 'options': field_options,\n\t\t\t\t\t'label': __('Field'), 'fieldname': 'field', 'reqd': 1,\n\t\t\t\t\t'onchange': () => {\n\t\t\t\t\t\tconst new_df = Object.assign({},\n\t\t\t\t\t\t\tfield_mappings[dialog.get_value('field')]);\n\t\t\t\t\t\t/* if the field label has status in it and\n\t\t\t\t\t\tif it has select fieldtype with no default value then\n\t\t\t\t\t\tset a default value from the available option. */\n\t\t\t\t\t\tif(new_df.label.match(/status/i) &&\n\t\t\t\t\t\t\tnew_df.fieldtype === 'Select' && !new_df.default) {\n\n\t\t\t\t\t\t\tlet options = [];\n\t\t\t\t\t\t\tif(typeof new_df.options===\"string\") {\n\t\t\t\t\t\t\t\toptions = new_df.options.split(\"\\n\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t//set second option as default if first option is an empty string\n\t\t\t\t\t\t\tnew_df.default = options[0] || options[1];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnew_df.label = __('Value');\n\t\t\t\t\t\tnew_df.reqd = 1;\n\t\t\t\t\t\tdelete new_df.depends_on;\n\t\t\t\t\t\tdialog.replace_field('value', new_df);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'fieldtype': 'Data',\n\t\t\t\t\t'label': __('Value'),\n\t\t\t\t\t'fieldname': 'value',\n\t\t\t\t\t'reqd': 1\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action: ({ value }) => {\n\t\t\t\tconst fieldname = field_mappings[dialog.get_value('field')].fieldname;\n\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs',\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\t\tdocnames: docnames,\n\t\t\t\t\t\taction: 'update',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t[fieldname]: value\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).then(r => {\n\t\t\t\t\tlet failed = r.message || [];\n\n\t\t\t\t\tif (failed.length && !r._server_messages) {\n\t\t\t\t\t\tfrappe.throw(__('Cannot update {0}', [failed.map(f => f.bold ? f.bold() : f).join(', ')]));\n\t\t\t\t\t}\n\t\t\t\t\tdone();\n\t\t\t\t\tdialog.hide();\n\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __('Update')\n\t\t});\n\n\t\tdialog.refresh();\n\t\tdialog.show();\n\t}\n}","import BulkOperations from \"./bulk_operations\";\n\nfrappe.provide('frappe.views');\n\nfrappe.views.ListView = class ListView extends frappe.views.BaseList {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tconst doctype = route[1];\n\n\t\tif (route.length === 2) {\n\t\t\t// List/{doctype} => List/{doctype}/{last_view} or List\n\t\t\tconst user_settings = frappe.get_user_settings(doctype);\n\t\t\tconst last_view = user_settings.last_view;\n\t\t\tfrappe.set_route('List', doctype, frappe.views.is_valid(last_view) ? last_view : 'List');\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tconstructor(opts) {\n\t\tsuper(opts);\n\t\tthis.show();\n\t}\n\n\thas_permissions() {\n\t\tconst can_read = frappe.perm.has_perm(this.doctype, 0, 'read');\n\t\treturn can_read;\n\t}\n\n\tshow() {\n\t\tif (!this.has_permissions()) {\n\t\t\tfrappe.set_route('');\n\t\t\tfrappe.msgprint(__(`Not permitted to view ${this.doctype}`));\n\t\t\treturn;\n\t\t}\n\n\t\tthis.init().then(() => {\n\t\t\tif (frappe.route_options) {\n\t\t\t\tthis.set_filters_from_route_options();\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthis.refresh();\n\t\t\t}\n\t\t});\n\t}\n\n\tget view_user_settings() {\n\t\treturn this.user_settings[this.view_name] || {};\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\t\tthis.view_name = 'List';\n\t\t// initialize with saved filters\n\t\tconst saved_filters = this.view_user_settings.filters;\n\t\tif (saved_filters) {\n\t\t\tthis.filters = this.validate_filters(saved_filters);\n\t\t} else {\n\t\t\t// filters in listview_settings\n\t\t\tconst filters = (this.settings.filters || []).map(f => {\n\t\t\t\tif (f.length === 3) {\n\t\t\t\t\tf = [this.doctype, f[0], f[1], f[2]];\n\t\t\t\t}\n\t\t\t\treturn f;\n\t\t\t});\n\n\t\t\tthis.filters = filters;\n\t\t}\n\t\t// initialize with saved order by\n\t\tthis.order_by = this.view_user_settings.order_by || 'modified desc';\n\n\t\t// build menu items\n\t\tthis.menu_items = this.menu_items.concat(this.get_menu_items());\n\n\t\tthis.actions_menu_items = this.get_actions_menu_items();\n\n\t\tthis.patch_refresh_and_load_lib();\n\t}\n\n\tvalidate_filters(filters) {\n\t\treturn filters.uniqBy(f => f[1]);\n\t}\n\n\tsetup_page() {\n\t\tthis.parent.list_view = this;\n\t\tsuper.setup_page();\n\t}\n\n\tsetup_page_head() {\n\t\tsuper.setup_page_head();\n\t\tthis.set_primary_action();\n\t\tthis.set_actions_menu_items();\n\t}\n\n\tset_actions_menu_items() {\n\t\tthis.actions_menu_items.map(item => {\n\t\t\tconst $item = this.page.add_actions_menu_item(item.label, item.action, item.standard);\n\t\t\tif (item.class) {\n\t\t\t\t$item.addClass(item.class);\n\t\t\t}\n\t\t});\n\t}\n\n\tshow_restricted_list_indicator_if_applicable() {\n\t\tconst match_rules_list = frappe.perm.get_match_rules(this.doctype);\n\t\tif(match_rules_list.length) {\n\t\t\tthis.restricted_list = $('<button class=\"restricted-list form-group\">Restricted</button>')\n\t\t\t\t.prepend('<span class=\"octicon octicon-lock\"></span>')\n\t\t\t\t.click(() => this.show_restrictions(match_rules_list))\n\t\t\t\t.appendTo(this.page.page_form);\n\t\t}\n\t}\n\n\tshow_restrictions(match_rules_list) {\n\t\tfrappe.msgprint(frappe.render_template('list_view_permission_restrictions', {\n\t\t\tcondition_list: match_rules_list\n\t\t}), 'Restrictions');\n\t}\n\n\tset_fields() {\n\t\tlet fields = [].concat(\n\t\t\tfrappe.model.std_fields_list,\n\t\t\tthis.get_fields_in_list_view(),\n\t\t\t[this.meta.title_field, this.meta.image_field],\n\t\t\t(this.settings.add_fields || []),\n\t\t\tthis.meta.track_seen ? '_seen' : null,\n\t\t\t'enabled',\n\t\t\t'disabled'\n\t\t);\n\n\t\tfields.forEach(f => this._add_field(f));\n\t}\n\n\tpatch_refresh_and_load_lib() {\n\t\t// throttle refresh for 1s\n\t\tthis.refresh = this.refresh.bind(this);\n\t\tthis.refresh = frappe.utils.throttle(this.refresh, 1000);\n\t\tthis.load_lib = new Promise(resolve => {\n\t\t\tif (this.required_libs) {\n\t\t\t\tfrappe.require(this.required_libs, resolve);\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t\t// call refresh every 5 minutes\n\t\tconst interval = 5 * 60 * 1000;\n\t\tsetInterval(() => {\n\t\t\t// don't call if route is different\n\t\t\tif (frappe.get_route_str() === this.page_name) {\n\t\t\t\tthis.refresh();\n\t\t\t}\n\t\t}, interval);\n\t}\n\n\n\tset_primary_action() {\n\t\tif (this.can_create) {\n\t\t\tthis.page.set_primary_action(__('New'), () => {\n\t\t\t\tthis.make_new_doc();\n\t\t\t}, 'octicon octicon-plus');\n\t\t} else {\n\t\t\tthis.page.clear_primary_action();\n\t\t}\n\t}\n\n\tmake_new_doc() {\n\t\tconst doctype = this.doctype;\n\t\tconst options = {};\n\t\tthis.filter_area.get().forEach(f => {\n\t\t\tif (f[2] === \"=\" && frappe.model.is_non_std_field(f[1])) {\n\t\t\t\toptions[f[1]] = f[3];\n\t\t\t}\n\t\t});\n\t\tfrappe.new_doc(doctype, options);\n\t}\n\n\tsetup_view() {\n\t\tthis.setup_columns();\n\t\tthis.render_header();\n\t\tthis.render_skeleton();\n\t\tthis.setup_events();\n\t\tthis.settings.onload && this.settings.onload(this);\n\t\tthis.show_restricted_list_indicator_if_applicable();\n\t}\n\n\tsetup_freeze_area() {\n\t\tthis.$freeze =\n\t\t\t$(`<div class=\"freeze flex justify-center align-center text-muted\">${__('Loading')}...</div>`)\n\t\t\t\t.hide();\n\t\tthis.$result.append(this.$freeze);\n\t}\n\n\tsetup_columns() {\n\t\t// setup columns for list view\n\t\tthis.columns = [];\n\n\t\tconst get_df = frappe.meta.get_docfield.bind(null, this.doctype);\n\n\t\t// 1st column: title_field or name\n\t\tif (this.meta.title_field) {\n\t\t\tthis.columns.push({\n\t\t\t\ttype: 'Subject',\n\t\t\t\tdf: get_df(this.meta.title_field)\n\t\t\t});\n\t\t} else {\n\t\t\tthis.columns.push({\n\t\t\t\ttype: 'Subject',\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: __('Name'),\n\t\t\t\t\tfieldname: 'name'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// 2nd column: Status indicator\n\t\tif (frappe.has_indicator(this.doctype)) {\n\t\t\t// indicator\n\t\t\tthis.columns.push({\n\t\t\t\ttype: 'Status'\n\t\t\t});\n\t\t}\n\n\t\tconst fields_in_list_view = this.get_fields_in_list_view();\n\t\t// Add rest from in_list_view docfields\n\t\tthis.columns = this.columns.concat(\n\t\t\tfields_in_list_view\n\t\t\t\t.filter(df => {\n\t\t\t\t\tif (frappe.has_indicator(this.doctype) && df.fieldname === 'status') {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif (!df.in_list_view) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\treturn df.fieldname !== this.meta.title_field;\n\t\t\t\t})\n\t\t\t\t.map(df => ({\n\t\t\t\t\ttype: 'Field',\n\t\t\t\t\tdf\n\t\t\t\t}))\n\t\t);\n\n\t\t// limit to 4 columns\n\t\tthis.columns = this.columns.slice(0, 4);\n\t}\n\n\tget_no_result_message() {\n\t\tconst new_button = this.can_create ?\n\t\t\t`<p><button class=\"btn btn-primary btn-sm btn-new-doc\">\n\t\t\t\t${__('Make a new {0}', [__(this.doctype)])}\n\t\t\t</button></p>` : '';\n\n\t\treturn `<div class=\"msg-box no-border\">\n\t\t\t<p>${__('No {0} found', [__(this.doctype)])}</p>\n\t\t\t${new_button}\n\t\t</div>`;\n\t}\n\n\tfreeze() {\n\t\tthis.$result.find('.list-count').html(`<span>${__('Refreshing')}...</span>`);\n\t}\n\n\tget_args() {\n\t\tconst args = super.get_args();\n\n\t\treturn Object.assign(args, {\n\t\t\twith_comment_count: true\n\t\t});\n\t}\n\n\ttoggle_result_area() {\n\t\tsuper.toggle_result_area();\n\t\tthis.toggle_actions_menu_button(\n\t\t\tthis.$result.find('.list-row-check:checked').length > 0\n\t\t);\n\t}\n\n\ttoggle_actions_menu_button(toggle) {\n\t\tif (toggle) {\n\t\t\tthis.page.show_actions_menu();\n\t\t\tthis.page.clear_primary_action();\n\t\t} else {\n\t\t\tthis.page.hide_actions_menu();\n\t\t\tthis.set_primary_action();\n\t\t}\n\t}\n\n\trender_header() {\n\t\tif (this.$result.find('.list-row-head').length === 0) {\n\t\t\t// append header once\n\t\t\tthis.$result.prepend(this.get_header_html());\n\t\t}\n\t}\n\n\trender_skeleton() {\n\t\tconst $row = this.get_list_row_html_skeleton('<div><input type=\"checkbox\" /></div>');\n\t\tthis.$result.append($row);\n\t}\n\n\tbefore_render() {\n\t\tthis.settings.before_render && this.settings.before_render();\n\t\tfrappe.model.user_settings.save(this.doctype, 'last_view', this.view_name);\n\t\tthis.save_view_user_settings({\n\t\t\tfilters: this.filter_area.get(),\n\t\t\torder_by: this.sort_selector.get_sql_string()\n\t\t});\n\t}\n\n\trender() {\n\t\tthis.$result.find('.list-row-container').remove();\n\t\tif (this.data.length > 0) {\n\t\t\t// append rows\n\t\t\tthis.$result.append(\n\t\t\t\tthis.data.map(doc => this.get_list_row_html(doc)).join('')\n\t\t\t);\n\t\t}\n\t\tthis.render_count();\n\t\tthis.render_tags();\n\t}\n\n\trender_count() {\n\t\tthis.get_count_html()\n\t\t\t.then(html => {\n\t\t\t\tthis.$result.find('.list-count').html(html);\n\t\t\t});\n\t}\n\n\trender_tags() {\n\t\tconst $list_rows = this.$result.find('.list-row-container');\n\n\t\tthis.data.forEach((d, i) => {\n\t\t\tlet tag_html = $(`<div class='tag-row'>\n\t\t\t\t<div class='list-tag hidden-xs'></div>\n\t\t\t</div>`).appendTo($list_rows.get(i));\n\n\t\t\t// add tags\n\t\t\tlet tag_editor = new frappe.ui.TagEditor({\n\t\t\t\tparent: tag_html.find('.list-tag'),\n\t\t\t\tfrm: {\n\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\tdocname: d.name\n\t\t\t\t},\n\t\t\t\tlist_sidebar: this.list_sidebar,\n\t\t\t\tuser_tags: d._user_tags,\n\t\t\t\ton_change: (user_tags) => {\n\t\t\t\t\td._user_tags = user_tags;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ttag_editor.wrapper.on('click', '.tagit-label', (e) => {\n\t\t\t\tconst $this = $(e.currentTarget);\n\t\t\t\tthis.filter_area.add(this.doctype, '_user_tags', '=', $this.text());\n\t\t\t});\n\t\t});\n\t}\n\n\tget_header_html() {\n\t\tconst subject_field = this.columns[0].df;\n\t\tlet subject_html = `\n\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"${__(\"Select All\")}\">\n\t\t\t<span class=\"level-item list-liked-by-me\">\n\t\t\t\t<i class=\"octicon octicon-heart text-extra-muted\" title=\"${__(\"Likes\")}\"></i>\n\t\t\t</span>\n\t\t\t<span class=\"level-item\">${__(subject_field.label)}</span>\n\t\t`;\n\t\tconst $columns = this.columns.map(col => {\n\t\t\tlet classes = [\n\t\t\t\t'list-row-col ellipsis',\n\t\t\t\tcol.type == 'Subject' ? 'list-subject level' : 'hidden-xs',\n\t\t\t\tfrappe.model.is_numeric_field(col.df) ? 'text-right' : ''\n\t\t\t].join(' ');\n\n\t\t\treturn `\n\t\t\t\t<div class=\"${classes}\">\n\t\t\t\t\t${col.type === 'Subject' ? subject_html : `\n\t\t\t\t\t<span>${__(col.df && col.df.label || col.type)}</span>`}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}).join('');\n\n\t\treturn this.get_header_html_skeleton($columns, '<span class=\"list-count\"></span>');\n\t}\n\n\tget_header_html_skeleton(left = '', right = '') {\n\t\treturn `\n\t\t\t<header class=\"level list-row list-row-head text-muted small\">\n\t\t\t\t<div class=\"level-left list-header-subject\">\n\t\t\t\t\t${left}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"level-left checkbox-actions\">\n\t\t\t\t\t<div class=\"level list-subject\">\n\t\t\t\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"${__(\"Select All\")}\">\n\t\t\t\t\t\t<span class=\"level-item list-header-meta\"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"level-right\">\n\t\t\t\t\t${right}\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t`;\n\t}\n\n\tget_left_html(doc) {\n\t\treturn this.columns.map(col => this.get_column_html(col, doc)).join('');\n\t}\n\n\tget_right_html(doc) {\n\t\treturn this.get_meta_html(doc);\n\t}\n\n\tget_list_row_html(doc) {\n\t\treturn this.get_list_row_html_skeleton(this.get_left_html(doc), this.get_right_html(doc));\n\t}\n\n\tget_list_row_html_skeleton(left = '', right = '') {\n\t\treturn `\n\t\t\t<div class=\"list-row-container\">\n\t\t\t\t<div class=\"level list-row small\">\n\t\t\t\t\t<div class=\"level-left ellipsis\">\n\t\t\t\t\t\t${left}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"level-right text-muted ellipsis\">\n\t\t\t\t\t\t${right}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_column_html(col, doc) {\n\t\tif (col.type === 'Status') {\n\t\t\treturn `\n\t\t\t\t<div class=\"list-row-col hidden-xs ellipsis\">\n\t\t\t\t\t${this.get_indicator_html(doc)}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tconst df = col.df || {};\n\t\tconst label = df.label;\n\t\tconst fieldname = df.fieldname;\n\t\tconst value = doc[fieldname] || '';\n\n\t\t// listview_setting formatter\n\t\tconst formatters = this.settings.formatters;\n\n\t\tconst format = () => {\n\t\t\tif (formatters && formatters[fieldname]) {\n\t\t\t\treturn formatters[fieldname](value, df, doc);\n\t\t\t} else if (df.fieldtype === 'Code') {\n\t\t\t\treturn value;\n\t\t\t} else {\n\t\t\t\treturn frappe.format(value, df, null, doc);\n\t\t\t}\n\t\t};\n\n\t\tconst field_html = () => {\n\t\t\tlet html;\n\t\t\tconst _value = typeof value === 'string' ? frappe.utils.escape_html(value) : value;\n\n\t\t\tif (df.fieldtype === 'Image') {\n\t\t\t\thtml = df.options ?\n\t\t\t\t\t`<img src=\"${doc[df.options]}\" style=\"max-height: 30px; max-width: 100%;\">` :\n\t\t\t\t\t`<div class=\"missing-image small\">\n\t\t\t\t\t\t<span class=\"octicon octicon-circle-slash\"></span>\n\t\t\t\t\t</div>`;\n\t\t\t} else if (df.fieldtype === 'Select') {\n\t\t\t\thtml = `<span class=\"filterable indicator ${frappe.utils.guess_colour(_value)} ellipsis\"\n\t\t\t\t\tdata-filter=\"${fieldname},=,${value}\">\n\t\t\t\t\t${__(_value)}\n\t\t\t\t</span>`;\n\t\t\t} else if (df.fieldtype === 'Link') {\n\t\t\t\thtml = `<a class=\"filterable text-muted ellipsis\"\n\t\t\t\t\tdata-filter=\"${fieldname},=,${value}\">\n\t\t\t\t\t${_value}\n\t\t\t\t</a>`;\n\t\t\t} else if (df.fieldtype === 'Text Editor') {\n\t\t\t\thtml = `<span class=\"text-muted ellipsis\">\n\t\t\t\t\t${_value}\n\t\t\t\t</span>`;\n\t\t\t} else {\n\t\t\t\thtml = `<a class=\"filterable text-muted ellipsis\"\n\t\t\t\t\tdata-filter=\"${fieldname},=,${value}\">\n\t\t\t\t\t${format()}\n\t\t\t\t</a>`;\n\t\t\t}\n\n\t\t\treturn `<span class=\"ellipsis\"\n\t\t\t\ttitle=\"${__(label) + ': ' + _value}\">\n\t\t\t\t${html}\n\t\t\t</span>`;\n\t\t};\n\n\t\tconst class_map = {\n\t\t\tSubject: 'list-subject level',\n\t\t\tField: 'hidden-xs'\n\t\t};\n\t\tconst css_class = [\n\t\t\t'list-row-col ellipsis',\n\t\t\tclass_map[col.type],\n\t\t\tfrappe.model.is_numeric_field(df) ? 'text-right' : ''\n\t\t].join(' ');\n\n\t\tconst html_map = {\n\t\t\tSubject: this.get_subject_html(doc),\n\t\t\tField: field_html()\n\t\t};\n\t\tconst column_html = html_map[col.type];\n\n\t\treturn `\n\t\t\t<div class=\"${css_class}\">\n\t\t\t\t${column_html}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_meta_html(doc) {\n\t\tlet html = '';\n\t\tif (doc[this.meta.title_field || ''] !== doc.name) {\n\t\t\thtml += `\n\t\t\t\t<div class=\"level-item hidden-xs hidden-sm ellipsis\">\n\t\t\t\t\t<a class=\"text-muted ellipsis\" href=\"${this.get_form_link(doc)}\">\n\t\t\t\t\t\t${doc.name}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\tconst modified = comment_when(doc.modified, true);\n\n\t\tconst last_assignee = JSON.parse(doc._assign || '[]').slice(-1)[0];\n\t\tconst assigned_to = last_assignee ?\n\t\t\t`<span class=\"filterable\"\n\t\t\t\tdata-filter=\"_assign,like,%${last_assignee}%\">\n\t\t\t\t${frappe.avatar(last_assignee)}\n\t\t\t</span>` :\n\t\t\t`<span class=\"avatar avatar-small avatar-empty\"></span>`;\n\n\t\tconst comment_count =\n\t\t\t`<span class=\"${!doc._comment_count ? 'text-extra-muted' : ''} comment-count\">\n\t\t\t\t<i class=\"octicon octicon-comment-discussion\"></i>\n\t\t\t\t${doc._comment_count > 99 ? \"99+\" : doc._comment_count}\n\t\t\t</span>`;\n\n\t\thtml += `\n\t\t\t<div class=\"level-item hidden-xs list-row-activity\">\n\t\t\t\t${modified}\n\t\t\t\t${assigned_to}\n\t\t\t\t${comment_count}\n\t\t\t</div>\n\t\t\t<div class=\"level-item visible-xs text-right\">\n\t\t\t\t${this.get_indicator_dot(doc)}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn html;\n\t}\n\n\tget_count_html() {\n\t\tconst current_count = this.data.length;\n\n\t\treturn frappe.call({\n\t\t\ttype: 'GET',\n\t\t\tmethod: this.method,\n\t\t\targs: {\n\t\t\t\tdoctype: this.doctype,\n\t\t\t\tfilters: this.get_filters_for_args(),\n\t\t\t\tfields: [`count(${frappe.model.get_full_column_name('name', this.doctype)}) as total_count`]\n\t\t\t}\n\t\t}).then(r => {\n\t\t\tconst count = r.message.values[0][0] || current_count;\n\t\t\tconst str = __('{0} of {1}', [current_count, count]);\n\t\t\tconst html = `<span>${str}</span>`;\n\t\t\treturn html;\n\t\t});\n\t}\n\n\tget_form_link(doc) {\n\t\tconst docname = doc.name.match(/[%'\"]/)\n\t\t\t? encodeURIComponent(doc.name)\n\t\t\t: doc.name;\n\n\t\treturn '#Form/' + this.doctype + '/' + docname;\n\t}\n\n\tget_subject_html(doc) {\n\t\tlet user = frappe.session.user;\n\t\tlet subject_field = this.columns[0].df;\n\t\tlet value = doc[subject_field.fieldname] || doc.name;\n\t\tlet subject = strip_html(value);\n\t\tlet escaped_subject = frappe.utils.escape_html(value);\n\n\t\tconst liked_by = JSON.parse(doc._liked_by || '[]');\n\t\tlet heart_class = liked_by.includes(user) ?\n\t\t\t'liked-by' : 'text-extra-muted not-liked';\n\n\t\tconst seen = JSON.parse(doc._seen || '[]')\n\t\t\t.includes(user) ? '' : 'bold';\n\n\t\tlet subject_html = `\n\t\t\t<input class=\"level-item list-row-checkbox hidden-xs\" type=\"checkbox\" data-name=\"${doc.name}\">\n\t\t\t<span class=\"level-item\" style=\"margin-bottom: 1px;\">\n\t\t\t\t<i class=\"octicon octicon-heart like-action ${heart_class}\"\n\t\t\t\t\tdata-name=\"${doc.name}\" data-doctype=\"${this.doctype}\"\n\t\t\t\t\tdata-liked-by=\"${encodeURI(doc._liked_by) || '[]'}\"\n\t\t\t\t>\n\t\t\t\t</i>\n\t\t\t\t<span class=\"likes-count\">\n\t\t\t\t\t${ liked_by.length > 99 ? __(\"99\") + '+' : __(liked_by.length || '')}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<span class=\"level-item ${seen} ellipsis\" title=\"${escaped_subject}\">\n\t\t\t\t<a class=\"ellipsis\" href=\"${this.get_form_link(doc)}\" title=\"${escaped_subject}\">\n\t\t\t\t${subject}\n\t\t\t\t</a>\n\t\t\t</span>\n\t\t`;\n\n\t\treturn subject_html;\n\t}\n\n\tget_indicator_html(doc) {\n\t\tconst indicator = frappe.get_indicator(doc, this.doctype);\n\t\tif (indicator) {\n\t\t\treturn `<span class=\"indicator ${indicator[1]} filterable\"\n\t\t\t\tdata-filter='${indicator[2]}'>\n\t\t\t\t${__(indicator[0])}\n\t\t\t<span>`;\n\t\t}\n\t\treturn '';\n\t}\n\n\tget_indicator_dot(doc) {\n\t\tconst indicator = frappe.get_indicator(doc, this.doctype);\n\t\tif (!indicator) return '';\n\t\treturn `<span class='indicator ${indicator[1]}' title='${__(indicator[0])}'></span>`;\n\t}\n\n\tsetup_events() {\n\t\t// filterable events\n\t\tthis.$result.on('click', '.filterable', e => {\n\t\t\tif (e.metaKey || e.ctrlKey) return;\n\t\t\te.stopPropagation();\n\t\t\tconst $this = $(e.currentTarget);\n\t\t\tconst filters = $this.attr('data-filter').split('|');\n\n\t\t\tconst filters_to_apply = filters.map(f => {\n\t\t\t\tf = f.split(',');\n\t\t\t\tif (f[2] === 'Today') {\n\t\t\t\t\tf[2] = frappe.datetime.get_today();\n\t\t\t\t} else if (f[2] == 'User') {\n\t\t\t\t\tf[2] = frappe.session.user;\n\t\t\t\t}\n\t\t\t\treturn [this.doctype, f[0], f[1], f.slice(2).join(',')];\n\t\t\t});\n\t\t\tthis.filter_area.add(filters_to_apply);\n\t\t});\n\n\t\tthis.$result.on('click', '.list-row', (e) => {\n\t\t\tconst $target = $(e.target);\n\n\t\t\t// tick checkbox if Ctrl/Meta key is pressed\n\t\t\tif (e.ctrlKey || e.metaKey && !$target.is('a')) {\n\t\t\t\tconst $list_row = $(e.currentTarget);\n\t\t\t\tconst $check = $list_row.find('.list-row-checkbox');\n\t\t\t\t$check.prop('checked', !$check.prop('checked'));\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.on_row_checked();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// don't open form when checkbox, like, filterable are clicked\n\t\t\tif ($target.hasClass('filterable') ||\n\t\t\t\t$target.hasClass('octicon-heart') ||\n\t\t\t\t$target.is(':checkbox') ||\n\t\t\t\t$target.is('a')\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// open form\n\t\t\tconst $row = $(e.currentTarget);\n\t\t\tconst link = $row.find('.list-subject a').get(0);\n\t\t\tif (link) {\n\t\t\t\twindow.location.href = link.href;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\t// toggle tags\n\t\tthis.list_sidebar.parent.on('click', '.list-tag-preview', () => {\n\t\t\tthis.toggle_tags();\n\t\t});\n\n\t\tthis.$no_result.find('.btn-new-doc').click(() => this.make_new_doc());\n\n\t\tthis.setup_check_events();\n\t\tthis.setup_like();\n\t}\n\n\tsetup_check_events() {\n\t\tthis.$result.on('change', 'input[type=checkbox]', e => {\n\t\t\tconst $target = $(e.currentTarget);\n\n\t\t\tif ($target.is('.list-header-subject .list-check-all')) {\n\t\t\t\tconst $check = this.$result.find('.checkbox-actions .list-check-all');\n\t\t\t\t$check.prop('checked', $target.prop('checked'));\n\t\t\t\t$check.trigger('change');\n\t\t\t} else if ($target.is('.checkbox-actions .list-check-all')) {\n\t\t\t\tconst $check = this.$result.find('.list-header-subject .list-check-all');\n\t\t\t\t$check.prop('checked', $target.prop('checked'));\n\n\t\t\t\tthis.$result.find('.list-row-checkbox')\n\t\t\t\t\t.prop('checked', $target.prop('checked'));\n\t\t\t}\n\n\t\t\tthis.on_row_checked();\n\t\t});\n\n\t\tthis.$result.on('click', '.list-row-checkbox', e => {\n\t\t\tconst $target = $(e.currentTarget);\n\n\t\t\t// shift select checkboxes\n\t\t\tif (e.shiftKey && this.$checkbox_cursor && !$target.is(this.$checkbox_cursor)) {\n\t\t\t\tconst name_1 = this.$checkbox_cursor.data().name;\n\t\t\t\tconst name_2 = $target.data().name;\n\t\t\t\tconst index_1 = this.data.findIndex(d => d.name === name_1);\n\t\t\t\tconst index_2 = this.data.findIndex(d => d.name === name_2);\n\t\t\t\tlet [min_index, max_index] = [index_1, index_2];\n\n\t\t\t\tif (min_index > max_index) {\n\t\t\t\t\t[min_index, max_index] = [max_index, min_index];\n\t\t\t\t}\n\n\t\t\t\tlet docnames = this.data.slice(min_index + 1, max_index).map(d => d.name);\n\t\t\t\tconst selector = docnames.map(name => `.list-row-checkbox[data-name=\"${name}\"]`).join(',');\n\t\t\t\tthis.$result.find(selector).prop('checked', true);\n\t\t\t}\n\n\t\t\tthis.$checkbox_cursor = $target;\n\t\t});\n\t}\n\n\tsetup_like() {\n\t\tthis.$result.on('click', '.like-action', frappe.ui.click_toggle_like);\n\t\tthis.$result.on('click', '.list-liked-by-me', e => {\n\t\t\tconst $this = $(e.currentTarget);\n\t\t\t$this.toggleClass('active');\n\n\t\t\tif ($this.hasClass('active')) {\n\t\t\t\tthis.filter_area.add(this.doctype, '_liked_by', 'like', '%' + frappe.session.user + '%');\n\t\t\t} else {\n\t\t\t\tthis.filter_area.remove('_liked_by');\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.setup_like_popover(this.$result, '.liked-by');\n\t}\n\n\ton_row_checked() {\n\t\tthis.$list_head_subject = this.$list_head_subject || this.$result.find('header .list-header-subject');\n\t\tthis.$checkbox_actions = this.$checkbox_actions || this.$result.find('header .checkbox-actions');\n\n\t\tthis.$checks = this.$result.find('.list-row-checkbox:checked');\n\n\t\tthis.$list_head_subject.toggle(this.$checks.length === 0);\n\t\tthis.$checkbox_actions.toggle(this.$checks.length > 0);\n\n\t\tif (this.$checks.length === 0) {\n\t\t\tthis.$list_head_subject.find('.list-select-all').prop('checked', false);\n\t\t} else {\n\t\t\tthis.$checkbox_actions.find('.list-header-meta').html(\n\t\t\t\t__('{0} items selected', [this.$checks.length])\n\t\t\t);\n\t\t\tthis.$checkbox_actions.show();\n\t\t\tthis.$list_head_subject.hide();\n\t\t}\n\t\tthis.toggle_actions_menu_button(this.$checks.length > 0);\n\t}\n\n\ttoggle_tags() {\n\t\tthis.$result.toggleClass('tags-shown');\n\t}\n\n\tget_checked_items(only_docnames) {\n\t\tconst docnames = Array.from(this.$checks || [])\n\t\t\t.map(check => $(check).data().name);\n\n\t\tif (only_docnames) return docnames;\n\n\t\treturn this.data.filter(d => docnames.includes(d.name));\n\t}\n\n\tsave_view_user_settings(obj) {\n\t\treturn frappe.model.user_settings.save(this.doctype, this.view_name, obj);\n\t}\n\n\ton_update(data) {\n\t\tif (data.doctype === this.doctype) {\n\t\t\tthis.refresh();\n\t\t}\n\t}\n\n\tget_menu_items() {\n\t\tconst doctype = this.doctype;\n\t\tconst items = [];\n\n\t\tif (frappe.model.can_import(doctype)) {\n\t\t\titems.push({\n\t\t\t\tlabel: __('Import'),\n\t\t\t\taction: () => frappe.set_route('List', 'Data Import', {\n\t\t\t\t\treference_doctype: doctype\n\t\t\t\t}),\n\t\t\t\tstandard: true\n\t\t\t});\n\t\t}\n\n\t\tif (frappe.model.can_set_user_permissions(doctype)) {\n\t\t\titems.push({\n\t\t\t\tlabel: __('User Permissions'),\n\t\t\t\taction: () => frappe.set_route('List', 'User Permission', {\n\t\t\t\t\tallow: doctype\n\t\t\t\t}),\n\t\t\t\tstandard: true\n\t\t\t});\n\t\t}\n\n\t\tif (frappe.user_roles.includes('System Manager')) {\n\t\t\titems.push({\n\t\t\t\tlabel: __('Role Permissions Manager'),\n\t\t\t\taction: () => frappe.set_route('permission-manager', {\n\t\t\t\t\tdoctype\n\t\t\t\t}),\n\t\t\t\tstandard: true\n\t\t\t});\n\n\t\t\titems.push({\n\t\t\t\tlabel: __('Customize'),\n\t\t\t\taction: () => frappe.set_route('Form', 'Customize Form', {\n\t\t\t\t\tdoc_type: doctype\n\t\t\t\t}),\n\t\t\t\tstandard: true\n\t\t\t});\n\t\t}\n\n\t\titems.push({\n\t\t\tlabel: __('Toggle Sidebar'),\n\t\t\taction: () => this.toggle_side_bar(),\n\t\t\tstandard: true\n\t\t});\n\n\t\t// add to desktop\n\t\titems.push({\n\t\t\tlabel: __('Add to Desktop'),\n\t\t\taction: () => frappe.add_to_desktop(doctype, doctype),\n\t\t\tstandard: true\n\t\t});\n\n\t\tif (frappe.user.has_role('System Manager') && frappe.boot.developer_mode === 1) {\n\t\t\t// edit doctype\n\t\t\titems.push({\n\t\t\t\tlabel: __('Edit DocType'),\n\t\t\t\taction: () => frappe.set_route('Form', 'DocType', doctype),\n\t\t\t\tstandard: true\n\t\t\t});\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tget_actions_menu_items() {\n\t\tconst doctype = this.doctype;\n\t\tconst actions_menu_items = [];\n\t\tconst bulk_operations = new BulkOperations({ doctype: this.doctype });\n\n\t\tconst is_field_editable = (field_doc) => {\n\t\t\treturn field_doc.fieldname && frappe.model.is_value_type(field_doc)\n\t\t\t\t&& field_doc.fieldtype !== 'Read Only' && !field_doc.hidden && !field_doc.read_only;\n\t\t};\n\n\t\tconst has_editable_fields = (doctype) => {\n\t\t\treturn frappe.meta.get_docfields(doctype).some(field_doc => is_field_editable(field_doc));\n\t\t};\n\n\t\tconst has_submit_permission = (doctype) => {\n\t\t\treturn frappe.perm.has_perm(doctype, 0, 'submit');\n\t\t};\n\n\t\t// utility\n\t\tconst bulk_assignment = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Assign To'),\n\t\t\t\taction: () => bulk_operations.assign(this.get_checked_items(true), this.refresh),\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_printing = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Print'),\n\t\t\t\taction: () => bulk_operations.print(this.get_checked_items()),\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_delete = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Delete'),\n\t\t\t\taction: () => {\n\t\t\t\t\tconst docnames = this.get_checked_items(true);\n\t\t\t\t\tfrappe.confirm(__('Delete {0} items permanently?', [docnames.length]),\n\t\t\t\t\t\t() => bulk_operations.delete(docnames, this.refresh));\n\t\t\t\t},\n\t\t\t\tstandard: true,\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_cancel = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Cancel'),\n\t\t\t\taction: () => {\n\t\t\t\t\tconst docnames = this.get_checked_items(true);\n\t\t\t\t\tif (docnames.length > 0) {\n\t\t\t\t\t\tfrappe.confirm(__('Cancel {0} documents?', [docnames.length]),\n\t\t\t\t\t\t\t() => bulk_operations.submit_or_cancel(docnames, 'cancel', this.refresh));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_submit = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Submit'),\n\t\t\t\taction: () => {\n\t\t\t\t\tconst docnames = this.get_checked_items(true);\n\t\t\t\t\tif (docnames.length > 0) {\n\t\t\t\t\t\tfrappe.confirm(__('Submit {0} documents?', [docnames.length]),\n\t\t\t\t\t\t\t() => bulk_operations.submit_or_cancel(docnames, 'submit', this.refresh));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_edit = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Edit'),\n\t\t\t\taction: () => {\n\t\t\t\t\tlet field_mappings = {};\n\n\t\t\t\t\tfrappe.meta.get_docfields(doctype).forEach(field_doc => {\n\t\t\t\t\t\tif (is_field_editable(field_doc)) {\n\t\t\t\t\t\t\tfield_mappings[field_doc.label] = Object.assign({}, field_doc);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tconst docnames = this.get_checked_items(true);\n\n\t\t\t\t\tbulk_operations.edit(docnames, field_mappings, this.refresh);\n\t\t\t\t},\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\t// bulk edit\n\t\tif (has_editable_fields(doctype)) {\n\t\t\tactions_menu_items.push(bulk_edit());\n\t\t}\n\n\t\t// bulk assignment\n\t\tactions_menu_items.push(bulk_assignment());\n\n\t\t// bulk printing\n\t\tif (frappe.model.can_print(doctype)) {\n\t\t\tactions_menu_items.push(bulk_printing());\n\t\t}\n\n\t\t// Bulk submit\n\t\tif (frappe.model.is_submittable(doctype) && has_submit_permission(doctype)) {\n\t\t\tactions_menu_items.push(bulk_submit());\n\t\t}\n\n\t\t// Bulk cancel\n\t\tif (frappe.model.can_cancel(doctype)) {\n\t\t\tactions_menu_items.push(bulk_cancel());\n\t\t}\n\n\t\t// bulk delete\n\t\tif (frappe.model.can_delete(doctype)) {\n\t\t\tactions_menu_items.push(bulk_delete());\n\t\t}\n\n\t\treturn actions_menu_items;\n\t}\n\n\tset_filters_from_route_options() {\n\t\tconst filters = [];\n\t\tfor (let field in frappe.route_options) {\n\t\t\tvar value = frappe.route_options[field];\n\t\t\tvar doctype = null;\n\n\t\t\t// if `Child DocType.fieldname`\n\t\t\tif (field.includes('.')) {\n\t\t\t\tdoctype = field.split('.')[0];\n\t\t\t\tfield = field.split('.')[1];\n\t\t\t}\n\n\t\t\t// find the table in which the key exists\n\t\t\t// for example the filter could be {\"item_code\": \"X\"}\n\t\t\t// where item_code is in the child table.\n\n\t\t\t// we can search all tables for mapping the doctype\n\t\t\tif (!doctype) {\n\t\t\t\tdoctype = frappe.meta.get_doctype_for_field(this.doctype, field);\n\t\t\t}\n\n\t\t\tif (doctype) {\n\t\t\t\tif ($.isArray(value)) {\n\t\t\t\t\tfilters.push([doctype, field, value[0], value[1]]);\n\t\t\t\t} else {\n\t\t\t\t\tfilters.push([doctype, field, \"=\", value]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfrappe.route_options = null;\n\n\t\tthis.filter_area.add(filters);\n\t}\n\n\tstatic trigger_list_update(data) {\n\t\tconst doctype = data.doctype;\n\t\tif (!doctype) return;\n\t\tfrappe.provide('frappe.views.trees');\n\n\t\t// refresh tree view\n\t\tif (frappe.views.trees[doctype]) {\n\t\t\tfrappe.views.trees[doctype].tree.refresh();\n\t\t\treturn;\n\t\t}\n\n\t\t// refresh list view\n\t\tconst page_name = frappe.get_route_str();\n\t\tconst list_view = frappe.views.list_view[page_name];\n\t\tlist_view && list_view.on_update(data);\n\t}\n};\n\n$(document).on('save', (event, doc) => {\n\tfrappe.views.ListView.trigger_list_update(doc);\n});","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.views.list_view');\n\nwindow.cur_list = null;\nfrappe.views.ListFactory = frappe.views.Factory.extend({\n\tmake: function (route) {\n\t\tvar me = this;\n\t\tvar doctype = route[1];\n\n\t\tfrappe.model.with_doctype(doctype, function () {\n\t\t\tif (locals['DocType'][doctype].issingle) {\n\t\t\t\tfrappe.set_re_route('Form', doctype);\n\t\t\t} else {\n\t\t\t\t// List / Gantt / Kanban / etc\n\t\t\t\t// File is a special view\n\t\t\t\tconst view_name = doctype !== 'File' ? route[2] : 'File';\n\t\t\t\tlet view_class = frappe.views[view_name + 'View'];\n\t\t\t\tif (!view_class) view_class = frappe.views.ListView;\n\n\t\t\t\tif (view_class && view_class.load_last_view && view_class.load_last_view()) {\n\t\t\t\t\t// view can have custom routing logic\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfrappe.provide('frappe.views.list_view.' + doctype);\n\t\t\t\tconst page_name = frappe.get_route_str();\n\n\t\t\t\tif (!frappe.views.list_view[page_name]) {\n\t\t\t\t\tfrappe.views.list_view[page_name] = new view_class({\n\t\t\t\t\t\tdoctype: doctype,\n\t\t\t\t\t\tparent: me.make_page(true, page_name)\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.container.change_to(page_name);\n\t\t\t\t}\n\t\t\t\tme.set_cur_list();\n\t\t\t}\n\t\t});\n\t},\n\tshow: function () {\n\t\tif(this.re_route_to_view()) {\n\t\t\treturn;\n\t\t}\n\t\tthis.set_module_breadcrumb();\n\t\tthis._super();\n\t\tthis.set_cur_list();\n\t\tcur_list && cur_list.show();\n\t},\n\tre_route_to_view: function() {\n\t\tvar route = frappe.get_route();\n\t\tvar doctype = route[1];\n\t\tvar last_route = frappe.route_history.slice(-2)[0];\n\t\tif (route[0] === 'List' && route.length === 2 && frappe.views.list_view[doctype]) {\n\t\t\tif(last_route && last_route[0]==='List' && last_route[1]===doctype) {\n\t\t\t\t// last route same as this route, so going back.\n\t\t\t\t// this happens because #List/Item will redirect to #List/Item/List\n\t\t\t\t// while coming from back button, the last 2 routes will be same, so\n\t\t\t\t// we know user is coming in the reverse direction (via back button)\n\n\t\t\t\t// example:\n\t\t\t\t// Step 1: #List/Item redirects to #List/Item/List\n\t\t\t\t// Step 2: User hits \"back\" comes back to #List/Item\n\t\t\t\t// Step 3: Now we cannot send the user back to #List/Item/List so go back one more step\n\t\t\t\twindow.history.go(-1);\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t},\n\tset_module_breadcrumb: function () {\n\t\tif (frappe.route_history.length > 1) {\n\t\t\tvar prev_route = frappe.route_history[frappe.route_history.length - 2];\n\t\t\tif (prev_route[0] === 'modules') {\n\t\t\t\tvar doctype = frappe.get_route()[1],\n\t\t\t\t\tmodule = prev_route[1];\n\t\t\t\tif (frappe.module_links[module] && frappe.module_links[module].includes(doctype)) {\n\t\t\t\t\t// save the last page from the breadcrumb was accessed\n\t\t\t\t\tfrappe.breadcrumbs.set_doctype_module(doctype, module);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tset_cur_list: function () {\n\t\tvar route = frappe.get_route();\n\t\tvar page_name = frappe.get_route_str();\n\t\tcur_list = frappe.views.list_view[page_name];\n\t\tif (cur_list && cur_list.doctype !== route[1]) {\n\t\t\t// changing...\n\t\t\twindow.cur_list = null;\n\t\t}\n\t}\n});\n","frappe.provide('frappe.ui');\n\nexport default class ListFilter {\n\tconstructor({ wrapper, doctype }) {\n\t\tObject.assign(this, arguments[0]);\n\t\tthis.can_add_global = frappe.user.has_role(['System Manager', 'Administrator']);\n\t\tthis.filters = [];\n\t\tthis.make();\n\t\tthis.bind();\n\t\tthis.refresh();\n\t}\n\n\tmake() {\n\t\t// init dom\n\t\tthis.wrapper.html('<li class=\"input-area\"></li>');\n\t\tthis.$input_area = this.wrapper.find('.input-area');\n\t\tthis.$list_filters = this.wrapper.find('.list-filters');\n\n\t\tthis.filter_input = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tlabel: __('Save Filter').toUpperCase(),\n\t\t\t\tplaceholder: __('Filter Name'),\n\t\t\t\tinput_class: 'input-xs'\n\t\t\t},\n\t\t\tparent: this.$input_area,\n\t\t\trender_input: 1,\n\t\t});\n\n\t\t$(this.filter_input.label_area).css('font-size', 10);\n\n\t\tthis.is_global_input = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Check',\n\t\t\t\tlabel: __('Is Global')\n\t\t\t},\n\t\t\tparent: this.$input_area,\n\t\t\trender_input: 1\n\t\t});\n\n\t}\n\n\tbind() {\n\t\tthis.bind_save_filter();\n\t\tthis.bind_click_filter();\n\t\tthis.bind_remove_filter();\n\t}\n\n\trefresh() {\n\t\tthis.get_list_filters()\n\t\t\t.then(() => {\n\t\t\t\tconst html = this.filters.map(filter => this.filter_template(filter));\n\t\t\t\tthis.wrapper.find('.list-link').remove();\n\t\t\t\tthis.wrapper.append(html);\n\t\t\t});\n\t\tthis.is_global_input.toggle(false);\n\t\tthis.filter_input.set_description('');\n\t}\n\n\tfilter_template(filter) {\n\t\treturn `<li class=\"list-link\" data-name=\"${filter.name}\">\n\t\t\t<a style=\"max-width: 90%;\">${filter.filter_name}</a>\n\t\t\t<a class=\"text-muted pull-right\"><span class=\"remove octicon octicon-x\"></span></a>\n\t\t</li>`;\n\t}\n\n\tbind_click_filter() {\n\t\tthis.wrapper.on('click', '.list-link', e => {\n\t\t\tconst name = $(e.currentTarget).attr('data-name');\n\t\t\tthis.list_view.filter_area.clear()\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.list_view.filter_area.add(this.get_filters_values(name));\n\t\t\t\t});\n\t\t});\n\t}\n\n\tbind_remove_filter() {\n\t\tthis.wrapper.on('click', '.list-link .remove', e => {\n\t\t\tconst $li = $(e.currentTarget).closest('.list-link')\n\t\t\tconst name = $li.attr('data-name');\n\t\t\t$li.remove();\n\t\t\tthis.remove_filter(name)\n\t\t\t\t.then(() => this.refresh());\n\t\t});\n\t}\n\n\tbind_save_filter() {\n\t\tthis.filter_input.$input.keydown(frappe.utils.debounce(e => {\n\t\t\tconst value = this.filter_input.get_value();\n\t\t\tconst has_value = Boolean(value);\n\n\t\t\tif (e.which === frappe.ui.keyCode['ENTER']) {\n\t\t\t\tif (!has_value || this.filter_name_exists(value)) return;\n\n\t\t\t\tthis.filter_input.set_value('');\n\t\t\t\tthis.save_filter(value)\n\t\t\t\t\t.then(() => this.refresh());\n\t\t\t} else {\n\t\t\t\tlet help_text = __('Press Enter to save');\n\n\t\t\t\tif (this.filter_name_exists(value)) {\n\t\t\t\t\thelp_text = __('Duplicate Filter Name');\n\t\t\t\t}\n\n\t\t\t\tthis.filter_input.set_description(has_value ? help_text : '');\n\n\t\t\t\tif (this.can_add_global) {\n\t\t\t\t\tthis.is_global_input.toggle(has_value);\n\t\t\t\t}\n\t\t\t}\n\t\t}, 300));\n\t}\n\n\tsave_filter(filter_name) {\n\t\treturn frappe.db.insert({\n\t\t\tdoctype: 'List Filter',\n\t\t\treference_doctype: this.list_view.doctype,\n\t\t\tfilter_name,\n\t\t\tfor_user: this.is_global_input.get_value() ? '' : frappe.session.user,\n\t\t\tfilters: JSON.stringify(this.get_current_filters())\n\t\t});\n\t}\n\n\tremove_filter(name) {\n\t\tif (!name) return;\n\t\treturn frappe.db.delete_doc('List Filter', name);\n\t}\n\n\tget_filters_values(name) {\n\t\tconst filter = this.filters.find(filter => filter.name === name);\n\t\treturn  JSON.parse(filter.filters || '[]');\n\t}\n\n\tget_current_filters() {\n\t\treturn this.list_view.filter_area.get();\n\t}\n\n\tfilter_name_exists(filter_name) {\n\t\treturn (this.filters || []).find(f => f.filter_name === filter_name);\n\t}\n\n\tget_list_filters() {\n\t\treturn frappe.db.get_list('List Filter', {\n\t\t\tfields: ['name', 'filter_name', 'for_user', 'filters'],\n\t\t\tfilters: { reference_doctype: this.list_view.doctype },\n\t\t\tor_filters: [['for_user', '=', frappe.session.user], ['for_user', '=', '']]\n\t\t}).then((filters) => {\n\t\t\tthis.filters = filters || [];\n\t\t});\n\t}\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nimport ListFilter from './list_filter';\nfrappe.provide('frappe.views');\n\n// opts:\n// stats = list of fields\n// doctype\n// parent\n// set_filter = function called on click\n\nfrappe.views.ListSidebar = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t\tthis.get_stats();\n\t\tthis.cat_tags = [];\n\t},\n\tmake: function() {\n\t\tvar sidebar_content = frappe.render_template(\"list_sidebar\", { doctype: this.doctype });\n\n\t\tthis.sidebar = $('<div class=\"list-sidebar overlay-sidebar hidden-xs hidden-sm\"></div>')\n\t\t\t.html(sidebar_content)\n\t\t\t.appendTo(this.page.sidebar.empty());\n\n\t\tthis.setup_reports();\n\t\tthis.setup_list_filter();\n\t\tthis.setup_assigned_to_me();\n\t\tthis.setup_views();\n\t\tthis.setup_kanban_boards();\n\t\tthis.setup_calendar_view();\n\t\tthis.setup_email_inbox();\n\n\t\tlet limits = frappe.boot.limits;\n\n\t\tif (limits.upgrade_url && limits.expiry && !frappe.flags.upgrade_dismissed) {\n\t\t\tthis.setup_upgrade_box();\n\t\t}\n\t},\n\tsetup_views: function() {\n\t\tvar show_list_link = false;\n\n\t\tif (frappe.views.calendar[this.doctype]) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Calendar\"]').removeClass(\"hide\");\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Gantt\"]').removeClass('hide');\n\t\t\tshow_list_link = true;\n\t\t}\n\t\t//show link for kanban view\n\t\tthis.sidebar.find('.list-link[data-view=\"Kanban\"]').removeClass('hide');\n\t\tif (this.doctype === \"Communication\" && frappe.boot.email_accounts.length) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Inbox\"]').removeClass('hide');\n\t\t\tshow_list_link = true;\n\t\t}\n\n\t\tif (frappe.treeview_settings[this.doctype]) {\n\t\t\tthis.sidebar.find(\".tree-link\").removeClass(\"hide\");\n\t\t}\n\n\t\tthis.current_view = 'List';\n\t\tvar route = frappe.get_route();\n\t\tif (route.length > 2 && frappe.views.view_modes.includes(route[2])) {\n\t\t\tthis.current_view = route[2];\n\n\t\t\tif (this.current_view === 'Kanban') {\n\t\t\t\tthis.kanban_board = route[3];\n\t\t\t} else if (this.current_view === 'Inbox') {\n\t\t\t\tthis.email_account = route[3];\n\t\t\t}\n\t\t}\n\n\t\t// disable link for current view\n\t\tthis.sidebar.find('.list-link[data-view=\"' + this.current_view + '\"] a')\n\t\t\t.attr('disabled', 'disabled').addClass('disabled');\n\n\t\t//enable link for Kanban view\n\t\tthis.sidebar.find('.list-link[data-view=\"Kanban\"] a, .list-link[data-view=\"Inbox\"] a')\n\t\t\t.attr('disabled', null).removeClass('disabled');\n\n\t\t// show image link if image_view\n\t\tif (this.list_view.meta.image_field) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Image\"]').removeClass('hide');\n\t\t\tshow_list_link = true;\n\t\t}\n\n\t\tif (show_list_link) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"List\"]').removeClass('hide');\n\t\t}\n\t},\n\tsetup_reports: function() {\n\t\t// add reports linked to this doctype to the dropdown\n\t\tvar me = this;\n\t\tvar added = [];\n\t\tvar dropdown = this.page.sidebar.find('.reports-dropdown');\n\t\tvar divider = false;\n\n\t\tvar add_reports = function(reports) {\n\t\t\t$.each(reports, function(name, r) {\n\t\t\t\tif (!r.ref_doctype || r.ref_doctype == me.doctype) {\n\t\t\t\t\tvar report_type = r.report_type === 'Report Builder' ?\n\t\t\t\t\t\t`List/${r.ref_doctype}/Report` : 'query-report';\n\n\t\t\t\t\tvar route = r.route || report_type + '/' + (r.title || r.name);\n\n\t\t\t\t\tif (added.indexOf(route) === -1) {\n\t\t\t\t\t\t// don't repeat\n\t\t\t\t\t\tadded.push(route);\n\n\t\t\t\t\t\tif (!divider) {\n\t\t\t\t\t\t\tme.get_divider().appendTo(dropdown);\n\t\t\t\t\t\t\tdivider = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$('<li><a href=\"#' + route + '\">' +\n\t\t\t\t\t\t\t__(r.title || r.name) + '</a></li>').appendTo(dropdown);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t// from reference doctype\n\t\tif (this.list_view.settings.reports) {\n\t\t\tadd_reports(this.list_view.settings.reports);\n\t\t}\n\n\t\t// from specially tagged reports\n\t\tadd_reports(frappe.boot.user.all_reports || []);\n\t},\n\n\tsetup_list_filter: function() {\n\t\tthis.list_filter = new ListFilter({\n\t\t\twrapper: this.page.sidebar.find('.list-filters'),\n\t\t\tdoctype: this.doctype,\n\t\t\tlist_view: this.list_view\n\t\t});\n\t},\n\n\tsetup_kanban_boards: function() {\n\t\t// add kanban boards linked to this doctype to the dropdown\n\t\tvar me = this;\n\t\tvar $dropdown = this.page.sidebar.find('.kanban-dropdown');\n\t\tvar divider = false;\n\n\t\tvar meta = frappe.get_meta(this.doctype);\n\t\tvar boards = meta && meta.__kanban_boards;\n\t\tif (!boards) return;\n\n\t\tboards.forEach(function(board) {\n\t\t\tvar route = [\"List\", board.reference_doctype, \"Kanban\", board.name].join('/');\n\t\t\tif (!divider) {\n\t\t\t\tme.get_divider().appendTo($dropdown);\n\t\t\t\tdivider = true;\n\t\t\t}\n\t\t\t$(`<li><a href=\"#${route}\">\n\t\t\t\t<span>${__(board.name)}</span>\n\t\t\t\t${board.private ? '<i class=\"fa fa-lock fa-fw text-warning\"></i>' : ''}\n\t\t\t</a></li>`).appendTo($dropdown);\n\t\t});\n\n\t\t$dropdown.find('.new-kanban-board').click(function() {\n\t\t\t// frappe.new_doc('Kanban Board', {reference_doctype: me.doctype});\n\t\t\tvar select_fields = frappe.get_meta(me.doctype)\n\t\t\t\t.fields.filter(function(df) {\n\t\t\t\t\treturn df.fieldtype === 'Select' &&\n\t\t\t\t\t\tdf.fieldname !== 'kanban_column';\n\t\t\t\t});\n\n\t\t\tvar fields = [{\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tfieldname: 'board_name',\n\t\t\t\tlabel: __('Kanban Board Name'),\n\t\t\t\treqd: 1\n\t\t\t}];\n\n\t\t\tif (select_fields.length > 0) {\n\t\t\t\tfields = fields.concat([{\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\tfieldname: 'field_name',\n\t\t\t\t\tlabel: __('Columns based on'),\n\t\t\t\t\toptions: select_fields.map(df => df.label).join('\\n'),\n\t\t\t\t\tdefault: select_fields[0]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Check',\n\t\t\t\t\tfieldname: 'custom_column',\n\t\t\t\t\tlabel: __('Custom Column'),\n\t\t\t\t\tdefault: 0,\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tvar checked = d.get_value('custom_column');\n\t\t\t\t\t\tif (checked) {\n\t\t\t\t\t\t\t$(d.body).find('.frappe-control[data-fieldname=\"field_name\"]').hide();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$(d.body).find('.frappe-control[data-fieldname=\"field_name\"]').show();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t]);\n\t\t\t}\n\n\t\t\tif (me.doctype === 'Task') {\n\t\t\t\tfields[0].description = __('A new Project with this name will be created');\n\t\t\t}\n\n\t\t\tif (['Note', 'ToDo'].includes(me.doctype)) {\n\t\t\t\tfields[0].description = __('This Kanban Board will be private');\n\t\t\t}\n\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: __('New Kanban Board'),\n\t\t\t\tfields: fields,\n\t\t\t\tprimary_action_label: __('Save'),\n\t\t\t\tprimary_action: function(values) {\n\n\t\t\t\t\tvar custom_column = values.custom_column !== undefined ?\n\t\t\t\t\t\tvalues.custom_column : 1;\n\t\t\t\t\tvar field_name;\n\t\t\t\t\tif (custom_column) {\n\t\t\t\t\t\tfield_name = 'kanban_column';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfield_name =\n\t\t\t\t\t\t\tselect_fields\n\t\t\t\t\t\t\t\t.find(df => df.label === values.field_name)\n\t\t\t\t\t\t\t\t.fieldname;\n\t\t\t\t\t}\n\n\t\t\t\t\tme.add_custom_column_field(custom_column)\n\t\t\t\t\t\t.then(function() {\n\t\t\t\t\t\t\treturn me.make_kanban_board(values.board_name, field_name);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(function() {\n\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t}, function(err) {\n\t\t\t\t\t\t\tfrappe.msgprint(err);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\td.show();\n\t\t});\n\t},\n\tadd_custom_column_field: function(flag) {\n\t\tvar me = this;\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tif (!flag) resolve(false);\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.custom.doctype.custom_field.custom_field.add_custom_field',\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.doctype,\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Kanban Column',\n\t\t\t\t\t\tfieldname: 'kanban_column',\n\t\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\t\thidden: 1\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).success(function() {\n\t\t\t\tresolve(true);\n\t\t\t}).error(function(err) {\n\t\t\t\treject(err);\n\t\t\t});\n\t\t});\n\t},\n\tmake_kanban_board: function(board_name, field_name) {\n\t\tvar me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.desk.doctype.kanban_board.kanban_board.quick_kanban_board',\n\t\t\targs: {\n\t\t\t\tdoctype: me.doctype,\n\t\t\t\tboard_name: board_name,\n\t\t\t\tfield_name: field_name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar kb = r.message;\n\t\t\t\tif (kb.filters) {\n\t\t\t\t\tfrappe.provide('frappe.kanban_filters');\n\t\t\t\t\tfrappe.kanban_filters[kb.kanban_board_name] = kb.filters;\n\t\t\t\t}\n\t\t\t\tfrappe.set_route(\n\t\t\t\t\t'List',\n\t\t\t\t\tme.doctype,\n\t\t\t\t\t'Kanban',\n\t\t\t\t\tkb.kanban_board_name\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t},\n\tsetup_calendar_view: function() {\n\t\tconst doctype = this.doctype;\n\n\t\tfrappe.db.get_list('Calendar View', {\n\t\t\tfilters: {\n\t\t\t\treference_doctype: doctype\n\t\t\t}\n\t\t}).then(result => {\n\t\t\tif (!result) return;\n\t\t\tconst calendar_views = result;\n\t\t\tconst $link_calendar = this.sidebar.find('.list-link[data-view=\"Calendar\"]');\n\n\t\t\tlet default_link = '';\n\t\t\tif (frappe.views.calendar[this.doctype]) {\n\t\t\t\t// has standard calendar view\n\t\t\t\tdefault_link = `<li><a href=\"#List/${doctype}/Calendar/Default\">\n\t\t\t\t\t${ __(\"Default\") }</a></li>`;\n\t\t\t}\n\t\t\tconst other_links = calendar_views.map(\n\t\t\t\tcalendar_view => `<li><a href=\"#List/${doctype}/Calendar/${calendar_view.name}\">\n\t\t\t\t\t${ __(calendar_view.name) }</a>\n\t\t\t\t</li>`\n\t\t\t).join('');\n\n\t\t\tconst dropdown_html = `\n\t\t\t\t<div class=\"btn-group\">\n\t\t\t\t\t<a class=\"dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n\t\t\t\t\t\t${ __(\"Calendar\") } <span class=\"caret\"></span>\n\t\t\t\t\t</a>\n\t\t\t\t\t<ul class=\"dropdown-menu calendar-dropdown\" style=\"max-height: 300px; overflow-y: auto;\">\n\t\t\t\t\t\t${default_link}\n\t\t\t\t\t\t${other_links}\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\t$link_calendar.removeClass('hide');\n\t\t\t$link_calendar.html(dropdown_html);\n\t\t});\n\t},\n\tsetup_email_inbox: function() {\n\t\t// get active email account for the user and add in dropdown\n\t\tif (this.doctype != \"Communication\")\n\t\t\treturn;\n\n\t\tlet $dropdown = this.page.sidebar.find('.email-account-dropdown');\n\t\tlet divider = false;\n\n\t\tif (has_common(frappe.user_roles, [\"System Manager\", \"Administrator\"])) {\n\t\t\t$(`<li class=\"new-email-account\"><a>${__(\"New Email Account\")}</a></li>`)\n\t\t\t\t.appendTo($dropdown);\n\t\t}\n\n\t\tlet accounts = frappe.boot.email_accounts;\n\t\taccounts.forEach((account) => {\n\t\t\tlet email_account = (account.email_id == \"All Accounts\") ? \"All Accounts\" : account.email_account;\n\t\t\tlet route = [\"List\", \"Communication\", \"Inbox\", email_account].join('/');\n\t\t\tif (!divider) {\n\t\t\t\tthis.get_divider().appendTo($dropdown);\n\t\t\t\tdivider = true;\n\t\t\t}\n\t\t\t$(`<li><a href=\"#${route}\">${account.email_id}</a></li>`).appendTo($dropdown);\n\t\t\tif (account.email_id === \"Sent Mail\")\n\t\t\t\tdivider = false;\n\t\t});\n\n\t\t$dropdown.find('.new-email-account').click(function() {\n\t\t\tfrappe.new_doc(\"Email Account\");\n\t\t});\n\t},\n\tsetup_assigned_to_me: function() {\n\t\tthis.page.sidebar.find(\".assigned-to-me a\").on(\"click\", () => {\n\t\t\tthis.list_view.filter_area.add(this.list_view.doctype, \"_assign\", \"like\", `%${frappe.session.user}%`);\n\t\t});\n\t},\n\tsetup_upgrade_box: function() {\n\t\tlet upgrade_list = $(`<ul class=\"list-unstyled sidebar-menu\"></ul>`).appendTo(this.sidebar);\n\n\t\t// Show Renew/Upgrade button,\n\t\t// if account is holding one user free plan or\n\t\t// if account's expiry date within range of 30 days from today's date\n\n\t\tlet upgrade_date = frappe.datetime.add_days(frappe.datetime.get_today(), 30);\n\t\tif (frappe.boot.limits.users === 1 || upgrade_date >= frappe.boot.limits.expiry) {\n\t\t\tlet upgrade_box = $(`<div class=\"border\" style=\"\n\t\t\t\t\tpadding: 0px 10px;\n\t\t\t\t\tborder-radius: 3px;\n\t\t\t\t\">\n\t\t\t\t<a><i class=\"octicon octicon-x pull-right close\" style=\"margin-top: 10px;\"></i></a>\n\t\t\t\t<h5>Go Premium</h5>\n\t\t\t\t<p>Upgrade to a premium plan with more users, storage and priority support.</p>\n\t\t\t\t<button class=\"btn btn-xs btn-default btn-upgrade\" style=\"margin-bottom: 10px;\"> Renew / Upgrade </button>\n\t\t\t\t</div>`).appendTo(upgrade_list);\n\n\t\t\tupgrade_box.find('.btn-upgrade').on('click', () => {\n\t\t\t\tfrappe.set_route('usage-info');\n\t\t\t});\n\n\t\t\tupgrade_box.find('.close').on('click', () => {\n\t\t\t\tupgrade_list.remove();\n\t\t\t\tfrappe.flags.upgrade_dismissed = 1;\n\t\t\t});\n\t\t}\n\t},\n\tget_cat_tags: function() {\n\t\treturn this.cat_tags;\n\t},\n\tget_stats: function() {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: 'frappe.desk.reportview.get_sidebar_stats',\n\t\t\targs: {\n\t\t\t\tstats: me.stats,\n\t\t\t\tdoctype: me.doctype,\n\t\t\t\tfilters: me.default_filters || []\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tme.defined_category = r.message;\n\t\t\t\tif (r.message.defined_cat) {\n\t\t\t\t\tme.defined_category = r.message.defined_cat;\n\t\t\t\t\tme.cats = {};\n\t\t\t\t\t//structure the tag categories\n\t\t\t\t\tfor (var i in me.defined_category) {\n\t\t\t\t\t\tif (me.cats[me.defined_category[i].category] === undefined) {\n\t\t\t\t\t\t\tme.cats[me.defined_category[i].category] = [me.defined_category[i].tag];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.cats[me.defined_category[i].category].push(me.defined_category[i].tag);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tme.cat_tags[i] = me.defined_category[i].tag;\n\t\t\t\t\t}\n\t\t\t\t\tme.tempstats = r.message.stats;\n\n\t\t\t\t\t$.each(me.cats, function(i, v) {\n\t\t\t\t\t\tme.render_stat(i, (me.tempstats || {})[\"_user_tags\"], v);\n\t\t\t\t\t});\n\t\t\t\t\tme.render_stat(\"_user_tags\", (me.tempstats || {})[\"_user_tags\"]);\n\t\t\t\t} else {\n\t\t\t\t\t//render normal stats\n\t\t\t\t\tme.render_stat(\"_user_tags\", (r.message.stats || {})[\"_user_tags\"]);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\trender_stat: function(field, stat, tags) {\n\t\tvar me = this;\n\t\tvar sum = 0;\n\t\tvar stats = [];\n\t\tvar label = frappe.meta.docfield_map[this.doctype][field] ?\n\t\t\tfrappe.meta.docfield_map[this.doctype][field].label : field;\n\n\t\tstat = (stat || []).sort(function(a, b) {\n\t\t\treturn b[1] - a[1];\n\t\t});\n\t\t$.each(stat, function(i, v) {\n\t\t\tsum = sum + v[1];\n\t\t});\n\n\t\tif (tags) {\n\t\t\tfor (var t in tags) {\n\t\t\t\tvar nfound = -1;\n\t\t\t\tfor (var i in stat) {\n\t\t\t\t\tif (tags[t] === stat[i][0]) {\n\t\t\t\t\t\tstats.push(stat[i]);\n\t\t\t\t\t\tnfound = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (nfound < 0) {\n\t\t\t\t\tstats.push([tags[t], 0]);\n\t\t\t\t} else {\n\t\t\t\t\tme.tempstats[\"_user_tags\"].splice(nfound, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfield = \"_user_tags\";\n\t\t} else {\n\t\t\tstats = stat;\n\t\t}\n\t\tvar context = {\n\t\t\tfield: field,\n\t\t\tstat: stats,\n\t\t\tsum: sum,\n\t\t\tlabel: field === '_user_tags' ? (tags ? __(label) : __(\"Tags\")) : __(label),\n\t\t};\n\t\t$(frappe.render_template(\"list_sidebar_stat\", context))\n\t\t\t.on(\"click\", \".stat-link\", function() {\n\t\t\t\tvar fieldname = $(this).attr('data-field');\n\t\t\t\tvar label = $(this).attr('data-label');\n\t\t\t\tif (label == \"No Tags\") {\n\t\t\t\t\tme.list_view.filter_list.add_filter(me.list_view.doctype, fieldname, 'not like', '%,%');\n\t\t\t\t\tme.list_view.run();\n\t\t\t\t} else {\n\t\t\t\t\tme.set_filter(fieldname, label);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.insertBefore(this.sidebar.find(\".close-sidebar-button\"));\n\t},\n\tset_fieldtype: function(df) {\n\n\t\t// scrub\n\t\tif (df.fieldname == \"docstatus\") {\n\t\t\tdf.fieldtype = \"Select\",\n\t\t\tdf.options = [\n\t\t\t\t{ value: 0, label: \"Draft\" },\n\t\t\t\t{ value: 1, label: \"Submitted\" },\n\t\t\t\t{ value: 2, label: \"Cancelled\" },\n\t\t\t];\n\t\t} else if (df.fieldtype == 'Check') {\n\t\t\tdf.fieldtype = 'Select';\n\t\t\tdf.options = [{ value: 0, label: 'No' },\n\t\t\t\t{ value: 1, label: 'Yes' }\n\t\t\t];\n\t\t} else if (['Text', 'Small Text', 'Text Editor', 'Code', 'Tag', 'Comments',\n\t\t\t'Dynamic Link', 'Read Only', 'Assign'\n\t\t].indexOf(df.fieldtype) != -1) {\n\t\t\tdf.fieldtype = 'Data';\n\t\t} else if (df.fieldtype == 'Link' && this.$w.find('.condition').val() != \"=\") {\n\t\t\tdf.fieldtype = 'Data';\n\t\t}\n\t\tif (df.fieldtype === \"Data\" && (df.options || \"\").toLowerCase() === \"email\") {\n\t\t\tdf.options = null;\n\t\t}\n\t},\n\treload_stats: function() {\n\t\tthis.sidebar.find(\".sidebar-stat\").remove();\n\t\tthis.get_stats();\n\t},\n\tget_divider: function() {\n\t\treturn $('<li role=\"separator\" class=\"divider\"></li>');\n\t}\n});","frappe.provide('frappe.views');\n\nfrappe.views.GanttView = class GanttView extends frappe.views.ListView {\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\t\tthis.view_name = 'Gantt';\n\t\tthis.page_title = this.page_title + ' ' + __('Gantt');\n\t\tthis.calendar_settings = frappe.views.calendar[this.doctype] || {};\n\t\tif(this.calendar_settings.order_by) {\n\t\t\tthis.order_by = this.calendar_settings.order_by + ' asc';\n\t\t} else {\n\t\t\tthis.order_by = this.view_user_settings.order_by || this.calendar_settings.field_map.start + ' asc';\n\t\t}\n\t}\n\n\tsetup_view() {\n\n\t}\n\n\tprepare_data(data) {\n\t\tsuper.prepare_data(data);\n\t\tthis.prepare_tasks();\n\t}\n\n\tprepare_tasks() {\n\t\tvar me = this;\n\t\tvar meta = this.meta;\n\t\tvar field_map = this.calendar_settings.field_map;\n\n\t\tthis.tasks = this.data.map(function (item) {\n\t\t\t// set progress\n\t\t\tvar progress = 0;\n\t\t\tif (field_map.progress && $.isFunction(field_map.progress)) {\n\t\t\t\tprogress = field_map.progress(item);\n\t\t\t} else if (field_map.progress) {\n\t\t\t\tprogress = item[field_map.progress];\n\t\t\t}\n\n\t\t\t// title\n\t\t\tvar label;\n\t\t\tif (meta.title_field) {\n\t\t\t\tlabel = $.format(\"{0} ({1})\", [item[meta.title_field], item.name]);\n\t\t\t} else {\n\t\t\t\tlabel = item[field_map.title];\n\t\t\t}\n\n\t\t\tvar r = {\n\t\t\t\tstart: item[field_map.start],\n\t\t\t\tend: item[field_map.end],\n\t\t\t\tname: label,\n\t\t\t\tid: item[field_map.id || 'name'],\n\t\t\t\tdoctype: me.doctype,\n\t\t\t\tprogress: progress,\n\t\t\t\tdependencies: item.depends_on_tasks || \"\"\n\t\t\t};\n\n\t\t\tif (item.color && frappe.ui.color.validate_hex(item.color)) {\n\t\t\t\tr['custom_class'] = 'color-' + item.color.substr(1);\n\t\t\t}\n\n\t\t\tif (item.is_milestone) {\n\t\t\t\tr['custom_class'] = 'bar-milestone';\n\t\t\t}\n\n\t\t\treturn r;\n\t\t});\n\t}\n\n\trender() {\n\t\tthis.load_lib.then(() => {\n\t\t\tthis.render_gantt();\n\t\t});\n\t}\n\n\trender_gantt() {\n\t\tconst me = this;\n\t\tconst gantt_view_mode = this.view_user_settings.gantt_view_mode || 'Day';\n\t\tconst field_map = this.calendar_settings.field_map;\n\t\tconst date_format = 'YYYY-MM-DD';\n\n\t\tthis.$result.empty();\n\n\t\tthis.gantt = new Gantt(this.$result[0], this.tasks, {\n\t\t\tview_mode: gantt_view_mode,\n\t\t\tdate_format: \"YYYY-MM-DD\",\n\t\t\ton_click: task => {\n\t\t\t\tfrappe.set_route('Form', task.doctype, task.id);\n\t\t\t},\n\t\t\ton_date_change: (task, start, end) => {\n\t\t\t\tif (!me.can_write) return;\n\t\t\t\tfrappe.db.set_value(task.doctype, task.id, {\n\t\t\t\t\t[field_map.start]: moment(start).format(date_format),\n\t\t\t\t\t[field_map.end]: moment(end).format(date_format)\n\t\t\t\t});\n\t\t\t},\n\t\t\ton_progress_change: (task, progress) => {\n\t\t\t\tif (!me.can_write) return;\n\t\t\t\tvar progress_fieldname = 'progress';\n\n\t\t\t\tif ($.isFunction(field_map.progress)) {\n\t\t\t\t\tprogress_fieldname = null;\n\t\t\t\t} else if (field_map.progress) {\n\t\t\t\t\tprogress_fieldname = field_map.progress;\n\t\t\t\t}\n\n\t\t\t\tif (progress_fieldname) {\n\t\t\t\t\tfrappe.db.set_value(task.doctype, task.id, {\n\t\t\t\t\t\t[progress_fieldname]: parseInt(progress)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\ton_view_change: mode => {\n\t\t\t\t// save view mode\n\t\t\t\tme.save_view_user_settings({\n\t\t\t\t\tgantt_view_mode: mode\n\t\t\t\t});\n\t\t\t},\n\t\t\tcustom_popup_html: task => {\n\t\t\t\tvar item = me.get_item(task.id);\n\n\t\t\t\tvar html =\n\t\t\t\t\t`<h5>${task.name}</h5>\n\t\t\t\t\t<p>${task._start.format('MMM D')} - ${task._end.format('MMM D')}</p>`;\n\n\t\t\t\t// custom html in doctype settings\n\t\t\t\tvar custom = me.settings.gantt_custom_popup_html;\n\t\t\t\tif (custom && $.isFunction(custom)) {\n\t\t\t\t\tvar ganttobj = task;\n\t\t\t\t\thtml = custom(ganttobj, item);\n\t\t\t\t}\n\t\t\t\treturn '<div class=\"details-container\">' + html + '</div>';\n\t\t\t}\n\t\t});\n\t\tthis.setup_view_mode_buttons();\n\t\tthis.set_colors();\n\t}\n\n\tsetup_view_mode_buttons() {\n\t\t// view modes (for translation) __(\"Day\"), __(\"Week\"), __(\"Month\"),\n\t\t//__(\"Half Day\"), __(\"Quarter Day\")\n\n\t\tlet $btn_group = this.$paging_area.find('.gantt-view-mode');\n\t\tif ($btn_group.length > 0) return;\n\n\t\tconst view_modes = this.gantt.options.view_modes || [];\n\t\tconst active_class = view_mode => this.gantt.view_is(view_mode) ? 'btn-info' : '';\n\t\tconst html =\n\t\t\t`<div class=\"btn-group gantt-view-mode\">\n\t\t\t\t${view_modes.map(value => `<button type=\"button\"\n\t\t\t\t\t\tclass=\"btn btn-default btn-sm btn-view-mode ${active_class(value)}\"\n\t\t\t\t\t\tdata-value=\"${value}\">\n\t\t\t\t\t\t${__(value)}\n\t\t\t\t\t</button>`).join('')}\n\t\t\t</div>`;\n\n\t\tthis.$paging_area.find('.level-left').append(html);\n\n\t\t// change view mode asynchronously\n\t\tconst change_view_mode = (value) => setTimeout(() => this.gantt.change_view_mode(value), 0);\n\n\t\tthis.$paging_area.on('click', '.btn-view-mode', e => {\n\t\t\tconst $btn = $(e.currentTarget);\n\t\t\tthis.$paging_area.find('.btn-view-mode').removeClass('btn-info');\n\t\t\t$btn.addClass('btn-info');\n\n\t\t\tconst value = $btn.data().value;\n\t\t\tchange_view_mode(value);\n\t\t});\n\t}\n\n\tset_colors() {\n\t\tconst classes = this.tasks\n\t\t\t.map(t => t.custom_class)\n\t\t\t.filter(c => c && c.startsWith('color-'));\n\n\t\tlet style = classes.map(c => {\n\t\t\tconst class_name = c.replace('#', '');\n\t\t\tconst bar_color = '#' + c.substr(6);\n\t\t\tconst progress_color = frappe.ui.color.get_contrast_color(bar_color);\n\t\t\treturn `\n\t\t\t\t.gantt .bar-wrapper.${class_name} .bar {\n\t\t\t\t\tfill: ${bar_color};\n\t\t\t\t}\n\t\t\t\t.gantt .bar-wrapper.${class_name} .bar-progress {\n\t\t\t\t\tfill: ${progress_color};\n\t\t\t\t}\n\t\t\t`;\n\t\t}).join(\"\");\n\n\t\tstyle = `<style>${style}</style>`;\n\t\tthis.$result.prepend(style);\n\t}\n\n\tget_item(name) {\n\t\treturn this.data.find(item => item.name === name);\n\t}\n\n\tget required_libs() {\n\t\treturn [\n\t\t\t\"assets/frappe/js/lib/frappe-gantt/frappe-gantt.css\",\n\t\t\t\"assets/frappe/js/lib/frappe-gantt/frappe-gantt.min.js\"\n\t\t];\n\t}\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.views.calendar\");\nfrappe.provide(\"frappe.views.calendars\");\n\nfrappe.views.CalendarView = class CalendarView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (route.length === 3) {\n\t\t\tconst doctype = route[1];\n\t\t\tconst user_settings = frappe.get_user_settings(doctype)['Calendar'] || {};\n\t\t\troute.push(user_settings.last_calendar_view || 'Default');\n\t\t\tfrappe.set_route(route);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\t\tthis.view_name = 'Calendar';\n\t\tthis.page_title = this.page_title + ' ' + __('Calendar');\n\t\tthis.calendar_settings = frappe.views.calendar[this.doctype] || {};\n\t\tthis.calendar_name = frappe.get_route()[3];\n\t}\n\n\tsetup_view() {\n\n\t}\n\n\tbefore_render() {\n\t\tsuper.before_render();\n\t\tthis.save_view_user_settings({\n\t\t\tlast_calendar: this.calendar_name\n\t\t});\n\t}\n\n\trender() {\n\t\tif (this.calendar) {\n\t\t\tthis.calendar.refresh();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.load_lib\n\t\t\t.then(() => this.get_calendar_options())\n\t\t\t.then(options => {\n\t\t\t\tthis.calendar = new frappe.views.Calendar(options);\n\t\t\t});\n\t}\n\n\tget_calendar_options() {\n\t\tconst options = {\n\t\t\tdoctype: this.doctype,\n\t\t\tparent: this.$result,\n\t\t\tpage: this.page,\n\t\t\tlist_view: this\n\t\t};\n\t\tconst calendar_name = this.calendar_name;\n\n\t\treturn new Promise(resolve => {\n\t\t\tif (calendar_name === 'Default') {\n\t\t\t\tObject.assign(options, frappe.views.calendar[this.doctype]);\n\t\t\t\tresolve(options);\n\t\t\t} else {\n\t\t\t\tfrappe.model.with_doc('Calendar View', calendar_name, () => {\n\t\t\t\t\tconst doc = frappe.get_doc('Calendar View', calendar_name);\n\t\t\t\t\tObject.assign(options, {\n\t\t\t\t\t\tfield_map: {\n\t\t\t\t\t\t\tid: \"name\",\n\t\t\t\t\t\t\tstart: doc.start_date_field,\n\t\t\t\t\t\t\tend: doc.end_date_field,\n\t\t\t\t\t\t\ttitle: doc.subject_field\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tresolve(options);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tget required_libs() {\n\t\treturn [\n\t\t\t'assets/frappe/js/lib/fullcalendar/fullcalendar.min.css',\n\t\t\t'assets/frappe/js/lib/fullcalendar/fullcalendar.min.js',\n\t\t\t'assets/frappe/js/lib/fullcalendar/locale-all.js'\n\t\t];\n\t}\n};\n\nfrappe.views.Calendar = Class.extend({\n\tinit: function(options) {\n\t\t$.extend(this, options);\n\t\tthis.make_page();\n\t\tthis.setup_options();\n\t\tthis.make();\n\t},\n\tmake_page: function() {\n\t\tvar me = this;\n\n\t\t// add links to other calendars\n\t\tme.page.clear_user_actions();\n\t\t$.each(frappe.boot.calendars, function(i, doctype) {\n\t\t\tif(frappe.model.can_read(doctype)) {\n\t\t\t\tme.page.add_menu_item(__(doctype), function() {\n\t\t\t\t\tfrappe.set_route(\"List\", doctype, \"Calendar\");\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t$(this.parent).on(\"show\", function() {\n\t\t\tme.$cal.fullCalendar(\"refetchEvents\");\n\t\t});\n\t},\n\n\tmake: function() {\n\t\tthis.$wrapper = this.parent;\n\t\tthis.$cal = $(\"<div>\").appendTo(this.$wrapper);\n\t\tthis.footnote_area = frappe.utils.set_footnote(this.footnote_area, this.$wrapper,\n\t\t\t__(\"Select or drag across time slots to create a new event.\"));\n\t\tthis.footnote_area.css({\"border-top\": \"0px\"});\n\n\t\tthis.$cal.fullCalendar(this.cal_options);\n\t\tthis.set_css();\n\t},\n\tset_css: function() {\n\t\t// flatify buttons\n\t\tthis.$wrapper.find(\"button.fc-state-default\")\n\t\t\t.removeClass(\"fc-state-default\")\n\t\t\t.addClass(\"btn btn-default\");\n\n\t\tthis.$wrapper.find(\".fc-button-group\").addClass(\"btn-group\");\n\n\t\tthis.$wrapper.find('.fc-prev-button span')\n\t\t\t.attr('class', '').addClass('fa fa-chevron-left');\n\t\tthis.$wrapper.find('.fc-next-button span')\n\t\t\t.attr('class', '').addClass('fa fa-chevron-right');\n\n\t\tvar btn_group = this.$wrapper.find(\".fc-button-group\");\n\t\tbtn_group.find(\".fc-state-active\").addClass(\"active\");\n\n\t\tbtn_group.find(\".btn\").on(\"click\", function() {\n\t\t\tbtn_group.find(\".btn\").removeClass(\"active\");\n\t\t\t$(this).addClass(\"active\");\n\t\t});\n\t},\n\tfield_map: {\n\t\t\"id\": \"name\",\n\t\t\"start\": \"start\",\n\t\t\"end\": \"end\",\n\t\t\"allDay\": \"all_day\",\n\t},\n\tcolor_map: {\n\t\t\"danger\": \"red\",\n\t\t\"success\": \"green\",\n\t\t\"warning\": \"orange\",\n\t\t\"default\": \"blue\"\n\t},\n\tget_system_datetime: function(date) {\n\t\tdate._offset = moment.user_utc_offset;\n\t\treturn frappe.datetime.convert_to_system_tz(date);\n\t},\n\tsetup_options: function() {\n\t\tvar me = this;\n\t\tthis.cal_options = {\n\t\t\tlocale: frappe.boot.user.language || \"en\",\n\t\t\theader: {\n\t\t\t\tleft: 'title',\n\t\t\t\tcenter: '',\n\t\t\t\tright: 'prev,next month,agendaWeek,agendaDay'\n\t\t\t},\n\t\t\teditable: true,\n\t\t\tselectable: true,\n\t\t\tselectHelper: true,\n\t\t\tforceEventDuration: true,\n\t\t\tevents: function(start, end, timezone, callback) {\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: me.get_events_method || \"frappe.desk.calendar.get_events\",\n\t\t\t\t\ttype: \"GET\",\n\t\t\t\t\targs: me.get_args(start, end),\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tvar events = r.message;\n\t\t\t\t\t\tevents = me.prepare_events(events);\n\t\t\t\t\t\tcallback(events);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\teventRender: function(event, element) {\n\t\t\t\telement.attr('title', event.tooltip);\n\t\t\t},\n\t\t\teventClick: function(event) {\n\t\t\t\t// edit event description or delete\n\t\t\t\tvar doctype = event.doctype || me.doctype;\n\t\t\t\tif(frappe.model.can_read(doctype)) {\n\t\t\t\t\tfrappe.set_route(\"Form\", doctype, event.name);\n\t\t\t\t}\n\t\t\t},\n\t\t\teventDrop: function(event, delta, revertFunc) {\n\t\t\t\tme.update_event(event, revertFunc);\n\t\t\t},\n\t\t\teventResize: function(event, delta, revertFunc) {\n\t\t\t\tme.update_event(event, revertFunc);\n\t\t\t},\n\t\t\tselect: function(startDate, endDate, jsEvent, view) {\n\t\t\t\tif (view.name===\"month\" && (endDate - startDate)===86400000) {\n\t\t\t\t\t// detect single day click in month view\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar event = frappe.model.get_new_doc(me.doctype);\n\n\t\t\t\tevent[me.field_map.start] = me.get_system_datetime(startDate);\n\n\t\t\t\tif(me.field_map.end)\n\t\t\t\t\tevent[me.field_map.end] = me.get_system_datetime(endDate);\n\n\t\t\t\tif(me.field_map.allDay) {\n\t\t\t\t\tvar all_day = (startDate._ambigTime && endDate._ambigTime) ? 1 : 0;\n\n\t\t\t\t\tevent[me.field_map.allDay] = all_day;\n\n\t\t\t\t\tif (all_day)\n\t\t\t\t\t\tevent[me.field_map.end] = me.get_system_datetime(moment(endDate).subtract(1, \"s\"));\n\t\t\t\t}\n\n\t\t\t\tfrappe.set_route(\"Form\", me.doctype, event.name);\n\t\t\t},\n\t\t\tdayClick: function(date, jsEvent, view) {\n\t\t\t\tif(view.name === 'month') {\n\t\t\t\t\tconst $date_cell = $('td[data-date=' + date.format('YYYY-MM-DD') + \"]\");\n\n\t\t\t\t\tif($date_cell.hasClass('date-clicked')) {\n\t\t\t\t\t\tme.$cal.fullCalendar('changeView', 'agendaDay');\n\t\t\t\t\t\tme.$cal.fullCalendar('gotoDate', date);\n\t\t\t\t\t\tme.$wrapper.find('.date-clicked').removeClass('date-clicked');\n\n\t\t\t\t\t\t// update \"active view\" btn\n\t\t\t\t\t\tme.$wrapper.find('.fc-month-button').removeClass('active');\n\t\t\t\t\t\tme.$wrapper.find('.fc-agendaDay-button').addClass('active');\n\t\t\t\t\t}\n\n\t\t\t\t\tme.$wrapper.find('.date-clicked').removeClass('date-clicked');\n\t\t\t\t\t$date_cell.addClass('date-clicked');\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\n\t\tif(this.options) {\n\t\t\t$.extend(this.cal_options, this.options);\n\t\t}\n\t},\n\tget_args: function(start, end) {\n\t\tvar args = {\n\t\t\tdoctype: this.doctype,\n\t\t\tstart: this.get_system_datetime(start),\n\t\t\tend: this.get_system_datetime(end),\n\t\t\tfilters: this.list_view.filter_area.get(),\n\t\t\tfield_map: this.field_map\n\t\t};\n\t\treturn args;\n\t},\n\trefresh: function() {\n\t\tthis.$cal.fullCalendar('refetchEvents');\n\t},\n\tprepare_events: function(events) {\n\t\tvar me = this;\n\n\t\treturn (events || []).map(d => {\n\t\t\td.id = d.name;\n\t\t\td.editable = frappe.model.can_write(d.doctype || me.doctype);\n\n\t\t\t// do not allow submitted/cancelled events to be moved / extended\n\t\t\tif(d.docstatus && d.docstatus > 0) {\n\t\t\t\td.editable = false;\n\t\t\t}\n\n\t\t\t$.each(me.field_map, function(target, source) {\n\t\t\t\td[target] = d[source];\n\t\t\t});\n\n\t\t\tif(!me.field_map.allDay)\n\t\t\t\td.allDay = 1;\n\n\t\t\t// convert to user tz\n\t\t\td.start = frappe.datetime.convert_to_user_tz(d.start);\n\t\t\td.end = frappe.datetime.convert_to_user_tz(d.end);\n\n\t\t\t// show event on single day if start or end date is invalid\n\t\t\tif (!frappe.datetime.validate(d.start) && d.end) {\n\t\t\t\td.start = frappe.datetime.add_days(d.end, -1);\n\t\t\t}\n\n\t\t\tif (d.start && !frappe.datetime.validate(d.end)) {\n\t\t\t\td.end = frappe.datetime.add_days(d.start, 1);\n\t\t\t}\n\n\t\t\tme.fix_end_date_for_event_render(d);\n\t\t\tme.prepare_colors(d);\n\t\t\treturn d;\n\t\t});\n\t},\n\tprepare_colors: function(d) {\n\t\tlet color, color_name;\n\t\tif(this.get_css_class) {\n\t\t\tcolor_name = this.color_map[this.get_css_class(d)];\n\t\t\tcolor_name = frappe.ui.color.validate_hex(color_name) ?\n\t\t\t\tcolor_name : 'blue';\n\t\t\td.backgroundColor = frappe.ui.color.get(color_name, 'extra-light');\n\t\t\td.textColor = frappe.ui.color.get(color_name, 'dark');\n\t\t} else {\n\t\t\tcolor = d.color;\n\t\t\tif (!frappe.ui.color.validate_hex(color) || !color) {\n\t\t\t\tcolor = frappe.ui.color.get('blue', 'extra-light');\n\t\t\t}\n\t\t\td.backgroundColor = color;\n\t\t\td.textColor = frappe.ui.color.get_contrast_color(color);\n\t\t}\n\t\treturn d;\n\t},\n\tupdate_event: function(event, revertFunc) {\n\t\tvar me = this;\n\t\tfrappe.model.remove_from_locals(me.doctype, event.name);\n\t\treturn frappe.call({\n\t\t\tmethod: me.update_event_method || \"frappe.desk.calendar.update_event\",\n\t\t\targs: me.get_update_args(event),\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.exc) {\n\t\t\t\t\tfrappe.show_alert(__(\"Unable to update event\"));\n\t\t\t\t\trevertFunc();\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function() {\n\t\t\t\trevertFunc();\n\t\t\t}\n\t\t});\n\t},\n\tget_update_args: function(event) {\n\t\tvar me = this;\n\t\tvar args = {\n\t\t\tname: event[this.field_map.id]\n\t\t};\n\n\t\targs[this.field_map.start] = me.get_system_datetime(event.start);\n\n\t\tif(this.field_map.allDay)\n\t\t\targs[this.field_map.allDay] = (event.start._ambigTime && event.end._ambigTime) ? 1 : 0;\n\n\t\tif(this.field_map.end) {\n\t\t\tif (!event.end) {\n\t\t\t\tevent.end = event.start.add(1, \"hour\");\n\t\t\t}\n\n\t\t\targs[this.field_map.end] = me.get_system_datetime(event.end);\n\n\t\t\tif (args[this.field_map.allDay]) {\n\t\t\t\targs[this.field_map.end] = me.get_system_datetime(moment(event.end).subtract(1, \"s\"));\n\t\t\t}\n\t\t}\n\n\t\targs.doctype = event.doctype || this.doctype;\n\n\t\treturn { args: args, field_map: this.field_map };\n\t},\n\n\tfix_end_date_for_event_render: function(event) {\n\t\tif (event.allDay) {\n\t\t\t// We use inclusive end dates. This workaround fixes the rendering of events\n\t\t\tevent.start = event.start ? $.fullCalendar.moment(event.start).stripTime() : null;\n\t\t\tevent.end = event.end ? $.fullCalendar.moment(event.end).add(1, \"day\").stripTime() : null;\n\t\t}\n\t}\n});\n","/**\n * frappe.views.ImageView\n */\nfrappe.provide(\"frappe.views\");\n\nfrappe.views.ImageView = class ImageView extends frappe.views.ListView {\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\t\tthis.view_name = 'Image';\n\t\tthis.page_title = this.page_title + ' ' + __('Images');\n\t}\n\n\tsetup_view() {\n\t\tthis.setup_columns();\n\t}\n\n\tset_fields() {\n\t\tthis.fields = [\n\t\t\t'name',\n\t\t\tthis.meta.title_field,\n\t\t\tthis.meta.image_field\n\t\t];\n\t}\n\n\tprepare_data(data) {\n\t\tsuper.prepare_data(data);\n\t\tthis.items = this.data.map(d => {\n\t\t\t// absolute url if cordova, else relative\n\t\t\td._image_url = this.get_image_url(d);\n\t\t\treturn d;\n\t\t});\n\t}\n\n\trender() {\n\t\tthis.get_attached_images()\n\t\t\t.then(() => {\n\t\t\t\tthis.render_image_view();\n\n\t\t\t\tif (!this.gallery) {\n\t\t\t\t\tthis.setup_gallery();\n\t\t\t\t} else {\n\t\t\t\t\tthis.gallery.prepare_pswp_items(this.items, this.images_map);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\trender_image_view() {\n\t\tvar html = this.items.map(this.item_html.bind(this)).join(\"\");\n\n\t\tthis.$result.html(`\n\t\t\t${this.get_header_html()}\n\t\t\t<div class=\"image-view-container small\">\n\t\t\t\t${html}\n\t\t\t</div>\n\t\t`);\n\t}\n\n\titem_html(item) {\n\t\titem._name = encodeURI(item.name);\n\t\tconst encoded_name = item._name;\n\t\tconst title = strip_html(item[this.meta.title_field || 'name']);\n\t\tconst _class = !item._image_url ? 'no-image' : '';\n\t\tconst _html = item._image_url ?\n\t\t\t`<img data-name=\"${encoded_name}\" src=\"${ item._image_url }\" alt=\"${ title }\">` :\n\t\t\t`<span class=\"placeholder-text\">\n\t\t\t\t${ frappe.get_abbr(title) }\n\t\t\t</span>`;\n\n\t\treturn `\n\t\t\t<div class=\"image-view-item\">\n\t\t\t\t<div class=\"image-view-header\">\n\t\t\t\t\t<div class=\"list-row-col list-subject ellipsis level\">\n\t\t\t\t\t\t${this.get_subject_html(item)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"image-view-body\">\n\t\t\t\t\t<a  data-name=\"${encoded_name}\"\n\t\t\t\t\t\ttitle=\"${encoded_name}\"\n\t\t\t\t\t\thref=\"${this.get_form_link(item)}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"image-field ${_class}\"\n\t\t\t\t\t\t\tdata-name=\"${encoded_name}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${_html}\n\t\t\t\t\t\t\t<button class=\"btn btn-default zoom-view\" data-name=\"${encoded_name}\">\n\t\t\t\t\t\t\t\t<i class=\"fa fa-search-plus\"></i>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_image_url(data) {\n\t\tvar url;\n\t\turl = data.image ? data.image : data[this.meta.image_field];\n\n\t\t// absolute url for mobile\n\t\tif (window.cordova && !frappe.utils.is_url(url)) {\n\t\t\turl = frappe.base_url + url;\n\t\t}\n\t\tif (url) {\n\t\t\treturn url;\n\t\t}\n\t\treturn null;\n\t}\n\n\tget_attached_images() {\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.core.doctype.file.file.get_attached_images',\n\t\t\targs: {\n\t\t\t\tdoctype: this.doctype,\n\t\t\t\tnames: this.items.map(i => i.name)\n\t\t\t}\n\t\t}).then(r => {\n\t\t\tthis.images_map = Object.assign(this.images_map || {}, r.message);\n\t\t});\n\t}\n\n\tget_header_html() {\n\t\treturn this.get_header_html_skeleton(`\n\t\t\t<div class=\"list-row-col list-subject level \">\n\t\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"Select All\">\n\t\t\t\t<span class=\"level-item list-liked-by-me\">\n\t\t\t\t\t<i class=\"octicon octicon-heart text-extra-muted\" title=\"Likes\"></i>\n\t\t\t\t</span>\n\t\t\t\t<span class=\"level-item\"></span>\n\t\t\t</div>\n\t\t`);\n\t}\n\n\tsetup_gallery() {\n\t\tvar me = this;\n\t\tthis.gallery = new frappe.views.GalleryView({\n\t\t\tdoctype: this.doctype,\n\t\t\titems: this.items,\n\t\t\twrapper: this.$result,\n\t\t\timages_map: this.images_map\n\t\t});\n\t\tthis.$result.on('click', '.btn.zoom-view', function (e) {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tvar name = $(this).data().name;\n\t\t\tname = decodeURIComponent(name);\n\t\t\tme.gallery.show(name);\n\t\t\treturn false;\n\t\t});\n\t}\n};\n\nfrappe.views.GalleryView = Class.extend({\n\tinit: function (opts) {\n\t\t$.extend(this, opts);\n\t\tvar me = this;\n\n\t\tthis.lib_ready = this.load_lib();\n\t\tthis.lib_ready.then(function () {\n\t\t\tme.prepare();\n\t\t});\n\t},\n\tprepare: function () {\n\t\t// keep only one pswp dom element\n\t\tthis.pswp_root = $('body > .pswp');\n\t\tif (this.pswp_root.length === 0) {\n\t\t\tvar pswp = frappe.render_template('photoswipe_dom');\n\t\t\tthis.pswp_root = $(pswp).appendTo('body');\n\t\t}\n\t},\n\tprepare_pswp_items: function (_items, _images_map) {\n\t\tvar me = this;\n\n\t\tif (_items) {\n\t\t\t// passed when more button clicked\n\t\t\tthis.items = this.items.concat(_items);\n\t\t\tthis.images_map = _images_map;\n\t\t}\n\n\t\treturn new Promise(resolve => {\n\t\t\tconst items = this.items.map(function (i) {\n\t\t\t\tconst query = 'img[data-name=\"' + i._name + '\"]';\n\t\t\t\tlet el = me.wrapper.find(query).get(0);\n\n\t\t\t\tlet width, height;\n\t\t\t\tif (el) {\n\t\t\t\t\twidth = el.naturalWidth;\n\t\t\t\t\theight = el.naturalHeight;\n\t\t\t\t}\n\n\t\t\t\tif (!el) {\n\t\t\t\t\tel = me.wrapper.find('.image-field[data-name=\"' + i._name + '\"]').get(0);\n\t\t\t\t\twidth = el.getBoundingClientRect().width;\n\t\t\t\t\theight = el.getBoundingClientRect().height;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tsrc: i._image_url,\n\t\t\t\t\tmsrc: i._image_url,\n\t\t\t\t\tname: i.name,\n\t\t\t\t\tw: width,\n\t\t\t\t\th: height,\n\t\t\t\t\tel: el\n\t\t\t\t};\n\t\t\t});\n\t\t\tthis.pswp_items = items;\n\t\t\tresolve();\n\t\t});\n\t},\n\tshow: function (docname) {\n\t\tthis.lib_ready\n\t\t\t.then(() => this.prepare_pswp_items())\n\t\t\t.then(() => this._show(docname));\n\t},\n\t_show: function (docname) {\n\t\tconst me = this;\n\t\tconst items = this.pswp_items;\n\t\tconst item_index = items.findIndex(item => item.name === docname);\n\n\t\tvar options = {\n\t\t\tindex: item_index,\n\t\t\tgetThumbBoundsFn: function (index) {\n\t\t\t\tconst query = 'img[data-name=\"' + items[index]._name + '\"]';\n\t\t\t\tlet thumbnail = me.wrapper.find(query).get(0);\n\n\t\t\t\tif (!thumbnail) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar pageYScroll = window.pageYOffset || document.documentElement.scrollTop,\n\t\t\t\t\trect = thumbnail.getBoundingClientRect();\n\n\t\t\t\treturn {\n\t\t\t\t\tx: rect.left,\n\t\t\t\t\ty: rect.top + pageYScroll,\n\t\t\t\t\tw: rect.width\n\t\t\t\t};\n\t\t\t},\n\t\t\thistory: false,\n\t\t\tshareEl: false,\n\t\t\tshowHideOpacity: true\n\t\t};\n\n\t\t// init\n\t\tthis.pswp = new PhotoSwipe(\n\t\t\tthis.pswp_root.get(0),\n\t\t\tPhotoSwipeUI_Default,\n\t\t\titems,\n\t\t\toptions\n\t\t);\n\t\tthis.browse_images();\n\t\tthis.pswp.init();\n\t},\n\tbrowse_images: function () {\n\t\tconst $more_items = this.pswp_root.find('.pswp__more-items');\n\t\tconst images_map = this.images_map;\n\t\tlet last_hide_timeout = null;\n\n\t\tthis.pswp.listen('afterChange', function () {\n\t\t\tconst images = images_map[this.currItem.name];\n\t\t\tif (!images || images.length === 1) {\n\t\t\t\t$more_items.html('');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thide_more_items_after_2s();\n\t\t\tconst html = images.map(img_html).join(\"\");\n\t\t\t$more_items.html(html);\n\t\t});\n\n\t\tthis.pswp.listen('beforeChange', hide_more_items);\n\t\tthis.pswp.listen('initialZoomOut', hide_more_items);\n\t\tthis.pswp.listen('destroy', () => {\n\t\t\t$(document).off('mousemove', hide_more_items_after_2s);\n\t\t});\n\n\t\t// Replace current image on click\n\t\t$more_items.on('click', '.pswp__more-item', (e) => {\n\t\t\tconst img_el = e.target;\n\t\t\tconst index = this.pswp.items.findIndex(i => i.name === this.pswp.currItem.name);\n\n\t\t\tthis.pswp.goTo(index);\n\t\t\tthis.pswp.items.splice(index, 1, {\n\t\t\t\tsrc: img_el.src,\n\t\t\t\tw: img_el.naturalWidth,\n\t\t\t\th: img_el.naturalHeight,\n\t\t\t\tname: this.pswp.currItem.name\n\t\t\t});\n\t\t\tthis.pswp.invalidateCurrItems();\n\t\t\tthis.pswp.updateSize(true);\n\t\t});\n\n\t\t// hide more-images 2s after mousemove\n\t\t$(document).on('mousemove', hide_more_items_after_2s);\n\n\t\tfunction hide_more_items_after_2s() {\n\t\t\tclearTimeout(last_hide_timeout);\n\t\t\tshow_more_items();\n\t\t\tlast_hide_timeout = setTimeout(hide_more_items, 2000);\n\t\t}\n\n\t\tfunction show_more_items() {\n\t\t\t$more_items.show();\n\t\t}\n\n\t\tfunction hide_more_items() {\n\t\t\t$more_items.hide();\n\t\t}\n\n\t\tfunction img_html(src) {\n\t\t\treturn `<div class=\"pswp__more-item\">\n\t\t\t\t<img src=\"${src}\">\n\t\t\t</div>`;\n\t\t}\n\t},\n\tload_lib: function () {\n\t\treturn new Promise(resolve => {\n\t\t\tvar asset_dir = 'assets/frappe/js/lib/photoswipe/';\n\t\t\tfrappe.require([\n\t\t\t\tasset_dir + 'photoswipe.css',\n\t\t\t\tasset_dir + 'default-skin.css',\n\t\t\t\tasset_dir + 'photoswipe.js',\n\t\t\t\tasset_dir + 'photoswipe-ui-default.js'\n\t\t\t], resolve);\n\t\t});\n\t}\n});","frappe.provide('frappe.views');\n\nfrappe.views.KanbanView = class KanbanView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (route.length === 3) {\n\t\t\tconst doctype = route[1];\n\t\t\tconst user_settings = frappe.get_user_settings(doctype)['Kanban'] || {};\n\t\t\tif (!user_settings.last_kanban_board) {\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('Error'),\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\tmessage: __('Missing parameter Kanban Board Name')\n\t\t\t\t});\n\t\t\t\tfrappe.set_route('List', doctype, 'List');\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\troute.push(user_settings.last_kanban_board);\n\t\t\tfrappe.set_route(route);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\t\tthis.view_name = 'Kanban';\n\t\tthis.board_name = frappe.get_route()[3];\n\t\tthis.page_title = this.board_name;\n\t\tthis.card_meta = this.get_card_meta();\n\n\t\treturn this.get_board()\n\t\t\t.then(() => {\n\t\t\t\tthis.filters = this.board.filters_array;\n\t\t\t});\n\t}\n\n\tget_board() {\n\t\treturn frappe.db.get_doc('Kanban Board', this.board_name)\n\t\t\t.then(board => {\n\t\t\t\tthis.board = board;\n\t\t\t\tthis.board.filters_array = JSON.parse(this.board.filters || '[]');\n\t\t\t});\n\t}\n\n\tsetup_view() {\n\n\t}\n\n\tset_fields() {\n\t\tsuper.set_fields();\n\t\tthis._add_field(this.card_meta.title_field);\n\t}\n\n\tbefore_render() {\n\t\tthis.save_view_user_settings({\n\t\t\tlast_kanban_board: this.board_name\n\t\t});\n\n\t\tfrappe.call({\n\t\t\tmethod: 'frappe.desk.doctype.kanban_board.kanban_board.save_filters',\n\t\t\targs: {\n\t\t\t\tboard_name: this.board_name,\n\t\t\t\tfilters: this.filter_area.get()\n\t\t\t}\n\t\t}).then(function() {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __('Filters saved'),\n\t\t\t\tindicator: 'green'\n\t\t\t}, 0.5);\n\t\t});\n\t}\n\n\trender() {\n\t\tconst board_name = this.board_name;\n\t\tif(this.kanban && board_name === this.kanban.board_name) {\n\t\t\tthis.kanban.update(this.data);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.kanban = new frappe.views.KanbanBoard({\n\t\t\tdoctype: this.doctype,\n\t\t\tboard: this.board,\n\t\t\tboard_name: board_name,\n\t\t\tcards: this.data,\n\t\t\tcard_meta: this.card_meta,\n\t\t\twrapper: this.$result,\n\t\t\tcur_list: this,\n\t\t\tuser_settings: this.view_user_settings\n\t\t});\n\t}\n\n\tget_card_meta() {\n\t\tvar meta = frappe.get_meta(this.doctype);\n\t\tvar doc = frappe.model.get_new_doc(this.doctype);\n\t\tvar title_field = null;\n\t\tvar quick_entry = false;\n\n\t\tif(this.meta.title_field) {\n\t\t\ttitle_field = frappe.meta.get_field(this.doctype, this.meta.title_field);\n\t\t}\n\n\t\tthis.meta.fields.forEach(function(df) {\n\t\t\tconst is_valid_field =\n\t\t\t\tin_list(['Data', 'Text', 'Small Text', 'Text Editor'], df.fieldtype)\n\t\t\t\t\t&& !df.hidden;\n\n\t\t\tif (is_valid_field && !title_field) {\n\t\t\t\t// can be mapped to textarea\n\t\t\t\ttitle_field = df;\n\t\t\t}\n\t\t});\n\n\t\t// quick entry\n\t\tvar mandatory = meta.fields.filter(function(df) {\n\t\t\treturn df.reqd && !doc[df.fieldname];\n\t\t});\n\n\t\tif(mandatory.some(df => df.fieldtype === 'Table') || mandatory.length > 1) {\n\t\t\tquick_entry = true;\n\t\t}\n\n\t\tif(!title_field) {\n\t\t\ttitle_field = frappe.meta.get_field(this.doctype, 'name');\n\t\t}\n\n\t\treturn {\n\t\t\tquick_entry: quick_entry,\n\t\t\ttitle_field: title_field\n\t\t};\n\t}\n\n\tget required_libs() {\n\t\treturn [\n\t\t\t'assets/frappe/js/lib/fluxify.min.js',\n\t\t\t'assets/frappe/js/frappe/views/kanban/kanban_board.js'\n\t\t];\n\t}\n};\n","/**\n * frappe.views.InboxView\n */\n\nfrappe.provide(\"frappe.views\");\n\nfrappe.views.InboxView = class InboxView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (!route[3] && frappe.boot.email_accounts.length) {\n\t\t\tlet email_account;\n\t\t\tif (frappe.boot.email_accounts[0].email_id == \"All Accounts\") {\n\t\t\t\temail_account = \"All Accounts\";\n\t\t\t} else {\n\t\t\t\temail_account = frappe.boot.email_accounts[0].email_account;\n\t\t\t}\n\t\t\tfrappe.set_route(\"List\", \"Communication\", \"Inbox\", email_account);\n\t\t\treturn true;\n\t\t} else if (!route[3] || (route[3] !== \"All Accounts\" && !is_valid(route[3]))) {\n\t\t\tfrappe.msgprint(__('Invalid Email Account'));\n\t\t\twindow.history.back();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\n\t\tfunction is_valid(email_account) {\n\t\t\treturn frappe.boot.email_accounts.find(d => d.email_account === email_account);\n\t\t}\n\t}\n\tshow() {\n\t\tsuper.show();\n\t\t// save email account in user_settings\n\t\tthis.save_view_user_settings({\n\t\t\tlast_email_account: this.current_email_account\n\t\t});\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\t\tthis.view_name = 'Inbox';\n\t\tthis.email_account = frappe.get_route()[3];\n\t\tthis.page_title = this.email_account;\n\t\tthis.filters = this.get_inbox_filters();\n\t}\n\n\tget is_sent_emails() {\n\t\tconst f = this.filter_area.get()\n\t\t\t.find(filter => filter[1] === 'sent_or_received');\n\t\treturn f && f[3] === 'Sent';\n\t}\n\n\trender() {\n\t\tthis.emails = this.data;\n\t\tthis.render_inbox_view();\n\t}\n\n\trender_inbox_view() {\n\t\tlet html = this.emails.map(this.render_email_row.bind(this)).join(\"\");\n\n\t\tthis.$result.html(`\n\t\t\t${this.get_header_html()}\n\t\t\t${html}\n\t\t`);\n\t}\n\n\tget_header_html() {\n\t\treturn this.get_header_html_skeleton(`\n\t\t\t<div class=\"list-row-col list-subject level\">\n\t\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"Select All\">\n\t\t\t\t<span class=\"level-item\">${__('Subject')}</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col hidden-xs\">\n\t\t\t\t<span>${this.is_sent_emails ? __(\"To\") : __(\"From\")}</span>\n\t\t\t</div>\n\t\t`);\n\t}\n\n\trender_email_row(email) {\n\t\tif (!email.css_seen && email.seen)\n\t\t\temail.css_seen = \"seen\";\n\n\t\tconst columns_html = `\n\t\t\t<div class=\"list-row-col list-subject level\">\n\t\t\t\t<input class=\"level-item list-row-checkbox hidden-xs\" type=\"checkbox\" data-name=\"${email.name}\">\n\t\t\t\t<span class=\"level-item\">\n\t\t\t\t\t<a class=\"${ email.seen ? 'seen' : ''} ellipsis\" href=\"${this.get_form_link(email)}\">\n\t\t\t\t\t\t${email.subject}\n\t\t\t\t\t</a>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col hidden-xs\">\n\t\t\t\t<span>${this.is_sent_emails ? email.recipients : email.sender }</span>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.get_list_row_html_skeleton(columns_html, this.get_meta_html(email));\n\t}\n\n\tget_meta_html(email) {\n\t\tconst attachment = email.has_attachment ?\n\t\t\t`<span class=\"fa fa-paperclip fa-large\" title=\"${__('Has Attachments')}\"></span>` : '';\n\n\t\tconst form_link = frappe.utils.get_form_link(email.reference_doctype, email.reference_name);\n\t\tconst link = email.reference_doctype && email.reference_doctype !== this.doctype ?\n\t\t\t`<a class=\"text-muted grey\" href=\"${form_link}\"\n\t\t\t\ttitle=\"${__('Linked with {0}', [email.reference_doctype])}\">\n\t\t\t\t<i class=\"fa fa-link fa-large\"></i>\n\t\t\t</a>` : '';\n\n\t\tconst modified = comment_when(email.modified, true);\n\n\t\treturn `\n\t\t\t<div class=\"level-item hidden-xs list-row-activity\">\n\t\t\t\t${link}\n\t\t\t\t${attachment}\n\t\t\t\t${modified}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_inbox_filters() {\n\t\tvar email_account = this.email_account;\n\t\tvar default_filters = [\n\t\t\t[\"Communication\", \"communication_type\", \"=\", \"Communication\", true],\n\t\t\t[\"Communication\", \"communication_medium\", \"=\", \"Email\", true],\n\t\t];\n\t\tvar filters = [];\n\t\tif (email_account === \"Sent\") {\n\t\t\tfilters = default_filters.concat([\n\t\t\t\t[\"Communication\", \"sent_or_received\", \"=\", \"Sent\", true],\n\t\t\t\t[\"Communication\", \"email_status\", \"not in\", \"Spam,Trash\", true],\n\t\t\t]);\n\t\t} else if (in_list([\"Spam\", \"Trash\"], email_account)) {\n\t\t\tfilters = default_filters.concat([\n\t\t\t\t[\"Communication\", \"email_status\", \"=\", email_account, true],\n\t\t\t\t[\"Communication\", \"email_account\", \"in\", frappe.boot.all_accounts, true]\n\t\t\t]);\n\t\t} else {\n\t\t\tvar op = \"=\";\n\t\t\tif (email_account == \"All Accounts\") {\n\t\t\t\top = \"in\";\n\t\t\t\temail_account = frappe.boot.all_accounts;\n\t\t\t}\n\n\t\t\tfilters = default_filters.concat([\n\t\t\t\t[\"Communication\", \"sent_or_received\", \"=\", \"Received\", true],\n\t\t\t\t[\"Communication\", \"email_account\", op, email_account, true],\n\t\t\t\t[\"Communication\", \"email_status\", \"not in\", \"Spam,Trash\", true],\n\t\t\t]);\n\t\t}\n\n\t\treturn filters;\n\t}\n\n\tget_no_result_message() {\n\t\tvar email_account = this.email_account;\n\t\tvar args;\n\t\tif (in_list([\"Spam\", \"Trash\"], email_account)) {\n\t\t\treturn __(\"No {0} mail\", [email_account]);\n\t\t} else if (!email_account && !frappe.boot.email_accounts.length) {\n\t\t\t// email account is not configured\n\t\t\targs = {\n\t\t\t\tdoctype: \"Email Account\",\n\t\t\t\tmsg: __(\"No Email Account\"),\n\t\t\t\tlabel: __(\"New Email Account\"),\n\t\t\t};\n\t\t} else {\n\t\t\t// no sent mail\n\t\t\targs = {\n\t\t\t\tdoctype: \"Communication\",\n\t\t\t\tmsg: __(\"No Emails\"),\n\t\t\t\tlabel: __(\"Compose Email\")\n\t\t\t};\n\t\t}\n\n\t\tconst html = frappe.model.can_create(args.doctype) ?\n\t\t\t`<p>${args.msg}</p>\n\t\t\t<p>\n\t\t\t\t<button class=\"btn btn-primary btn-sm btn-new-doc\">\n\t\t\t\t\t${args.label}\n\t\t\t\t</button>\n\t\t\t</p>\n\t\t\t` :\n\t\t\t`<p>${ __(\"No Email Accounts Assigned\") }</p>`;\n\n\t\treturn `\n\t\t\t<div class=\"msg-box no-border\">\n\t\t\t\t${html}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tmake_new_doc() {\n\t\tif (!this.email_account && !frappe.boot.email_accounts.length) {\n\t\t\tfrappe.route_options = {\n\t\t\t\t'email_id': frappe.session.user_email\n\t\t\t};\n\t\t\tfrappe.new_doc('Email Account');\n\t\t} else {\n\t\t\tnew frappe.views.CommunicationComposer({\n\t\t\t\tdoc: {}\n\t\t\t});\n\t\t}\n\t}\n};","frappe.provide('frappe.views');\n\nfrappe.views.FileView = class FileView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (route.length === 2) {\n\t\t\tconst view_user_settings = frappe.get_user_settings('File', 'File');\n\t\t\tfrappe.set_route('List', 'File', view_user_settings.last_folder || frappe.boot.home_folder);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tsetup_view() {\n\t\tthis.setup_events();\n\t}\n\n\tset_breadcrumbs() {\n\t\tconst route = frappe.get_route();\n\t\troute.splice(-1);\n\t\tconst last_folder = route[route.length - 1];\n\t\tif (last_folder === 'File') return;\n\n\t\tconst last_folder_route = '#' + route.join('/');\n\t\tfrappe.breadcrumbs.add({\n\t\t\ttype: 'Custom',\n\t\t\tlabel: last_folder,\n\t\t\troute: last_folder_route\n\t\t});\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\t\tthis.view_name = 'File';\n\t\tthis.page_title = __('File Manager');\n\n\t\tconst route = frappe.get_route();\n\t\tthis.current_folder = route.slice(2).join('/');\n\t\tthis.filters = [['File', 'folder', '=', this.current_folder, true]];\n\t\tthis.order_by = this.view_user_settings.order_by || 'file_name asc';\n\n\t\tthis.menu_items = this.menu_items.concat(this.file_menu_items());\n\t}\n\n\tfile_menu_items() {\n\t\tconst items = [\n\t\t\t{\n\t\t\t\tlabel: __('Cut'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.file_manager.cut(this.get_checked_items(), this.current_folder);\n\t\t\t\t},\n\t\t\t\tclass: 'cut-menu-button hide'\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Paste'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.file_manager.paste(this.current_folder);\n\t\t\t\t},\n\t\t\t\tclass: 'paste-menu-button hide'\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('New Folder'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.prompt(__('Name'), (values) => {\n\t\t\t\t\t\tif((values.value.indexOf(\"/\") > -1)) {\n\t\t\t\t\t\t\tfrappe.throw(__(\"Folder name should not include '/' (slash)\"));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst data =  {\n\t\t\t\t\t\t\tfile_name: values.value,\n\t\t\t\t\t\t\tfolder: this.current_folder\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: \"frappe.core.doctype.file.file.create_new_folder\",\n\t\t\t\t\t\t\targs: data\n\t\t\t\t\t\t});\n\t\t\t\t\t}, __('Enter folder name'), __('Create'));\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Toggle Grid View'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.views.FileView.grid_view = !frappe.views.FileView.grid_view;\n\t\t\t\t\tthis.refresh();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Import Zip'),\n\t\t\t\taction: () => {\n\t\t\t\t\t// make upload dialog\n\t\t\t\t\tfrappe.ui.get_upload_dialog({\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tfolder: this.current_folder,\n\t\t\t\t\t\t\tfrom_form: 1\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: (attachment, r) => {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: 'frappe.core.doctype.file.file.unzip_file',\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\tname: r.message.name,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t\t\t\tif(r.exc) {\n\t\t\t\t\t\t\t\t\t\tfrappe.msgprint(__('Error in uploading files' + r.exc));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\treturn items;\n\t}\n\n\tset_fields() {\n\t\tthis.fields = this.meta.fields\n\t\t\t.filter(df => frappe.model.is_value_type(df.fieldtype) && !df.hidden)\n\t\t\t.map(df => df.fieldname)\n\t\t\t.concat(['name', 'modified', 'creation']);\n\t}\n\n\tprepare_data(data) {\n\t\tsuper.prepare_data(data);\n\n\t\tthis.data = this.data.map(d => {\n\t\t\tlet icon_class = '';\n\t\t\tif (d.is_folder) {\n\t\t\t\ticon_class = \"octicon octicon-file-directory\";\n\t\t\t} else if (frappe.utils.is_image_file(d.file_name)) {\n\t\t\t\ticon_class = \"octicon octicon-file-media\";\n\t\t\t} else {\n\t\t\t\ticon_class = 'octicon octicon-file-text';\n\t\t\t}\n\n\t\t\tlet title = d.file_name || d.file_url;\n\t\t\ttitle = title.slice(0, 60);\n\t\t\td._title = title;\n\t\t\td.icon_class = icon_class;\n\n\t\t\td.subject_html = `\n\t\t\t\t<i class=\"${icon_class} text-muted\" style=\"width: 16px;\"></i>\n\t\t\t\t<span>${title}</span>\n\t\t\t\t${d.is_private ? '<i class=\"fa fa-lock fa-fw text-warning\"></i>' : ''}\n\t\t\t`;\n\t\t\treturn d;\n\t\t});\n\n\t\t// Bring folders to the top\n\t\tconst { sort_by } = this.sort_selector;\n\t\tif (sort_by === 'file_name') {\n\t\t\tthis.data.sort((a, b) => {\n\t\t\t\tif (a.is_folder && !b.is_folder) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\tif (!a.is_folder &&b.is_folder) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t});\n\t\t}\n\t}\n\n\tbefore_render() {\n\t\tsuper.before_render();\n\t\tfrappe.model.user_settings.save('File', 'grid_view', frappe.views.FileView.grid_view);\n\t\tthis.save_view_user_settings({\n\t\t\tlast_folder: this.current_folder,\n\t\t});\n\t}\n\n\trender() {\n\t\tthis.$result.removeClass('file-grid');\n\t\tif (frappe.views.FileView.grid_view) {\n\t\t\tthis.render_grid_view();\n\t\t} else {\n\t\t\tsuper.render();\n\t\t}\n\t}\n\n\trender_grid_view() {\n\t\tlet html = '';\n\n\t\thtml = this.data.map(d => {\n\t\t\treturn `\n\t\t\t\t<a href=\"${this.get_route_url(d)}\">\n\t\t\t\t\t<div class=\"file-wrapper padding flex small\">\n\t\t\t\t\t\t<div class=\"file-icon text-muted\">\n\t\t\t\t\t\t\t<span class=\"${d.icon_class} mega-octicon\"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"file-title ellipsis\">${d._title}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t`;\n\t\t}).join('');\n\t\tthis.$result.addClass('file-grid');\n\t\tthis.$result.html(html);\n\t}\n\n\tget_header_html() {\n\t\tlet subject_html = `\n\t\t\t<div class=\"list-row-col list-subject level\">\n\t\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"${__(\"Select All\")}\">\n\t\t\t\t<span class=\"level-item\">${__('File Name')}</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs\">\n\t\t\t\t<span>${__('File Size')}</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs\">\n\t\t\t\t<span>${__('Created On')}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.get_header_html_skeleton(subject_html, '<span class=\"list-count\"></span>');\n\t}\n\n\tget_route_url(file) {\n\t\treturn file.is_folder ? '#List/File/' + file.name : this.get_form_link(file);\n\t}\n\n\tget_left_html(file) {\n\t\tconst file_size = frappe.form.formatters.FileSize(file.file_size);\n\t\tconst route_url = this.get_route_url(file);\n\n\t\tlet created_on;\n\t\tconst [date] = file.creation.split(' ');\n\t\tif (date === frappe.datetime.now_date()) {\n\t\t\tcreated_on = comment_when(file.creation);\n\t\t} else {\n\t\t\tcreated_on = frappe.datetime.str_to_user(date);\n\t\t}\n\n\t\treturn `\n\t\t\t<div class=\"list-row-col ellipsis list-subject level\">\n\t\t\t\t<input class=\"level-item list-row-checkbox hidden-xs\" type=\"checkbox\" data-name=\"${file.name}\">\n\t\t\t\t<span class=\"level-item  ellipsis\" title=\"${file.file_name}\">\n\t\t\t\t\t<a class=\"ellipsis\" href=\"${route_url}\" title=\"${file.file_name}\">\n\t\t\t\t\t\t${file.subject_html}\n\t\t\t\t\t</a>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs text-muted\">\n\t\t\t\t<span>${file_size}</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs text-muted\">\n\t\t\t\t<span>${created_on}</span>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_right_html(file) {\n\t\treturn `\n\t\t\t<div class=\"level-item list-row-activity\">\n\t\t\t\t${comment_when(file.modified)}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tmake_new_doc() {\n\t\tfrappe.ui.get_upload_dialog({\n\t\t\t\"args\": {\n\t\t\t\t\"folder\": this.current_folder,\n\t\t\t\t\"from_form\": 1\n\t\t\t},\n\t\t\tcallback:() => this.refresh()\n\t\t});\n\t}\n\n\tsetup_events() {\n\t\tsuper.setup_events();\n\t\tthis.setup_drag_drop();\n\t}\n\n\tsetup_drag_drop() {\n\t\tthis.$result.on('dragenter dragover', false)\n\t\t\t.on('drop', e => {\n\t\t\t\tvar dataTransfer = e.originalEvent.dataTransfer;\n\t\t\t\tif (!(dataTransfer && dataTransfer.files && dataTransfer.files.length > 0)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t\tfrappe.upload.make({\n\t\t\t\t\tfiles: dataTransfer.files,\n\t\t\t\t\t\"args\": {\n\t\t\t\t\t\t\"folder\": this.current_folder,\n\t\t\t\t\t\t\"from_form\": 1\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\ttoggle_result_area() {\n\t\tsuper.toggle_result_area();\n\t\tthis.toggle_cut_paste_buttons();\n\t}\n\n\ton_row_checked() {\n\t\tsuper.on_row_checked();\n\t\tthis.toggle_cut_paste_buttons();\n\t}\n\n\ttoggle_cut_paste_buttons() {\n\t\t// paste btn\n\t\tconst $paste_btn = this.page.menu_btn_group.find('.paste-menu-button');\n\t\tconst hide = !frappe.file_manager.can_paste ||\n\t\t\tfrappe.file_manager.old_folder === this.current_folder;\n\n\t\tif (hide) {\n\t\t\t$paste_btn.addClass('hide');\n\t\t} else {\n\t\t\t$paste_btn.removeClass('hide');\n\t\t}\n\n\t\t// cut btn\n\t\tconst $cut_btn = this.page.menu_btn_group.find('.cut-menu-button');\n\t\tif (this.$checks && this.$checks.length > 0) {\n\t\t\t$cut_btn.removeClass('hide');\n\t\t} else {\n\t\t\t$cut_btn.addClass('hide');\n\t\t}\n\t}\n};\n\nfrappe.views.FileView.grid_view = frappe.get_user_settings('File').grid_view || false;","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.treeview_settings\");\nfrappe.provide('frappe.views.trees');\nwindow.cur_tree = null;\n\nfrappe.views.TreeFactory = frappe.views.Factory.extend({\n\tmake: function(route) {\n\t\tfrappe.model.with_doctype(route[1], function() {\n\t\t\tvar options = {\n\t\t\t\tdoctype: route[1],\n\t\t\t\tmeta: frappe.get_meta(route[1])\n\t\t\t};\n\n\t\t\tif (!frappe.treeview_settings[route[1]] && !frappe.meta.get_docfield(route[1], \"is_group\")) {\n\t\t\t\tfrappe.msgprint(__(\"Tree view not available for {0}\", [route[1]] ));\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t$.extend(options, frappe.treeview_settings[route[1]] || {});\n\t\t\tfrappe.views.trees[options.doctype] = new frappe.views.TreeView(options);\n\t\t});\n\t}\n});\n\nfrappe.views.TreeView = Class.extend({\n\tinit: function(opts) {\n\t\tvar me = this;\n\n\t\tthis.opts = {};\n\t\tthis.opts.get_tree_root = true;\n\t\tthis.opts.show_expand_all = true;\n\t\t$.extend(this.opts, opts);\n\t\tthis.doctype = opts.doctype;\n\t\tthis.args = {doctype: me.doctype};\n\t\tthis.page_name = frappe.get_route_str();\n\t\tthis.get_tree_nodes =  me.opts.get_tree_nodes || \"frappe.desk.treeview.get_children\";\n\n\t\tthis.get_permissions();\n\t\tthis.make_page();\n\t\tthis.make_filters();\n\n\t\tif (me.opts.get_tree_root) {\n\t\t\tthis.get_root();\n\t\t}\n\n\t\tthis.onload();\n\t\tthis.set_menu_item();\n\t\tthis.set_primary_action();\n\t},\n\tget_permissions: function(){\n\t\tthis.can_read = frappe.model.can_read(this.doctype);\n\t\tthis.can_create = frappe.boot.user.can_create.indexOf(this.doctype) !== -1 ||\n\t\t\t\t\tfrappe.boot.user.in_create.indexOf(this.doctype) !== -1;\n\t\tthis.can_write = frappe.model.can_write(this.doctype);\n\t\tthis.can_delete = frappe.model.can_delete(this.doctype);\n\t},\n\tmake_page: function() {\n\t\tvar me = this;\n\t\tthis.parent = frappe.container.add_page(this.page_name);\n\t\tfrappe.ui.make_app_page({parent:this.parent, single_column:true});\n\n\t\tthis.page = this.parent.page;\n\t\tfrappe.container.change_to(this.page_name);\n\t\tfrappe.breadcrumbs.add(me.opts.breadcrumb || locals.DocType[me.doctype].module);\n\n\t\tthis.set_title();\n\n\t\tthis.page.main.css({\n\t\t\t\"min-height\": \"300px\",\n\t\t\t\"padding-bottom\": \"25px\"\n\t\t});\n\n\t\tif(this.opts.show_expand_all) {\n\t\t\tthis.page.add_inner_button(__('Expand All'), function() {\n\t\t\t\tme.tree.load_children(me.tree.root_node, true);\n\t\t\t});\n\t\t}\n\n\t\tif(this.opts.view_template) {\n\t\t\tvar row = $('<div class=\"row\"><div>').appendTo(this.page.main);\n\t\t\tthis.body = $('<div class=\"col-sm-6 col-xs-12\"></div>').appendTo(row);\n\t\t\tthis.node_view = $('<div class=\"col-sm-6 hidden-xs\"></div>').appendTo(row);\n\t\t} else {\n\t\t\tthis.body = this.page.main;\n\t\t}\n\t},\n\tset_title: function() {\n\t\tthis.page.set_title(this.opts.title || __('{0} Tree', [__(this.doctype)]));\n\t},\n\tonload: function() {\n\t\tvar me = this;\n\t\tthis.opts.onload && this.opts.onload(me);\n\t},\n\tmake_filters: function(){\n\t\tvar me = this;\n\t\tfrappe.treeview_settings.filters = []\n\t\t$.each(this.opts.filters || [], function(i, filter) {\n\t\t\tif(frappe.route_options && frappe.route_options[filter.fieldname]) {\n\t\t\t\tfilter.default = frappe.route_options[filter.fieldname]\n\t\t\t}\n\n\t\t\tfilter.change = function() {\n\t\t\t\tvar val = this.get_value();\n\t\t\t\tme.args[filter.fieldname] = val;\n\t\t\t\tif (val) {\n\t\t\t\t\tme.root_label = val;\n\t\t\t\t\tme.page.set_title(val);\n\t\t\t\t} else {\n\t\t\t\t\tme.root_label = me.opts.root_label;\n\t\t\t\t\tme.set_title();\n\t\t\t\t}\n\t\t\t\tme.make_tree();\n\t\t\t}\n\n\t\t\tme.page.add_field(filter);\n\n\t\t\tif (filter.default) {\n\t\t\t\t$(\"[data-fieldname='\"+filter.fieldname+\"']\").trigger(\"change\");\n\t\t\t}\n\t\t})\n\t},\n\tget_root: function() {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: me.get_tree_nodes,\n\t\t\targs: me.args,\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tme.root_label = r.message[0][\"value\"];\n\t\t\t\t\tme.make_tree();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\tmake_tree: function() {\n\t\t$(this.parent).find(\".tree\").remove();\n\n\t\tthis.tree = new frappe.ui.Tree({\n\t\t\tparent: this.body,\n\t\t\tlabel: this.args[this.opts.root_label] || this.root_label || this.opts.root_label,\n\t\t\texpandable: true,\n\n\t\t\targs: this.args,\n\t\t\tmethod: this.get_tree_nodes,\n\n\t\t\t// array of button props: {label, condition, click, btnClass}\n\t\t\ttoolbar: this.get_toolbar(),\n\n\t\t\tget_label: this.opts.get_label,\n\t\t\ton_render: this.opts.onrender,\n\t\t\ton_click: (node) => { this.select_node(node); },\n\t\t});\n\n\t\tcur_tree = this.tree;\n\t},\n\n\tselect_node: function(node) {\n\t\tvar me = this;\n\t\tif(this.opts.click) {\n\t\t\tthis.opts.click(node);\n\t\t}\n\t\tif(this.opts.view_template) {\n\t\t\tthis.node_view.empty();\n\t\t\t$(frappe.render_template(me.opts.view_template,\n\t\t\t\t{data:node.data, doctype:me.doctype})).appendTo(this.node_view);\n\t\t}\n\t},\n\tget_toolbar: function() {\n\t\tvar me = this;\n\n\t\tvar toolbar = [\n\t\t\t{\n\t\t\t\tlabel:__(me.can_write? \"Edit\": \"Details\"),\n\t\t\t\tcondition: function(node) {\n\t\t\t\t\treturn !node.is_root && me.can_read;\n\t\t\t\t},\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tfrappe.set_route(\"Form\", me.doctype, node.label);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel:__(\"Add Child\"),\n\t\t\t\tcondition: function(node) {\n\t\t\t\t\treturn me.can_create && node.expandable && !node.hide_add;\n\t\t\t\t},\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tme.new_node();\n\t\t\t\t},\n\t\t\t\tbtnClass: \"hidden-xs\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel:__(\"Rename\"),\n\t\t\t\tcondition: function(node) {\n\t\t\t\t\tlet allow_rename = true;\n\t\t\t\t\tif (me.doctype && frappe.get_meta(me.doctype)) {\n\t\t\t\t\t\tif(!frappe.get_meta(me.doctype).allow_rename) allow_rename = false;\n\t\t\t\t\t}\n\t\t\t\t\treturn !node.is_root && me.can_write && allow_rename;\n\t\t\t\t},\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tfrappe.model.rename_doc(me.doctype, node.label, function(new_name) {\n\t\t\t\t\t\tnode.$tree_link.find('a').text(new_name);\n\t\t\t\t\t\tnode.label = new_name;\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tbtnClass: \"hidden-xs\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel:__(\"Delete\"),\n\t\t\t\tcondition: function(node) { return !node.is_root && me.can_delete; },\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tfrappe.model.delete_doc(me.doctype, node.label, function() {\n\t\t\t\t\t\tnode.parent.remove();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tbtnClass: \"hidden-xs\"\n\t\t\t}\n\t\t]\n\n\t\tif(this.opts.toolbar && this.opts.extend_toolbar) {\n\t\t\treturn toolbar.concat(this.opts.toolbar)\n\t\t} else if (this.opts.toolbar && !this.opts.extend_toolbar) {\n\t\t\treturn this.opts.toolbar\n\t\t} else {\n\t\t\treturn toolbar\n\t\t}\n\t},\n\tnew_node: function() {\n\t\tvar me = this;\n\t\tvar node = me.tree.get_selected_node();\n\n\t\tif(!(node && node.expandable)) {\n\t\t\tfrappe.msgprint(__(\"Select a group node first.\"));\n\t\t\treturn;\n\t\t}\n\n\t\tthis.prepare_fields();\n\n\t\t// the dialog\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __('New {0}',[__(me.doctype)]),\n\t\t\tfields: me.fields\n\t\t});\n\n\t\tvar args = $.extend({}, me.args);\n\t\targs[\"parent_\"+me.doctype.toLowerCase().replace(/ /g,'_')] = me.args[\"parent\"];\n\n\t\td.set_value(\"is_group\", 0);\n\t\td.set_values(args);\n\n\t\t// create\n\t\td.set_primary_action(__(\"Create New\"), function() {\n\t\t\tvar btn = this;\n\t\t\tvar v = d.get_values();\n\t\t\tif(!v) return;\n\n\t\t\tvar node = me.tree.get_selected_node();\n\t\t\tv.parent = node.label;\n\t\t\tv.doctype = me.doctype;\n\n\t\t\tif(node.is_root){\n\t\t\t\tv['is_root'] = node.is_root;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tv['is_root'] = false;\n\t\t\t}\n\n\t\t\t$.extend(args, v)\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: me.opts.add_tree_node || \"frappe.desk.treeview.add_node\",\n\t\t\t\targs: args,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\td.hide();\n\t\t\t\t\t\tif(node.expanded) {\n\t\t\t\t\t\t\tme.tree.toggle_node(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tme.tree.load_children(node, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\td.show();\n\t},\n\tprepare_fields: function(){\n\t\tvar me = this;\n\n\t\tthis.fields = [\n\t\t\t{fieldtype:'Check', fieldname:'is_group', label:__('Group Node'),\n\t\t\t\tdescription: __(\"Further nodes can be only created under 'Group' type nodes\")}\n\t\t]\n\n\t\tif (this.opts.fields) {\n\t\t\tthis.fields = this.opts.fields;\n\t\t}\n\n\t\tthis.ignore_fields = this.opts.ignore_fields || [];\n\n\t\tvar mandatory_fields = $.map(me.opts.meta.fields, function(d) {\n\t\t\treturn (d.reqd || d.bold && !d.read_only) ? d : null });\n\n\t\tvar opts_field_names = this.fields.map(function(d) {\n\t\t\treturn d.fieldname\n\t\t})\n\n\t\tmandatory_fields.map(function(d) {\n\t\t\tif($.inArray(d.fieldname, me.ignore_fields) === -1 && $.inArray(d.fieldname, opts_field_names) === -1) {\n\t\t\t\tme.fields.push(d)\n\t\t\t}\n\t\t})\n\t},\n\tprint_tree: function() {\n\t\tif(!frappe.model.can_print(this.doctype)) {\n\t\t\tfrappe.msgprint(__(\"You are not allowed to print this report\"));\n\t\t\treturn false;\n\t\t}\n\t\tvar tree = $(\".tree:visible\").html();\n\t\tvar me = this;\n\t\tfrappe.ui.get_print_settings(false, function(print_settings) {\n\t\t\tvar title =  __(me.docname || me.doctype);\n\t\t\tfrappe.render_tree({title: title, tree: tree, print_settings:print_settings});\n\t\t});\n\t},\n\tset_primary_action: function(){\n\t\tvar me = this;\n\t\tif (!this.opts.disable_add_node && this.can_create) {\n\t\t\tme.page.set_primary_action(__(\"New\"), function() {\n\t\t\t\tme.new_node();\n\t\t\t}, \"octicon octicon-plus\")\n\t\t}\n\t},\n\tset_menu_item: function(){\n\t\tvar me = this;\n\n\t\tthis.menu_items = [\n\t\t\t{\n\t\t\t\tlabel: __('View List'),\n\t\t\t\taction: function() {\n\t\t\t\t\tfrappe.set_route('List', me.doctype);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Print'),\n\t\t\t\taction: function() {\n\t\t\t\t\tme.print_tree();\n\t\t\t\t}\n\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Refresh'),\n\t\t\t\taction: function() {\n\t\t\t\t\tme.make_tree();\n\t\t\t\t}\n\t\t\t},\n\t\t];\n\n\t\tif (me.opts.menu_items) {\n\t\t\tme.menu_items.push.apply(me.menu_items, me.opts.menu_items)\n\t\t}\n\n\t\t$.each(me.menu_items, function(i, menu_item){\n\t\t\tvar has_perm = true;\n\t\t\tif(menu_item[\"condition\"]) {\n\t\t\t\thas_perm = eval(menu_item[\"condition\"]);\n\t\t\t}\n\n\t\t\tif (has_perm) {\n\t\t\t\tme.page.add_menu_item(menu_item[\"label\"], menu_item[\"action\"]);\n\t\t\t}\n\t\t});\n\n\t\t// last menu item\n\t\tme.page.add_menu_item(__('Add to Desktop'), () => {\n\t\t\tconst label = me.doctype === 'Account' ?\n\t\t\t\t__('Chart of Accounts') :\n\t\t\t\t__(me.doctype);\n\t\t\tfrappe.add_to_desktop(label, me.doctype);\n\t\t});\n\t}\n});\n\n\n\n\n\n\n\n\n"],"names":["frappe","has_indicator","doctype","model","is_submittable","listview_settings","get_indicator","workflow","get_state_fieldname","meta","has_field","doc","__unsaved","__","workflows","without_workflow","settings","workflow_fieldname","value","colour","locals","style","Success","Warning","Danger","Primary","docstatus","has_indicator_for_draft","indicator","status","utils","guess_colour","enabled","disabled","ui","Filter","opts","$","extend","this","undefined","filter_utils","conditions","invalid_condition_map","Date","Datetime","Data","Select","Link","Currency","Color","make","make_select","set_events","setup","filter_edit_area","render_template","appendTo","parent","find","fieldselect","FieldSelect","parent_doctype","filter_fields","select","fieldname","set_field","filter_options","filter_items","set_value","on","remove","removeClass","on_change","update_filter_tag","change","field","let","condition","get_condition","fieldtype","includes","add_condition_help","df","const","set_values","setup_state","is_new","promise","Promise","resolve","addClass","hidden","then","$filter_tag","hide","freeze","_filter_value_set","set_filter_button_text","make_tag","original_type","set_condition","Array","isArray","join","trim","cur","k","original_docfield","fields_by_name","msgprint","copy_dict","read_only","c","get_default_condition","set_fieldtype","selected_doctype","selected_fieldname","make_field","old_fieldtype","old_text","get_value","hide_invalid_conditions","field_area","empty","get","f","form","make_control","only_input","refresh","wrapper","keydown","e","which","get_selected_value","val","trigger_change","$condition_field","get_filter_tag_element","insertAfter","bind_tag","bind","filter_button","closest","show","toggle","html","get_filter_button_text","get_formatted_value","label","$desc","desc_area","in_list","invalid_conditions","0","1","2","cint","format","only_value","strip","indexOf","slice","split","map","v","description","reqd","ignore_link_validation","options","toLowerCase","FilterGroup","filters","append","get_container_template","add_filter","add_filters","promises","filter","push","ref","all","validate_args","is_new_filter","arguments","length","args","push_new_filter","std_fields_list","throw","bold","filter_exists","_push_new_filter","update","update_filters","filter_value","exists","f_value","equal","arrays_equal","get_filters","clear_filters","get_filter","Class","init","me","$input","select_input","awesomplete","Awesomplete","minChars","maxItems","autoFirst","list","item","repl","data","originalEvent","text","get_item","i","add_field_option","build_options","clear","parts","each","table_fields","std_filters","std_fields","d","doctype_obj","istable","concat","with_blank","main_table_fields","docfield_list","sort","perm","has_perm","permlevel","report_hide","table_df","child_table_fields","table","no_value_type","Tags","tagsList","onTagAdd","onTagRemove","onTagClick","onChange","placeholder","$wrapper","$ul","$inputWrapper","getListElement","$placeholder","deactivate","boot","keypress","keyCode","addTag","activate","addTags","focus","$tag","getTag","insertBefore","removeTag","labels","clearTags","$element","className","$li","$removeTag","attr","$toggle_tag","TagEditor","setup_tags","user_tags","initialized","tags","tag","refreshing","toTitle","call","method","get_args","callback","r","splice","setup_awesomplete","setup_complete","input","target","frm","txt","cat_tags","list_sidebar","JSON","stringify","get_cat_tags","message","trigger","dt","dn","docname","setTimeout","is_liked","get_liked_by","session","user","liked","_liked_by","parse","toggle_like","$btn","name","add","hasClass","css","quiet","exc","action_buttons","replace","liked_by","idx","click_toggle_like","$count","siblings","not_liked","setup_like_popover","$parent","selector","dom","is_touchscreen","popover","animation","placement","content","decodeURI","container","provide","views","BaseList","Object","assign","init_promise","tasks","setup_defaults","set_stats","setup_fields","setup_page","setup_side_bar","setup_main_section","setup_view","fn","run_serially","page_name","get_route_str","page_title","get_meta","user_settings","get_user_settings","start","page_length","can_create","can_write","fields","order_by","primary_action","secondary_action","action","menu_items","class","set_fields","build_fields","title_field","forEach","_add_field","get_fields_in_list_view","is_value_type","in_list_view","uniqBy","stats","workflow_state_fieldname","page","$page","page_form","setup_page_head","set_title","set_menu_items","set_breadcrumbs","$secondary_action","set_secondary_action","icon","$item","add_menu_item","standard","breadcrumbs","module","ListSidebar","list_view","toggle_side_bar","toggleClass","current_view","setup_list_wrapper","setup_filter_area","setup_sort_selector","setup_result_area","setup_no_result_area","setup_freeze_area","setup_paging_area","$frappe_list","main","filter_area","FilterArea","set","sort_selector","SortSelector","$filter_list_wrapper","onchange","$result","$no_result","get_no_result_message","$freeze","$paging_area","$this","currentTarget","is","get_fields","get_full_column_name","get_filters_for_args","get_sql_string","type","freeze_on_refresh","freeze_message","prepare_data","toggle_result_area","before_render","render","dict","keys","values","show_more","call_for_selected_items","names","get_checked_items","standard_filters_wrapper","trigger_refresh","make_standard_filters","make_filter_list","filter_list","standard_filters","get_standard_filters","this$1","from","set_standard_filter","non_standard_filters","refresh_list_view","fields_dict","reduce","out","key","custom_filter_configs","config","doctype_fields","in_standard_filter","unshift","input_class","add_field","position","z-index","right","top","font-size","base_list","default_filters","view_modes","is_valid","view_mode","BulkOperations","print","docs","print_settings","get_doc","allow_print_for_draft","allow_print_for_cancelled","valid_docs","has_role","dialog","Dialog","title","get_print_formats","set_primary_action","default_print_format","with_letterhead","print_format","print_sel","json_string","window","open","encodeURIComponent","delete","docnames","done","items","failed","_server_messages","play_sound","AssignToDialog","obj","bulk_assign","re_assign","submit_or_cancel","edit","field_mappings","field_options","new_df","match","default","depends_on","replace_field","primary_action_label","ListView","super","load_last_view","route","get_route","last_view","set_route","has_permissions","route_options","set_filters_from_route_options","prototypeAccessors","view_user_settings","view_name","saved_filters","validate_filters","get_menu_items","actions_menu_items","get_actions_menu_items","patch_refresh_and_load_lib","set_actions_menu_items","add_actions_menu_item","show_restricted_list_indicator_if_applicable","match_rules_list","get_match_rules","restricted_list","prepend","click","show_restrictions","condition_list","image_field","add_fields","track_seen","throttle","load_lib","required_libs","require","setInterval","make_new_doc","clear_primary_action","is_non_std_field","new_doc","setup_columns","render_header","render_skeleton","setup_events","onload","columns","get_df","get_docfield","fields_in_list_view","new_button","with_comment_count","toggle_actions_menu_button","show_actions_menu","hide_actions_menu","get_header_html","$row","get_list_row_html_skeleton","save","save_view_user_settings","get_list_row_html","render_count","render_tags","get_count_html","$list_rows","tag_html","_user_tags","subject_field","subject_html","$columns","col","is_numeric_field","get_header_html_skeleton","left","get_left_html","get_column_html","get_right_html","get_meta_html","get_indicator_html","_value","formatters","Subject","Field","get_subject_html","escape_html","get_form_link","modified","comment_when","last_assignee","_assign","avatar","_comment_count","get_indicator_dot","current_count","count","subject","strip_html","escaped_subject","heart_class","seen","_seen","encodeURI","metaKey","ctrlKey","stopPropagation","filters_to_apply","datetime","get_today","$target","$check","prop","preventDefault","on_row_checked","link","location","href","toggle_tags","setup_check_events","setup_like","shiftKey","$checkbox_cursor","name_1","name_2","findIndex","min_index","max_index","$list_head_subject","$checkbox_actions","$checks","only_docnames","check","on_update","can_import","reference_doctype","can_set_user_permissions","allow","user_roles","doc_type","add_to_desktop","developer_mode","bulk_operations","is_field_editable","field_doc","get_docfields","some","has_editable_fields","can_print","has_submit_permission","confirm","can_cancel","can_delete","get_doctype_for_field","trigger_list_update","trees","tree","document","event","cur_list","ListFactory","Factory","with_doctype","issingle","set_re_route","view_class","change_to","make_page","set_cur_list","re_route_to_view","set_module_breadcrumb","_super","last_route","route_history","history","go","prev_route","module_links","set_doctype_module","ListFilter","can_add_global","$input_area","$list_filters","filter_input","toUpperCase","render_input","label_area","is_global_input","bind_save_filter","bind_click_filter","bind_remove_filter","get_list_filters","filter_template","set_description","get_filters_values","remove_filter","debounce","has_value","Boolean","filter_name_exists","save_filter","help_text","filter_name","db","insert","for_user","get_current_filters","delete_doc","get_list","or_filters","get_stats","sidebar_content","sidebar","setup_reports","setup_list_filter","setup_assigned_to_me","setup_views","setup_kanban_boards","setup_calendar_view","setup_email_inbox","limits","upgrade_url","expiry","flags","upgrade_dismissed","setup_upgrade_box","show_list_link","calendar","email_accounts","treeview_settings","kanban_board","email_account","added","dropdown","divider","add_reports","reports","ref_doctype","report_type","get_divider","all_reports","list_filter","$dropdown","boards","__kanban_boards","board","private","select_fields","body","field_name","custom_column","add_custom_column_field","make_kanban_board","board_name","err","flag","reject","success","error","kb","kanban_filters","kanban_board_name","result","calendar_views","$link_calendar","default_link","other_links","calendar_view","dropdown_html","has_common","account","email_id","upgrade_list","upgrade_date","add_days","users","upgrade_box","defined_category","defined_cat","cats","category","tempstats","render_stat","stat","sum","docfield_map","a","b","t","nfound","context","run","set_filter","$w","reload_stats","GanttView","calendar_settings","field_map","prepare_tasks","progress","isFunction","end","id","dependencies","depends_on_tasks","color","validate_hex","substr","is_milestone","render_gantt","gantt_view_mode","gantt","Gantt","date_format","on_click","task","on_date_change","moment","on_progress_change","progress_fieldname","parseInt","on_view_change","mode","custom_popup_html","_start","_end","custom","gantt_custom_popup_html","setup_view_mode_buttons","set_colors","view_is","change_view_mode","custom_class","startsWith","class_name","bar_color","get_contrast_color","CalendarView","last_calendar_view","calendar_name","last_calendar","get_calendar_options","Calendar","with_doc","start_date_field","end_date_field","setup_options","clear_user_actions","calendars","can_read","$cal","fullCalendar","footnote_area","set_footnote","border-top","cal_options","set_css","btn_group","allDay","color_map","danger","warning","get_system_datetime","date","_offset","user_utc_offset","convert_to_system_tz","locale","language","header","center","editable","selectable","selectHelper","forceEventDuration","events","timezone","get_events_method","prepare_events","eventRender","element","tooltip","eventClick","eventDrop","delta","revertFunc","update_event","eventResize","startDate","endDate","jsEvent","view","get_new_doc","all_day","_ambigTime","subtract","dayClick","$date_cell","source","convert_to_user_tz","validate","fix_end_date_for_event_render","prepare_colors","color_name","get_css_class","backgroundColor","textColor","remove_from_locals","update_event_method","get_update_args","show_alert","stripTime","ImageView","_image_url","get_image_url","get_attached_images","render_image_view","gallery","prepare_pswp_items","images_map","setup_gallery","item_html","_name","encoded_name","_class","_html","get_abbr","url","image","cordova","is_url","base_url","GalleryView","decodeURIComponent","lib_ready","prepare","pswp_root","pswp","_items","_images_map","width","height","query","el","naturalWidth","naturalHeight","getBoundingClientRect","src","msrc","w","h","pswp_items","_show","index","getThumbBoundsFn","thumbnail","pageYScroll","pageYOffset","documentElement","scrollTop","rect","x","y","shareEl","showHideOpacity","PhotoSwipe","PhotoSwipeUI_Default","browse_images","$more_items","last_hide_timeout","hide_more_items_after_2s","clearTimeout","hide_more_items","img_html","listen","images","currItem","off","img_el","goTo","invalidateCurrItems","updateSize","asset_dir","KanbanView","last_kanban_board","card_meta","get_card_meta","get_board","filters_array","kanban","KanbanBoard","cards","quick_entry","get_field","mandatory","InboxView","back","last_email_account","current_email_account","get_inbox_filters","is_sent_emails","emails","render_inbox_view","render_email_row","email","css_seen","columns_html","recipients","sender","attachment","has_attachment","form_link","reference_name","all_accounts","op","msg","CommunicationComposer","user_email","FileView","last_folder","home_folder","last_folder_route","current_folder","file_menu_items","file_manager","cut","paste","prompt","file_name","folder","grid_view","get_upload_dialog","from_form","icon_class","is_folder","is_image_file","file_url","_title","is_private","render_grid_view","get_route_url","file","created_on","file_size","FileSize","route_url","creation","now_date","str_to_user","setup_drag_drop","dataTransfer","files","upload","toggle_cut_paste_buttons","$paste_btn","menu_btn_group","can_paste","old_folder","$cut_btn","cur_tree","TreeFactory","TreeView","get_tree_root","show_expand_all","get_tree_nodes","get_permissions","make_filters","get_root","set_menu_item","in_create","add_page","make_app_page","single_column","breadcrumb","DocType","min-height","padding-bottom","add_inner_button","load_children","root_node","view_template","row","node_view","root_label","make_tree","Tree","expandable","toolbar","get_toolbar","get_label","on_render","onrender","node","select_node","is_root","hide_add","new_node","btnClass","allow_rename","rename_doc","new_name","$tree_link","extend_toolbar","get_selected_node","prepare_fields","get_values","add_tree_node","expanded","toggle_node","ignore_fields","mandatory_fields","opts_field_names","inArray","print_tree","get_print_settings","render_tree","disable_add_node","apply","menu_item","eval"],"mappings":"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"}