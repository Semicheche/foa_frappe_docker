var Rollup=function(exports){"use strict";var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var clusterize_min=createCommonjsModule(function(t){t.exports=function(){function t(t,e,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function e(t,e,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)}function n(t){return"[object Array]"===Object.prototype.toString.call(t)}function r(t,e){return window.getComputedStyle?window.getComputedStyle(e)[t]:e.currentStyle[t]}var o=function(){for(var t=3,e=document.createElement("b"),n=e.all||[];e.innerHTML="\x3c!--[if gt IE "+ ++t+"]><i><![endif]--\x3e",n[0];);return 4<t?t:document.documentMode}(),a=navigator.platform.toLowerCase().indexOf("mac")+1,i=function(r){if(!(this instanceof i))return new i(r);var o=this,s={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};o.options={};for(var l,c="rows_in_block blocks_in_cluster show_no_data_row no_data_class no_data_text keep_parity tag callbacks".split(" "),d=0;l=c[d];d++)o.options[l]=void 0!==r[l]&&null!=r[l]?r[l]:s[l];for(s=["scroll","content"],d=0;c=s[d];d++)if(o[c+"_elem"]=r[c+"Id"]?document.getElementById(r[c+"Id"]):r[c+"Elem"],!o[c+"_elem"])throw Error("Error! Could not find "+c+" element");o.content_elem.hasAttribute("tabindex")||o.content_elem.setAttribute("tabindex",0);var p=n(r.rows)?r.rows:o.fetchMarkup(),u={};r=o.scroll_elem.scrollTop,o.insertToDOM(p,u),o.scroll_elem.scrollTop=r;var h=!1,f=0,_=!1,g=function(){a&&(_||(o.content_elem.style.pointerEvents="none"),_=!0,clearTimeout(f),f=setTimeout(function(){o.content_elem.style.pointerEvents="auto",_=!1},50)),h!=(h=o.getClusterNum())&&o.insertToDOM(p,u),o.options.callbacks.scrollingProgress&&o.options.callbacks.scrollingProgress(o.getScrollProgress())},m=0,y=function(){clearTimeout(m),m=setTimeout(o.refresh,100)};t("scroll",o.scroll_elem,g),t("resize",window,y),o.destroy=function(t){e("scroll",o.scroll_elem,g),e("resize",window,y),o.html((t?o.generateEmptyRow():p).join(""))},o.refresh=function(t){(o.getRowsHeight(p)||t)&&o.update(p)},o.update=function(t){p=n(t)?t:[],t=o.scroll_elem.scrollTop,p.length*o.options.item_height<t&&(h=o.scroll_elem.scrollTop=0),o.insertToDOM(p,u),o.scroll_elem.scrollTop=t},o.clear=function(){o.update([])},o.getRowsAmount=function(){return p.length},o.getScrollProgress=function(){return this.options.scroll_top/(p.length*this.options.item_height)*100||0};var v=function(t,e){var r=n(e)?e:[];r.length&&(p="append"==t?p.concat(r):r.concat(p),o.insertToDOM(p,u))};o.append=function(t){v("append",t)},o.prepend=function(t){v("prepend",t)}};return i.prototype={constructor:i,fetchMarkup:function(){for(var t=[],e=this.getChildNodes(this.content_elem);e.length;)t.push(e.shift().outerHTML);return t},exploreEnvironment:function(t,e){var n=this.options;n.content_tag=this.content_elem.tagName.toLowerCase(),t.length&&(o&&9>=o&&!n.tag&&(n.tag=t[0].match(/<([^>\s/]*)/)[1].toLowerCase()),1>=this.content_elem.children.length&&(e.data=this.html(t[0]+t[0]+t[0])),n.tag||(n.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(t))},getRowsHeight:function(t){var e=this.options,n=e.item_height;if(e.cluster_height=0,t.length){var o=(t=this.content_elem.children)[Math.floor(t.length/2)];return e.item_height=o.offsetHeight,"tr"==e.tag&&"collapse"!=r("borderCollapse",this.content_elem)&&(e.item_height+=parseInt(r("borderSpacing",this.content_elem),10)||0),"tr"!=e.tag&&(t=parseInt(r("marginTop",o),10)||0,o=parseInt(r("marginBottom",o),10)||0,e.item_height+=Math.max(t,o)),e.block_height=e.item_height*e.rows_in_block,e.rows_in_cluster=e.blocks_in_cluster*e.rows_in_block,e.cluster_height=e.blocks_in_cluster*e.block_height,n!=e.item_height}},getClusterNum:function(){return this.options.scroll_top=this.scroll_elem.scrollTop,Math.floor(this.options.scroll_top/(this.options.cluster_height-this.options.block_height))||0},generateEmptyRow:function(){var t=this.options;if(!t.tag||!t.show_no_data_row)return[];var e,n=document.createElement(t.tag),r=document.createTextNode(t.no_data_text);return n.className=t.no_data_class,"tr"==t.tag&&((e=document.createElement("td")).colSpan=100,e.appendChild(r)),n.appendChild(e||r),[n.outerHTML]},generate:function(t,e){var n=this.options;if((i=t.length)<n.rows_in_block)return{top_offset:0,bottom_offset:0,rows_above:0,rows:i?t:this.generateEmptyRow()};var r=Math.max((n.rows_in_cluster-n.rows_in_block)*e,0),o=r+n.rows_in_cluster,a=Math.max(r*n.item_height,0),i=(n=Math.max((i-o)*n.item_height,0),[]),s=r;for(1>a&&s++;r<o;r++)t[r]&&i.push(t[r]);return{top_offset:a,bottom_offset:n,rows_above:s,rows:i}},renderExtraTag:function(t,e){var n=document.createElement(this.options.tag);return n.className=["clusterize-extra-row","clusterize-"+t].join(" "),e&&(n.style.height=e+"px"),n.outerHTML},insertToDOM:function(t,e){this.options.cluster_height||this.exploreEnvironment(t,e);var n=this.generate(t,this.getClusterNum()),r=n.rows.join(""),o=this.checkChanges("data",r,e),a=this.checkChanges("top",n.top_offset,e),i=this.checkChanges("bottom",n.bottom_offset,e),s=this.options.callbacks,l=[];o||a?(n.top_offset&&(this.options.keep_parity&&l.push(this.renderExtraTag("keep-parity")),l.push(this.renderExtraTag("top-space",n.top_offset))),l.push(r),n.bottom_offset&&l.push(this.renderExtraTag("bottom-space",n.bottom_offset)),s.clusterWillChange&&s.clusterWillChange(),this.html(l.join("")),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",n.rows_above),s.clusterChanged&&s.clusterChanged()):i&&(this.content_elem.lastChild.style.height=n.bottom_offset+"px")},html:function(t){var e=this.content_elem;if(o&&9>=o&&"tr"==this.options.tag){var n=document.createElement("div");for(n.innerHTML="<table><tbody>"+t+"</tbody></table>";t=e.lastChild;)e.removeChild(t);for(n=this.getChildNodes(n.firstChild.firstChild);n.length;)e.appendChild(n.shift())}else e.innerHTML=t},getChildNodes:function(t){for(var e=[],n=0,r=(t=t.children).length;n<r;n++)e.push(t[n]);return e},checkChanges:function(t,e,n){var r=e!=n[t];return n[t]=e,r}},i}()});frappe.views.ReportFactory=frappe.views.Factory.extend({make:function(t){var e=["List",t[1],"Report"];t[2]&&e.push(t[2]),frappe.set_route(e)}});var Sortable=createCommonjsModule(function(t){var e;e=function(){if("undefined"==typeof window||!window.document)return function(){throw new Error("Sortable.js requires a window with a document")};var t,e,n,r,o,a,i,s,l,c,d,p,u,h,f,_,g,m,y,v,b,w={},C=/\s+/g,$=/left|right|inline/,x="Sortable"+(new Date).getTime(),T=window,k=T.document,M=T.parseInt,S=T.setTimeout,R=T.jQuery||T.Zepto,D=T.Polymer,E=!1,I="draggable"in k.createElement("div"),j=!navigator.userAgent.match(/(?:Trident.*rv[ :]?11\.|msie)/i)&&((b=k.createElement("x")).style.cssText="pointer-events:auto","auto"===b.style.pointerEvents),L=!1,O=Math.abs,H=Math.min,A=[],N=[],B=rt(function(t,e,n){if(n&&e.scroll){var r,o,a,i,d,p,u=n[x],h=e.scrollSensitivity,f=e.scrollSpeed,_=t.clientX,g=t.clientY,m=window.innerWidth,y=window.innerHeight;if(l!==n&&(s=e.scroll,l=n,c=e.scrollFn,!0===s)){s=n;do{if(s.offsetWidth<s.scrollWidth||s.offsetHeight<s.scrollHeight)break}while(s=s.parentNode)}s&&(r=s,o=s.getBoundingClientRect(),a=(O(o.right-_)<=h)-(O(o.left-_)<=h),i=(O(o.bottom-g)<=h)-(O(o.top-g)<=h)),a||i||(i=(y-g<=h)-(g<=h),((a=(m-_<=h)-(_<=h))||i)&&(r=T)),w.vx===a&&w.vy===i&&w.el===r||(w.el=r,w.vx=a,w.vy=i,clearInterval(w.pid),r&&(w.pid=setInterval(function(){if(p=i?i*f:0,d=a?a*f:0,"function"==typeof c)return c.call(u,d,p,t);r===T?T.scrollTo(T.pageXOffset+d,T.pageYOffset+p):(r.scrollTop+=p,r.scrollLeft+=d)},24)))}},30),W=function(t){function e(t,e){return void 0!==t&&!0!==t||(t=n.name),"function"==typeof t?t:function(n,r){var o=r.options.group.name;return e?t:t&&(t.join?t.indexOf(o)>-1:o==t)}}var n={},r=t.group;r&&"object"==typeof r||(r={name:r}),n.name=r.name,n.checkPull=e(r.pull,!0),n.checkPut=e(r.put),n.revertClone=r.revertClone,t.group=n};try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){E={capture:!1,passive:!1}}}))}catch(t){}function F(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be HTMLElement, and not "+{}.toString.call(t);this.el=t,this.options=e=ot({},e),t[x]=this;var n={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(t.nodeName)?"li":">*",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==F.supportPointer};for(var r in n)!(r in e)&&(e[r]=n[r]);for(var o in W(e),this)"_"===o.charAt(0)&&"function"==typeof this[o]&&(this[o]=this[o].bind(this));this.nativeDraggable=!e.forceFallback&&I,q(t,"mousedown",this._onTapStart),q(t,"touchstart",this._onTapStart),e.supportPointer&&q(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(q(t,"dragover",this),q(t,"dragenter",this)),N.push(this._onDragOver),e.store&&this.sort(e.store.get(this))}function P(e,n){"clone"!==e.lastPullMode&&(n=!0),r&&r.state!==n&&(G(r,"display",n?"none":""),n||r.state&&(e.options.group.revertClone?(o.insertBefore(r,a),e._animate(t,r)):o.insertBefore(r,t)),r.state=n)}function z(t,e,n){if(t){n=n||k;do{if(">*"===e&&t.parentNode===n||nt(t,e))return t}while(t=V(t))}return null}function V(t){var e=t.host;return e&&e.nodeType?e:t.parentNode}function q(t,e,n){t.addEventListener(e,n,E)}function X(t,e,n){t.removeEventListener(e,n,E)}function Y(t,e,n){if(t)if(t.classList)t.classList[n?"add":"remove"](e);else{var r=(" "+t.className+" ").replace(C," ").replace(" "+e+" "," ");t.className=(r+(n?" "+e:"")).replace(C," ")}}function G(t,e,n){var r=t&&t.style;if(r){if(void 0===n)return k.defaultView&&k.defaultView.getComputedStyle?n=k.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),void 0===e?n:n[e];e in r||(e="-webkit-"+e),r[e]=n+("string"==typeof n?"":"px")}}function U(t,e,n){if(t){var r=t.getElementsByTagName(e),o=0,a=r.length;if(n)for(;o<a;o++)n(r[o],o);return r}return[]}function K(t,e,n,o,a,i,s,l){t=t||e[x];var c=k.createEvent("Event"),d=t.options,p="on"+n.charAt(0).toUpperCase()+n.substr(1);c.initEvent(n,!0,!0),c.to=a||e,c.from=i||e,c.item=o||e,c.clone=r,c.oldIndex=s,c.newIndex=l,e.dispatchEvent(c),d[p]&&d[p].call(t,c)}function Q(t,e,n,r,o,a,i,s){var l,c,d=t[x],p=d.options.onMove;return(l=k.createEvent("Event")).initEvent("move",!0,!0),l.to=e,l.from=t,l.dragged=n,l.draggedRect=r,l.related=o||e,l.relatedRect=a||e.getBoundingClientRect(),l.willInsertAfter=s,t.dispatchEvent(l),p&&(c=p.call(d,l,i)),c}function J(t){t.draggable=!1}function Z(){L=!1}function tt(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,n=e.length,r=0;n--;)r+=e.charCodeAt(n);return r.toString(36)}function et(t,e){var n=0;if(!t||!t.parentNode)return-1;for(;t&&(t=t.previousElementSibling);)"TEMPLATE"===t.nodeName.toUpperCase()||">*"!==e&&!nt(t,e)||n++;return n}function nt(t,e){if(t){var n=(e=e.split(".")).shift().toUpperCase(),r=new RegExp("\\s("+e.join("|")+")(?=\\s)","g");return!(""!==n&&t.nodeName.toUpperCase()!=n||e.length&&((" "+t.className+" ").match(r)||[]).length!=e.length)}return!1}function rt(t,e){var n,r;return function(){void 0===n&&(n=arguments,r=this,S(function(){1===n.length?t.call(r,n[0]):t.apply(r,n),n=void 0},e))}}function ot(t,e){if(t&&e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function at(t){return D&&D.dom?D.dom(t).cloneNode(!0):R?R(t).clone(!0)[0]:t.cloneNode(!0)}function it(t){return S(t,0)}function st(t){return clearTimeout(t)}return F.prototype={constructor:F,_onTapStart:function(e){var n,r=this,o=this.el,a=this.options,s=a.preventOnFilter,l=e.type,c=e.touches&&e.touches[0],d=(c||e).target,p=e.target.shadowRoot&&e.path&&e.path[0]||d,u=a.filter;if(function(t){var e=t.getElementsByTagName("input"),n=e.length;for(;n--;){var r=e[n];r.checked&&A.push(r)}}(o),!t&&!(/mousedown|pointerdown/.test(l)&&0!==e.button||a.disabled)&&!p.isContentEditable&&(d=z(d,a.draggable,o))&&i!==d){if(n=et(d,a.draggable),"function"==typeof u){if(u.call(this,e,d,this))return K(r,p,"filter",d,o,o,n),void(s&&e.preventDefault())}else if(u&&(u=u.split(",").some(function(t){if(t=z(p,t.trim(),o))return K(r,t,"filter",d,o,o,n),!0})))return void(s&&e.preventDefault());a.handle&&!z(p,a.handle,o)||this._prepareDragStart(e,c,d,n)}},_prepareDragStart:function(n,r,s,l){var c,d=this,p=d.el,u=d.options,f=p.ownerDocument;s&&!t&&s.parentNode===p&&(m=n,o=p,e=(t=s).parentNode,a=t.nextSibling,i=s,_=u.group,h=l,this._lastX=(r||n).clientX,this._lastY=(r||n).clientY,t.style["will-change"]="all",c=function(){d._disableDelayedDrag(),t.draggable=d.nativeDraggable,Y(t,u.chosenClass,!0),d._triggerDragStart(n,r),K(d,o,"choose",t,o,o,h)},u.ignore.split(",").forEach(function(e){U(t,e.trim(),J)}),q(f,"mouseup",d._onDrop),q(f,"touchend",d._onDrop),q(f,"touchcancel",d._onDrop),q(f,"selectstart",d),u.supportPointer&&q(f,"pointercancel",d._onDrop),u.delay?(q(f,"mouseup",d._disableDelayedDrag),q(f,"touchend",d._disableDelayedDrag),q(f,"touchcancel",d._disableDelayedDrag),q(f,"mousemove",d._disableDelayedDrag),q(f,"touchmove",d._disableDelayedDrag),u.supportPointer&&q(f,"pointermove",d._disableDelayedDrag),d._dragStartTimer=S(c,u.delay)):c())},_disableDelayedDrag:function(){var t=this.el.ownerDocument;clearTimeout(this._dragStartTimer),X(t,"mouseup",this._disableDelayedDrag),X(t,"touchend",this._disableDelayedDrag),X(t,"touchcancel",this._disableDelayedDrag),X(t,"mousemove",this._disableDelayedDrag),X(t,"touchmove",this._disableDelayedDrag),X(t,"pointermove",this._disableDelayedDrag)},_triggerDragStart:function(e,n){(n=n||("touch"==e.pointerType?e:null))?(m={target:t,clientX:n.clientX,clientY:n.clientY},this._onDragStart(m,"touch")):this.nativeDraggable?(q(t,"dragend",this),q(o,"dragstart",this._onDragStart)):this._onDragStart(m,!0);try{k.selection?it(function(){k.selection.empty()}):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(){if(o&&t){var e=this.options;Y(t,e.ghostClass,!0),Y(t,e.dragClass,!1),F.active=this,K(this,o,"start",t,o,o,h)}else this._nulling()},_emulateDragOver:function(){if(y){if(this._lastX===y.clientX&&this._lastY===y.clientY)return;this._lastX=y.clientX,this._lastY=y.clientY,j||G(n,"display","none");var t=k.elementFromPoint(y.clientX,y.clientY),e=t,r=N.length;if(t&&t.shadowRoot&&(e=t=t.shadowRoot.elementFromPoint(y.clientX,y.clientY)),e)do{if(e[x]){for(;r--;)N[r]({clientX:y.clientX,clientY:y.clientY,target:t,rootEl:e});break}t=e}while(e=e.parentNode);j||G(n,"display","")}},_onTouchMove:function(t){if(m){var e=this.options,r=e.fallbackTolerance,o=e.fallbackOffset,a=t.touches?t.touches[0]:t,i=a.clientX-m.clientX+o.x,s=a.clientY-m.clientY+o.y,l=t.touches?"translate3d("+i+"px,"+s+"px,0)":"translate("+i+"px,"+s+"px)";if(!F.active){if(r&&H(O(a.clientX-this._lastX),O(a.clientY-this._lastY))<r)return;this._dragStarted()}this._appendGhost(),v=!0,y=a,G(n,"webkitTransform",l),G(n,"mozTransform",l),G(n,"msTransform",l),G(n,"transform",l),t.preventDefault()}},_appendGhost:function(){if(!n){var e,r=t.getBoundingClientRect(),a=G(t),i=this.options;Y(n=t.cloneNode(!0),i.ghostClass,!1),Y(n,i.fallbackClass,!0),Y(n,i.dragClass,!0),G(n,"top",r.top-M(a.marginTop,10)),G(n,"left",r.left-M(a.marginLeft,10)),G(n,"width",r.width),G(n,"height",r.height),G(n,"opacity","0.8"),G(n,"position","fixed"),G(n,"zIndex","100000"),G(n,"pointerEvents","none"),i.fallbackOnBody&&k.body.appendChild(n)||o.appendChild(n),e=n.getBoundingClientRect(),G(n,"width",2*r.width-e.width),G(n,"height",2*r.height-e.height)}},_onDragStart:function(e,n){var a=this,i=e.dataTransfer,s=a.options;a._offUpEvents(),_.checkPull(a,a,t,e)&&((r=at(t)).draggable=!1,r.style["will-change"]="",G(r,"display","none"),Y(r,a.options.chosenClass,!1),a._cloneId=it(function(){o.insertBefore(r,t),K(a,o,"clone",t)})),Y(t,s.dragClass,!0),n?("touch"===n?(q(k,"touchmove",a._onTouchMove),q(k,"touchend",a._onDrop),q(k,"touchcancel",a._onDrop),s.supportPointer&&(q(k,"pointermove",a._onTouchMove),q(k,"pointerup",a._onDrop))):(q(k,"mousemove",a._onTouchMove),q(k,"mouseup",a._onDrop)),a._loopId=setInterval(a._emulateDragOver,50)):(i&&(i.effectAllowed="move",s.setData&&s.setData.call(a,i,t)),q(k,"drop",a),a._dragStartId=it(a._dragStarted))},_onDragOver:function(i){var s,l,c,h,f=this.el,m=this.options,y=m.group,b=F.active,w=_===y,C=!1,T=m.sort;if(void 0!==i.preventDefault&&(i.preventDefault(),!m.dragoverBubble&&i.stopPropagation()),!t.animated&&(v=!0,b&&!m.disabled&&(w?T||(h=!o.contains(t)):g===this||(b.lastPullMode=_.checkPull(this,b,t,i))&&y.checkPut(this,b,t,i))&&(void 0===i.rootEl||i.rootEl===this.el))){if(B(i,m,this.el),L)return;if(s=z(i.target,m.draggable,f),l=t.getBoundingClientRect(),g!==this&&(g=this,C=!0),h)return P(b,!0),e=o,void(r||a?o.insertBefore(t,r||a):T||o.appendChild(t));if(0===f.children.length||f.children[0]===n||f===i.target&&function(t,e){var n=t.lastElementChild.getBoundingClientRect();return e.clientY-(n.top+n.height)>5||e.clientX-(n.left+n.width)>5}(f,i)){if(0!==f.children.length&&f.children[0]!==n&&f===i.target&&(s=f.lastElementChild),s){if(s.animated)return;c=s.getBoundingClientRect()}P(b,w),!1!==Q(o,f,t,l,s,c,i)&&(t.contains(f)||(f.appendChild(t),e=f),this._animate(l,t),s&&this._animate(c,s))}else if(s&&!s.animated&&s!==t&&void 0!==s.parentNode[x]){d!==s&&(d=s,p=G(s),u=G(s.parentNode));var k=(c=s.getBoundingClientRect()).right-c.left,M=c.bottom-c.top,R=$.test(p.cssFloat+p.display)||"flex"==u.display&&0===u["flex-direction"].indexOf("row"),D=s.offsetWidth>t.offsetWidth,E=s.offsetHeight>t.offsetHeight,I=(R?(i.clientX-c.left)/k:(i.clientY-c.top)/M)>.5,j=s.nextElementSibling,O=!1;if(R){var H=t.offsetTop,A=s.offsetTop;O=H===A?s.previousElementSibling===t&&!D||I&&D:s.previousElementSibling===t||t.previousElementSibling===s?(i.clientY-c.top)/M>.5:A>H}else C||(O=j!==t&&!E||I&&E);var N=Q(o,f,t,l,s,c,i,O);!1!==N&&(1!==N&&-1!==N||(O=1===N),L=!0,S(Z,30),P(b,w),t.contains(f)||(O&&!j?f.appendChild(t):s.parentNode.insertBefore(t,O?j:s)),e=t.parentNode,this._animate(l,t),this._animate(c,s))}}},_animate:function(t,e){var n=this.options.animation;if(n){var r=e.getBoundingClientRect();1===t.nodeType&&(t=t.getBoundingClientRect()),G(e,"transition","none"),G(e,"transform","translate3d("+(t.left-r.left)+"px,"+(t.top-r.top)+"px,0)"),e.offsetWidth,G(e,"transition","all "+n+"ms"),G(e,"transform","translate3d(0,0,0)"),clearTimeout(e.animated),e.animated=S(function(){G(e,"transition",""),G(e,"transform",""),e.animated=!1},n)}},_offUpEvents:function(){var t=this.el.ownerDocument;X(k,"touchmove",this._onTouchMove),X(k,"pointermove",this._onTouchMove),X(t,"mouseup",this._onDrop),X(t,"touchend",this._onDrop),X(t,"pointerup",this._onDrop),X(t,"touchcancel",this._onDrop),X(t,"pointercancel",this._onDrop),X(t,"selectstart",this)},_onDrop:function(i){var s=this.el,l=this.options;clearInterval(this._loopId),clearInterval(w.pid),clearTimeout(this._dragStartTimer),st(this._cloneId),st(this._dragStartId),X(k,"mouseover",this),X(k,"mousemove",this._onTouchMove),this.nativeDraggable&&(X(k,"drop",this),X(s,"dragstart",this._onDragStart)),this._offUpEvents(),i&&(v&&(i.preventDefault(),!l.dropBubble&&i.stopPropagation()),n&&n.parentNode&&n.parentNode.removeChild(n),o!==e&&"clone"===F.active.lastPullMode||r&&r.parentNode&&r.parentNode.removeChild(r),t&&(this.nativeDraggable&&X(t,"dragend",this),J(t),t.style["will-change"]="",Y(t,this.options.ghostClass,!1),Y(t,this.options.chosenClass,!1),K(this,o,"unchoose",t,e,o,h),o!==e?(f=et(t,l.draggable))>=0&&(K(null,e,"add",t,e,o,h,f),K(this,o,"remove",t,e,o,h,f),K(null,e,"sort",t,e,o,h,f),K(this,o,"sort",t,e,o,h,f)):t.nextSibling!==a&&(f=et(t,l.draggable))>=0&&(K(this,o,"update",t,e,o,h,f),K(this,o,"sort",t,e,o,h,f)),F.active&&(null!=f&&-1!==f||(f=h),K(this,o,"end",t,e,o,h,f),this.save()))),this._nulling()},_nulling:function(){o=t=e=n=a=r=i=s=l=m=y=v=f=d=p=g=_=F.active=null,A.forEach(function(t){t.checked=!0}),A.length=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragover":case"dragenter":t&&(this._onDragOver(e),function(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move");t.preventDefault()}(e));break;case"mouseover":this._onDrop(e);break;case"selectstart":e.preventDefault()}},toArray:function(){for(var t,e=[],n=this.el.children,r=0,o=n.length,a=this.options;r<o;r++)z(t=n[r],a.draggable,this.el)&&e.push(t.getAttribute(a.dataIdAttr)||tt(t));return e},sort:function(t){var e={},n=this.el;this.toArray().forEach(function(t,r){var o=n.children[r];z(o,this.options.draggable,n)&&(e[t]=o)},this),t.forEach(function(t){e[t]&&(n.removeChild(e[t]),n.appendChild(e[t]))})},save:function(){var t=this.options.store;t&&t.set(this)},closest:function(t,e){return z(t,e||this.options.draggable,this.el)},option:function(t,e){var n=this.options;if(void 0===e)return n[t];n[t]=e,"group"===t&&W(n)},destroy:function(){var t=this.el;t[x]=null,X(t,"mousedown",this._onTapStart),X(t,"touchstart",this._onTapStart),X(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(X(t,"dragover",this),X(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),N.splice(N.indexOf(this._onDragOver),1),this._onDrop(),this.el=t=null}},q(k,"touchmove",function(t){F.active&&t.preventDefault()}),F.utils={on:q,off:X,css:G,find:U,is:function(t,e){return!!z(t,e,t)},extend:ot,throttle:rt,closest:z,toggleClass:Y,clone:at,index:et,nextTick:it,cancelNextTick:st},F.create=function(t,e){return new F(t,e)},F.version="1.7.0",F},t.exports=e()}),clusterize=createCommonjsModule(function(t){t.exports=function(){var t=function(){for(var t=3,e=document.createElement("b"),n=e.all||[];e.innerHTML="\x3c!--[if gt IE "+ ++t+"]><i><![endif]--\x3e",n[0];);return t>4?t:document.documentMode}(),e=navigator.platform.toLowerCase().indexOf("mac")+1,n=function(t){if(!(this instanceof n))return new n(t);var i=this,s={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};i.options={};for(var l,c=["rows_in_block","blocks_in_cluster","show_no_data_row","no_data_class","no_data_text","keep_parity","tag","callbacks"],d=0;l=c[d];d++)i.options[l]=void 0!==t[l]&&null!=t[l]?t[l]:s[l];for(var p,u=["scroll","content"],d=0;p=u[d];d++)if(i[p+"_elem"]=t[p+"Id"]?document.getElementById(t[p+"Id"]):t[p+"Elem"],!i[p+"_elem"])throw new Error("Error! Could not find "+p+" element");i.content_elem.hasAttribute("tabindex")||i.content_elem.setAttribute("tabindex",0);var h=a(t.rows)?t.rows:i.fetchMarkup(),f={},_=i.scroll_elem.scrollTop;i.insertToDOM(h,f),i.scroll_elem.scrollTop=_;var g=!1,m=0,y=!1,v=function(){e&&(y||(i.content_elem.style.pointerEvents="none"),y=!0,clearTimeout(m),m=setTimeout(function(){i.content_elem.style.pointerEvents="auto",y=!1},50)),g!=(g=i.getClusterNum())&&i.insertToDOM(h,f),i.options.callbacks.scrollingProgress&&i.options.callbacks.scrollingProgress(i.getScrollProgress())},b=0,w=function(){clearTimeout(b),b=setTimeout(i.refresh,100)};r("scroll",i.scroll_elem,v),r("resize",window,w),i.destroy=function(t){o("scroll",i.scroll_elem,v),o("resize",window,w),i.html((t?i.generateEmptyRow():h).join(""))},i.refresh=function(t){(i.getRowsHeight(h)||t)&&i.update(h)},i.update=function(t){h=a(t)?t:[];var e=i.scroll_elem.scrollTop;h.length*i.options.item_height<e&&(i.scroll_elem.scrollTop=0,g=0),i.insertToDOM(h,f),i.scroll_elem.scrollTop=e},i.clear=function(){i.update([])},i.getRowsAmount=function(){return h.length},i.getScrollProgress=function(){return this.options.scroll_top/(h.length*this.options.item_height)*100||0};var C=function(t,e){var n=a(e)?e:[];n.length&&(h="append"==t?h.concat(n):n.concat(h),i.insertToDOM(h,f))};i.append=function(t){C("append",t)},i.prepend=function(t){C("prepend",t)}};function r(t,e,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function o(t,e,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)}function a(t){return"[object Array]"===Object.prototype.toString.call(t)}function i(t,e){return window.getComputedStyle?window.getComputedStyle(e)[t]:e.currentStyle[t]}return n.prototype={constructor:n,fetchMarkup:function(){for(var t=[],e=this.getChildNodes(this.content_elem);e.length;)t.push(e.shift().outerHTML);return t},exploreEnvironment:function(e,n){var r=this.options;r.content_tag=this.content_elem.tagName.toLowerCase(),e.length&&(t&&t<=9&&!r.tag&&(r.tag=e[0].match(/<([^>\s/]*)/)[1].toLowerCase()),this.content_elem.children.length<=1&&(n.data=this.html(e[0]+e[0]+e[0])),r.tag||(r.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(e))},getRowsHeight:function(t){var e=this.options,n=e.item_height;if(e.cluster_height=0,t.length){var r=this.content_elem.children;if(r.length){var o=r[Math.floor(r.length/2)];if(e.item_height=o.offsetHeight,"tr"==e.tag&&"collapse"!=i("borderCollapse",this.content_elem)&&(e.item_height+=parseInt(i("borderSpacing",this.content_elem),10)||0),"tr"!=e.tag){var a=parseInt(i("marginTop",o),10)||0,s=parseInt(i("marginBottom",o),10)||0;e.item_height+=Math.max(a,s)}return e.block_height=e.item_height*e.rows_in_block,e.rows_in_cluster=e.blocks_in_cluster*e.rows_in_block,e.cluster_height=e.blocks_in_cluster*e.block_height,n!=e.item_height}}},getClusterNum:function(){return this.options.scroll_top=this.scroll_elem.scrollTop,Math.floor(this.options.scroll_top/(this.options.cluster_height-this.options.block_height))||0},generateEmptyRow:function(){var t=this.options;if(!t.tag||!t.show_no_data_row)return[];var e,n=document.createElement(t.tag),r=document.createTextNode(t.no_data_text);return n.className=t.no_data_class,"tr"==t.tag&&((e=document.createElement("td")).colSpan=100,e.appendChild(r)),n.appendChild(e||r),[n.outerHTML]},generate:function(t,e){var n=this.options,r=t.length;if(r<n.rows_in_block)return{top_offset:0,bottom_offset:0,rows_above:0,rows:r?t:this.generateEmptyRow()};var o=Math.max((n.rows_in_cluster-n.rows_in_block)*e,0),a=o+n.rows_in_cluster,i=Math.max(o*n.item_height,0),s=Math.max((r-a)*n.item_height,0),l=[],c=o;i<1&&c++;for(var d=o;d<a;d++)t[d]&&l.push(t[d]);return{top_offset:i,bottom_offset:s,rows_above:c,rows:l}},renderExtraTag:function(t,e){var n=document.createElement(this.options.tag);return n.className=["clusterize-extra-row","clusterize-"+t].join(" "),e&&(n.style.height=e+"px"),n.outerHTML},insertToDOM:function(t,e){this.options.cluster_height||this.exploreEnvironment(t,e);var n=this.generate(t,this.getClusterNum()),r=n.rows.join(""),o=this.checkChanges("data",r,e),a=this.checkChanges("top",n.top_offset,e),i=this.checkChanges("bottom",n.bottom_offset,e),s=this.options.callbacks,l=[];o||a?(n.top_offset&&(this.options.keep_parity&&l.push(this.renderExtraTag("keep-parity")),l.push(this.renderExtraTag("top-space",n.top_offset))),l.push(r),n.bottom_offset&&l.push(this.renderExtraTag("bottom-space",n.bottom_offset)),s.clusterWillChange&&s.clusterWillChange(),this.html(l.join("")),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",n.rows_above),this.content_elem.style["counter-increment"]="clusterize-counter "+(n.rows_above-1),s.clusterChanged&&s.clusterChanged()):i&&(this.content_elem.lastChild.style.height=n.bottom_offset+"px")},html:function(e){var n=this.content_elem;if(t&&t<=9&&"tr"==this.options.tag){var r,o=document.createElement("div");for(o.innerHTML="<table><tbody>"+e+"</tbody></table>";r=n.lastChild;)n.removeChild(r);for(var a=this.getChildNodes(o.firstChild.firstChild);a.length;)n.appendChild(a.shift())}else n.innerHTML=e},getChildNodes:function(t){for(var e=t.children,n=[],r=0,o=e.length;r<o;r++)n.push(e[r]);return n},checkChanges:function(t,e,n){var r=e!=n[t];return n[t]=e,r}},n}()});function _interopDefault$1(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var Sortable$2=_interopDefault$1(Sortable),Clusterize=_interopDefault$1(clusterize);function $$1(t,e){return"string"==typeof t?(e||document).querySelector(t):t||null}function isObject(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}$$1.each=function(t,e){return"string"==typeof t?Array.from((e||document).querySelectorAll(t)):t||null},$$1.create=function(t,e){var n=document.createElement(t),r=function(t){var r=e[t];if("inside"===t)$$1(r).appendChild(n);else if("around"===t){var o=$$1(r);o.parentNode.insertBefore(n,o),n.appendChild(o)}else"styles"===t?"object"==typeof r&&Object.keys(r).map(function(t){n.style[t]=r[t]}):t in n?n[t]=r:n.setAttribute(t,r)};for(var o in e)r(o);return n},$$1.on=function(t,e,n,r){r?$$1.delegate(t,e,n,r):(r=n,$$1.bind(t,e,r))},$$1.off=function(t,e,n){t.removeEventListener(e,n)},$$1.bind=function(t,e,n){e.split(/\s+/).forEach(function(e){t.addEventListener(e,n)})},$$1.delegate=function(t,e,n,r){t.addEventListener(e,function(t){var e=t.target.closest(n);e&&(t.delegatedTarget=e,r.call(this,t,e))})},$$1.unbind=function(t,e){if(t){var n=function(n){var r=e[n];n.split(/\s+/).forEach(function(e){t.removeEventListener(e,r)})};for(var r in e)n(r)}},$$1.fire=function(t,e,n){var r=document.createEvent("HTMLEvents");for(var o in r.initEvent(e,!0,!0),n)r[o]=n[o];return t.dispatchEvent(r)},$$1.data=function(t,e){if(!e)return t.dataset;for(var n in e)t.dataset[n]=e[n]},$$1.style=function(t,e){if("string"==typeof e)return $$1.getStyle(t,e);Array.isArray(t)||(t=[t]),t.map(function(t){for(var n in e)t.style[n]=e[n]})},$$1.removeStyle=function(t,e){Array.isArray(t)||(t=[t]),Array.isArray(e)||(e=[e]),t.map(function(t){for(var n=0,r=e;n<r.length;n+=1){var o=r[n];t.style[o]=""}})},$$1.getStyle=function(t,e){var n=getComputedStyle(t)[e];return["width","height"].includes(e)&&(n=parseFloat(n)),n},$$1.closest=function(t,e){return e?e.matches(t)?e:$$1.closest(t,e.parentNode):null},$$1.inViewport=function(t,e){var n=t.getBoundingClientRect(),r=n.top,o=n.left,a=n.bottom,i=n.right,s=e.getBoundingClientRect(),l=s.top,c=s.left,d=s.bottom,p=s.right;return r>=l&&o>=c&&a<=d&&i<=p},$$1.scrollTop=function(t,e){requestAnimationFrame(function(){t.scrollTop=e})},$$1.scrollbarWidth=function(){var t=document.createElement("div");$$1.style(t,{width:"100px",height:"100px",overflow:"scroll",position:"absolute",top:"-9999px"}),document.body.appendChild(t);var e=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),e};var isObject_1=isObject,commonjsGlobal$1="undefined"!=typeof window?window:void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:{},freeGlobal="object"==typeof commonjsGlobal$1&&commonjsGlobal$1&&commonjsGlobal$1.Object===Object&&commonjsGlobal$1,_freeGlobal=freeGlobal,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=_freeGlobal||freeSelf||Function("return this")(),_root=root,now=function(){return _root.Date.now()},now_1=now,Symbol=_root.Symbol,_Symbol=Symbol,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,nativeObjectToString=objectProto.toString,symToStringTag=_Symbol?_Symbol.toStringTag:void 0;function getRawTag(t){var e=hasOwnProperty.call(t,symToStringTag),n=t[symToStringTag];try{t[symToStringTag]=void 0;var r=!0}catch(t){}var o=nativeObjectToString.call(t);return r&&(e?t[symToStringTag]=n:delete t[symToStringTag]),o}var _getRawTag=getRawTag,objectProto$1=Object.prototype,nativeObjectToString$1=objectProto$1.toString;function objectToString(t){return nativeObjectToString$1.call(t)}var _objectToString=objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag$1=_Symbol?_Symbol.toStringTag:void 0;function baseGetTag(t){return null==t?void 0===t?undefinedTag:nullTag:symToStringTag$1&&symToStringTag$1 in Object(t)?_getRawTag(t):_objectToString(t)}var _baseGetTag=baseGetTag;function isObjectLike(t){return null!=t&&"object"==typeof t}var isObjectLike_1=isObjectLike,symbolTag="[object Symbol]";function isSymbol(t){return"symbol"==typeof t||isObjectLike_1(t)&&_baseGetTag(t)==symbolTag}var isSymbol_1=isSymbol,NAN=NaN,reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function toNumber(t){if("number"==typeof t)return t;if(isSymbol_1(t))return NAN;if(isObject_1(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=isObject_1(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(reTrim,"");var n=reIsBinary.test(t);return n||reIsOctal.test(t)?freeParseInt(t.slice(2),n?2:8):reIsBadHex.test(t)?NAN:+t}var toNumber_1=toNumber,FUNC_ERROR_TEXT="Expected a function",nativeMax=Math.max,nativeMin=Math.min;function debounce(t,e,n){var r,o,a,i,s,l,c=0,d=!1,p=!1,u=!0;if("function"!=typeof t)throw new TypeError(FUNC_ERROR_TEXT);function h(e){var n=r,a=o;return r=o=void 0,c=e,i=t.apply(a,n)}function f(t){var n=t-l;return void 0===l||n>=e||n<0||p&&t-c>=a}function _(){var t=now_1();if(f(t))return g(t);s=setTimeout(_,function(t){var n=e-(t-l);return p?nativeMin(n,a-(t-c)):n}(t))}function g(t){return s=void 0,u&&r?h(t):(r=o=void 0,i)}function m(){var t=now_1(),n=f(t);if(r=arguments,o=this,l=t,n){if(void 0===s)return function(t){return c=t,s=setTimeout(_,e),d?h(t):i}(l);if(p)return s=setTimeout(_,e),h(l)}return void 0===s&&(s=setTimeout(_,e)),i}return e=toNumber_1(e)||0,isObject_1(n)&&(d=!!n.leading,a=(p="maxWait"in n)?nativeMax(toNumber_1(n.maxWait)||0,e):a,u="trailing"in n?!!n.trailing:u),m.cancel=function(){void 0!==s&&clearTimeout(s),c=0,r=l=o=s=void 0},m.flush=function(){return void 0===s?i:g(now_1())},m}var debounce_1=debounce,FUNC_ERROR_TEXT$1="Expected a function";function throttle(t,e,n){var r=!0,o=!0;if("function"!=typeof t)throw new TypeError(FUNC_ERROR_TEXT$1);return isObject_1(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),debounce_1(t,e,{leading:r,maxWait:e,trailing:o})}var throttle_1=throttle;function camelCaseToDash(t){return t.replace(/([A-Z])/g,function(t){return"-"+t[0].toLowerCase()})}function makeDataAttributeString(t){return Object.keys(t).map(function(e){var n=camelCaseToDash(e),r=t[e];return void 0===r?"":"data-"+n+'="'+r+'" '}).join("").trim()}function copyTextToClipboard(t){var e=document.createElement("textarea");e.style.position="fixed",e.style.top=0,e.style.left=0,e.style.width="2em",e.style.height="2em",e.style.padding=0,e.style.border="none",e.style.outline="none",e.style.boxShadow="none",e.style.background="transparent",e.value=t,document.body.appendChild(e),e.select();try{document.execCommand("copy")}catch(t){console.log("Oops, unable to copy")}document.body.removeChild(e)}function isNumeric(t){return!isNaN(t)}var throttle$1=throttle_1,debounce$2=debounce_1;function nextTick(t,e){return void 0===e&&(e=null),function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];return new Promise(function(r){var o=function(){var o=t.apply(e,n);r(o)};window.setImmediate?setImmediate(o):window.requestAnimationFrame?requestAnimationFrame(o):setTimeout(o)})}}function linkProperties(t,e,n){var r=n.reduce(function(t,n){return t[n]={get:function(){return e[n]}},t},{});Object.defineProperties(t,r)}function isSet(t){return void 0!==t||null!==t}function notSet(t){return!isSet(t)}function isNumber(t){return!isNaN(t)}function ensureArray(t){return Array.isArray(t)?t:[t]}var DataManager=function(t){this.options=t,this.sortRows=nextTick(this.sortRows,this),this.switchColumn=nextTick(this.switchColumn,this),this.removeColumn=nextTick(this.removeColumn,this),this.filterRows=nextTick(this.filterRows,this)},prototypeAccessors={currentSort:{configurable:!0}};DataManager.prototype.init=function(t,e){t||(t=this.options.data),e&&(this.options.columns=e),this.data=t,this.rowCount=0,this.columns=[],this.rows=[],this.prepareColumns(),this.prepareRows(),this.prepareTreeRows(),this.prepareRowView(),this.prepareNumericColumns()},prototypeAccessors.currentSort.get=function(){return this.columns.find(function(t){return"none"!==t.sortOrder})||{colIndex:-1,sortOrder:"none"}},DataManager.prototype.prepareColumns=function(){this.columns=[],this.validateColumns(),this.prepareDefaultColumns(),this.prepareHeader()},DataManager.prototype.prepareDefaultColumns=function(){if(this.options.checkboxColumn&&!this.hasColumnById("_checkbox")){var t={id:"_checkbox",content:this.getCheckboxHTML(),editable:!1,resizable:!1,sortable:!1,focusable:!1,dropdown:!1,width:32};this.columns.push(t)}if(this.options.serialNoColumn&&!this.hasColumnById("_rowIndex")){this.columns.push({id:"_rowIndex",content:"",align:"center",editable:!1,resizable:!1,focusable:!1,dropdown:!1})}},DataManager.prototype.prepareHeader=function(){var t=this,e=this.columns.concat(this.options.columns),n={isHeader:1,editable:!0,sortable:!0,resizable:!0,focusable:!0,dropdown:!0,width:null,format:function(t){return null==t?"":t+""}};this.columns=e.map(function(e,n){return t.prepareCell(e,n)}).map(function(t){return Object.assign({},n,t)}).map(function(t){return t.content=t.content||t.name||"",t.id=t.id||t.content,t})},DataManager.prototype.prepareCell=function(t,e){var n={content:"",align:"left",sortOrder:"none",colIndex:e,column:this.columns[e]};return null!==t&&"object"==typeof t?Object.assign(n,t):n.content=t,n},DataManager.prototype.prepareNumericColumns=function(){var t=this.getRow(0);t&&(this.columns=this.columns.map(function(e,n){var r=t[n].content;return!e.align&&r&&isNumeric(r)&&(e.align="right"),e}))},DataManager.prototype.prepareRows=function(){var t=this;this.validateData(this.data),this.rows=this.data.map(function(e,n){var r=t._getNextRowCount(),o=[],a={rowIndex:r};if(Array.isArray(e))for(t.options.checkboxColumn&&o.push(t.getCheckboxHTML()),t.options.serialNoColumn&&o.push(r+1+""),o=o.concat(e);o.length<t.columns.length;)o.push("");else{for(var i=0,s=t.columns;i<s.length;i+=1){var l=s[i];"_checkbox"===l.id?o.push(t.getCheckboxHTML()):"_rowIndex"===l.id?o.push(r+1+""):o.push(e[l.id])}a.indent=e.indent||0}return t.prepareRow(o,a)})},DataManager.prototype.prepareTreeRows=function(){var t=this;this.rows.forEach(function(e,n){if(isNumber(e.meta.indent)){var r=t.getRow(n+1);e.meta.isLeaf=!r||notSet(r.meta.indent)||r.meta.indent<=e.meta.indent}})},DataManager.prototype.prepareRowView=function(){this.rowViewOrder=this.rows.map(function(t){return t.meta.rowIndex})},DataManager.prototype.prepareRow=function(t,e){var n=this,r={rowIndex:e.rowIndex,indent:e.indent};return(t=t.map(function(t,e){return n.prepareCell(t,e)}).map(function(t){return Object.assign({},r,t)})).meta=e,t},DataManager.prototype.validateColumns=function(){var t=this.options.columns;if(!Array.isArray(t))throw new DataError("`columns` must be an array");t.forEach(function(t,e){if("string"!=typeof t&&"object"!=typeof t)throw new DataError('column "'+e+'" must be a string or an object')})},DataManager.prototype.validateData=function(t){if(Array.isArray(t)&&(0===t.length||Array.isArray(t[0])||"object"==typeof t[0]))return!0;throw new DataError("`data` must be an array of arrays or objects")},DataManager.prototype.appendRows=function(t){var e;this.validateData(t),(e=this.rows).push.apply(e,this.prepareRows(t))},DataManager.prototype.sortRows=function(t,e){void 0===e&&(e="none"),t=+t,this.getColumns().map(function(n){n.colIndex===t?n.sortOrder=e:n.sortOrder="none"}),this._sortRows(t,e)},DataManager.prototype._sortRows=function(t,e){var n=this;if(this.currentSort.colIndex===t&&("asc"===this.currentSort.sortOrder&&"desc"===e||"desc"===this.currentSort.sortOrder&&"asc"===e))return this.reverseArray(this.rowViewOrder),void(this.currentSort.sortOrder=e);if(this.rowViewOrder.sort(function(r,o){var a=r,i=o,s=n.getCell(t,r).content,l=n.getCell(t,o).content;if("none"===e)return a-i;if("asc"===e){if(s<l)return-1;if(s>l)return 1;if(s===l)return 0}else if("desc"===e){if(s<l)return 1;if(s>l)return-1;if(s===l)return 0}return 0}),this.hasColumnById("_rowIndex")){var r=this.getColumnIndexById("_rowIndex");this.rows.forEach(function(t,e){var o=n.rowViewOrder.indexOf(e);t[r].content=o+1+""})}},DataManager.prototype.reverseArray=function(t){var e=null,n=null;for(e=0,n=t.length-1;e<n;e+=1,n-=1){var r=t[e];t[e]=t[n],t[n]=r}},DataManager.prototype.switchColumn=function(t,e){var n=this.columns[t];this.columns[t]=this.columns[e],this.columns[e]=n,this.columns[t].colIndex=t,this.columns[e].colIndex=e,this.rows.forEach(function(n){var r=Object.assign({},n[t],{colIndex:e}),o=Object.assign({},n[e],{colIndex:t});n[e]=r,n[t]=o})},DataManager.prototype.removeColumn=function(t){t=+t;this.columns=this.columns.filter(function(e){return e.colIndex!==t}).map(function(t,e){return Object.assign({},t,{colIndex:e})}),this.rows.forEach(function(e){e.splice(t,1),e.forEach(function(t,e){t.colIndex=e})})},DataManager.prototype.updateRow=function(t,e){if(t.length<this.columns.length){if(this.hasColumnById("_rowIndex"))t=[e+1+""].concat(t);if(this.hasColumnById("_checkbox")){t=['<input type="checkbox" />'].concat(t)}}var n=this.prepareRow(t,e),r=this.rows.findIndex(function(t){return t[0].rowIndex===e});return this.rows[r]=n,n},DataManager.prototype.updateCell=function(t,e,n){var r;for(var o in"object"==typeof t&&(t=(r=t).colIndex,e=r.rowIndex,n=r),r=this.getCell(t,e),n){var a=n[o];void 0!==a&&(r[o]=a)}return r},DataManager.prototype.updateColumn=function(t,e){var n=this.getColumn(t);for(var r in e){var o=e[r];void 0!==o&&(n[r]=o)}return n},DataManager.prototype.filterRows=function(t,e){var n=[],r=[];return this.rows.map(function(t){return t[e]}).forEach(function(e){var o=String(e.content||"").toLowerCase(),a=(t||"").toLowerCase();!a||o.includes(a)?r.push(e.rowIndex):n.push(e.rowIndex)}),this._filteredRows=r,{rowsToHide:n,rowsToShow:r}},DataManager.prototype.getFilteredRowIndices=function(){return this._filteredRows||this.rows.map(function(t){return t.meta.rowIndex})},DataManager.prototype.getRowCount=function(){return this.rowCount},DataManager.prototype._getNextRowCount=function(){var t=this.rowCount;return this.rowCount++,t},DataManager.prototype.getRows=function(t,e){return this.rows.slice(t,e)},DataManager.prototype.getRowsForView=function(t,e){var n=this;return this.rowViewOrder.map(function(t){return n.rows[t]}).slice(t,e)},DataManager.prototype.getColumns=function(t){var e=this.columns;return t&&(e=e.slice(this.getStandardColumnCount())),e},DataManager.prototype.getStandardColumnCount=function(){return this.options.checkboxColumn&&this.options.serialNoColumn?2:this.options.checkboxColumn||this.options.serialNoColumn?1:0},DataManager.prototype.getColumnCount=function(t){var e=this.columns.length;return t&&(e-=this.getStandardColumnCount()),e},DataManager.prototype.getColumn=function(t){return(t=+t)<0&&(t=this.columns.length+t),this.columns.find(function(e){return e.colIndex===t})},DataManager.prototype.getColumnById=function(t){return this.columns.find(function(e){return e.id===t})},DataManager.prototype.getRow=function(t){return t=+t,this.rows[t]},DataManager.prototype.getCell=function(t,e){return e=+e,t=+t,this.getRow(e)[t]},DataManager.prototype.getChildren=function(t){t=+t;for(var e=this.getRow(t).meta.indent,n=[],r=t+1;r<this.rowCount;r++){var o=this.getRow(r);if(!isNaN(o.meta.indent)&&(o.meta.indent>e&&n.push(r),o.meta.indent===e))break}return n},DataManager.prototype.getImmediateChildren=function(t){t=+t;for(var e=this.getRow(t).meta.indent,n=[],r=e+1,o=t+1;o<this.rowCount;o++){var a=this.getRow(o);if(!(isNaN(a.meta.indent)||a.meta.indent>r)&&(a.meta.indent===r&&n.push(o),a.meta.indent===e))break}return n},DataManager.prototype.get=function(){return{columns:this.columns,rows:this.rows}},DataManager.prototype.getData=function(t){return this.data[t]},DataManager.prototype.hasColumn=function(t){return Boolean(this.columns.find(function(e){return e.content===t}))},DataManager.prototype.hasColumnById=function(t){return Boolean(this.columns.find(function(e){return e.id===t}))},DataManager.prototype.getColumnIndex=function(t){return this.columns.findIndex(function(e){return e.content===t})},DataManager.prototype.getColumnIndexById=function(t){return this.columns.findIndex(function(e){return e.id===t})},DataManager.prototype.getCheckboxHTML=function(){return'<input type="checkbox" />'},Object.defineProperties(DataManager.prototype,prototypeAccessors);var DataError=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(TypeError),ColumnManager=function(t){this.instance=t,linkProperties(this,this.instance,["options","fireEvent","header","datamanager","style","wrapper","rowmanager","bodyScrollable"]),this.bindEvents(),getDropdownHTML=getDropdownHTML.bind(this,this.options.dropdownButton)};ColumnManager.prototype.renderHeader=function(){this.header.innerHTML="<thead></thead>",this.refreshHeader()},ColumnManager.prototype.refreshHeader=function(){var t=this,e=this.datamanager.getColumns(),n=$$1.each(".data-table-cell[data-is-header]",this.header);!$$1(".data-table-cell",this.header)||e.length<n.length?($$1("thead",this.header).innerHTML=this.getHeaderHTML(e),this.$filterRow=$$1(".data-table-row[data-is-filter]",this.header),this.$filterRow&&$$1.style(this.$filterRow,{display:"none"})):n.map(function(n,r){var o=e[r];$$1.data(n,{colIndex:o.colIndex});var a=$$1(".sort-indicator",n);a&&(a.innerHTML=t.options.sortIndicator[o.sortOrder])}),this.$columnMap=[]},ColumnManager.prototype.getHeaderHTML=function(t){var e=this.rowmanager.getRowHTML(t,{isHeader:1});return this.options.inlineFilters&&(e+=this.rowmanager.getRowHTML(t,{isFilter:1})),e},ColumnManager.prototype.bindEvents=function(){this.bindDropdown(),this.bindResizeColumn(),this.bindMoveColumn(),this.bindFilter()},ColumnManager.prototype.bindDropdown=function(){var t,e=this;$$1.on(this.header,"click",".data-table-dropdown-toggle",function(e,n){var o=$$1.closest(".data-table-dropdown",n);o.classList.contains("is-active")?r():(r(),o.classList.add("is-active"),t=o)}),$$1.on(document.body,"click",function(t){t.target.matches(".data-table-dropdown-toggle")||r()});var n=this.options.headerDropdown;function r(e){t&&t.classList.remove("is-active"),t=null}$$1.on(this.header,"click",".data-table-dropdown-list > div",function(t,r){var o=$$1.closest(".data-table-cell",r),a=$$1.data(r).index,i=$$1.data(o).colIndex,s=n[a].action;s&&s.call(e.instance,e.getColumn(i))})},ColumnManager.prototype.bindResizeColumn=function(){var t,e,n,r=this,o=!1;$$1.on(this.header,"mousedown",".data-table-cell .column-resizer",function(a,i){document.body.classList.add("data-table-resize");var s=i.parentNode.parentNode;t=s;var l=$$1.data(t).colIndex,c=r.getColumn(l);c&&!1===c.resizable||(o=!0,e=$$1.style($$1(".content",t),"width"),n=a.pageX)}),$$1.on(document.body,"mouseup",function(e){if(document.body.classList.remove("data-table-resize"),t){o=!1;var n=$$1.data(t).colIndex;r.setColumnWidth(n),r.style.setBodyStyle(),t=null}}),$$1.on(document.body,"mousemove",function(a){if(o){var i=e+(a.pageX-n),s=$$1.data(t).colIndex;r.getColumnMinWidth(s)>i||(r.datamanager.updateColumn(s,{width:i}),r.setColumnHeaderWidth(s))}})},ColumnManager.prototype.bindMoveColumn=function(){var t=this,e=function(){if($$1(".data-table-cell",t.header)){var e=$$1(".data-table-row",t.header);t.sortable=Sortable$2.create(e,{onEnd:function(e){var n=e.oldIndex,r=e.newIndex,o=e.item;+$$1.data(o).colIndex!==r&&t.switchColumn(n,r)},preventOnFilter:!1,filter:".column-resizer, .data-table-dropdown",animation:150})}};$$1.on(document.body,"mousemove",e)},ColumnManager.prototype.bindSortColumn=function(){var t=this;$$1.on(this.header,"click",".data-table-cell .column-title",function(e,n){var r=n.closest(".data-table-cell"),o=$$1.data(r),a=o.colIndex,i=o.sortOrder;void 0===i&&(i="none");var s,l,c=t.getColumn(a);c&&!1===c.sortable||($$1(".sort-indicator",t.header).textContent="",$$1.each(".data-table-cell",t.header).map(function(t){$$1.data(t,{sortOrder:"none"})}),"none"===i?(s="asc",l="▲"):"asc"===i?(s="desc",l="▼"):"desc"===i&&(s="none",l=""),$$1.data(r,{sortOrder:s}),$$1(".sort-indicator",r).textContent=l,t.sortColumn(a,s))})},ColumnManager.prototype.sortColumn=function(t,e){var n=this;this.instance.freeze(),this.sortRows(t,e).then(function(){return n.refreshHeader(),n.rowmanager.refreshRows()}).then(function(){return n.instance.unfreeze()}).then(function(){n.fireEvent("onSortColumn",n.getColumn(t))})},ColumnManager.prototype.removeColumn=function(t){var e=this,n=this.getColumn(t);this.instance.freeze(),this.datamanager.removeColumn(t).then(function(){return e.refreshHeader(),e.rowmanager.refreshRows()}).then(function(){return e.instance.unfreeze()}).then(function(){e.fireEvent("onRemoveColumn",n)})},ColumnManager.prototype.switchColumn=function(t,e){var n=this;this.instance.freeze(),this.datamanager.switchColumn(t,e).then(function(){return n.refreshHeader(),n.rowmanager.refreshRows()}).then(function(){n.setColumnWidth(t),n.setColumnWidth(e),n.instance.unfreeze()}).then(function(){n.fireEvent("onSwitchColumn",n.getColumn(t),n.getColumn(e))})},ColumnManager.prototype.toggleFilter=function(t){var e;(e=void 0===t?!this.isFilterShown:t)?$$1.style(this.$filterRow,{display:""}):$$1.style(this.$filterRow,{display:"none"}),this.isFilterShown=e,this.style.setBodyStyle()},ColumnManager.prototype.focusFilter=function(t){this.isFilterShown&&$$1('[data-col-index="'+t+'"] .data-table-filter',this.$filterRow).focus()},ColumnManager.prototype.bindFilter=function(){var t=this;if(this.options.inlineFilters){$$1.on(this.header,"keydown",".data-table-filter",debounce$2(function(e){var n=$$1.closest(".data-table-cell",e.target),r=$$1.data(n).colIndex,o=e.target.value;t.datamanager.filterRows(o,r).then(function(e){var n=e.rowsToHide,r=e.rowsToShow;t.rowmanager.hideRows(n),t.rowmanager.showRows(r)})},300))}},ColumnManager.prototype.sortRows=function(t,e){return this.datamanager.sortRows(t,e)},ColumnManager.prototype.getColumn=function(t){return this.datamanager.getColumn(t)},ColumnManager.prototype.getColumns=function(){return this.datamanager.getColumns()},ColumnManager.prototype.setColumnWidth=function(t,e){t=+t,this._columnWidthMap=this._columnWidthMap||[];var n=e||this.getColumn(t).width,r=this._columnWidthMap[t],o='[data-col-index="'+t+'"] .content, [data-col-index="'+t+'"] .edit-cell',a={width:n+"px"};void 0!==(r=this.style.setStyle(o,a,r))&&(this._columnWidthMap[t]=r)},ColumnManager.prototype.setColumnHeaderWidth=function(t){t=+t,this.$columnMap=this.$columnMap||[];var e='.data-table-header [data-col-index="'+t+'"] .content',n=this.getColumn(t).width,r=this.$columnMap[t];r||(r=this.header.querySelector(e),this.$columnMap[t]=r),r.style.width=n+"px"},ColumnManager.prototype.getColumnMinWidth=function(t){return t=+t,this.getColumn(t).minWidth||24},ColumnManager.prototype.getFirstColumnIndex=function(){return this.datamanager.getColumnIndexById("_rowIndex")+1},ColumnManager.prototype.getHeaderCell$=function(t){return $$1('.data-table-cell[data-col-index="'+t+'"]',this.header)},ColumnManager.prototype.getLastColumnIndex=function(){return this.datamanager.getColumnCount()-1},ColumnManager.prototype.getSerialColumnIndex=function(){return this.datamanager.getColumns().findIndex(function(t){return t.content.includes("Sr. No")})};var getDropdownHTML=function(t){return void 0===t&&(t="v"),'<div class="data-table-dropdown-toggle">'+t+'</div>\n    <div class="data-table-dropdown-list">\n      '+this.options.headerDropdown.map(function(t,e){return'<div data-index="'+e+'">'+t.label+"</div>"}).join("")+"\n    </div>\n  "},CellManager=function(t){this.instance=t,linkProperties(this,this.instance,["wrapper","options","style","bodyScrollable","columnmanager","rowmanager","datamanager","keyboard"]),this.bindEvents()};CellManager.prototype.bindEvents=function(){this.bindFocusCell(),this.bindEditCell(),this.bindKeyboardSelection(),this.bindCopyCellContents(),this.bindMouseEvents(),this.bindTreeEvents()},CellManager.prototype.bindFocusCell=function(){this.bindKeyboardNav()},CellManager.prototype.bindEditCell=function(){var t=this;this.$editingCell=null,$$1.on(this.bodyScrollable,"dblclick",".data-table-cell",function(e,n){t.activateEditing(n)}),this.keyboard.on("enter",function(e){t.$focusedCell&&!t.$editingCell?t.activateEditing(t.$focusedCell):t.$editingCell&&(t.submitEditing(),t.deactivateEditing())})},CellManager.prototype.bindKeyboardNav=function(){var t=this;["left","right","up","down","tab","shift+tab"].map(function(e){return t.keyboard.on(e,function(){return function(e){if(!t.$focusedCell||t.$editingCell)return!1;var n=t.$focusedCell;return"left"===e||"shift+tab"===e?n=t.getLeftCell$(n):"right"===e||"tab"===e?n=t.getRightCell$(n):"up"===e?n=t.getAboveCell$(n):"down"===e&&(n=t.getBelowCell$(n)),t.focusCell(n),!0}(e)})}),["left","right","up","down"].map(function(e){return t.keyboard.on("ctrl+"+e,function(){return function(e){if(!t.$focusedCell||t.$editingCell)return!1;var n=t.$focusedCell,r=$$1.data(n),o=r.rowIndex,a=r.colIndex;return"left"===e?n=t.getLeftMostCell$(o):"right"===e?n=t.getRightMostCell$(o):"up"===e?n=t.getTopMostCell$(a):"down"===e&&(n=t.getBottomMostCell$(a)),t.focusCell(n),!0}(e)})}),this.keyboard.on("esc",function(){t.deactivateEditing()}),this.options.inlineFilters&&this.keyboard.on("ctrl+f",function(e){var n=$$1.closest(".data-table-cell",e.target),r=$$1.data(n).colIndex;return t.activateFilter(r),!0})},CellManager.prototype.bindKeyboardSelection=function(){var t=this;["left","right","up","down"].map(function(e){return t.keyboard.on("shift+"+e,function(){return t.selectArea(function(e){var n=t.getSelectionCursor();return"left"===e?n=t.getLeftCell$(n):"right"===e?n=t.getRightCell$(n):"up"===e?n=t.getAboveCell$(n):"down"===e&&(n=t.getBelowCell$(n)),n}(e))})})},CellManager.prototype.bindCopyCellContents=function(){var t=this;this.keyboard.on("ctrl+c",function(){t.copyCellContents(t.$focusedCell,t.$selectionCursor)})},CellManager.prototype.bindMouseEvents=function(){var t=this,e=null;$$1.on(this.bodyScrollable,"mousedown",".data-table-cell",function(n){e=!0,t.focusCell($$1(n.delegatedTarget))}),$$1.on(this.bodyScrollable,"mouseup",function(){e=!1});$$1.on(this.bodyScrollable,"mousemove",".data-table-cell",throttle$1(function(n){e&&t.selectArea($$1(n.delegatedTarget))},50))},CellManager.prototype.bindTreeEvents=function(){var t=this;$$1.on(this.bodyScrollable,"click",".toggle",function(e,n){var r=$$1.closest(".data-table-cell",n),o=$$1.data(r).rowIndex;r.classList.contains("tree-close")?t.rowmanager.openSingleNode(o):t.rowmanager.closeSingleNode(o)})},CellManager.prototype.focusCell=function(t,e){void 0===e&&(e={});var n=e.skipClearSelection;if(void 0===n&&(n=0),t&&t!==this.$editingCell){var r=$$1.data(t),o=r.colIndex;if(!r.isHeader)!1!==this.columnmanager.getColumn(o).focusable&&(this.scrollToCell(t),this.deactivateEditing(),n||this.clearSelection(),this.$focusedCell&&this.$focusedCell.classList.remove("selected"),this.$focusedCell=t,t.classList.add("selected"),t.focus(),this.highlightRowColumnHeader(t))}},CellManager.prototype.highlightRowColumnHeader=function(t){var e=$$1.data(t),n='.data-table-header .data-table-cell[data-col-index="'+e.colIndex+'"]',r='.data-table-cell[data-row-index="'+e.rowIndex+'"][data-col-index="'+this.datamanager.getColumnIndexById("_rowIndex")+'"]';this.lastHeaders&&$$1.removeStyle(this.lastHeaders,"backgroundColor");var o=$$1(n,this.wrapper),a=$$1(r,this.wrapper);$$1.style([o,a],{backgroundColor:"#f5f7fa"}),this.lastHeaders=[o,a]},CellManager.prototype.selectAreaOnClusterChanged=function(){if(this.$focusedCell&&this.$selectionCursor){var t=$$1.data(this.$selectionCursor),e=t.colIndex,n=t.rowIndex,r=this.getCell$(e,n);if(r&&r!==this.$selectionCursor){var o=$$1.data(this.$focusedCell);this.$focusedCell=this.getCell$(o.colIndex,o.rowIndex),this.selectArea(r)}}},CellManager.prototype.focusCellOnClusterChanged=function(){if(this.$focusedCell){var t=$$1.data(this.$focusedCell),e=t.colIndex,n=t.rowIndex,r=this.getCell$(e,n);r&&this.focusCell(r,{skipClearSelection:1})}},CellManager.prototype.selectArea=function(t){this.$focusedCell&&this._selectArea(this.$focusedCell,t)&&(this.$selectionCursor=t)},CellManager.prototype._selectArea=function(t,e){var n=this;if(t===e)return!1;var r=this.getCellsInRange(t,e);return!!r&&(this.clearSelection(),r.map(function(t){var e;return(e=n).getCell$.apply(e,t)}).map(function(t){return t.classList.add("highlight")}),!0)},CellManager.prototype.getCellsInRange=function(t,e){var n,r,o,a,i,s,l;if("number"==typeof t)a=(n=arguments)[0],i=n[1],s=n[2],l=n[3];else if("object"==typeof t){if(!t||!e)return!1;var c=$$1.data(t),d=$$1.data(e);a=c.colIndex,i=c.rowIndex,s=d.colIndex,l=d.rowIndex}if(i>l&&(i=(r=[l,i])[0],l=r[1]),a>s&&(a=(o=[s,a])[0],s=o[1]),this.isStandardCell(a)||this.isStandardCell(s))return!1;for(var p=[],u=a,h=i,f=[];h<=l;)f.push(h),h++;return f.map(function(t){for(;u<=s;)p.push([u,t]),u++;u=a}),p},CellManager.prototype.clearSelection=function(){$$1.each(".data-table-cell.highlight",this.bodyScrollable).map(function(t){return t.classList.remove("highlight")}),this.$selectionCursor=null},CellManager.prototype.getSelectionCursor=function(){return this.$selectionCursor||this.$focusedCell},CellManager.prototype.activateEditing=function(t){this.focusCell(t);var e=$$1.data(t),n=e.rowIndex,r=e.colIndex,o=this.columnmanager.getColumn(r);if(!o||!1!==o.editable&&!1!==o.focusable){var a=this.getCell(r,n);if(!a||!1!==a.editable){if(this.$editingCell){var i=$$1.data(this.$editingCell),s=i._rowIndex,l=i._colIndex;if(n===s&&r===l)return}this.$editingCell=t,t.classList.add("editing");var c=$$1(".edit-cell",t);c.innerHTML="";var d=this.getEditor(r,n,a.content,c);d&&(this.currentCellEditor=d,d.initValue(a.content,n,o))}}},CellManager.prototype.deactivateEditing=function(){this.$focusedCell&&this.$focusedCell.focus(),this.$editingCell&&(this.$editingCell.classList.remove("editing"),this.$editingCell=null)},CellManager.prototype.getEditor=function(t,e,n,r){var o=this.datamanager.getColumn(t),a=this.datamanager.getRow(e),i=this.datamanager.getData(e),s=this.options.getEditor?this.options.getEditor(t,e,n,r,o,a,i):this.getDefaultEditor(r);return!1!==s&&(void 0===s&&(s=this.getDefaultEditor(r)),s)},CellManager.prototype.getDefaultEditor=function(t){var e=$$1.create("input",{class:"input-style",type:"text",inside:t});return{initValue:function(t){e.focus(),e.value=t},getValue:function(){return e.value},setValue:function(t){e.value=t}}},CellManager.prototype.submitEditing=function(){var t=this;if(this.$editingCell){var e=this.$editingCell,n=$$1.data(e),r=n.rowIndex,o=n.colIndex,a=this.datamanager.getColumn(o);if(e){var i=this.currentCellEditor;if(i){var s=i.getValue(),l=i.setValue(s,r,a),c=this.getCell(o,r).content;this.updateCell(o,r,s),e.focus(),l&&l.then&&l.catch(function(e){console.log(e),t.updateCell(o,r,c)})}}this.currentCellEditor=null}},CellManager.prototype.copyCellContents=function(t,e){var n=this;if(e||!t){var r=this.getCellsInRange(t,e);if(r)copyTextToClipboard(r.map(function(t){var e;return(e=n).getCell.apply(e,t)}).reduce(function(t,e){var n=e.rowIndex;return t[n]=t[n]||[],t[n].push(e.content),t},[]).map(function(t){return t.join("\t")}).join("\n"))}else{var o=$$1.data(t),a=o.colIndex,i=o.rowIndex;copyTextToClipboard(this.getCell(a,i).content)}},CellManager.prototype.activateFilter=function(t){this.columnmanager.toggleFilter(),this.columnmanager.focusFilter(t),this.columnmanager.isFilterShown||this.$focusedCell.focus()},CellManager.prototype.updateCell=function(t,e,n){var r=this.datamanager.updateCell(t,e,{content:n});this.refreshCell(r)},CellManager.prototype.refreshCell=function(t){$$1(this.selector(t.colIndex,t.rowIndex),this.bodyScrollable).innerHTML=this.getCellContent(t)},CellManager.prototype.toggleTreeButton=function(t,e){var n=this.columnmanager.getFirstColumnIndex(),r=this.getCell$(n,t);r&&r.classList[e?"remove":"add"]("tree-close")},CellManager.prototype.isStandardCell=function(t){return t<this.columnmanager.getFirstColumnIndex()},CellManager.prototype.getCell$=function(t,e){return $$1(this.selector(t,e),this.bodyScrollable)},CellManager.prototype.getAboveCell$=function(t){for(var e=$$1.data(t).colIndex,n=t.parentElement.previousElementSibling;n&&n.classList.contains("hide");)n=n.previousElementSibling;return n?$$1('[data-col-index="'+e+'"]',n):t},CellManager.prototype.getBelowCell$=function(t){for(var e=$$1.data(t).colIndex,n=t.parentElement.nextElementSibling;n&&n.classList.contains("hide");)n=n.nextElementSibling;return n?$$1('[data-col-index="'+e+'"]',n):t},CellManager.prototype.getLeftCell$=function(t){return t.previousElementSibling},CellManager.prototype.getRightCell$=function(t){return t.nextElementSibling},CellManager.prototype.getLeftMostCell$=function(t){return this.getCell$(this.columnmanager.getFirstColumnIndex(),t)},CellManager.prototype.getRightMostCell$=function(t){return this.getCell$(this.columnmanager.getLastColumnIndex(),t)},CellManager.prototype.getTopMostCell$=function(t){return this.getCell$(t,this.rowmanager.getFirstRowIndex())},CellManager.prototype.getBottomMostCell$=function(t){return this.getCell$(t,this.rowmanager.getLastRowIndex())},CellManager.prototype.getCell=function(t,e){return this.instance.datamanager.getCell(t,e)},CellManager.prototype.getCellAttr=function(t){return this.instance.getCellAttr(t)},CellManager.prototype.getRowHeight=function(){return $$1.style($$1(".data-table-row",this.bodyScrollable),"height")},CellManager.prototype.scrollToCell=function(t){if($$1.inViewport(t,this.bodyScrollable))return!1;var e=$$1.data(t).rowIndex;return this.rowmanager.scrollToRow(e),!1},CellManager.prototype.getRowCountPerPage=function(){return Math.ceil(this.instance.getViewportHeight()/this.getRowHeight())},CellManager.prototype.getCellHTML=function(t){return'\n            <td class="data-table-cell noselect" '+makeDataAttributeString({rowIndex:t.rowIndex,colIndex:t.colIndex,isHeader:t.isHeader,isFilter:t.isFilter})+' tabindex="0">\n                '+this.getCellContent(t)+"\n            </td>\n        "},CellManager.prototype.getCellContent=function(t){var e,n=t.isHeader,r=t.isFilter,o=!n&&!1!==t.editable?this.getEditCellHTML():"",a=n&&!1!==t.sortable?'<span class="sort-indicator"></span>':"",i=n&&!1!==t.resizable?'<span class="column-resizer"></span>':"",s=n&&!1!==t.dropdown?'<div class="data-table-dropdown">'+getDropdownHTML()+"</div>":"",l=t.format||t.column&&t.column.format||null;if(n||r||!l)e=t.content;else{var c=this.datamanager.getRow(t.rowIndex),d=this.datamanager.getData(t.rowIndex);e=l(t.content,c,t.column,d)}if(this.options.treeView&&!n&&!r&&void 0!==t.indent){var p=this.datamanager.getRow(t.rowIndex+1),u=p&&p.meta.indent>t.indent;if(this.datamanager.getColumnIndexById("_rowIndex")+1===t.colIndex){var h=1.5*((t.indent||0)+1);e='<span class="tree-node" style="padding-left: '+h+'rem">\n                    '+(u?'<span class="toggle" style="left: '+(h-1.5)+'rem"></span>':"")+e+"</span>"}}return'\n            <div class="content ellipsis">\n                '+e+"\n                "+a+"\n                "+i+"\n                "+s+"\n            </div>\n            "+o+"\n        "},CellManager.prototype.getEditCellHTML=function(){return'\n      <div class="edit-cell"></div>\n    '},CellManager.prototype.selector=function(t,e){return'.data-table-cell[data-col-index="'+t+'"][data-row-index="'+e+'"]'};var RowManager=function(t){this.instance=t,linkProperties(this,this.instance,["options","fireEvent","wrapper","bodyScrollable","bodyRenderer"]),this.bindEvents(),this.refreshRows=nextTick(this.refreshRows,this)},prototypeAccessors$1={datamanager:{configurable:!0},cellmanager:{configurable:!0}};prototypeAccessors$1.datamanager.get=function(){return this.instance.datamanager},prototypeAccessors$1.cellmanager.get=function(){return this.instance.cellmanager},RowManager.prototype.bindEvents=function(){this.bindCheckbox()},RowManager.prototype.bindCheckbox=function(){var t=this;this.options.checkboxColumn&&(this.checkMap=[],$$1.on(this.wrapper,"click",'.data-table-cell[data-col-index="0"] [type="checkbox"]',function(e,n){var r=n.closest(".data-table-cell"),o=$$1.data(r),a=o.rowIndex,i=o.isHeader,s=n.checked;i?t.checkAll(s):t.checkRow(a,s)}))},RowManager.prototype.refreshRows=function(){this.instance.renderBody(),this.instance.setDimensions()},RowManager.prototype.refreshRow=function(t,e){var n=this;this.datamanager.updateRow(t,e).forEach(function(t){n.cellmanager.refreshCell(t)})},RowManager.prototype.getCheckedRows=function(){if(!this.checkMap)return[];var t=[];for(var e in this.checkMap){1===this.checkMap[e]&&t.push(e)}return t},RowManager.prototype.highlightCheckedRows=function(){var t=this;this.getCheckedRows().map(function(e){return t.checkRow(e,!0)})},RowManager.prototype.checkRow=function(t,e){var n=e?1:0;this.checkMap[t]=n,$$1.each(function(t){return'.data-table-cell[data-row-index="'+t+'"][data-col-index="0"] [type="checkbox"]'}(t),this.bodyScrollable).map(function(t){t.checked=e}),this.highlightRow(t,e),this.showCheckStatus(),this.fireEvent("onCheckRow",this.datamanager.getRow(t))},RowManager.prototype.checkAll=function(t){var e=t?1:0;this.checkMap=t?Array.from(Array(this.getTotalRows())).map(function(t){return e}):[],$$1.each('.data-table-cell[data-col-index="0"] [type="checkbox"]',this.bodyScrollable).map(function(e){e.checked=t}),this.highlightAll(t),this.showCheckStatus()},RowManager.prototype.showCheckStatus=function(){if(this.options.checkedRowStatus){var t=this.getCheckedRows().length;t>0?this.bodyRenderer.showToastMessage(t+" row"+(t>1?"s":"")+" selected"):this.bodyRenderer.clearToastMessage()}},RowManager.prototype.highlightRow=function(t,e){void 0===e&&(e=!0);var n=this.getRow$(t);n&&(e||!this.bodyScrollable.classList.contains("row-highlight-all")?(e&&n.classList.contains("row-unhighlight")&&n.classList.remove("row-unhighlight"),this._highlightedRows=this._highlightedRows||{},e?(n.classList.add("row-highlight"),this._highlightedRows[t]=n):(n.classList.remove("row-highlight"),delete this._highlightedRows[t])):n.classList.add("row-unhighlight"))},RowManager.prototype.highlightAll=function(t){if(void 0===t&&(t=!0),t)this.bodyScrollable.classList.add("row-highlight-all");else{for(var e in this.bodyScrollable.classList.remove("row-highlight-all"),this._highlightedRows){this._highlightedRows[e].classList.remove("row-highlight")}this._highlightedRows={}}},RowManager.prototype.hideRows=function(t){var e=this;(t=ensureArray(t)).map(function(t){e.getRow$(t).classList.add("hide")})},RowManager.prototype.showRows=function(t){var e=this;(t=ensureArray(t)).map(function(t){e.getRow$(t).classList.remove("hide")})},RowManager.prototype.openSingleNode=function(t){var e=this.datamanager.getImmediateChildren(t);this.showRows(e),this.cellmanager.toggleTreeButton(t,!0)},RowManager.prototype.closeSingleNode=function(t){var e=this;this.datamanager.getImmediateChildren(t).forEach(function(t){e.datamanager.getRow(t).meta.isLeaf?(e.hideRows(t),e.cellmanager.toggleTreeButton(t,!1)):(e.closeSingleNode(t),e.hideRows(t))}),this.cellmanager.toggleTreeButton(t,!1)},RowManager.prototype.getRow$=function(t){return $$1(this.selector(t),this.bodyScrollable)},RowManager.prototype.getTotalRows=function(){return this.datamanager.getRowCount()},RowManager.prototype.getFirstRowIndex=function(){return 0},RowManager.prototype.getLastRowIndex=function(){return this.datamanager.getRowCount()-1},RowManager.prototype.scrollToRow=function(t){t=+t,this._lastScrollTo=this._lastScrollTo||0;var e=this.getRow$(t);if(!$$1.inViewport(e,this.bodyScrollable)){var n=e.getBoundingClientRect().height,r=this.bodyScrollable.getBoundingClientRect(),o=r.top,a=r.bottom,i=Math.floor((a-o)/n),s=0;s=t>this._lastScrollTo?n*(t+1-i):n*(t+1-1),this._lastScrollTo=t,$$1.scrollTop(this.bodyScrollable,s)}},RowManager.prototype.getRowHTML=function(t,e){var n=this,r=makeDataAttributeString(e);return e.isFilter&&(t=t.map(function(t){return Object.assign({},t,{content:n.getFilterInput({colIndex:t.colIndex}),isFilter:1,isHeader:void 0,editable:!1})})),'\n            <tr class="data-table-row" '+r+">\n                "+t.map(function(t){return n.cellmanager.getCellHTML(t)}).join("")+"\n            </tr>\n        "},RowManager.prototype.getFilterInput=function(t){return'<input class="data-table-filter input-style" type="text" '+makeDataAttributeString(t)+" />"},RowManager.prototype.selector=function(t){return'.data-table-row[data-row-index="'+t+'"]'},Object.defineProperties(RowManager.prototype,prototypeAccessors$1);var BodyRenderer=function(t){this.instance=t,this.options=t.options,this.datamanager=t.datamanager,this.rowmanager=t.rowmanager,this.cellmanager=t.cellmanager,this.bodyScrollable=t.bodyScrollable,this.log=t.log,this.appendRemainingData=nextTick(this.appendRemainingData,this)};BodyRenderer.prototype.render=function(){this.options.clusterize?this.renderBodyWithClusterize():this.renderBodyHTML()},BodyRenderer.prototype.renderBodyHTML=function(){var t=this.datamanager.getRowsForView();this.bodyScrollable.innerHTML='\n            <table class="data-table-body">\n                '+this.getBodyHTML(t)+"\n            </table>\n        ",this.instance.setDimensions(),this.restoreState()},BodyRenderer.prototype.renderBodyWithClusterize=function(){var t=this,e=this.datamanager.getRowsForView(0,20),n=this.getDataForClusterize(e);0===n.length&&(n=['<tr class="no-data"><td>'+this.options.noDataMessage+"</td></tr>"]),this.clusterize?this.clusterize.update(n):(this.bodyScrollable.innerHTML='\n                <table class="data-table-body">\n                    '+this.getBodyHTML([])+"\n                </table>\n            ",this.clusterize=new Clusterize({rows:n,scrollElem:this.bodyScrollable,contentElem:$$1("tbody",this.bodyScrollable),callbacks:{clusterChanged:function(){t.restoreState()}},show_no_data_row:!1}),this.instance.setDimensions()),this.appendRemainingData()},BodyRenderer.prototype.restoreState=function(){this.rowmanager.highlightCheckedRows(),this.cellmanager.selectAreaOnClusterChanged(),this.cellmanager.focusCellOnClusterChanged()},BodyRenderer.prototype.appendRemainingData=function(){var t=this.datamanager.getRowsForView(20),e=this.getDataForClusterize(t);this.clusterize.append(e)},BodyRenderer.prototype.showToastMessage=function(t){this.instance.toastMessage.innerHTML="<span>"+t+"</span>"},BodyRenderer.prototype.clearToastMessage=function(){this.instance.toastMessage.innerHTML=""},BodyRenderer.prototype.getDataForClusterize=function(t){var e=this;return t.map(function(t){return e.rowmanager.getRowHTML(t,t.meta)})},BodyRenderer.prototype.getBodyHTML=function(t){var e=this;return"\n            <tbody>\n                "+t.map(function(t){return e.rowmanager.getRowHTML(t,t.meta)}).join("")+"\n            </tbody>\n        "};var Style=function(t){this.instance=t,linkProperties(this,this.instance,["options","datamanager","columnmanager","header","bodyScrollable","datatableWrapper","getColumn"]),this.scopeClass="datatable-instance-"+t.constructor.instances,t.datatableWrapper.classList.add(this.scopeClass);var e=document.createElement("style");t.wrapper.insertBefore(e,t.datatableWrapper),this.styleEl=e,this.bindResizeWindow()},prototypeAccessors$2={stylesheet:{configurable:!0}};prototypeAccessors$2.stylesheet.get=function(){return this.styleEl.sheet},Style.prototype.bindResizeWindow=function(){var t=this;"fluid"===this.options.layout&&$$1.on(window,"resize",throttle$1(function(){t.distributeRemainingWidth(),t.refreshColumnWidth(),t.compensateScrollbarWidth(),t.setBodyStyle()},300))},Style.prototype.destroy=function(){this.styleEl.remove()},Style.prototype.setStyle=function(t,e,n){var r=this;void 0===n&&(n=-1);var o=Object.keys(e).map(function(t){return t.includes("-")||(t=camelCaseToDash(t)),t+":"+e[t]+";"}).join(""),a=t.split(",").map(function(t){return"."+r.scopeClass+" "+t}).join(",")+" { "+o+" }";if(this.stylesheet){var i=this.stylesheet.cssRules.length;return-1!==n&&(this.stylesheet.deleteRule(n),i=n),this.stylesheet.insertRule(a,i),i}},Style.prototype.setDimensions=function(){this.setHeaderStyle(),this.setupMinWidth(),this.setupNaturalColumnWidth(),this.setupColumnWidth(),this.distributeRemainingWidth(),this.setColumnStyle(),this.compensateScrollbarWidth(),this.setDefaultCellHeight(),this.setBodyStyle()},Style.prototype.setHeaderStyle=function(){"fluid"===this.options.layout&&$$1.style(this.header,{width:0}),$$1.style(this.header,{margin:0});var t=this.datamanager.getColumns().filter(function(t){return!1===t.resizable}).map(function(t){return t.colIndex}).map(function(t){return'.data-table-header [data-col-index="'+t+'"]'}).join();this.setStyle(t,{cursor:"pointer"})},Style.prototype.setupMinWidth=function(){var t=this;$$1.each(".data-table-cell[data-is-header]",this.header).map(function(e){var n=$$1.style($$1(".content",e),"width"),r=$$1.data(e).colIndex,o=t.getColumn(r);o.minWidth||(o.minWidth=n)})},Style.prototype.setupNaturalColumnWidth=function(){var t=this;$$1(".data-table-row")&&$$1.each('.data-table-row[data-row-index="0"] .data-table-cell',this.bodyScrollable).map(function(e){var n=$$1.data(e).colIndex,r=t.datamanager.getColumn(n),o=$$1.style($$1(".content",e),"width");"_rowIndex"===r.id&&(o=t.getRowIndexColumnWidth(o),r.width=o),r.naturalWidth=o})},Style.prototype.setupColumnWidth=function(){if("ratio"===this.options.layout){var t=$$1.style(this.datatableWrapper,"width");if(this.options.serialNoColumn)t=t-this.datamanager.getColumnById("_rowIndex").width-1;if(this.options.checkboxColumn)t=t-this.datamanager.getColumnById("_checkbox").width-1;var e=t/this.datamanager.getColumns().map(function(t){return"_rowIndex"===t.id||"_checkbox"===t.id?0:(t.width||(t.width=1),t.ratioWidth=parseInt(t.width,10),t.ratioWidth)}).reduce(function(t,e){return t+e});this.datamanager.getColumns().map(function(t){"_rowIndex"!==t.id&&"_checkbox"!==t.id&&(t.width=Math.floor(e*t.ratioWidth)-1)})}else this.datamanager.getColumns().map(function(t){t.width||(t.width=t.naturalWidth),t.width<t.minWidth&&(t.width=t.minWidth)})},Style.prototype.compensateScrollbarWidth=function(){var t=$$1.scrollbarWidth(),e=this.datamanager.getColumn(-1),n=e.width-t;this.columnmanager.setColumnWidth(e.colIndex,n)},Style.prototype.distributeRemainingWidth=function(){var t=this;if("fluid"===this.options.layout){var e=$$1.style(this.instance.datatableWrapper,"width"),n=$$1.style(this.header,"width"),r=this.datamanager.getColumns().filter(function(t){return t.resizable}),o=(e-n)/r.length;r.map(function(e){var n=$$1.style(t.getColumnHeaderElement(e.colIndex),"width"),r=Math.floor(n+o)-2;t.datamanager.updateColumn(e.colIndex,{width:r})})}},Style.prototype.setDefaultCellHeight=function(){if(!this.__cellHeightSet){var t=$$1(".data-table-cell",this.instance.bodyScrollable);if(t){var e=this.options.cellHeight||$$1.style(t,"height");e&&(this.setCellHeight(e),this.__cellHeightSet=!0)}}},Style.prototype.setCellHeight=function(t){this.setStyle(".data-table-cell .content",{height:t+"px"}),this.setStyle(".data-table-cell .edit-cell",{height:t+"px"})},Style.prototype.setColumnStyle=function(){var t=this;this.datamanager.getColumns().map(function(e){["left","center","right"].includes(e.align)&&t.setStyle('[data-col-index="'+e.colIndex+'"]',{"text-align":e.align}),t.columnmanager.setColumnHeaderWidth(e.colIndex),t.columnmanager.setColumnWidth(e.colIndex)}),this.setBodyStyle()},Style.prototype.refreshColumnWidth=function(){var t=this;this.datamanager.getColumns().map(function(e){t.columnmanager.setColumnHeaderWidth(e.colIndex),t.columnmanager.setColumnWidth(e.colIndex)})},Style.prototype.setBodyStyle=function(){var t=$$1.style(this.header,"width");$$1.style(this.bodyScrollable,{width:t+"px"}),$$1.style(this.bodyScrollable,{marginTop:$$1.style(this.header,"height")+"px"}),$$1.style($$1("table",this.bodyScrollable),{margin:0,width:"100%"})},Style.prototype.getColumnHeaderElement=function(t){return(t=+t)<0?null:$$1('.data-table-cell[data-col-index="'+t+'"]',this.header)},Style.prototype.getRowIndexColumnWidth=function(t){this._rowIndexColumnWidthMap=this._rowIndexColumnWidthMap||{};var e=(this.datamanager.getRowCount()+"").length;return this._rowIndexColumnWidthMap[e]||(this._rowIndexColumnWidthMap[e]=t+8*(e-1)),this._rowIndexColumnWidthMap[e]},Object.defineProperties(Style.prototype,prototypeAccessors$2);var KEYCODES={13:"enter",91:"meta",16:"shift",17:"ctrl",18:"alt",37:"left",38:"up",39:"right",40:"down",9:"tab",27:"esc",67:"c",70:"f"},Keyboard=function(t){this.listeners={},$$1.on(t,"keydown",this.handler.bind(this))};Keyboard.prototype.handler=function(t){var e=KEYCODES[t.keyCode];t.shiftKey&&"shift"!==e&&(e="shift+"+e),(t.ctrlKey&&"ctrl"!==e||t.metaKey&&"meta"!==e)&&(e="ctrl+"+e);var n=this.listeners[e];if(n&&n.length>0)for(var r=0,o=n;r<o.length;r+=1){var a=(0,o[r])(t);void 0!==a&&!0!==a||t.preventDefault()}},Keyboard.prototype.on=function(t,e){var n=this;t.split(",").map(function(t){return t.trim()}).map(function(t){n.listeners[t]=n.listeners[t]||[],n.listeners[t].push(e)})};var DEFAULT_OPTIONS={columns:[],data:[],dropdownButton:"▼",headerDropdown:[{label:"Sort Ascending",action:function(t){this.sortColumn(t.colIndex,"asc")}},{label:"Sort Descending",action:function(t){this.sortColumn(t.colIndex,"desc")}},{label:"Reset sorting",action:function(t){this.sortColumn(t.colIndex,"none")}},{label:"Remove column",action:function(t){this.removeColumn(t.colIndex)}}],events:{onRemoveColumn:function(t){},onSwitchColumn:function(t,e){},onSortColumn:function(t){},onCheckRow:function(t){}},sortIndicator:{asc:"↑",desc:"↓",none:""},freezeMessage:"",getEditor:null,serialNoColumn:!0,checkboxColumn:!1,clusterize:!0,logs:!1,layout:"fixed",noDataMessage:"No Data",cellHeight:null,inlineFilters:!1,treeView:!1,checkedRowStatus:!0},DataTable=function t(e,n){if(t.instances++,"string"==typeof e&&(e=document.querySelector(e)),this.wrapper=e,!(this.wrapper instanceof HTMLElement))throw new Error("Invalid argument given for `wrapper`");this.buildOptions(n),this.prepare(),this.style=new Style(this),this.keyboard=new Keyboard(this.wrapper),this.datamanager=new DataManager(this.options),this.rowmanager=new RowManager(this),this.columnmanager=new ColumnManager(this),this.cellmanager=new CellManager(this),this.bodyRenderer=new BodyRenderer(this),this.options.data&&this.refresh()};DataTable.prototype.buildOptions=function(t){var e;this.options=this.options||{},this.options=Object.assign({},DEFAULT_OPTIONS,this.options||{},t),(e=this.options.headerDropdown).push.apply(e,t.headerDropdown||[]),this.events=Object.assign({},DEFAULT_OPTIONS.events,this.options.events||{},t.events||{}),this.fireEvent=this.fireEvent.bind(this)},DataTable.prototype.prepare=function(){this.prepareDom(),this.unfreeze()},DataTable.prototype.prepareDom=function(){this.wrapper.innerHTML='\n            <div class="data-table">\n                <table class="data-table-header">\n                </table>\n                <div class="body-scrollable">\n                </div>\n                <div class="freeze-container">\n                <span>'+this.options.freezeMessage+'</span>\n                </div>\n                <div class="data-table-footer">\n                </div>\n                <div class="toast-message"></div>\n            </div>\n        ',this.datatableWrapper=$$1(".data-table",this.wrapper),this.header=$$1(".data-table-header",this.wrapper),this.bodyScrollable=$$1(".body-scrollable",this.wrapper),this.freezeContainer=$$1(".freeze-container",this.wrapper),this.toastMessage=$$1(".toast-message",this.wrapper)},DataTable.prototype.refresh=function(t,e){this.datamanager.init(t,e),this.render(),this.setDimensions()},DataTable.prototype.destroy=function(){this.wrapper.innerHTML="",this.style.destroy()},DataTable.prototype.appendRows=function(t){this.datamanager.appendRows(t),this.rowmanager.refreshRows()},DataTable.prototype.refreshRow=function(t,e){this.rowmanager.refreshRow(t,e)},DataTable.prototype.render=function(){this.renderHeader(),this.renderBody()},DataTable.prototype.renderHeader=function(){this.columnmanager.renderHeader()},DataTable.prototype.renderBody=function(){this.bodyRenderer.render()},DataTable.prototype.setDimensions=function(){this.style.setDimensions()},DataTable.prototype.showToastMessage=function(t){this.bodyRenderer.showToastMessage(t)},DataTable.prototype.clearToastMessage=function(){this.bodyRenderer.clearToastMessage()},DataTable.prototype.getColumn=function(t){return this.datamanager.getColumn(t)},DataTable.prototype.getColumns=function(){return this.datamanager.getColumns()},DataTable.prototype.getRows=function(){return this.datamanager.getRows()},DataTable.prototype.getCell=function(t,e){return this.datamanager.getCell(t,e)},DataTable.prototype.getColumnHeaderElement=function(t){return this.columnmanager.getColumnHeaderElement(t)},DataTable.prototype.getViewportHeight=function(){return this.viewportHeight||(this.viewportHeight=$$1.style(this.bodyScrollable,"height")),this.viewportHeight},DataTable.prototype.sortColumn=function(t,e){this.columnmanager.sortColumn(t,e)},DataTable.prototype.removeColumn=function(t){this.columnmanager.removeColumn(t)},DataTable.prototype.scrollToLastColumn=function(){this.datatableWrapper.scrollLeft=9999},DataTable.prototype.freeze=function(){$$1.style(this.freezeContainer,{display:""})},DataTable.prototype.unfreeze=function(){$$1.style(this.freezeContainer,{display:"none"})},DataTable.prototype.updateOptions=function(t){this.buildOptions(t)},DataTable.prototype.fireEvent=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];this.events[t].apply(this,e)},DataTable.prototype.log=function(){this.options.logs&&console.log.apply(console,arguments)},DataTable.instances=0;var name="frappe-datatable",version="0.0.3",description="A modern datatable library for the web",main="dist/frappe-datatable.cjs.js",scripts={start:"yarn run dev",build:"rollup -c",dev:"rollup -c -w",test:"mocha --compilers js:babel-core/register --colors ./test/*.spec.js","test:watch":"mocha --compilers js:babel-core/register --colors -w ./test/*.spec.js"},devDependencies={chai:"3.5.0",cssnano:"^3.10.0",deepmerge:"^2.0.1",eslint:"3.19.0","eslint-loader":"1.7.1",mocha:"3.3.0","postcss-cssnext":"^3.1.0","postcss-nested":"^3.0.0",precss:"^3.1.0","rollup-plugin-commonjs":"^8.3.0","rollup-plugin-json":"^2.3.0","rollup-plugin-node-resolve":"^3.0.3","rollup-plugin-postcss":"^1.2.8","rollup-plugin-uglify":"^3.0.0"},repository={type:"git",url:"https://github.com/frappe/datatable.git"},keywords=["datatable","data","grid","table"],author="Faris Ansari",license="MIT",bugs={url:"https://github.com/frappe/datatable/issues"},homepage="https://frappe.github.io/datatable",dependencies={"clusterize.js":"^0.18.0",lodash:"^4.17.5",sortablejs:"^1.7.0"},packageJson={name:name,version:version,description:description,main:main,scripts:scripts,devDependencies:devDependencies,repository:repository,keywords:keywords,author:author,license:license,bugs:bugs,homepage:homepage,dependencies:dependencies};DataTable.__version__=packageJson.version;var frappeDatatable_cjs=DataTable;return frappe.provide("frappe.views"),frappe.views.ReportView=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setup_defaults=function(){var e=this;t.prototype.setup_defaults.call(this),this.view_name="Report",this.page_title=__("Report:")+" "+this.page_title,this.menu_items=this.report_menu_items();var n=frappe.get_route();if(4===n.length&&(this.report_name=n[3]),this.add_totals_row=this.view_user_settings.add_totals_row||0,this.report_name)return this.get_report_doc().then(function(t){e.report_doc=t,e.report_doc.json=JSON.parse(e.report_doc.json),e.filters=e.report_doc.json.filters,e.order_by=e.report_doc.json.order_by,e.add_totals_row=e.report_doc.json.add_totals_row,e.page_title=e.report_name})},e.prototype.setup_view=function(){this.setup_columns(),this.bind_charts_button()},e.prototype.setup_result_area=function(){t.prototype.setup_result_area.call(this),this.$datatable_wrapper=$('<div class="data-table-wrapper">'),this.$charts_wrapper=$('<div class="charts-wrapper">'),this.$result.append(this.$charts_wrapper),this.$result.append(this.$datatable_wrapper)},e.prototype.before_render=function(){this.save_report_settings()},e.prototype.save_report_settings=function(){frappe.model.user_settings.save(this.doctype,"last_view",this.view_name),this.report_name||this.save_view_user_settings({fields:this.fields,filters:this.filter_area.get(),order_by:this.sort_selector.get_sql_string(),add_totals_row:this.add_totals_row})},e.prototype.update_data=function(t){var e=t.message||{};e=frappe.utils.dict(e.keys,e.values),0===this.start?this.data=e:this.data=this.data.concat(e)},e.prototype.render=function(){0!==this.data.length&&(this.chart&&this.refresh_charts(),this.datatable?this.datatable.refresh(this.get_data(this.data)):this.setup_datatable(this.data))},e.prototype.on_update=function(t){var e=this;if(this.doctype===t.doctype&&t.name){var n=t.user!==frappe.session.user;this.data.find(function(e){return e.name===t.name})?frappe.db.get_doc(t.doctype,t.name).then(function(t){return e.update_row(t,n)}):this.refresh()}},e.prototype.update_row=function(t,e){var n=this,r=[];this.data=this.data.map(function(e,n){if(e.name===t.name){for(var o in e)if(o.includes(":")){var a=o.split(":"),i=a[0],s=a[1],l=Object.keys(t).filter(function(e){return Array.isArray(t[e])&&t[e][0].doctype===i}).map(function(e){return t[e]}).map(function(t){return t[0]}).filter(function(t){return t.name===e[i+":name"]})[0];l&&(e[o]=l[s])}else e[o]=t[o];r.push([e,n])}return e});r.forEach(function(t){var r=t[0],o=t[1],a=n.build_row(r);n.datatable.refreshRow(a,o),function(t){if(e){var r=n.$result.find('.data-table-row[data-row-index="'+t+'"]');r.addClass("row-update"),setTimeout(function(){return r.removeClass("row-update")},500)}}(o)})},e.prototype.setup_datatable=function(t){var e=this;this.datatable=new frappeDatatable_cjs(this.$datatable_wrapper[0],{columns:this.columns,data:this.get_data(t),getEditor:this.get_editing_object.bind(this),events:{onRemoveColumn:function(t){e.remove_column_from_datatable(t)},onSwitchColumn:function(t,n){e.switch_column(t,n)}},headerDropdown:[{label:__("Add Column"),action:function(t){var n=[],r=e.get_columns_for_picker();n=r[e.doctype].filter(function(t){return!e.is_column_added(t)}).map(function(t){return{label:__(t.label),value:t.fieldname}}),delete r[e.doctype];var o=function(t){r[t].filter(function(t){return!e.is_column_added(t)}).map(function(e){return{label:__(e.label)+" ("+t+")",value:e.fieldname+","+t}}).forEach(function(t){return n.push(t)})};for(var a in r)o(a);var i=new frappe.ui.Dialog({title:__("Add Column"),fields:[{label:__("Select Column"),fieldname:"column",fieldtype:"Autocomplete",options:n},{label:__("Insert Column Before {0}",[t.docfield.label.bold()]),fieldname:"insert_before",fieldtype:"Check"}],primary_action:function(r){var o,a=r.column,s=r.insert_before;if(!n.map(function(t){return t.value}).includes(a))return frappe.show_alert(__("Invalid column")),void i.hide();var l=e.doctype;a.includes(",")&&(a=(o=a.split(","))[0],l=o[1]);var c=t.colIndex;s&&(c-=1),e.add_column_to_datatable(a,l,c),i.hide()}});i.show()}}]})},e.prototype.bind_charts_button=function(){var t=this;this.list_sidebar.sidebar.find(".charts-menu").removeClass("hide"),this.list_sidebar.sidebar.on("click",".toggle-charts",function(e){e.preventDefault(),t.toggle_charts()}),this.list_sidebar.sidebar.on("click",".configure-charts",function(e){e.preventDefault(),t.get_chart_data().then(function(){return t.refresh_charts()})}),this.refresh_charts_sidebar_button()},e.prototype.refresh_charts_sidebar_button=function(){var t=this.list_sidebar.sidebar.find(".configure-charts");this.chart&&!this.$charts_wrapper.hasClass("hidden")?t.removeClass("hidden"):t.addClass("hidden")},e.prototype.toggle_charts=function(){this.chart?(this.$charts_wrapper.toggleClass("hidden"),this.$charts_wrapper.hasClass("hidden")||this.chart.refresh(),this.refresh_charts_sidebar_button()):this.setup_charts()},e.prototype.setup_charts=function(){var t=this;this.get_chart_data().then(function(e){var n={labels:e.labels,datasets:e.datasets};t.last_chart_type=e.chart_type;t.chart=new Chart(t.$charts_wrapper[0],{title:__("{0} Chart",[t.doctype]),data:n,type:e.chart_type,height:150,colors:["violet","light-blue","orange","red"],format_tooltip_x:function(t){return t.doc.name},format_tooltip_y:function(e){return frappe.format(e,(n=e.field,frappe.meta.get_docfield(t.doctype,n)),{always_show_decimals:!0,inline:!0},function(e,n){return t.data.find(function(t){return t[n]===e})}(e.doc));var n}}),t.refresh_charts_sidebar_button()})},e.prototype.refresh_charts=function(){if(this.chart){var t=this.chart_args,e=t.x_field,n=t.y_fields,r=t.chart_type,o=this.get_chart_args(e,n,r);this.chart.update_values(o.datasets,o.labels),this.chart.refresh(),o.chart_type!==this.last_chart_type&&this.chart.get_different_chart(o.chart_type)}},e.prototype.get_chart_data=function(){var t=this;return new Promise(function(e){var n=t.fields.map(function(t){return t[0]}),r=t.meta.fields.filter(function(t){return!t.hidden&&n.includes(t.fieldname)}).map(function(t){return t.fieldname}),o=t.meta.fields.filter(function(t){return!t.hidden&&frappe.model.is_numeric_field(t)&&n.includes(t.fieldname)}).map(function(t){return t.fieldname}),a=t.chart_args||{},i=new frappe.ui.Dialog({title:__("Configure Chart"),fields:[{label:__("X Axis Field"),fieldtype:"Autocomplete",fieldname:"x_axis",options:r,default:a.x_field},{label:__("Y Axis Fields"),fieldtype:"MultiSelect",fieldname:"y_axes",options:o,description:__("Showing only Numeric fields from Report"),default:a.y_fields},{label:__("Chart Type"),fieldtype:"Select",options:["Bar","Line","Scatter","Pie","Percentage"],fieldname:"chart_type",default:toTitle(a.chart_type||"Bar")}],primary_action:function(n){var a=n.x_axis,s=n.y_axes,l=n.chart_type;if((s=s.split(",").map(function(t){return t.trim()}).filter(Boolean)).every(function(t){return o.includes(t)})&&r.includes(a)){var c=t.get_chart_args(a,s,l);t.chart_args=c,e(c),i.hide()}}});i.show()})},e.prototype.get_chart_args=function(t,e,n){var r=this,o=this.data.map(function(e){return{doc:e,toString:function(){return e[t]},slice:String.prototype.slice}});return{chart_type:n.toLowerCase(),x_field:t,y_fields:e,labels:o,datasets:e.map(function(t){return{name:frappe.meta.get_docfield(r.doctype,t).label,values:r.data.map(function(e){return{doc:e,field:t,toString:function(){return e[t]},slice:String.prototype.slice}})}})}},e.prototype.get_editing_object=function(t,e,n,r){var o=this,a=this.render_editing_input(t,n,r);return!!a&&(a.df.change=function(){return a.set_focus()},{initValue:function(t){return a.set_value(t)},setValue:function(n){var r=o.datatable.getCell(t,e),i=o.datatable.getColumn(t).docfield.fieldname,s=r.name,l=r.doctype;return a.set_value(n),o.set_control_value(l,s,i,n).then(function(t){var e=o.data.find(function(e){return e.name===t.name});for(var n in e)e[n]=t[n]}).then(function(){return o.refresh_charts()})},getValue:function(){return a.get_value()}})},e.prototype.set_control_value=function(t,e,n,r){return this.last_updated_doc=e,new Promise(function(o,a){var i;frappe.db.set_value(t,e,(i={},i[n]=r,i)).then(function(t){t.message?o(t.message):a()}).fail(a)})},e.prototype.render_editing_input=function(t,e,n){var r=this,o=this.datatable.getColumn(t),a=null;if("Text Editor"===o.docfield.fieldtype){var i=new frappe.ui.Dialog({title:__("Edit {0}",[o.docfield.label]),fields:[o.docfield],primary_action:function(){r.datatable.cellmanager.submitEditing(),r.datatable.cellmanager.deactivateEditing(),i.hide()}});i.show(),a=i.fields_dict[o.docfield.fieldname]}else(a=frappe.ui.form.make_control({df:o.docfield,parent:n,render_input:!0})).set_value(e),a.toggle_label(!1),a.toggle_description(!1);return a},e.prototype.is_editable=function(t,e){return!(!t||0!==e.docstatus)&&!(frappe.model.std_fields_list.includes(t.fieldname)||t.read_only||t.hidden||!frappe.model.can_write(this.doctype))},e.prototype.get_data=function(t){return this.build_rows(t)},e.prototype.set_fields=function(){var t=this;if(this.report_name&&this.report_doc.json.fields)this.fields=this.report_doc.json.fields;else if(this.view_user_settings.fields)this.fields=this.view_user_settings.fields;else{this.fields=[];var e=function(e){return t._add_field(e)};["name","docstatus",this.meta.title_field,this.meta.image_field].map(e);var n=this.meta.fields.filter(function(e){return(e.in_list_view||e.in_standard_filter)&&frappe.perm.has_perm(t.doctype,e.permlevel,"read")&&frappe.model.is_value_type(e.fieldtype)&&!e.report_hide});n.map(e),n.filter(function(t){return"Currency"===t.fieldtype&&t.options}).map(function(t){t.options.includes(":")?e(t.options.split(":")[1]):e(t.options)}),(this.settings.add_fields||[]).map(e)}},e.prototype.build_fields=function(){this.fields.push(["docstatus",this.doctype]),t.prototype.build_fields.call(this)},e.prototype.get_fields=function(){var t=this,e=this.fields.map(function(e){var n=frappe.model.get_full_column_name(e[0],e[1]);return e[1]!==t.doctype&&(n=n+" as '"+e[1]+":"+e[0]+"'"),n}),n=this.get_unique_cdt_in_view().map(function(t){return frappe.model.get_full_column_name("name",t)+" as '"+t+":name'"});return e=e.concat(n)},e.prototype.get_unique_cdt_in_view=function(){var t=this;return this.fields.filter(function(e){return e[1]!==t.doctype}).map(function(t){return t[1]}).uniqBy(function(t){return t})},e.prototype.add_column_to_datatable=function(t,e,n){var r=[t,e];this.fields.splice(n,0,r),this.add_currency_column(t,e,n),this.build_fields(),this.setup_columns(),this.datatable.destroy(),this.datatable=null,this.refresh()},e.prototype.add_currency_column=function(t,e,n){var r=frappe.meta.get_docfield(e,t);if(r&&"Currency"===r.fieldtype&&r.options&&!r.options.includes(":")){var o=[r.options,e];void 0===n?this.fields.push(o):this.fields.splice(n,0,o),frappe.show_alert(__("Also adding the dependent currency field {0}",[o[0].bold()]))}},e.prototype.remove_column_from_datatable=function(t){var e=this.fields.findIndex(function(e){return t.field===e[0]});-1!==e&&("name"===this.fields[e][0]&&frappe.throw(__("Cannot remove ID field")),this.fields.splice(e,1),this.build_fields(),this.setup_columns(),this.refresh())},e.prototype.switch_column=function(t,e){var n=this.fields.findIndex(function(e){return t.field===e[0]}),r=this.fields.findIndex(function(t){return e.field===t[0]}),o=this.fields.slice(),a=o[n];o[n]=o[r],o[r]=a,this.fields=o,this.build_fields(),this.setup_columns(),this.refresh()},e.prototype.get_columns_for_picker=function(){var t={},e=function(t){return!in_list(frappe.model.no_value_type,t.fieldtype)&&!t.report_hide&&"naming_series"!==t.fieldname&&!t.hidden},n=frappe.meta.get_docfields(this.doctype).filter(e);return n=[{label:__("ID"),fieldname:"name",fieldtype:"Data"}].concat(n,frappe.model.std_fields),t[this.doctype]=n,frappe.meta.get_table_fields(this.doctype).filter(function(t){return!t.hidden}).forEach(function(n){var r=n.options,o=frappe.meta.get_docfields(r).filter(e);t[r]=o}),t},e.prototype.get_dialog_fields=function(){var t=this,e=[],n=this.get_columns_for_picker();return e.push({label:__(this.doctype),fieldname:this.doctype,fieldtype:"MultiCheck",columns:2,options:n[this.doctype].map(function(e){return{label:__(e.label),value:e.fieldname,checked:t.fields.find(function(t){return t[0]===e.fieldname})}})}),delete n[this.doctype],frappe.meta.get_table_fields(this.doctype).filter(function(t){return!t.hidden}).forEach(function(r){var o=r.options;e.push({label:__(r.label)+" ("+__(o)+")",fieldname:r.options,fieldtype:"MultiCheck",columns:2,options:n[o].map(function(e){return{label:__(e.label),value:e.fieldname,checked:t.fields.find(function(t){return t[0]===e.fieldname&&t[1]===o})}})})}),e},e.prototype.is_column_added=function(t){return Boolean(this.fields.find(function(e){return e[0]===t.fieldname&&t.parent===e[1]}))},e.prototype.setup_columns=function(){var t=this,e=["docstatus"],n=this.fields.filter(function(t){return!e.includes(t[0])});this.columns=n.map(function(e){return t.build_column(e)})},e.prototype.build_column=function(t){var e=t[0],n=t[1],r=frappe.meta.docfield_map[n||this.doctype][e];if(r||(r=frappe.model.get_std_field(e))&&(r.parent=this.doctype,"name"==e&&(r.options=this.doctype)),r){var o=__(r?r.label:toTitle(e));n!==this.doctype&&(o+=" ("+__(n)+")");var a=frappe.model.is_non_std_field(e)&&!r.read_only;return{id:e,field:e,docfield:r,name:o,content:o,width:(r?cint(r.width):null)||null,editable:a,format:function(t,e,n,r){return frappe.format(t,n.docfield,{always_show_decimals:!0},r)}}}},e.prototype.build_rows=function(t){var e=this,n=t.map(function(t){return e.build_row(t)});if(this.add_totals_row){var r=t.reduce(function(t,n){return e.columns.forEach(function(e,r){t[r]=t[r]||{name:"Totals Row",content:""},e.field in n&&frappe.model.is_numeric_field(e.docfield)&&(t[r].format||(t[r].format=function(t){return frappe.format(t,e.docfield,{always_show_decimals:!0})}),t[r].content=t[r].content||0,t[r].content+=parseInt(n[e.field],10))}),t},[]);r[0].content=__("Totals").bold(),n.push(r)}return n},e.prototype.build_row=function(t){var e=this;return this.columns.map(function(n){if(n.docfield.parent!==e.doctype){var r=function(t){return n.docfield.parent+":"+t},o=t[r("name")];return{name:o,doctype:n.docfield.parent,content:t[r(n.field)],editable:Boolean(o&&e.is_editable(n.docfield,t)),format:function(t){return frappe.format(t,n.docfield,{always_show_decimals:!0})}}}if(n.field in t){var a=t[n.field];return{name:t.name,doctype:n.docfield.parent,content:a,editable:e.is_editable(n.docfield,t)}}return{content:""}})},e.prototype.get_checked_items=function(t){var e=this,n=this.datatable.rowmanager.getCheckedRows().filter(function(t){return null!=t}).map(function(t){return e.data[t]});return t?n.map(function(t){return t.name}):n},e.prototype.save_report=function(t){var e=this,n=function(t){return frappe.call({method:"frappe.desk.reportview.save_report",args:{name:t,doctype:e.doctype,json:JSON.stringify({filters:e.filter_area.get(),fields:e.fields,order_by:e.sort_selector.get_sql_string(),add_totals_row:e.add_totals_row})},callback:function(t){t.exc?frappe.msgprint(__("Report was not saved (there were errors)")):t.message!=e.report_name&&frappe.set_route("List",e.doctype,"Report",t.message)}})};this.report_name&&"save"==t?n(this.report_name):frappe.prompt({fieldname:"name",label:__("New Report name"),reqd:1,fieldtype:"Data"},function(t){n(t.name)},__("Save As"))},e.prototype.get_report_doc=function(){var t=this;return new Promise(function(e){frappe.model.with_doc("Report",t.report_name,function(){e(frappe.get_doc("Report",t.report_name))})})},e.prototype.report_menu_items=function(){var t=this,e=[{label:__("Show Totals"),action:function(){t.add_totals_row=!t.add_totals_row,t.save_view_user_settings({add_totals_row:t.add_totals_row}),t.datatable.refresh(t.get_data(t.data))}},{label:__("Print"),action:function(){frappe.ui.get_print_settings(!1,function(e){var n=__(t.doctype);frappe.render_grid({title:n,print_settings:e,columns:t.columns,data:t.data})})}},{label:__("Toggle Chart"),action:function(){return t.toggle_charts()}},{label:__("Toggle Sidebar"),action:function(){return t.toggle_side_bar()}},{label:__("Pick Columns"),action:function(){var e=new frappe.ui.Dialog({title:__("Pick Columns"),fields:t.get_dialog_fields(),primary_action:function(n){var r=n[t.doctype].map(function(e){return[e,t.doctype]});delete n[t.doctype];var o=function(t){r=r.concat(n[t].map(function(e){return[e,t]}))};for(var a in n)o(a);t.fields=r,t.fields.map(function(e){return t.add_currency_column(e[0],e[1])}),t.build_fields(),t.setup_columns(),t.datatable.destroy(),t.datatable=null,t.refresh(),e.hide()}});e.show()}}];return frappe.model.can_export(this.doctype)&&e.push({label:__("Export"),action:function(){var e=t.get_args(),n=t.get_checked_items(!0);frappe.prompt({fieldtype:"Select",label:__("Select File Type"),fieldname:"file_format_type",options:"Excel\nCSV",default:"Excel",reqd:1},function(r){e.cmd="frappe.desk.reportview.export_query",e.file_format_type=r.file_format_type,"CSV"!==e.file_format_type?(t.add_totals_row&&(e.add_totals_row=1),n.length>0&&(e.selected_items=n),e.start=0,e.page_length=t.data.length,open_url_post(frappe.request.url,e)):frappe.tools.downloadify(t.data,null,t.doctype)},__("Export Report: {0}",[__(t.doctype)]),__("Download"))}}),e.push({label:__("Setup Auto Email"),action:function(){t.report_name?frappe.set_route("List","Auto Email Report",{report:t.report_name}):frappe.msgprint(__("Please save the report first"))}}),frappe.user.is_report_manager()&&(e=e.concat([{label:__("Save"),action:function(){return t.save_report("save")}},{label:__("Save As"),action:function(){return t.save_report("save_as")}}])),this.report_name&&frappe.model.can_set_user_permissions("Report")&&e.push({label:__("User Permissions"),action:function(){var e={doctype:"Report",name:t.report_name};frappe.set_route("List","User Permission",e)}}),e.push({label:__("Add to Desktop"),action:function(){frappe.add_to_desktop(t.report_name||__("{0} Report",[t.doctype]),t.doctype,t.report_name)}}),e.map(function(t){return Object.assign(t,{standard:!0})})},e}(frappe.views.ListView),frappe.templates.reportview_footer='<div class="row">  <div class="col-md-6">   {% if has_child_column %}    <div class="checkbox">        <label>            <input type="checkbox" class="show-all-data"       style="margin-top: 2px"       {{ show_all_data ? "checked" : "" }}>       {{ __("Show all data") }}        </label>    </div>   {% endif %}  </div>  {% if can_write %}  <div class="col-md-6 text-right"><p class="text-muted">   {{ __("Tip:  Double click cell to edit") }}</p></div>  {% endif %} </div>',frappe.provide("frappe.views"),frappe.provide("frappe.query_reports"),frappe.standard_pages["query-report"]=function(){var t=frappe.container.add_page("query-report");frappe.ui.make_app_page({parent:t,title:__("Query Report"),single_column:!0}),frappe.query_report=new frappe.views.QueryReport({parent:t}),$(t).bind("show",function(){frappe.query_report.show()})},frappe.views.QueryReport=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={get_values:{configurable:!0}};return e.prototype.show=function(){var t=this;this.init().then(function(){return t.load()})},e.prototype.init=function(){var t=this;if(this.init_promise)return this.init_promise;var e=[this.setup_defaults,this.setup_page,this.setup_report_wrapper].map(function(e){return e.bind(t)});return this.init_promise=frappe.run_serially(e),this.init_promise},e.prototype.setup_defaults=function(){var t=this;this.route=frappe.get_route(),this.page_name=frappe.get_route_str(),this.primary_action=null,this.secondary_action={label:__("Refresh"),action:function(){return t.refresh()}},this.refresh=frappe.utils.throttle(this.refresh,300),this.menu_items=[]},e.prototype.load=function(){frappe.get_route().length<2?this.toggle_nothing_to_show(!0):this.report_name!==frappe.get_route()[1]?(this.toggle_loading(!0),this.load_report()):this.refresh_report()},e.prototype.load_report=function(){var t=this;this.route=frappe.get_route(),this.page_name=frappe.get_route_str(),this.report_name=this.route[1],this.page_title=__(this.report_name),this.menu_items=this.get_menu_items(),this.datatable=null,frappe.run_serially([function(){return t.get_report_doc()},function(){return t.get_report_settings()},function(){return t.setup_page_head()},function(){return t.refresh_report()}])},e.prototype.refresh_report=function(){var t=this;return this.toggle_message(!0),frappe.run_serially([function(){return t.setup_filters()},function(){return t.set_route_filters()},function(){return t.report_settings.onload&&t.report_settings.onload(t)},function(){return t.get_user_settings()},function(){return t.refresh()},function(){return t.save_user_settings()}])},e.prototype.get_report_doc=function(){var t=this;return frappe.model.with_doc("Report",this.report_name).then(function(e){t.report_doc=e}).then(function(){return frappe.model.with_doc("DocType",t.report_doc.ref_doctype)})},e.prototype.get_report_settings=function(){var t=this;return frappe.query_reports[this.report_name]?(this.report_settings=frappe.query_reports[this.report_name],this._load_script):(this._load_script=new Promise(function(e){return frappe.call({method:"frappe.desk.query_report.get_script",args:{report_name:t.report_name},callback:e})}).then(function(t){return frappe.dom.eval(t.message.script||""),t}).then(function(e){return frappe.after_ajax(function(){t.report_settings=frappe.query_reports[t.report_name],t.report_settings.html_format=e.message.html_format})}),this._load_script)},e.prototype.setup_filters=function(){var t=this;this.clear_filters();var e=this.report_settings.filters;void 0===e&&(e=[]),this.filters=e.map(function(e){if("Break"!==e.fieldtype){var n=t.page.add_field(e);return e.default&&n.set_input(e.default),e.get_query&&(n.get_query=e.get_query),e.on_change&&(n.on_change=e.on_change),e.onchange=function(){n.on_change?n.on_change(t):t.refresh()},n}}).filter(Boolean),0===this.filters.length?this.page.hide_form():this.page.show_form(),this.set_filters_by_name()},e.prototype.set_filters_by_name=function(){for(var t in frappe.query_report_filters_by_name={},this.filters)frappe.query_report_filters_by_name[this.filters[t].df.fieldname]=this.filters[t]},e.prototype.set_route_filters=function(){if(frappe.route_options){var t=Object.keys(frappe.route_options),e=this.filters.filter(function(e){return t.includes(e.df.fieldname)}).map(function(t){return function(){var e=frappe.route_options[t.df.fieldname];return t.set_value(e)}});return e.push(function(){frappe.route_options=null}),frappe.run_serially(e)}},e.prototype.clear_filters=function(){this.page.clear_fields()},e.prototype.refresh=function(){var t=this;this.toggle_message(!0);var e=this.get_filter_values(!0);return new Promise(function(n){return frappe.call({method:"frappe.desk.query_report.run",type:"GET",args:{report_name:t.report_name,filters:e},callback:n})}).then(function(e){var n=e.message;t.toggle_message(!1),n.result&&n.result.length?(t.render_chart(n),t.render_report(n)):t.toggle_nothing_to_show(!0)})},e.prototype.render_report=function(t){var e=this;this.columns=this.prepare_columns(t.columns),this.data=this.prepare_data(t.result),this.tree_report=this.data.some(function(t){return"indent"in t});var n=this.get_visible_columns();this.datatable?this.datatable.refresh(this.data,n):this.datatable=new frappeDatatable_cjs(this.$report[0],{columns:n,data:this.data,inlineFilters:!0,treeView:this.tree_report,layout:"fixed",events:{onRemoveColumn:function(){return e.save_user_settings()},onSwitchColumn:function(){return e.save_user_settings()}}})},e.prototype.render_chart=function(t){this.$chart.empty();var e=this.report_settings.get_chart_data?this.report_settings.get_chart_data(t.columns,t.result):t.chart?t.chart:{};e.data&&e.data.labels&&e.data.labels.length>0&&(Object.assign(e,{height:200}),this.$chart.show(),this.chart=new Chart(this.$chart[0],e))},e.prototype.get_user_settings=function(){var t=this;return frappe.model.user_settings.get(this.report_name).then(function(e){t.user_settings=e})},e.prototype.save_user_settings=function(t){if(void 0===t&&(t=!1),t)return frappe.model.user_settings.save(this.report_name,"column_order",[]);if(this.datatable){var e=this.datatable.datamanager.getColumns(!0).map(function(t){return t.id});return frappe.model.user_settings.save(this.report_name,"column_order",e)}},e.prototype.prepare_columns=function(t){return t.map(function(t){var e;if("string"==typeof t)if(t.includes(":")){var n,r=t.split(":"),o=r[0],a=r[1],i=r[2];a.includes("/")&&(a=(e=a.split("/"))[0],n=e[1]),t={label:o,fieldname:o,fieldtype:a,width:i,options:n}}else t={label:t,fieldname:t,fieldtype:"Data"};return Object.assign(t,{id:t.fieldname,name:t.label,width:parseInt(t.width)||null,editable:!1,format:function(t,e,n,r){return frappe.format(t||"",n,{for_print:!1,always_show_decimals:!0},r)}})})},e.prototype.prepare_data=function(t){var e=this;return t.map(function(t){var n={};return Array.isArray(t)?(e.columns.forEach(function(e,r){n[e.id]=t[r]||null}),n):t})},e.prototype.get_visible_columns=function(){var t=this;return this.user_settings.column_order&&this.user_settings.column_order.length>0?this.user_settings.column_order.map(function(e){return t.columns.find(function(t){return t.id===e})}).filter(Boolean):this.columns},e.prototype.get_filter_values=function(t){var e=this.filters.filter(function(t){return t.df.reqd}).filter(function(t){return!t.get_value()});return t&&e.length>0&&t&&frappe.throw(__("Filter missing: {0}",[e.map(function(t){return t.df.label}).join(", ")])),this.filters.filter(function(t){return t.get_value()}).map(function(t){var e,n=t.get_value();return t.df.hidden&&(n=t.value),"%"===n&&(n=null),(e={})[t.df.fieldname]=n,e}).reduce(function(t,e){return Object.assign(t,e),t},{})},e.prototype.set_breadcrumbs=function(){if(this.report_doc&&this.report_doc.ref_doctype){var t=frappe.get_meta(this.report_doc.ref_doctype);frappe.breadcrumbs.add(t.module)}},e.prototype.print_report=function(t){var e=this.report_settings.html_format||null,n=this.get_filters_html_for_print();frappe.render_grid({template:e,title:__(this.report_name),subtitle:n,print_settings:t,filters:this.get_filter_values(),data:e?this.data:this.get_data_for_print(),columns:e?this.columns:this.get_visible_columns(),report:this})},e.prototype.pdf_report=function(t){var e=frappe.urllib.get_base_url(),n=frappe.boot.print_css,r="Landscape"==t.orientation,o=this.report_settings.html_format||null,a=o?this.columns:this.get_visible_columns(),i=o?this.data:this.get_data_for_print(),s=this.get_filter_values(),l=this.get_filters_html_for_print(),c=frappe.render_template(o||"print_grid",{title:__(this.report_name),subtitle:l,filters:s,data:i,columns:a,report:this}),d=frappe.render_template("print_template",{title:__(this.report_name),content:c,base_url:e,print_css:n,print_settings:t,landscape:r,columns:a});frappe.render_pdf(d,t)},e.prototype.get_filters_html_for_print=function(){var t=this.get_filter_values();return Object.keys(t).map(function(e){var n=frappe.query_report_filters_by_name[e].df.label,r=t[e];return"<h6>"+__(n)+": "+r+"</h6>"}).join("")},e.prototype.export_report=function(){var t=this;if(this.export_dialog)return this.export_dialog.clear(),void this.export_dialog.show();this.export_dialog=frappe.prompt({label:__("Select File Format"),fieldname:"file_format",fieldtype:"Select",options:["Excel","CSV"],default:"Excel",reqd:1},function(e){var n=e.file_format;if("CSV"===n){var r=t.columns.map(function(t){return t.label}),o=t.get_data_for_csv(),a=[r].concat(o);frappe.tools.downloadify(a,null,t.report_name)}else{var i=t.get_filter_values(!0),s={cmd:"frappe.desk.query_report.export_query",report_name:t.report_name,file_format_type:n,filters:i,visible_idx:t.datatable.datamanager.getFilteredRowIndices()};open_url_post(frappe.request.url,s)}},__("Export Report: "+this.report_name),__("Download"))},e.prototype.get_data_for_csv=function(){var t=this;return this.datatable.datamanager.getFilteredRowIndices().map(function(e){return t.datatable.datamanager.getRow(e).map(function(t){return t.content})}).map(function(t){return t.slice(1)})},e.prototype.get_data_for_print=function(){var t=this;return this.datatable.datamanager.getFilteredRowIndices().map(function(e){return t.data[e]})},e.prototype.get_columns_for_print=function(){return this.columns||[]},e.prototype.get_menu_items=function(){var t=this;return[{label:__("Refresh"),action:function(){return t.refresh()},class:"visible-xs"},{label:__("Edit"),action:function(){return frappe.set_route("Form","Report",t.report_name)},condition:function(){return frappe.user.is_report_manager()},standard:!0},{label:__("Print"),action:function(){frappe.ui.get_print_settings(!1,function(e){return t.print_report(e)},t.report_doc.letter_head)},condition:function(){return frappe.model.can_print(t.report_doc.ref_doctype)},standard:!0},{label:__("PDF"),action:function(){frappe.ui.get_print_settings(!1,function(e){return t.pdf_report(e)},t.report_doc.letter_head)},condition:function(){return frappe.model.can_print(t.report_doc.ref_doctype)},standard:!0},{label:__("Export"),action:function(){return t.export_report()},standard:!0},{label:__("Setup Auto Email"),action:function(){return frappe.set_route("List","Auto Email Report",{report:t.report_name})},standard:!0},{label:__("User Permissions"),action:function(){return frappe.set_route("List","User Permission",{doctype:"Report",name:t.report_name})},condition:function(){return frappe.model.can_set_user_permissions("Report")},standard:!0},{label:__("Clear User Settings"),action:function(){return t.save_user_settings(!0).then(function(){return t.refresh_report()})},standard:!0},{label:__("Add to Desktop"),action:function(){return frappe.add_to_desktop(t.report_name,null,t.report_name)},standard:!0}]},e.prototype.setup_page_head=function(){t.prototype.setup_page_head.call(this),this.page.set_title_sub("<label class='label label-warning text-color'>"+__("Beta")+"</label>")},e.prototype.setup_report_wrapper=function(){this.$report||(this.$chart=$('<div class="chart-wrapper">').hide().appendTo(this.page.main),this.$report=$('<div class="report-wrapper">').appendTo(this.page.main),this.$message=$(this.message_div("")).hide().appendTo(this.page.main))},e.prototype.message_div=function(t){return"<div class='flex justify-center align-center text-muted' style='height: 50vh;'>\n\t\t\t<div>"+t+"</div>\n\t\t</div>"},e.prototype.toggle_loading=function(t){this.toggle_message(t,__("Loading")+"...")},e.prototype.toggle_nothing_to_show=function(t){this.toggle_message(t,__("Nothing to show"))},e.prototype.toggle_message=function(t,e){t?(this.$message.find("div").html(e),this.$message.show()):this.$message.hide(),this.$report.toggle(!t),this.$chart.toggle(!t)},n.get_values.get=function(){return this.get_filter_values},Object.defineProperties(e.prototype,n),e}(frappe.views.BaseList),frappe.provide("frappe.report_dump"),$.extend(frappe.report_dump,{data:{},last_modified:{},with_data:function(t,e){var n=Object.keys(frappe.report_dump.last_modified);return frappe.call({method:"frappe.desk.report_dump.get_data",type:"GET",args:{doctypes:t,last_modified:frappe.report_dump.last_modified},freeze:!0,callback:function(t){$.each(t.message,function(t,e){frappe.report_dump.set_data(t,e)}),$.each(t.message,function(t,e){in_list(n,t)||e.links&&$.each(frappe.report_dump.data[t],function(t,n){$.each(e.links,function(t,e){frappe.report_dump.data[e[0]][n[t]]?n[t]=frappe.report_dump.data[e[0]][n[t]][e[1]]:n[t]=null})})}),e()}})},set_data:function(t,e){var n=[],r={},o=function(n){var r={};return $.each(e.columns,function(t,e){r[e]=n[t]}),r.id=r.name,r.doctype=t,r};frappe.report_dump.last_modified[t]?($.each(e.data,function(t,e){var n=o(e);r[n.name]=n}),$.each(frappe.report_dump.data[t],function(t,o){r[o.name]?(n.push(r[o.name]),delete r[o.name]):-1!==e.modified_names.indexOf(o.name)||n.push(o)}),$.each(r,function(t,e){n.push(e)})):$.each(e.data,function(t,e){n.push(o(e))}),frappe.report_dump.last_modified[t]=e.last_modified,frappe.report_dump.data[t]=n}}),frappe.provide("frappe.views"),frappe.views.GridReport=Class.extend({init:function(t){this.filter_inputs={},this.preset_checks=[],this.tree_grid={show:!1},$.extend(this,t),this.wrapper=$('<div class="grid-report"></div>').appendTo(this.page.main),this.page.main.find(".page").css({"padding-top":"0px"}),this.filters&&this.make_filters(),this.make_waiting(),this.get_data_and_refresh()},bind_show:function(){var t=this;$(this.page).bind("show",function(){frappe.cur_grid_report=t,t.get_data_and_refresh()})},get_data_and_refresh:function(){var t=this;this.get_data(function(){t.apply_filters_from_route(),t.refresh()})},get_data:function(t){var e=this;frappe.report_dump.with_data(this.doctypes,function(){e.setup_filters_done||(e.setup_filters(),e.setup_filters_done=!0),t()})},setup_filters:function(){var t=this;$.each(t.filter_inputs,function(e,n){var r=n.get(0).opts;"Select"==r.fieldtype&&in_list(t.doctypes,r.link)?$(n).add_options(frappe.report_dump.data[r.link].map(function(t){return t.name})):"Link"==r.fieldtype&&in_list(t.doctypes,r.link)&&(r.list=frappe.report_dump.data[r.link].map(function(t){return t.name}),t.set_autocomplete(n,r.list))}),this.page.set_primary_action(__("Refresh"),function(){t.get_data(function(){t.refresh()})}),this.filter_inputs&&this.page.add_menu_item(__("Reset Filters"),function(){t.init_filter_values(),t.refresh()},!0),this.page.add_menu_item(__("Print"),function(){frappe.ui.get_print_settings(!1,function(e){frappe.render_grid({grid:t.grid,title:t.page.title,print_settings:e})})},!0),this.filter_inputs.range&&this.filter_inputs.range.on("change",function(){t.refresh()})},set_filter:function(t,e){var n=this.filter_inputs[t];if(n){var r=n.get(0).opts;"Check"===r.fieldtype&&n.prop("checked",!!cint(e)),"Date"==r.fieldtype?n.val(frappe.datetime.str_to_user(e)):n.val(e)}else frappe.msgprint(__("Invalid Filter: {0}",[t]))},set_autocomplete:function(t,e){var n=this;new Awesomplete(t.get(0),{list:e}),t.on("awesomplete-select",function(e){var r=e.originalEvent.text.value;t.val(r),n.refresh()})},init_filter_values:function(){$.each(this.filter_inputs,function(t,e){var n=e.get(0).opts;frappe.sys_defaults[t]?e.val(frappe.sys_defaults[t]):"Select"==n.fieldtype?e.get(0).selectedIndex=0:"Data"==n.fieldtype?e.val(""):"Link"==n.fieldtype&&e.val("")}),this.set_default_values()},set_default_values:function(){var t={from_date:frappe.datetime.str_to_user(frappe.sys_defaults.year_start_date),to_date:frappe.datetime.str_to_user(frappe.sys_defaults.year_end_date)},e=this;$.each(t,function(t,n){e.filter_inputs[t]&&!e.filter_inputs[t].val()&&e.filter_inputs[t].val(n)})},make_filters:function(){var t=this;$.each(this.filters,function(e,n){n.fieldname=n.fieldname||n.label.replace(/ /g,"_").toLowerCase();var r=null;"Select"==n.fieldtype?r=t.page.add_select(n.label,n.options||[n.default_value]):"Link"==n.fieldtype?(r=t.page.add_data(n.label),new Awesomplete(r.get(0),{list:n.list||[]})):"Button"===n.fieldtype&&n.label===__("Refresh")?r=t.page.set_primary_action(n.label,null,n.icon):"Button"===n.fieldtype?r=t.page.add_menu_item(n.label,null,!0):"Date"===n.fieldtype?r=t.page.add_date(n.label):"Label"===n.fieldtype?r=t.page.add_label(n.label):"Data"===n.fieldtype?r=t.page.add_data(n.label):"Check"===n.fieldtype&&(r=t.page.add_check(n.label)),r&&(r&&(r.get(0).opts=n),n.cssClass&&r.addClass(n.cssClass),r.keypress(function(e){13==e.which&&t.refresh()})),t.filter_inputs[n.fieldname]=r})},make_waiting:function(){this.waiting=frappe.messages.waiting(this.wrapper,__("Loading Report")+"...")},load_filter_values:function(){var t=this;$.each(this.filter_inputs,function(e,n){var r=n.get(0).opts;"Check"==r.fieldtype?t[r.fieldname]=n.prop("checked")?1:0:"Button"!=r.fieldtype&&(t[r.fieldname]=n.val(),"Date"==r.fieldtype?t[r.fieldname]=frappe.datetime.user_to_str(t[r.fieldname]):"Select"==r.fieldtype&&(t[r.fieldname+"_default"]=r.default_value))}),this.filter_inputs.from_date&&this.filter_inputs.to_date&&this.to_date<this.from_date&&frappe.msgprint(__("From Date must be before To Date"))},make_name_map:function(t,e){var n={};return e=e||"name",$.each(t,function(t,r){n[r[e]]=r}),n},reset_item_values:function(t){var e=this;$.each(this.columns,function(n,r){r.formatter==e.currency_formatter&&(t[r.id]=0)})},round_item_values:function(t){var e=this;$.each(this.columns,function(n,r){r.formatter==e.currency_formatter&&(t[r.id]=flt(t[r.id],frappe.defaults.get_default("float_precision")||3))})},round_off_data:function(){var t=this;$.each(this.data,function(e,n){t.round_item_values(n)})},refresh:function(){this.waiting.toggle(!1),this.grid_wrapper||this.make(),this.load_filter_values(),this.setup_columns(),this.setup_dataview_columns(),this.apply_link_formatters(),this.prepare_data(),this.round_off_data(),this.prepare_data_view(),frappe.show_alert("Updated",2),this.render(),this.setup_chart&&this.setup_chart()},setup_dataview_columns:function(){this.columns=this.columns.filter(function(t){return!t.hidden}),this.datatable_columns=this.columns.map(function(t){return Object.assign(t,{format:function(t,e,n,r){return n.formatter?n.formatter(e,{},t,n,r):t||""}})})},make:function(){var t=this;this.chart_area=$('<div class="chart" style="padding-bottom: 1px"></div>').appendTo(this.wrapper),this.page.add_menu_item(__("Export"),function(){return t.export()},!0),this.grid_wrapper=$("<div style='height: 500px;'>").appendTo(this.wrapper),this.id=frappe.dom.set_unique_id(this.grid_wrapper.get(0)),this.bind_show(),frappe.cur_grid_report=this,$(this.wrapper).trigger("make")},apply_filters_from_route:function(){var t=this;frappe.route_options?($.each(frappe.route_options,function(e,n){t.set_filter(e,n)}),frappe.route_options=null):this.init_filter_values(),this.set_default_values(),$(this.wrapper).trigger("apply_filters_from_route")},options:{editable:!1,enableColumnReorder:!1},render:function(){var t=this;this.datatable=new frappeDatatable_cjs("#"+this.id,{columns:this.datatable_columns,data:this.data,layout:"fixed",inlineFilters:!0,treeView:!0,checkboxColumn:!0,checkedRowStatus:!1,events:{onCheckRow:function(e){var n=e.meta.rowIndex,r=t.datatable.rowmanager.checkMap[n];t.datatable.datamanager.getData(n).checked=Boolean(r),t.setup_chart&&t.setup_chart()}}}),this.data.forEach(function(e,n){e.checked&&t.datatable.rowmanager.checkRow(n,!0)})},prepare_data_view:function(){},export:function(){return frappe.tools.downloadify(frappe.slickgrid_tools.get_view_data(this.columns,this.dataView),["Report Manager","System Manager"],this.title),!1},apply_filters:function(t){var e=this.filter_inputs;if(t._show)return!0;for(var n in e)if(!this.apply_filter(t,n))return!1;return!0},apply_filter:function(t,e){var n=this.filter_inputs[e].get(0);return!(n.opts.filter&&!n.opts.filter(this[n.opts.fieldname],t,n.opts,this))},apply_zero_filter:function(t,e,n,r){if(!r.show_zero){for(var o=0,a=r.columns.length;o<a;o++){var i=r.columns[o];if(i.formatter==r.currency_formatter&&!i.hidden&&(flt(e[i.field])>.001||flt(e[i.field])<-.001))return!0}return!1}return!0},show_zero_check:function(){var t=this;this.wrapper.bind("make",function(){t.wrapper.find(".show-zero").toggle(!0).find("input").click(function(){t.refresh()})})},is_default:function(t){return this[t]==this[t+"_default"]},date_formatter:function(t,e,n){return frappe.datetime.str_to_user(n)},currency_formatter:function(t,e,n,r,o){return isNaN(n)&&(n=""),repl('<div style="text-align: right; %(_style)s">%(value)s</div>',{_style:o._style||"",value:null==n||""===n?"":format_number(n)})},text_formatter:function(t,e,n,r,o){return repl('<span style="%(_style)s" title="%(esc_value)s">%(value)s</span>',{_style:o._style||"",esc_value:cstr(n).replace(/"/g,'\\"'),value:cstr(n)})},check_formatter:function(t,e,n,r,o){return repl('<input type="checkbox" data-id="%(id)s" \t\t\tclass="chart-check" %(checked)s>',{id:o.id,checked:o.checked?'checked="checked"':""})},apply_link_formatters:function(){$.each(this.columns,function(i,col){col.link_formatter&&(col.formatter=function(row,cell,value,columnDef,dataContext,for_print){if(!value)return"";if(for_print)return value;var me=frappe.cur_grid_report,html;if(dataContext._show)return repl('<span style="%(_style)s">%(value)s</span>',{_style:dataContext._style||"",value:value});var link_formatter=me.dataview_columns[cell].link_formatter;if(html=link_formatter.filter_input?repl("<a href=\"#\" \t\t\t\t\t\t\tonclick=\"frappe.cur_grid_report.set_filter('%(col_name)s', '%(value)s'); \t\t\t\t\t\t\t\tfrappe.cur_grid_report.refresh(); return false;\">\t\t\t\t\t\t\t%(value)s</a>",{value:value,col_name:link_formatter.filter_input,page_name:frappe.container.page.page_name}):value,link_formatter.open_btn){var doctype=link_formatter.doctype?eval(link_formatter.doctype):dataContext.doctype;html+=me.get_link_open_icon(doctype,value)}return html})})},get_link_open_icon:function(t,e){return repl(' <a href="#Form/%(doctype)s/%(name)s">\t\t\t<i class="fa fa-share" style="cursor: pointer;"></i></a>',{doctype:t,name:encodeURIComponent(e)})},make_date_range_columns:function(){this.columns=[];var t=this,e=this.filter_inputs.range.val();this.from_date=frappe.datetime.user_to_str(this.filter_inputs.from_date.val()),this.to_date=frappe.datetime.user_to_str(this.filter_inputs.to_date.val());var n=frappe.datetime.get_diff(this.to_date,this.from_date);t.column_map={},t.last_date=null;var r=function(e){t.columns.push({id:e,name:frappe.datetime.str_to_user(e),field:e,formatter:t.currency_formatter,width:100})},o=function(e){for(var o=0;o<=n;o++){var a=frappe.datetime.add_days(t.from_date,o);e||(e=function(){return!0}),e(a)&&r(a),t.last_date=a,t.columns.length&&(t.column_map[a]=t.columns[t.columns.length-1])}};"Daily"==e?o():"Weekly"==e?o(function(e){return!t.last_date||!(frappe.datetime.get_diff(e,t.from_date)%7)}):"Monthly"==e?o(function(e){return!t.last_date||frappe.datetime.str_to_obj(t.last_date).getMonth()!=frappe.datetime.str_to_obj(e).getMonth()}):"Quarterly"==e?o(function(e){return!t.last_date||1==frappe.datetime.str_to_obj(e).getDate()&&in_list([0,3,6,9],frappe.datetime.str_to_obj(e).getMonth())}):"Yearly"==e&&o(function(e){return!t.last_date||$.map(frappe.report_dump.data["Fiscal Year"],function(t){return e==t.year_start_date||null}).length}),$.each(this.columns,function(e,n){n.name=t.columns[e+1]?frappe.datetime.str_to_user(frappe.datetime.add_days(t.columns[e+1].id,-1)):frappe.datetime.str_to_user(t.to_date)})},trigger_refresh_on_change:function(t){var e=this;$.each(t,function(t,n){e.filter_inputs[n]&&e.filter_inputs[n].on("change",function(){e.refresh()})})}}),frappe.views.GridReportWithPlot=frappe.views.GridReport.extend({setup_chart:function(){if(in_list(["Daily","Weekly"],this.filter_inputs.range.val()))this.chart_area.toggle(!1);else{this.chart_area.toggle(!0);var t=this.get_chart_data?this.get_chart_data():null,e=this.wrapper.find(".chart")[0];this.chart=new Chart(e,{height:200,data:t,type:"line"})}},get_chart_data:function(){var t=this,e=[];$.each(t.columns,function(n,r){r.formatter!=t.currency_formatter||r.hidden||!1===r.plot||e.push(r.field)});var n={labels:e,datasets:[]};return $.each(this.data,function(t,r){if(r.checked){var o={};o.name=r.name,o.values=[],$.each(e,function(t,e){o.values.push(r[e])}),n.datasets.push(o)}}),n}}),frappe.views.TreeGridReport=frappe.views.GridReportWithPlot.extend({make_transaction_list:function(t,e){var n=this,r={};$.each(frappe.report_dump.data[e],function(t,e){r[e.parent]||(r[e.parent]=[]),r[e.parent].push(e)}),this.tl||(this.tl={}),this.tl[t]||(this.tl[t]=[]),$.each(frappe.report_dump.data[t],function(e,o){r[o.name]&&$.each(r[o.name],function(e,r){n.tl[t].push($.extend(copy_dict(o),r))})})},add_tree_grid_events:function(){var t=this;this.grid.onClick.subscribe(function(e,n){if($(e.target).hasClass("toggle")){var r=t.dataView.getItem(n.row);r&&(r._collapsed?r._collapsed=!1:r._collapsed=!0,t.dataView.updateItem(r.id,r)),e.stopImmediatePropagation()}})},tree_formatter:function(t,e,n,r,o){var a=frappe.cur_grid_report,i=a.data,s="<span style='display:inline-block;height:1px;width:"+15*o.indent+"px'></span>",l=a.dataView.getIdxById(o.id),c=a.tree_grid.formatter(o);return o.doctype&&(c+=a.get_link_open_icon(o.doctype,o.name)),i[l+1]&&i[l+1].indent>i[l].indent?o._collapsed?s+" <span class='toggle expand'></span>&nbsp;"+c:s+" <span class='toggle collapse'></span>&nbsp;"+c:s+" <span class='toggle'></span>&nbsp;"+c},tree_dataview_filter:function(t){var e=frappe.cur_grid_report;if(!e.apply_filters(t))return!1;for(var n=t[e.tree_grid.parent_field];n;){if(e.item_by_name[n]._collapsed)return!1;n=e.parent_map[n]}return!0},prepare_tree:function(t,e){var n=frappe.report_dump.data[e],r=frappe.report_dump.data[t],o=this,a={},i=n.map(function(t){return t.id});$.each(r,function(t,e){var n=e[o.tree_grid.parent_field];a[n]||(a[n]=[]),-1==i.indexOf(e.name)?a[n].push(e):frappe.msgprint(__("Ignoring Item {0}, because a group exists with the same name!",[e.name.bold()]))});var s=[];return $.each(n,function(t,e){e.is_group=!0,s.push(e),s=s.concat(a[e.name]||[])}),s},set_indent:function(){var t=this;$.each(this.data,function(e,n){var r=0,o=t.parent_map[n.name];if(o)for(;o;)r++,o=t.parent_map[o];n.indent=r})},export:function(){var t=frappe.msgprint($.format('<p>{0}</p>\t\t\t<p><input type="checkbox" name="with_groups" checked="checked"> {1}</p>\t\t\t<p><input type="checkbox" name="with_ledgers" checked="checked"> {2}</p>\t\t\t<p><button class="btn btn-primary"> {3}</button>',[__("Select To Download:"),__("With Groups"),__("With Ledgers"),__("Download")])),e=this;return $(t.body).find("button").click(function(){var n=$(t.body).find("[name='with_groups']").prop("checked"),r=$(t.body).find("[name='with_ledgers']").prop("checked"),o=frappe.slickgrid_tools.get_view_data(e.columns,e.dataView,function(t,e){if(n)for(var o=0;o<e.indent;o++)t[0]="   "+t[0];return!(!n||1!=e.is_group&&!e.is_group)||!(!r||1==e.is_group||e.is_group)});return frappe.tools.downloadify(o,["Report Manager","System Manager"],e.title),!1}),!1}}),frappe.templates.print_grid=' {% if title %} <h2>{{ __(title) }}</h2> <hr> {% endif %} {% if subtitle %} {{ subtitle }} <hr> {% endif %} <table class="table table-bordered">          <thead>         <tr>         {% for col in columns %}             {% if col.name && col._id !== "_check" %}             <th style="min-width: {{ col.minWidth }}px"                 {% if col.docfield && frappe.model.is_numeric_field(col.docfield) %}                     class="text-right"                 {% endif %}>{{ __(col.name) }}</th>             {% endif %}         {% endfor %}         </tr>     </thead>          <tbody>         {% for row in data %}             <tr>             {% for col in columns %}                 {% if col.name && col._id !== "_check" %}                      {% var value = col.fieldname ? row[col.fieldname] : row[col.id]; %}                      <td>                         {{ col.formatter                          ? col.formatter(row._index, col._index, value, col, row, true)                             : (col.docfield ? frappe.format(value, col.docfield) : value) }}                     </td>                 {% endif %}             {% endfor %}             </tr>         {% endfor %}     </tbody> </table> ',frappe.templates.print_tree='<!DOCTYPE html> <html lang="en">   <head>     <meta charset="utf-8">     <meta http-equiv="X-UA-Compatible" content="IE=edge">     <meta name="viewport" content="width=device-width, initial-scale=1">     <meta name="description" content="">     <meta name="author" content="">     <title>{{ title }}</title>     <link href="{{ base_url }}/assets/frappe/css/bootstrap.css" rel="stylesheet">  <link type="text/css" rel="stylesheet"   href="{{ base_url }}/assets/frappe/css/font-awesome.css">  <link rel="stylesheet" type="text/css" href="{{ base_url }}/assets/frappe/css/tree.css">   <style>   {{ print_css }}  </style>  <style>   .tree.opened::before,    .tree-node.opened::before,    .tree:last-child::after,    .tree-node:last-child::after {    z-index: 1;    border-left: 1px solid #d1d8dd;    background: none;   }   .tree a,   .tree-link {    text-decoration: none;    cursor: default;   }   .tree.opened > .tree-children > .tree-node > .tree-link::before,    .tree-node.opened > .tree-children > .tree-node > .tree-link::before {    border-top: 1px solid #d1d8dd;    z-index: 1;    background: none;   }   i.fa.fa-fw.fa-folder {    z-index: 2;    position: relative;   }   .tree:last-child::after, .tree-node:last-child::after {    display: none;   }   .tree-node-toolbar {    display: none;   }   i.octicon.octicon-primitive-dot.text-extra-muted {    width: 7px;    height: 7px;    border-radius: 50%;    background: #d1d8dd;    display: inline-block;    position: relative;    z-index: 2;   }    @media (max-width: 767px) {    ul.tree-children {     padding-left: 20px;    }   }  </style>   </head>   <body>    <div class="print-format-gutter">     {% if print_settings.repeat_header_footer %}    <div id="footer-html" class="visible-pdf">     {% if print_settings.letter_head && print_settings.letter_head.footer %}      <div class="letter-head-footer">       {{ print_settings.letter_head.footer }}      </div>     {% endif %}     <p class="text-center small page-number visible-pdf">      {{ __("Page {0} of {1}", [`<span class="page"></span>`, `<span class="topage"></span>`]) }}     </p>    </div>     {% endif %}      <div class="print-format {% if landscape %} landscape {% endif %}">      {% if print_settings.letter_head %}      <div {% if print_settings.repeat_header_footer %} id="header-html" class="hidden-pdf" {% endif %}>       <div class="letter-head">{{ print_settings.letter_head.header }}</div>      </div>     {% endif %}     <div class="tree opened">      {{ tree }}     </div>     </div>    </div>   </body> </html> ',exports.__moduleExports=clusterize_min,exports}({});
//# sourceMappingURL=report.min.js.map
